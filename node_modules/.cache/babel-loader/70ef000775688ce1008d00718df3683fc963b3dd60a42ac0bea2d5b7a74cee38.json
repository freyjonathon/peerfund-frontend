{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\n// src/features/wallet/PaymentMethod.jsx\nimport { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\nimport { fetchWallet, createDepositIntent, devConfirmDeposit } from '../wallet/walletApi';\n\n// ----- Stripe publishable key (CRA) -----\nimport { jsxDEV as _jsxDEV, Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\nfunction getToken() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, '');\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\n  return t || null;\n}\nfunction authHeaders() {\n  const t = getToken();\n  return t ? {\n    Authorization: `Bearer ${t}`\n  } : {};\n}\nlet cachedStripePromise;\nfunction getStripePromise() {\n  if (!pk) return null;\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\n  return cachedStripePromise;\n}\nexport default function PaymentMethodPage() {\n  _s();\n  var _wallet$availableCent, _wallet$pendingCents;\n  const [clientSecret, setClientSecret] = useState(null);\n  const [hasDefault, setHasDefault] = useState(false);\n  const [linking, setLinking] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n  const [loading, setLoading] = useState(true);\n\n  // Wallet & deposit\n  const [wallet, setWallet] = useState(null);\n  const [amount, setAmount] = useState('25.00');\n  const [depositing, setDepositing] = useState(false);\n\n  // Billing details (auto-filled)\n  const [fullName, setFullName] = useState('');\n  const [email, setEmail] = useState('');\n  const [editDetails, setEditDetails] = useState(false);\n  const stripePromise = useMemo(getStripePromise, [pk]);\n\n  // ---- bootstrap: hasDefault + wallet + profile name/email ----\n  useEffect(() => {\n    const ac = new AbortController();\n    (async () => {\n      try {\n        // 1) do we already have a default PM?\n        const r = await fetch('/api/payments/has-default-payment-method', {\n          headers: {\n            ...authHeaders()\n          },\n          signal: ac.signal\n        });\n        const d = r.ok ? await r.json() : {\n          hasDefault: false\n        };\n        setHasDefault(!!d.hasDefault);\n      } catch {\n        setHasDefault(false);\n      }\n\n      // 2) wallet sums\n      try {\n        setWallet(await fetchWallet());\n      } catch {}\n\n      // 3) profile for auto-fill (name/email)\n      try {\n        const p = await fetch('/api/users/profile', {\n          headers: {\n            ...authHeaders()\n          }\n        });\n        if (p.ok) {\n          const j = await p.json();\n          if (!fullName) setFullName(((j === null || j === void 0 ? void 0 : j.name) || '').trim());\n          if (!email) setEmail(((j === null || j === void 0 ? void 0 : j.email) || '').trim());\n        }\n      } catch {}\n      setLoading(false);\n    })();\n    return () => ac.abort();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  async function refreshWallet() {\n    try {\n      setWallet(await fetchWallet());\n    } catch {}\n  }\n  async function startBankLink() {\n    setLinking(true);\n    setErrorMsg('');\n    try {\n      if (!fullName.trim()) {\n        setErrorMsg('Please provide the account holder name.');\n        setEditDetails(true);\n        return;\n      }\n      const r = await fetch('/api/payments/create-setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        }\n      });\n      if (r.status === 401) {\n        // session expired: show inline message, don’t hard-redirect automatically\n        setErrorMsg('Your session expired. Please log in again, then retry linking your bank.');\n        return;\n      }\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to start bank link.');\n      const {\n        clientSecret\n      } = await r.json();\n      if (!clientSecret) throw new Error('No client_secret returned from server.');\n      setClientSecret(clientSecret);\n    } catch (e) {\n      setErrorMsg(e.message || 'Something went wrong starting bank link.');\n    } finally {\n      setLinking(false);\n    }\n  }\n  const showInputs = editDetails || !fullName.trim();\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 560,\n      margin: '0 auto',\n      padding: 16\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        marginTop: 0\n      },\n      children: \"Payment Method\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 7\n    }, this), !pk && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fef2f2',\n        border: '1px solid #fecaca',\n        color: '#7f1d1d',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: [\"Missing/invalid Stripe publishable key. Set\", ' ', /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"REACT_APP_STRIPE_PUBLISHABLE_KEY\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 16\n      }, this), ' ', \"in \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"p2p_contract_frontend/.env\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 14\n      }, this), \" and restart.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 9\n    }, this), errorMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fff7ed',\n        border: '1px solid #fed7aa',\n        color: '#7c2d12',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: errorMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 135,\n      columnNumber: 9\n    }, this), wallet && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#f1f5f9',\n        border: '1px solid #e2e8f0',\n        padding: 10,\n        borderRadius: 8,\n        marginBottom: 12,\n        fontSize: 14\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Wallet\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 145,\n        columnNumber: 11\n      }, this), \" \\u2014 Available: $\", (((_wallet$availableCent = wallet.availableCents) !== null && _wallet$availableCent !== void 0 ? _wallet$availableCent : 0) / 100).toFixed(2), ' ', \"\\u2022 Pending: $\", (((_wallet$pendingCents = wallet.pendingCents) !== null && _wallet$pendingCents !== void 0 ? _wallet$pendingCents : 0) / 100).toFixed(2)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 142,\n      columnNumber: 9\n    }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"Checking your payment method\\u2026\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 151,\n      columnNumber: 9\n    }, this) : /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          marginTop: 0\n        },\n        children: hasDefault ? 'Bank account on file for ACH debits.' : 'No bank account on file.'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 154,\n        columnNumber: 11\n      }, this), !hasDefault && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginBottom: 12\n        },\n        children: [!showInputs ? /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            alignItems: 'center',\n            gap: 12,\n            margin: '8px 0 12px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 14,\n              color: '#475569'\n            },\n            children: [\"Using \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: fullName || '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 166,\n              columnNumber: 27\n            }, this), email ? ` • ${email}` : '', ' ', \"from your profile.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"button\",\n            onClick: () => setEditDetails(true),\n            className: \"action-btn\",\n            style: {\n              padding: '6px 10px'\n            },\n            title: \"Edit billing details for bank link\",\n            children: \"Edit\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 17\n        }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'grid',\n            gap: 8,\n            margin: '8px 0 12px'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: fullName,\n            onChange: e => setFullName(e.target.value),\n            placeholder: \"Account holder full name\",\n            style: {\n              padding: '8px 10px',\n              border: '1px solid #e2e8f0',\n              borderRadius: 8\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"email\",\n            value: email,\n            onChange: e => setEmail(e.target.value),\n            placeholder: \"Email (optional)\",\n            style: {\n              padding: '8px 10px',\n              border: '1px solid #e2e8f0',\n              borderRadius: 8\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 19\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              onClick: () => setEditDetails(false),\n              className: \"action-btn\",\n              style: {\n                marginRight: 8\n              },\n              children: \"Done\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 197,\n              columnNumber: 21\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 196,\n            columnNumber: 19\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 181,\n          columnNumber: 17\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: startBankLink,\n          disabled: linking || !pk || !stripePromise || !fullName.trim(),\n          style: {\n            background: '#4f46e5',\n            color: '#fff',\n            border: '1px solid #4f46e5',\n            padding: '8px 14px',\n            borderRadius: 8,\n            cursor: linking || !fullName.trim() ? 'not-allowed' : 'pointer'\n          },\n          children: linking ? 'Starting…' : 'Link bank account'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 12,\n            color: '#64748b',\n            marginTop: 6\n          },\n          children: \"We\\u2019ll open a secure Stripe dialog to connect your bank.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 162,\n        columnNumber: 13\n      }, this), clientSecret && stripePromise && /*#__PURE__*/_jsxDEV(Elements, {\n        stripe: stripePromise,\n        children: /*#__PURE__*/_jsxDEV(BankLinkFlow, {\n          clientSecret: clientSecret,\n          fullName: fullName,\n          email: email,\n          onComplete: async () => {\n            setHasDefault(true);\n            setClientSecret(null);\n            await refreshWallet();\n          },\n          onError: setErrorMsg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 13\n      }, this), hasDefault && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          marginTop: 20,\n          padding: 12,\n          borderRadius: 8,\n          border: '1px solid #e2e8f0',\n          background: '#fff'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          style: {\n            margin: '0 0 8px'\n          },\n          children: \"Deposit to PeerFund balance\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 249,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          style: {\n            marginTop: 0,\n            color: '#475569'\n          },\n          children: \"We\\u2019ll debit your linked bank and add funds to your available balance.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 250,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(DepositBox, {\n          amount: amount,\n          setAmount: setAmount,\n          depositing: depositing,\n          setDepositing: setDepositing,\n          onSuccess: async () => {\n            await refreshWallet();\n            alert('Deposit initiated.');\n          },\n          onError: setErrorMsg\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 253,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 245,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 122,\n    columnNumber: 5\n  }, this);\n}\n\n/* ---------------- BankLinkFlow ---------------- */\n_s(PaymentMethodPage, \"a1SVJhq72mlYD1R2OqKAqbZTF3o=\");\n_c = PaymentMethodPage;\nfunction BankLinkFlow({\n  clientSecret,\n  fullName,\n  email,\n  onComplete,\n  onError\n}) {\n  _s2();\n  const stripe = useStripe();\n  const [working, setWorking] = useState(false);\n  async function handleLink() {\n    if (!stripe) {\n      onError === null || onError === void 0 ? void 0 : onError('Stripe not ready yet.');\n      return;\n    }\n    if (!fullName.trim()) {\n      onError === null || onError === void 0 ? void 0 : onError('Please enter the account holder name.');\n      return;\n    }\n    setWorking(true);\n    try {\n      // 1) Open Financial Connections\n      const {\n        error: collectError\n      } = await stripe.collectBankAccountForSetup({\n        clientSecret,\n        params: {\n          payment_method_type: 'us_bank_account',\n          payment_method_data: {\n            billing_details: {\n              name: fullName.trim(),\n              ...(email ? {\n                email\n              } : {})\n            }\n          }\n        }\n      });\n      if (collectError) throw collectError;\n\n      // 2) Confirm the SetupIntent\n      const {\n        setupIntent,\n        error: confirmError\n      } = await stripe.confirmUsBankAccountSetup(clientSecret);\n      if (confirmError) throw confirmError;\n\n      // 3) Status UX\n      if (setupIntent.status === 'succeeded') {\n        onComplete === null || onComplete === void 0 ? void 0 : onComplete();\n        alert('Bank account saved. ACH payments enabled.');\n      } else if (setupIntent.status === 'requires_action') {\n        const na = setupIntent.next_action;\n        if ((na === null || na === void 0 ? void 0 : na.type) === 'verify_with_microdeposits') {\n          alert('Bank linked. Micro-deposits will verify your account (1–2 business days).');\n        } else {\n          alert('Bank linked; additional verification required.');\n        }\n        onComplete === null || onComplete === void 0 ? void 0 : onComplete();\n      } else {\n        alert(`Setup in progress (status: ${setupIntent.status}).`);\n        onComplete === null || onComplete === void 0 ? void 0 : onComplete();\n      }\n    } catch (e) {\n      onError === null || onError === void 0 ? void 0 : onError((e === null || e === void 0 ? void 0 : e.message) || 'Failed to link bank account.');\n    } finally {\n      setWorking(false);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: 12\n    },\n    children: /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleLink,\n      disabled: !stripe || working,\n      style: {\n        background: '#10b981',\n        color: '#fff',\n        border: '1px solid #10b981',\n        padding: '8px 14px',\n        borderRadius: 8,\n        cursor: !stripe || working ? 'not-allowed' : 'pointer'\n      },\n      children: working ? 'Connecting…' : 'Connect and save bank'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 326,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 325,\n    columnNumber: 5\n  }, this);\n}\n_s2(BankLinkFlow, \"xI/djp9IF4sg6WO7GmySD1OaJqo=\", false, function () {\n  return [useStripe];\n});\n_c2 = BankLinkFlow;\nBankLinkFlow.propTypes = {\n  clientSecret: PropTypes.string.isRequired,\n  fullName: PropTypes.string.isRequired,\n  email: PropTypes.string,\n  onComplete: PropTypes.func,\n  onError: PropTypes.func\n};\n\n/* ---------------- DepositBox ---------------- */\n\nfunction DepositBox({\n  amount,\n  setAmount,\n  depositing,\n  setDepositing,\n  onSuccess,\n  onError\n}) {\n  _s3();\n  const stripe = useStripe();\n  async function handleDeposit() {\n    const n = Number(amount);\n    if (!Number.isFinite(n) || n <= 0) {\n      onError === null || onError === void 0 ? void 0 : onError('Enter a valid deposit amount.');\n      return;\n    }\n    setDepositing(true);\n    onError === null || onError === void 0 ? void 0 : onError('');\n    try {\n      const {\n        clientSecret,\n        ledgerId,\n        simulated\n      } = await createDepositIntent(n);\n      if (simulated) {\n        await devConfirmDeposit(ledgerId);\n        onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess();\n        return;\n      }\n      if (!stripe) throw new Error('Stripe not ready.');\n      const {\n        paymentIntent,\n        error\n      } = await stripe.confirmUsBankAccountPayment(clientSecret);\n      if (error) throw error;\n      const status = paymentIntent === null || paymentIntent === void 0 ? void 0 : paymentIntent.status;\n      if (status === 'succeeded' || status === 'processing') {\n        onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess();\n      } else if (status === 'requires_action') {\n        const na = paymentIntent.next_action;\n        if ((na === null || na === void 0 ? void 0 : na.type) === 'verify_with_microdeposits') {\n          alert('Deposit initiated. Funds complete after micro-deposit verification.');\n          onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess();\n        } else {\n          onError === null || onError === void 0 ? void 0 : onError('Additional action required to complete this deposit.');\n        }\n      } else {\n        onError === null || onError === void 0 ? void 0 : onError(`Deposit status: ${status || 'unknown'}.`);\n      }\n    } catch (e) {\n      onError === null || onError === void 0 ? void 0 : onError((e === null || e === void 0 ? void 0 : e.message) || 'Deposit failed.');\n    } finally {\n      setDepositing(false);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      gap: 8,\n      alignItems: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'center',\n        gap: 6\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"$\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 394,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        step: \"0.01\",\n        min: \"1\",\n        value: amount,\n        onChange: e => setAmount(e.target.value),\n        style: {\n          width: 120,\n          padding: '8px 10px',\n          border: '1px solid #e2e8f0',\n          borderRadius: 8\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 393,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleDeposit,\n      disabled: depositing,\n      style: {\n        background: '#4f46e5',\n        color: '#fff',\n        border: '1px solid #4f46e5',\n        padding: '8px 14px',\n        borderRadius: 8,\n        cursor: depositing ? 'not-allowed' : 'pointer'\n      },\n      children: depositing ? 'Processing…' : 'Deposit'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 402,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 392,\n    columnNumber: 5\n  }, this);\n}\n_s3(DepositBox, \"idaYC8DiWdfB9k82Pr6iCdOULZw=\", false, function () {\n  return [useStripe];\n});\n_c3 = DepositBox;\nDepositBox.propTypes = {\n  amount: PropTypes.string.isRequired,\n  setAmount: PropTypes.func.isRequired,\n  depositing: PropTypes.bool.isRequired,\n  setDepositing: PropTypes.func.isRequired,\n  onSuccess: PropTypes.func,\n  onError: PropTypes.func\n};\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"PaymentMethodPage\");\n$RefreshReg$(_c2, \"BankLinkFlow\");\n$RefreshReg$(_c3, \"DepositBox\");","map":{"version":3,"names":["useEffect","useMemo","useState","PropTypes","loadStripe","Elements","useStripe","fetchWallet","createDepositIntent","devConfirmDeposit","jsxDEV","_jsxDEV","Fragment","_Fragment","rawPk","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","trim","pk","test","getToken","t","localStorage","getItem","replace","toLowerCase","startsWith","slice","authHeaders","Authorization","cachedStripePromise","getStripePromise","PaymentMethodPage","_s","_wallet$availableCent","_wallet$pendingCents","clientSecret","setClientSecret","hasDefault","setHasDefault","linking","setLinking","errorMsg","setErrorMsg","loading","setLoading","wallet","setWallet","amount","setAmount","depositing","setDepositing","fullName","setFullName","email","setEmail","editDetails","setEditDetails","stripePromise","ac","AbortController","r","fetch","headers","signal","d","ok","json","p","j","name","abort","refreshWallet","startBankLink","method","status","Error","text","e","message","showInputs","style","maxWidth","margin","padding","children","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","background","border","color","borderRadius","marginBottom","fontSize","availableCents","toFixed","pendingCents","display","alignItems","gap","type","onClick","className","title","value","onChange","target","placeholder","marginRight","disabled","cursor","stripe","BankLinkFlow","onComplete","onError","DepositBox","onSuccess","alert","_c","_s2","working","setWorking","handleLink","error","collectError","collectBankAccountForSetup","params","payment_method_type","payment_method_data","billing_details","setupIntent","confirmError","confirmUsBankAccountSetup","na","next_action","_c2","propTypes","string","isRequired","func","_s3","handleDeposit","n","Number","isFinite","ledgerId","simulated","paymentIntent","confirmUsBankAccountPayment","step","min","width","_c3","bool","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx"],"sourcesContent":["// src/features/wallet/PaymentMethod.jsx\r\nimport { useEffect, useMemo, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\r\nimport { fetchWallet, createDepositIntent, devConfirmDeposit } from '../wallet/walletApi';\r\n\r\n// ----- Stripe publishable key (CRA) -----\r\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\r\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\r\n\r\nfunction getToken() {\r\n  let t = localStorage.getItem('token') || '';\r\n  t = t.replace(/^\"|\"$/g, '');\r\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\r\n  return t || null;\r\n}\r\nfunction authHeaders() {\r\n  const t = getToken();\r\n  return t ? { Authorization: `Bearer ${t}` } : {};\r\n}\r\n\r\nlet cachedStripePromise;\r\nfunction getStripePromise() {\r\n  if (!pk) return null;\r\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\r\n  return cachedStripePromise;\r\n}\r\n\r\nexport default function PaymentMethodPage() {\r\n  const [clientSecret, setClientSecret] = useState(null);\r\n  const [hasDefault, setHasDefault] = useState(false);\r\n  const [linking, setLinking] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Wallet & deposit\r\n  const [wallet, setWallet] = useState(null);\r\n  const [amount, setAmount] = useState('25.00');\r\n  const [depositing, setDepositing] = useState(false);\r\n\r\n  // Billing details (auto-filled)\r\n  const [fullName, setFullName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n  const [editDetails, setEditDetails] = useState(false);\r\n\r\n  const stripePromise = useMemo(getStripePromise, [pk]);\r\n\r\n  // ---- bootstrap: hasDefault + wallet + profile name/email ----\r\n  useEffect(() => {\r\n    const ac = new AbortController();\r\n    (async () => {\r\n      try {\r\n        // 1) do we already have a default PM?\r\n        const r = await fetch('/api/payments/has-default-payment-method', {\r\n          headers: { ...authHeaders() },\r\n          signal: ac.signal,\r\n        });\r\n        const d = r.ok ? await r.json() : { hasDefault: false };\r\n        setHasDefault(!!d.hasDefault);\r\n      } catch { setHasDefault(false); }\r\n\r\n      // 2) wallet sums\r\n      try { setWallet(await fetchWallet()); } catch {}\r\n\r\n      // 3) profile for auto-fill (name/email)\r\n      try {\r\n        const p = await fetch('/api/users/profile', { headers: { ...authHeaders() } });\r\n        if (p.ok) {\r\n          const j = await p.json();\r\n          if (!fullName) setFullName((j?.name || '').trim());\r\n          if (!email) setEmail((j?.email || '').trim());\r\n        }\r\n      } catch {}\r\n\r\n      setLoading(false);\r\n    })();\r\n    return () => ac.abort();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function refreshWallet() {\r\n    try { setWallet(await fetchWallet()); } catch {}\r\n  }\r\n\r\n  async function startBankLink() {\r\n    setLinking(true);\r\n    setErrorMsg('');\r\n    try {\r\n      if (!fullName.trim()) {\r\n        setErrorMsg('Please provide the account holder name.');\r\n        setEditDetails(true);\r\n        return;\r\n      }\r\n\r\n      const r = await fetch('/api/payments/create-setup-intent', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      });\r\n\r\n      if (r.status === 401) {\r\n        // session expired: show inline message, don’t hard-redirect automatically\r\n        setErrorMsg('Your session expired. Please log in again, then retry linking your bank.');\r\n        return;\r\n      }\r\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to start bank link.');\r\n\r\n      const { clientSecret } = await r.json();\r\n      if (!clientSecret) throw new Error('No client_secret returned from server.');\r\n\r\n      setClientSecret(clientSecret);\r\n    } catch (e) {\r\n      setErrorMsg(e.message || 'Something went wrong starting bank link.');\r\n    } finally {\r\n      setLinking(false);\r\n    }\r\n  }\r\n\r\n  const showInputs = editDetails || !fullName.trim();\r\n\r\n  return (\r\n    <div style={{ maxWidth: 560, margin: '0 auto', padding: 16 }}>\r\n      <h2 style={{ marginTop: 0 }}>Payment Method</h2>\r\n\r\n      {!pk && (\r\n        <div style={{ background:'#fef2f2', border:'1px solid #fecaca', color:'#7f1d1d',\r\n                      padding:'10px 12px', borderRadius:8, marginBottom:12 }}>\r\n          Missing/invalid Stripe publishable key. Set\r\n          {' '}<code>REACT_APP_STRIPE_PUBLISHABLE_KEY</code>{' '}\r\n          in <code>p2p_contract_frontend/.env</code> and restart.\r\n        </div>\r\n      )}\r\n\r\n      {errorMsg && (\r\n        <div style={{ background:'#fff7ed', border:'1px solid #fed7aa', color:'#7c2d12',\r\n                      padding:'10px 12px', borderRadius:8, marginBottom:12 }}>\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n\r\n      {wallet && (\r\n        <div style={{\r\n          background:'#f1f5f9', border:'1px solid #e2e8f0', padding:10,\r\n          borderRadius:8, marginBottom:12, fontSize:14 }}>\r\n          <strong>Wallet</strong> — Available: ${((wallet.availableCents ?? 0)/100).toFixed(2)}\r\n          {' '}• Pending: ${((wallet.pendingCents ?? 0)/100).toFixed(2)}\r\n        </div>\r\n      )}\r\n\r\n      {loading ? (\r\n        <p>Checking your payment method…</p>\r\n      ) : (\r\n        <>\r\n          <p style={{ marginTop: 0 }}>\r\n            {hasDefault\r\n              ? 'Bank account on file for ACH debits.'\r\n              : 'No bank account on file.'}\r\n          </p>\r\n\r\n          {/* Minimal “Link” section */}\r\n          {!hasDefault && (\r\n            <div style={{ marginBottom: 12 }}>\r\n              {!showInputs ? (\r\n                <div style={{ display:'flex', alignItems:'center', gap:12, margin:'8px 0 12px' }}>\r\n                  <div style={{ fontSize:14, color:'#475569' }}>\r\n                    Using <strong>{fullName || '—'}</strong>\r\n                    {email ? ` • ${email}` : ''}\r\n                    {' '}from your profile.\r\n                  </div>\r\n                  <button\r\n                    type=\"button\"\r\n                    onClick={() => setEditDetails(true)}\r\n                    className=\"action-btn\"\r\n                    style={{ padding:'6px 10px' }}\r\n                    title=\"Edit billing details for bank link\"\r\n                  >\r\n                    Edit\r\n                  </button>\r\n                </div>\r\n              ) : (\r\n                <div style={{ display:'grid', gap:8, margin:'8px 0 12px' }}>\r\n                  <input\r\n                    type=\"text\"\r\n                    value={fullName}\r\n                    onChange={(e) => setFullName(e.target.value)}\r\n                    placeholder=\"Account holder full name\"\r\n                    style={{ padding:'8px 10px', border:'1px solid #e2e8f0', borderRadius:8 }}\r\n                  />\r\n                  <input\r\n                    type=\"email\"\r\n                    value={email}\r\n                    onChange={(e) => setEmail(e.target.value)}\r\n                    placeholder=\"Email (optional)\"\r\n                    style={{ padding:'8px 10px', border:'1px solid #e2e8f0', borderRadius:8 }}\r\n                  />\r\n                  <div>\r\n                    <button\r\n                      type=\"button\"\r\n                      onClick={() => setEditDetails(false)}\r\n                      className=\"action-btn\"\r\n                      style={{ marginRight:8 }}\r\n                    >\r\n                      Done\r\n                    </button>\r\n                  </div>\r\n                </div>\r\n              )}\r\n\r\n              <button\r\n                onClick={startBankLink}\r\n                disabled={linking || !pk || !stripePromise || !fullName.trim()}\r\n                style={{\r\n                  background:'#4f46e5', color:'#fff', border:'1px solid #4f46e5',\r\n                  padding:'8px 14px', borderRadius:8,\r\n                  cursor: (linking || !fullName.trim()) ? 'not-allowed' : 'pointer',\r\n                }}\r\n              >\r\n                {linking ? 'Starting…' : 'Link bank account'}\r\n              </button>\r\n              <div style={{ fontSize:12, color:'#64748b', marginTop:6 }}>\r\n                We’ll open a secure Stripe dialog to connect your bank.\r\n              </div>\r\n            </div>\r\n          )}\r\n\r\n          {/* Stripe bank link confirmation UI */}\r\n          {clientSecret && stripePromise && (\r\n            <Elements stripe={stripePromise}>\r\n              <BankLinkFlow\r\n                clientSecret={clientSecret}\r\n                fullName={fullName}\r\n                email={email}\r\n                onComplete={async () => {\r\n                  setHasDefault(true);\r\n                  setClientSecret(null);\r\n                  await refreshWallet();\r\n                }}\r\n                onError={setErrorMsg}\r\n              />\r\n            </Elements>\r\n          )}\r\n\r\n          {/* Deposit panel appears once a default PM exists */}\r\n          {hasDefault && (\r\n            <div style={{\r\n              marginTop:20, padding:12, borderRadius:8,\r\n              border:'1px solid #e2e8f0', background:'#fff'\r\n            }}>\r\n              <h3 style={{ margin:'0 0 8px' }}>Deposit to PeerFund balance</h3>\r\n              <p style={{ marginTop:0, color:'#475569' }}>\r\n                We’ll debit your linked bank and add funds to your available balance.\r\n              </p>\r\n              <DepositBox\r\n                amount={amount}\r\n                setAmount={setAmount}\r\n                depositing={depositing}\r\n                setDepositing={setDepositing}\r\n                onSuccess={async () => {\r\n                  await refreshWallet();\r\n                  alert('Deposit initiated.');\r\n                }}\r\n                onError={setErrorMsg}\r\n              />\r\n            </div>\r\n          )}\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ---------------- BankLinkFlow ---------------- */\r\n\r\nfunction BankLinkFlow({ clientSecret, fullName, email, onComplete, onError }) {\r\n  const stripe = useStripe();\r\n  const [working, setWorking] = useState(false);\r\n\r\n  async function handleLink() {\r\n    if (!stripe) { onError?.('Stripe not ready yet.'); return; }\r\n    if (!fullName.trim()) { onError?.('Please enter the account holder name.'); return; }\r\n\r\n    setWorking(true);\r\n    try {\r\n      // 1) Open Financial Connections\r\n      const { error: collectError } = await stripe.collectBankAccountForSetup({\r\n        clientSecret,\r\n        params: {\r\n          payment_method_type: 'us_bank_account',\r\n          payment_method_data: {\r\n            billing_details: { name: fullName.trim(), ...(email ? { email } : {}) },\r\n          },\r\n        },\r\n      });\r\n      if (collectError) throw collectError;\r\n\r\n      // 2) Confirm the SetupIntent\r\n      const { setupIntent, error: confirmError } =\r\n        await stripe.confirmUsBankAccountSetup(clientSecret);\r\n      if (confirmError) throw confirmError;\r\n\r\n      // 3) Status UX\r\n      if (setupIntent.status === 'succeeded') {\r\n        onComplete?.();\r\n        alert('Bank account saved. ACH payments enabled.');\r\n      } else if (setupIntent.status === 'requires_action') {\r\n        const na = setupIntent.next_action;\r\n        if (na?.type === 'verify_with_microdeposits') {\r\n          alert('Bank linked. Micro-deposits will verify your account (1–2 business days).');\r\n        } else {\r\n          alert('Bank linked; additional verification required.');\r\n        }\r\n        onComplete?.();\r\n      } else {\r\n        alert(`Setup in progress (status: ${setupIntent.status}).`);\r\n        onComplete?.();\r\n      }\r\n    } catch (e) {\r\n      onError?.(e?.message || 'Failed to link bank account.');\r\n    } finally {\r\n      setWorking(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ marginTop: 12 }}>\r\n      <button\r\n        onClick={handleLink}\r\n        disabled={!stripe || working}\r\n        style={{\r\n          background:'#10b981', color:'#fff', border:'1px solid #10b981',\r\n          padding:'8px 14px', borderRadius:8,\r\n          cursor: !stripe || working ? 'not-allowed' : 'pointer',\r\n        }}\r\n      >\r\n        {working ? 'Connecting…' : 'Connect and save bank'}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nBankLinkFlow.propTypes = {\r\n  clientSecret: PropTypes.string.isRequired,\r\n  fullName: PropTypes.string.isRequired,\r\n  email: PropTypes.string,\r\n  onComplete: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n\r\n/* ---------------- DepositBox ---------------- */\r\n\r\nfunction DepositBox({ amount, setAmount, depositing, setDepositing, onSuccess, onError }) {\r\n  const stripe = useStripe();\r\n\r\n  async function handleDeposit() {\r\n    const n = Number(amount);\r\n    if (!Number.isFinite(n) || n <= 0) { onError?.('Enter a valid deposit amount.'); return; }\r\n    setDepositing(true); onError?.('');\r\n    try {\r\n      const { clientSecret, ledgerId, simulated } = await createDepositIntent(n);\r\n      if (simulated) {\r\n        await devConfirmDeposit(ledgerId);\r\n        onSuccess?.();\r\n        return;\r\n      }\r\n      if (!stripe) throw new Error('Stripe not ready.');\r\n      const { paymentIntent, error } =\r\n        await stripe.confirmUsBankAccountPayment(clientSecret);\r\n      if (error) throw error;\r\n\r\n      const status = paymentIntent?.status;\r\n      if (status === 'succeeded' || status === 'processing') {\r\n        onSuccess?.();\r\n      } else if (status === 'requires_action') {\r\n        const na = paymentIntent.next_action;\r\n        if (na?.type === 'verify_with_microdeposits') {\r\n          alert('Deposit initiated. Funds complete after micro-deposit verification.');\r\n          onSuccess?.();\r\n        } else {\r\n          onError?.('Additional action required to complete this deposit.');\r\n        }\r\n      } else {\r\n        onError?.(`Deposit status: ${status || 'unknown'}.`);\r\n      }\r\n    } catch (e) {\r\n      onError?.(e?.message || 'Deposit failed.');\r\n    } finally {\r\n      setDepositing(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ display:'flex', gap:8, alignItems:'center' }}>\r\n      <div style={{ display:'flex', alignItems:'center', gap:6 }}>\r\n        <span>$</span>\r\n        <input\r\n          type=\"number\" step=\"0.01\" min=\"1\"\r\n          value={amount}\r\n          onChange={(e) => setAmount(e.target.value)}\r\n          style={{ width:120, padding:'8px 10px', border:'1px solid #e2e8f0', borderRadius:8 }}\r\n        />\r\n      </div>\r\n      <button\r\n        onClick={handleDeposit}\r\n        disabled={depositing}\r\n        style={{\r\n          background:'#4f46e5', color:'#fff', border:'1px solid #4f46e5',\r\n          padding:'8px 14px', borderRadius:8,\r\n          cursor: depositing ? 'not-allowed' : 'pointer',\r\n        }}\r\n      >\r\n        {depositing ? 'Processing…' : 'Deposit'}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nDepositBox.propTypes = {\r\n  amount: PropTypes.string.isRequired,\r\n  setAmount: PropTypes.func.isRequired,\r\n  depositing: PropTypes.bool.isRequired,\r\n  setDepositing: PropTypes.func.isRequired,\r\n  onSuccess: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}