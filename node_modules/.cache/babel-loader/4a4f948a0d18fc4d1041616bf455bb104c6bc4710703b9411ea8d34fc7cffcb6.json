{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/features/wallet/PaymentMethod.jsx\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\n\n/* ---------------- Stripe publishable key ---------------- */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\n\n/* ---------------- Auth header helpers ---------------- */\nfunction getToken() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, '');\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\n  return t || null;\n}\nfunction authHeaders() {\n  const t = getToken();\n  return t ? {\n    Authorization: `Bearer ${t}`\n  } : {};\n}\n\n/* ---------------- Stripe init (cached) ---------------- */\nlet cachedStripePromise;\nfunction getStripePromise() {\n  if (!pk) return null;\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\n  return cachedStripePromise;\n}\n\n/* ================================================================== */\n/*                     One-bank Setup / Management                     */\n/* ================================================================== */\n\nexport default function PaymentMethodPage() {\n  _s();\n  const [clientSecret, setClientSecret] = useState(null);\n  const [currentPM, setCurrentPM] = useState(null);\n  const [linking, setLinking] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n  const [loading, setLoading] = useState(true);\n  const [fullName, setFullName] = useState('');\n  const [email, setEmail] = useState('');\n  const stripePromise = useMemo(getStripePromise, [pk]);\n  useEffect(() => {\n    const ac = new AbortController();\n    (async () => {\n      try {\n        try {\n          const prof = await fetch('/api/users/profile', {\n            headers: {\n              ...authHeaders()\n            },\n            signal: ac.signal,\n            cache: 'no-store'\n          });\n          if (prof.ok) {\n            const u = await prof.json();\n            if (u !== null && u !== void 0 && u.name) setFullName(u.name);\n            if (u !== null && u !== void 0 && u.email) setEmail(u.email);\n          }\n        } catch {}\n        await refreshPrimary(ac.signal);\n      } finally {\n        setLoading(false);\n      }\n    })();\n    return () => ac.abort();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  async function refreshPrimary(signal) {\n    try {\n      const r = await fetch(`/api/payment-method/mine?t=${Date.now()}`, {\n        headers: {\n          ...authHeaders()\n        },\n        signal,\n        cache: 'no-store'\n      });\n      if (!r.ok) {\n        setCurrentPM(null);\n        return;\n      }\n      const data = await r.json();\n      // Be tolerant to different shapes: {items:[...]} or just [...]\n      const list = Array.isArray(data) ? data : Array.isArray(data === null || data === void 0 ? void 0 : data.items) ? data.items : [];\n      // Log once to help debug if needed\n      console.debug('payment-method/mine response:', data);\n      const primary = list.find(x => x.isDefault) || list[0] || null;\n      setCurrentPM(primary || null);\n    } catch (e) {\n      console.error('refreshPrimary error:', e);\n      setCurrentPM(null);\n    }\n  }\n  async function startBankLink() {\n    setLinking(true);\n    setErrorMsg('');\n    try {\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        },\n        cache: 'no-store'\n      });\n      if (r.status === 401) {\n        setErrorMsg('Your session expired. Please log in again, then return here.');\n        return;\n      }\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\n      const {\n        client_secret\n      } = await r.json();\n      if (!client_secret) throw new Error('No client_secret returned from server.');\n      setClientSecret(client_secret); // triggers auto-start flow\n    } catch (e) {\n      setErrorMsg(e.message || 'Could not start bank link.');\n    } finally {\n      setLinking(false);\n    }\n  }\n  const hasPM = !!currentPM;\n  const stripeReady = !!pk && !!stripePromise;\n  const disabledBtn = linking || !stripeReady || !hasPM && !fullName;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 720,\n      margin: '0 auto',\n      padding: 16\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        marginTop: 0\n      },\n      children: \"Payment Method\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this), !pk && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fef2f2',\n        border: '1px solid #fecaca',\n        color: '#7f1d1d',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: [\"Missing Stripe publishable key. Add \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"REACT_APP_STRIPE_PUBLISHABLE_KEY\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 47\n      }, this), \" to your \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \".env\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 135,\n        columnNumber: 101\n      }, this), \".\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 131,\n      columnNumber: 9\n    }, this), errorMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fff7ed',\n        border: '1px solid #fed7aa',\n        color: '#7c2d12',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: errorMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 140,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      style: {\n        border: '1px solid #e2e8f0',\n        borderRadius: 12,\n        background: '#fff',\n        padding: 14,\n        opacity: loading ? 0.7 : 1\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          gap: 12\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 800,\n              fontSize: 16,\n              marginBottom: 4\n            },\n            children: hasPM ? (currentPM === null || currentPM === void 0 ? void 0 : currentPM.brand) || 'Bank account' : 'No bank account on file'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 13,\n              color: '#475569',\n              marginBottom: 6\n            },\n            children: hasPM ? currentPM !== null && currentPM !== void 0 && currentPM.last4 ? `•••• ${currentPM.last4}` : 'Linked — pending details' : 'Link your bank to send and receive money on PeerFund.'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 157,\n            columnNumber: 13\n          }, this), hasPM && /*#__PURE__*/_jsxDEV(\"small\", {\n            style: {\n              color: '#64748b'\n            },\n            children: [\"Used for \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"both\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 164,\n              columnNumber: 26\n            }, this), \" funding and payouts. Updating replaces your current bank.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 163,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 153,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: startBankLink,\n            disabled: disabledBtn,\n            style: {\n              background: '#4f46e5',\n              color: '#fff',\n              border: '1px solid #4f46e5',\n              padding: '10px 14px',\n              borderRadius: 10,\n              fontWeight: 800,\n              cursor: disabledBtn ? 'not-allowed' : 'pointer',\n              whiteSpace: 'nowrap'\n            },\n            children: hasPM ? linking ? 'Starting…' : 'Update bank account' : linking ? 'Starting…' : 'Link bank account'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 170,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => refreshPrimary(),\n            style: {\n              background: '#fff',\n              border: '1px solid #e2e8f0',\n              padding: '10px 12px',\n              borderRadius: 10,\n              fontWeight: 600,\n              color: '#334155'\n            },\n            children: \"Refresh\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 182,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 169,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 9\n      }, this), !hasPM && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gap: 8,\n          marginTop: 12,\n          background: '#fafafa',\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          padding: 10\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 14,\n            color: '#6b7280'\n          },\n          children: \"Account holder\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 200,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: fullName,\n          onChange: e => setFullName(e.target.value),\n          placeholder: \"Account holder full name\",\n          style: {\n            padding: '8px 10px',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 201,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"email\",\n          value: email,\n          onChange: e => setEmail(e.target.value),\n          placeholder: \"Email (optional, recommended)\",\n          style: {\n            padding: '8px 10px',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n          style: {\n            color: '#6b7280'\n          },\n          children: \"We pass this to Stripe only to label your bank method.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 215,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 196,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 7\n    }, this), clientSecret && stripePromise && /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      children: /*#__PURE__*/_jsxDEV(BankLinkFlow, {\n        clientSecret: clientSecret,\n        fullName: fullName,\n        email: email,\n        onSaved: async () => {\n          setClientSecret(null);\n          await refreshPrimary();\n        },\n        onError: msg => {\n          setClientSecret(null);\n          setErrorMsg(msg);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 224,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 5\n  }, this);\n}\n\n/* ---------------- Auto-run link/confirm/save flow ---------------- */\n_s(PaymentMethodPage, \"wwQ6xH4kjrz7TkJcANY4ZnWfUSg=\");\n_c = PaymentMethodPage;\nfunction BankLinkFlow({\n  clientSecret,\n  fullName,\n  email,\n  onSaved,\n  onError\n}) {\n  _s2();\n  const stripe = useStripe();\n  const [working, setWorking] = useState(true);\n  const startedRef = useRef(false);\n  async function saveToBackend(paymentMethodId) {\n    const r = await fetch('/api/payment-method/save', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...authHeaders()\n      },\n      body: JSON.stringify({\n        paymentMethodId,\n        makeDefault: true,\n        useForLoans: true\n      }),\n      cache: 'no-store'\n    });\n    if (!r.ok) {\n      const t = await r.text().catch(() => '');\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\n    }\n  }\n  useEffect(() => {\n    if (!stripe || !clientSecret || startedRef.current) return;\n    if (!fullName) {\n      onError === null || onError === void 0 ? void 0 : onError('Please enter the account holder’s full name.');\n      return;\n    }\n    startedRef.current = true;\n    (async () => {\n      try {\n        const {\n          error: collectError\n        } = await stripe.collectBankAccountForSetup({\n          clientSecret,\n          params: {\n            payment_method_type: 'us_bank_account',\n            payment_method_data: {\n              billing_details: {\n                name: fullName,\n                ...(email ? {\n                  email\n                } : {})\n              }\n            }\n          }\n        });\n        if (collectError) throw collectError;\n        const {\n          setupIntent,\n          error: confirmError\n        } = await stripe.confirmUsBankAccountSetup(clientSecret);\n        if (confirmError) throw confirmError;\n        const pmId = setupIntent === null || setupIntent === void 0 ? void 0 : setupIntent.payment_method;\n        if (!pmId) throw new Error('Missing payment method id from Stripe.');\n        await saveToBackend(pmId);\n        onSaved === null || onSaved === void 0 ? void 0 : onSaved(); // parent will refresh and show brand/last4\n      } catch (e) {\n        onError === null || onError === void 0 ? void 0 : onError((e === null || e === void 0 ? void 0 : e.message) || 'Failed to link bank account.');\n      } finally {\n        setWorking(false);\n      }\n    })();\n  }, [stripe, clientSecret, fullName, email, onSaved, onError]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: 12,\n      background: '#f8fafc',\n      border: '1px solid #e2e8f0',\n      borderRadius: 8,\n      padding: '10px 12px',\n      fontSize: 14,\n      color: '#334155'\n    },\n    children: working ? 'Opening secure bank link…' : 'Done.'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 307,\n    columnNumber: 5\n  }, this);\n}\n_s2(BankLinkFlow, \"tZ3Ll7qnc9kvFmxnNvnenfVp1QY=\", false, function () {\n  return [useStripe];\n});\n_c2 = BankLinkFlow;\nBankLinkFlow.propTypes = {\n  clientSecret: PropTypes.string.isRequired,\n  fullName: PropTypes.string.isRequired,\n  email: PropTypes.string,\n  onSaved: PropTypes.func,\n  onError: PropTypes.func\n};\nvar _c, _c2;\n$RefreshReg$(_c, \"PaymentMethodPage\");\n$RefreshReg$(_c2, \"BankLinkFlow\");","map":{"version":3,"names":["useEffect","useMemo","useRef","useState","PropTypes","loadStripe","Elements","useStripe","jsxDEV","_jsxDEV","rawPk","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","trim","pk","test","getToken","t","localStorage","getItem","replace","toLowerCase","startsWith","slice","authHeaders","Authorization","cachedStripePromise","getStripePromise","PaymentMethodPage","_s","clientSecret","setClientSecret","currentPM","setCurrentPM","linking","setLinking","errorMsg","setErrorMsg","loading","setLoading","fullName","setFullName","email","setEmail","stripePromise","ac","AbortController","prof","fetch","headers","signal","cache","ok","u","json","name","refreshPrimary","abort","r","Date","now","data","list","Array","isArray","items","console","debug","primary","find","x","isDefault","e","error","startBankLink","method","status","Error","text","client_secret","message","hasPM","stripeReady","disabledBtn","style","maxWidth","margin","padding","children","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","background","border","color","borderRadius","marginBottom","opacity","display","justifyContent","alignItems","gap","fontWeight","fontSize","brand","last4","onClick","disabled","cursor","whiteSpace","type","value","onChange","target","placeholder","stripe","BankLinkFlow","onSaved","onError","msg","_c","_s2","working","setWorking","startedRef","saveToBackend","paymentMethodId","body","JSON","stringify","makeDefault","useForLoans","catch","current","collectError","collectBankAccountForSetup","params","payment_method_type","payment_method_data","billing_details","setupIntent","confirmError","confirmUsBankAccountSetup","pmId","payment_method","_c2","propTypes","string","isRequired","func","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx"],"sourcesContent":["// src/features/wallet/PaymentMethod.jsx\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\r\n\r\n/* ---------------- Stripe publishable key ---------------- */\r\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\r\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\r\n\r\n/* ---------------- Auth header helpers ---------------- */\r\nfunction getToken() {\r\n  let t = localStorage.getItem('token') || '';\r\n  t = t.replace(/^\"|\"$/g, '');\r\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\r\n  return t || null;\r\n}\r\nfunction authHeaders() {\r\n  const t = getToken();\r\n  return t ? { Authorization: `Bearer ${t}` } : {};\r\n}\r\n\r\n/* ---------------- Stripe init (cached) ---------------- */\r\nlet cachedStripePromise;\r\nfunction getStripePromise() {\r\n  if (!pk) return null;\r\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\r\n  return cachedStripePromise;\r\n}\r\n\r\n/* ================================================================== */\r\n/*                     One-bank Setup / Management                     */\r\n/* ================================================================== */\r\n\r\nexport default function PaymentMethodPage() {\r\n  const [clientSecret, setClientSecret] = useState(null);\r\n  const [currentPM, setCurrentPM] = useState(null);\r\n\r\n  const [linking, setLinking] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [fullName, setFullName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n\r\n  const stripePromise = useMemo(getStripePromise, [pk]);\r\n\r\n  useEffect(() => {\r\n    const ac = new AbortController();\r\n    (async () => {\r\n      try {\r\n        try {\r\n          const prof = await fetch('/api/users/profile', {\r\n            headers: { ...authHeaders() },\r\n            signal: ac.signal,\r\n            cache: 'no-store',\r\n          });\r\n          if (prof.ok) {\r\n            const u = await prof.json();\r\n            if (u?.name) setFullName(u.name);\r\n            if (u?.email) setEmail(u.email);\r\n          }\r\n        } catch {}\r\n        await refreshPrimary(ac.signal);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n    return () => ac.abort();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function refreshPrimary(signal) {\r\n    try {\r\n      const r = await fetch(`/api/payment-method/mine?t=${Date.now()}`, {\r\n        headers: { ...authHeaders() },\r\n        signal,\r\n        cache: 'no-store',\r\n      });\r\n      if (!r.ok) {\r\n        setCurrentPM(null);\r\n        return;\r\n      }\r\n      const data = await r.json();\r\n      // Be tolerant to different shapes: {items:[...]} or just [...]\r\n      const list = Array.isArray(data) ? data : Array.isArray(data?.items) ? data.items : [];\r\n      // Log once to help debug if needed\r\n      console.debug('payment-method/mine response:', data);\r\n\r\n      const primary = list.find((x) => x.isDefault) || list[0] || null;\r\n      setCurrentPM(primary || null);\r\n    } catch (e) {\r\n      console.error('refreshPrimary error:', e);\r\n      setCurrentPM(null);\r\n    }\r\n  }\r\n\r\n  async function startBankLink() {\r\n    setLinking(true);\r\n    setErrorMsg('');\r\n    try {\r\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n        cache: 'no-store',\r\n      });\r\n      if (r.status === 401) {\r\n        setErrorMsg('Your session expired. Please log in again, then return here.');\r\n        return;\r\n      }\r\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\r\n      const { client_secret } = await r.json();\r\n      if (!client_secret) throw new Error('No client_secret returned from server.');\r\n      setClientSecret(client_secret); // triggers auto-start flow\r\n    } catch (e) {\r\n      setErrorMsg(e.message || 'Could not start bank link.');\r\n    } finally {\r\n      setLinking(false);\r\n    }\r\n  }\r\n\r\n  const hasPM = !!currentPM;\r\n  const stripeReady = !!pk && !!stripePromise;\r\n  const disabledBtn = linking || !stripeReady || (!hasPM && !fullName);\r\n\r\n  return (\r\n    <div style={{ maxWidth: 720, margin: '0 auto', padding: 16 }}>\r\n      <h2 style={{ marginTop: 0 }}>Payment Method</h2>\r\n\r\n      {!pk && (\r\n        <div style={{\r\n          background: '#fef2f2', border: '1px solid #fecaca', color: '#7f1d1d',\r\n          padding: '10px 12px', borderRadius: 8, marginBottom: 12\r\n        }}>\r\n          Missing Stripe publishable key. Add <code>REACT_APP_STRIPE_PUBLISHABLE_KEY</code> to your <code>.env</code>.\r\n        </div>\r\n      )}\r\n\r\n      {errorMsg && (\r\n        <div style={{\r\n          background: '#fff7ed', border: '1px solid #fed7aa', color: '#7c2d12',\r\n          padding: '10px 12px', borderRadius: 8, marginBottom: 12\r\n        }}>\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n\r\n      <section style={{\r\n        border: '1px solid #e2e8f0', borderRadius: 12, background: '#fff', padding: 14,\r\n        opacity: loading ? 0.7 : 1\r\n      }}>\r\n        <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 12 }}>\r\n          <div>\r\n            <div style={{ fontWeight: 800, fontSize: 16, marginBottom: 4 }}>\r\n              {hasPM ? (currentPM?.brand || 'Bank account') : 'No bank account on file'}\r\n            </div>\r\n            <div style={{ fontSize: 13, color: '#475569', marginBottom: 6 }}>\r\n              {hasPM\r\n                ? (currentPM?.last4 ? `•••• ${currentPM.last4}` : 'Linked — pending details')\r\n                : 'Link your bank to send and receive money on PeerFund.'}\r\n            </div>\r\n            {hasPM && (\r\n              <small style={{ color: '#64748b' }}>\r\n                Used for <strong>both</strong> funding and payouts. Updating replaces your current bank.\r\n              </small>\r\n            )}\r\n          </div>\r\n\r\n          <div style={{ display: 'flex', gap: 8 }}>\r\n            <button\r\n              onClick={startBankLink}\r\n              disabled={disabledBtn}\r\n              style={{\r\n                background: '#4f46e5', color: '#fff', border: '1px solid #4f46e5',\r\n                padding: '10px 14px', borderRadius: 10, fontWeight: 800,\r\n                cursor: disabledBtn ? 'not-allowed' : 'pointer', whiteSpace: 'nowrap'\r\n              }}\r\n            >\r\n              {hasPM ? (linking ? 'Starting…' : 'Update bank account')\r\n                     : (linking ? 'Starting…' : 'Link bank account')}\r\n            </button>\r\n            <button\r\n              onClick={() => refreshPrimary()}\r\n              style={{\r\n                background: '#fff', border: '1px solid #e2e8f0',\r\n                padding: '10px 12px', borderRadius: 10, fontWeight: 600, color: '#334155'\r\n              }}\r\n            >\r\n              Refresh\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {/* First-time identity fields */}\r\n        {!hasPM && (\r\n          <div style={{\r\n            display: 'grid', gap: 8, marginTop: 12,\r\n            background: '#fafafa', border: '1px solid #e5e7eb', borderRadius: 8, padding: 10\r\n          }}>\r\n            <div style={{ fontSize: 14, color: '#6b7280' }}>Account holder</div>\r\n            <input\r\n              type=\"text\"\r\n              value={fullName}\r\n              onChange={(e) => setFullName(e.target.value)}\r\n              placeholder=\"Account holder full name\"\r\n              style={{ padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n            />\r\n            <input\r\n              type=\"email\"\r\n              value={email}\r\n              onChange={(e) => setEmail(e.target.value)}\r\n              placeholder=\"Email (optional, recommended)\"\r\n              style={{ padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n            />\r\n            <small style={{ color: '#6b7280' }}>\r\n              We pass this to Stripe only to label your bank method.\r\n            </small>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      {/* Stripe bank link + SAVE to backend (makes it Default + Payout) */}\r\n      {clientSecret && stripePromise && (\r\n        <Elements stripe={stripePromise}>\r\n          <BankLinkFlow\r\n            clientSecret={clientSecret}\r\n            fullName={fullName}\r\n            email={email}\r\n            onSaved={async () => {\r\n              setClientSecret(null);\r\n              await refreshPrimary();\r\n            }}\r\n            onError={(msg) => {\r\n              setClientSecret(null);\r\n              setErrorMsg(msg);\r\n            }}\r\n          />\r\n        </Elements>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ---------------- Auto-run link/confirm/save flow ---------------- */\r\nfunction BankLinkFlow({ clientSecret, fullName, email, onSaved, onError }) {\r\n  const stripe = useStripe();\r\n  const [working, setWorking] = useState(true);\r\n  const startedRef = useRef(false);\r\n\r\n  async function saveToBackend(paymentMethodId) {\r\n    const r = await fetch('/api/payment-method/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      body: JSON.stringify({\r\n        paymentMethodId,\r\n        makeDefault: true,\r\n        useForLoans: true,\r\n      }),\r\n      cache: 'no-store',\r\n    });\r\n    if (!r.ok) {\r\n      const t = await r.text().catch(() => '');\r\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!stripe || !clientSecret || startedRef.current) return;\r\n    if (!fullName) {\r\n      onError?.('Please enter the account holder’s full name.');\r\n      return;\r\n    }\r\n    startedRef.current = true;\r\n\r\n    (async () => {\r\n      try {\r\n        const { error: collectError } = await stripe.collectBankAccountForSetup({\r\n          clientSecret,\r\n          params: {\r\n            payment_method_type: 'us_bank_account',\r\n            payment_method_data: {\r\n              billing_details: { name: fullName, ...(email ? { email } : {}) },\r\n            },\r\n          },\r\n        });\r\n        if (collectError) throw collectError;\r\n\r\n        const { setupIntent, error: confirmError } =\r\n          await stripe.confirmUsBankAccountSetup(clientSecret);\r\n        if (confirmError) throw confirmError;\r\n\r\n        const pmId = setupIntent?.payment_method;\r\n        if (!pmId) throw new Error('Missing payment method id from Stripe.');\r\n\r\n        await saveToBackend(pmId);\r\n\r\n        onSaved?.(); // parent will refresh and show brand/last4\r\n      } catch (e) {\r\n        onError?.(e?.message || 'Failed to link bank account.');\r\n      } finally {\r\n        setWorking(false);\r\n      }\r\n    })();\r\n  }, [stripe, clientSecret, fullName, email, onSaved, onError]);\r\n\r\n  return (\r\n    <div style={{\r\n      marginTop: 12, background: '#f8fafc', border: '1px solid #e2e8f0',\r\n      borderRadius: 8, padding: '10px 12px', fontSize: 14, color: '#334155'\r\n    }}>\r\n      {working ? 'Opening secure bank link…' : 'Done.'}\r\n    </div>\r\n  );\r\n}\r\n\r\nBankLinkFlow.propTypes = {\r\n  clientSecret: PropTypes.string.isRequired,\r\n  fullName: PropTypes.string.isRequired,\r\n  email: PropTypes.string,\r\n  onSaved: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}