{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/RepaymentForm.jsx\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst RepaymentForm = ({\n  loanId,\n  onPaymentSubmitted\n}) => {\n  _s();\n  const [repaymentDetails, setRepaymentDetails] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [isStartingCheckout, setIsStartingCheckout] = useState(false);\n  const token = localStorage.getItem('token');\n  useEffect(() => {\n    const fetchRepaymentDetails = async () => {\n      try {\n        const res = await fetch(`/api/repayments/${loanId}`, {\n          headers: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n        if (!res.ok) throw new Error('Failed to load repayments');\n        const repayments = await res.json();\n        const nextRepayment = repayments.find(r => r.status === 'PENDING');\n        if (!nextRepayment) {\n          setRepaymentDetails(null);\n          return;\n        }\n        setRepaymentDetails(nextRepayment);\n      } catch (err) {\n        console.error('Error fetching repayment info:', err);\n        alert('‚ö†Ô∏è Could not load repayment details.');\n      } finally {\n        setLoading(false);\n      }\n    };\n    fetchRepaymentDetails();\n  }, [loanId, token]);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading repayment form...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 38,\n    columnNumber: 23\n  }, this);\n  if (!repaymentDetails) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"\\u2705 All repayments are complete!\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 39,\n    columnNumber: 33\n  }, this);\n  const {\n    id: repaymentId,\n    basePayment = 0,\n    platformFee = 0,\n    bankFee = 0,\n    dueDate\n  } = repaymentDetails;\n  const totalDue = (Number(basePayment) + Number(platformFee || 0) + Number(bankFee || 0)).toFixed(2);\n  const startCheckout = async () => {\n    try {\n      setIsStartingCheckout(true);\n      const res = await fetch('/api/payments/repayment-session', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          loanId,\n          repaymentId // let backend lock the amount and add metadata\n        })\n      });\n      if (!res.ok) {\n        const errJson = await res.json().catch(() => ({}));\n        throw new Error(errJson.error || 'Could not create checkout session');\n      }\n      const data = await res.json();\n      if (data !== null && data !== void 0 && data.url) {\n        window.location.href = data.url; // redirect to Stripe Checkout\n      } else {\n        throw new Error('No checkout URL returned');\n      }\n    } catch (err) {\n      console.error('Start checkout error:', err);\n      alert('‚ö†Ô∏è There was a problem starting checkout. Please try again.');\n      setIsStartingCheckout(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: '1rem'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h4\", {\n      children: \"Make a Repayment\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Due Date:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 80,\n        columnNumber: 10\n      }, this), \" \", new Date(dueDate).toLocaleDateString()]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"ul\", {\n      children: [/*#__PURE__*/_jsxDEV(\"li\", {\n        children: [\"Principal + Interest: $\", Number(basePayment).toFixed(2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n        children: [\"Banking Fee (1%): $\", Number(bankFee).toFixed(2)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n        children: [\"PeerFund Fee (1%): $\", Number(platformFee).toFixed(2), ' ', Number(platformFee) === 0 && /*#__PURE__*/_jsxDEV(\"em\", {\n          children: \"(Waived for SuperUsers \\uD83D\\uDC8E)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 41\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"li\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Total Due:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 13\n        }, this), \" $\", totalDue]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 81,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n      children: [\"Amount Charged ($):\", /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        value: totalDue,\n        readOnly: true\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 94,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 92,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      type: \"button\",\n      onClick: startCheckout,\n      disabled: isStartingCheckout,\n      style: {\n        marginTop: '0.5rem'\n      },\n      children: isStartingCheckout ? 'Starting checkout‚Ä¶' : 'Pay with Card'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 78,\n    columnNumber: 5\n  }, this);\n};\n_s(RepaymentForm, \"Xh5PuthM3OWkfLTtSRtaigiNo6I=\");\n_c = RepaymentForm;\nexport default RepaymentForm;\nvar _c;\n$RefreshReg$(_c, \"RepaymentForm\");","map":{"version":3,"names":["React","useEffect","useState","jsxDEV","_jsxDEV","RepaymentForm","loanId","onPaymentSubmitted","_s","repaymentDetails","setRepaymentDetails","loading","setLoading","isStartingCheckout","setIsStartingCheckout","token","localStorage","getItem","fetchRepaymentDetails","res","fetch","headers","Authorization","ok","Error","repayments","json","nextRepayment","find","r","status","err","console","error","alert","children","fileName","_jsxFileName","lineNumber","columnNumber","id","repaymentId","basePayment","platformFee","bankFee","dueDate","totalDue","Number","toFixed","startCheckout","method","body","JSON","stringify","errJson","catch","data","url","window","location","href","style","marginTop","Date","toLocaleDateString","type","value","readOnly","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/RepaymentForm.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\n\r\nconst RepaymentForm = ({ loanId, onPaymentSubmitted }) => {\r\n  const [repaymentDetails, setRepaymentDetails] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n  const [isStartingCheckout, setIsStartingCheckout] = useState(false);\r\n\r\n  const token = localStorage.getItem('token');\r\n\r\n  useEffect(() => {\r\n    const fetchRepaymentDetails = async () => {\r\n      try {\r\n        const res = await fetch(`/api/repayments/${loanId}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        if (!res.ok) throw new Error('Failed to load repayments');\r\n        const repayments = await res.json();\r\n\r\n        const nextRepayment = repayments.find((r) => r.status === 'PENDING');\r\n        if (!nextRepayment) {\r\n          setRepaymentDetails(null);\r\n          return;\r\n        }\r\n\r\n        setRepaymentDetails(nextRepayment);\r\n      } catch (err) {\r\n        console.error('Error fetching repayment info:', err);\r\n        alert('‚ö†Ô∏è Could not load repayment details.');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    fetchRepaymentDetails();\r\n  }, [loanId, token]);\r\n\r\n  if (loading) return <p>Loading repayment form...</p>;\r\n  if (!repaymentDetails) return <p>‚úÖ All repayments are complete!</p>;\r\n\r\n  const { id: repaymentId, basePayment = 0, platformFee = 0, bankFee = 0, dueDate } = repaymentDetails;\r\n  const totalDue = (Number(basePayment) + Number(platformFee || 0) + Number(bankFee || 0)).toFixed(2);\r\n\r\n  const startCheckout = async () => {\r\n    try {\r\n      setIsStartingCheckout(true);\r\n      const res = await fetch('/api/payments/repayment-session', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify({\r\n          loanId,\r\n          repaymentId, // let backend lock the amount and add metadata\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const errJson = await res.json().catch(() => ({}));\r\n        throw new Error(errJson.error || 'Could not create checkout session');\r\n      }\r\n\r\n      const data = await res.json();\r\n      if (data?.url) {\r\n        window.location.href = data.url; // redirect to Stripe Checkout\r\n      } else {\r\n        throw new Error('No checkout URL returned');\r\n      }\r\n    } catch (err) {\r\n      console.error('Start checkout error:', err);\r\n      alert('‚ö†Ô∏è There was a problem starting checkout. Please try again.');\r\n      setIsStartingCheckout(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div style={{ marginTop: '1rem' }}>\r\n      <h4>Make a Repayment</h4>\r\n      <p><strong>Due Date:</strong> {new Date(dueDate).toLocaleDateString()}</p>\r\n      <ul>\r\n        <li>Principal + Interest: ${Number(basePayment).toFixed(2)}</li>\r\n        <li>Banking Fee (1%): ${Number(bankFee).toFixed(2)}</li>\r\n        <li>\r\n          PeerFund Fee (1%): ${Number(platformFee).toFixed(2)}{' '}\r\n          {Number(platformFee) === 0 && <em>(Waived for SuperUsers üíé)</em>}\r\n        </li>\r\n        <li><strong>Total Due:</strong> ${totalDue}</li>\r\n      </ul>\r\n\r\n      {/* Amount is locked to what backend will charge via Stripe */}\r\n      <label>\r\n        Amount Charged ($):\r\n        <input type=\"number\" value={totalDue} readOnly />\r\n      </label>\r\n      <br />\r\n\r\n      <button type=\"button\" onClick={startCheckout} disabled={isStartingCheckout} style={{ marginTop: '0.5rem' }}>\r\n        {isStartingCheckout ? 'Starting checkout‚Ä¶' : 'Pay with Card'}\r\n      </button>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default RepaymentForm;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}