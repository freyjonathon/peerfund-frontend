{"ast":null,"code":"import _objectSpread from\"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/features/loans/LoanDetails.jsx\nimport React,{useState,useEffect}from'react';import{useParams,useNavigate,useSearchParams}from'react-router-dom';import RepaymentForm from'./RepaymentForm';import ContractModal from'../../components/ContractModal';import UserProfileModal from'../../components/UserProfileModal';import LinkLoanBankButton from'./LinkLoanBankButton';import LoanFundingPanel from'./LoanFundingPanel';import WalletPanel from'../wallet/WalletPanel';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LoanDetails=()=>{var _loan$borrower,_loan$loanOffers,_loan$borrower2,_loan$loanOffers2;const{loanId}=useParams();const navigate=useNavigate();const[searchParams]=useSearchParams();const[loan,setLoan]=useState(null);const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[showRepaymentForm,setShowRepaymentForm]=useState(false);const[selectedOffer,setSelectedOffer]=useState(null);const[showContractModal,setShowContractModal]=useState(false);const[hasLoanBank,setHasLoanBank]=useState(false);const[expandedOffer,setExpandedOffer]=useState({});const[offerForm,setOfferForm]=useState({amount:'',duration:'',interestRate:'',message:''});// New: wallet + funding UX state (lender)\nconst[walletAvailableCents,setWalletAvailableCents]=useState(null);const[showWalletPanel,setShowWalletPanel]=useState(false);const token=localStorage.getItem('token');const userId=token?JSON.parse(atob(token.split('.')[1])).userId:null;const handleOfferChange=e=>{const{name,value}=e.target;setOfferForm(prev=>_objectSpread(_objectSpread({},prev),{},{[name]:value}));};const submitOffer=async()=>{try{const payload={amount:Number(loan.amount),duration:Number(offerForm.duration),interestRate:Number(offerForm.interestRate),message:(offerForm.message||'').trim()||undefined};if(!Number.isFinite(payload.duration)||payload.duration<1){alert('Please enter a valid duration (months).');return;}if(!Number.isFinite(payload.interestRate)||payload.interestRate<0){alert('Please enter a valid interest rate (APR).');return;}const res=await fetch(\"/api/loans/\".concat(loanId,\"/offers\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)},body:JSON.stringify(payload)});if(!res.ok)throw new Error((await res.text())||'Failed to submit offer');const data=await res.json();alert('Offer submitted!');setLoan(prev=>_objectSpread(_objectSpread({},prev),{},{loanOffers:[data,...(prev.loanOffers||[])]}));setOfferForm(f=>_objectSpread(_objectSpread({},f),{},{message:''}));}catch(err){console.error('Error submitting offer:',err);alert('There was a problem submitting your offer.');}};const fetchLoanDetails=async()=>{try{var _data$borrower;const res=await fetch(\"/api/loans/\".concat(loanId),{headers:{Authorization:\"Bearer \".concat(token)}});const data=await res.json();setLoan(data);setMessages(data.messages||[]);// If I am the borrower, check if I already have a loan funding payment method\nif(((_data$borrower=data.borrower)===null||_data$borrower===void 0?void 0:_data$borrower.id)===userId){try{const pmRes=await fetch('/api/stripe/has-loan-payment-method',{headers:{Authorization:\"Bearer \".concat(token)}});if(pmRes.ok){const pmData=await pmRes.json();setHasLoanBank(!!pmData.hasLoanPaymentMethod);}else{setHasLoanBank(false);}}catch(err){console.warn('Error checking loan payment method:',err);setHasLoanBank(false);}}}catch(err){console.error('Error fetching loan details:',err);}};useEffect(()=>{fetchLoanDetails();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[loanId]);useEffect(()=>{var _ref,_loan$interestRate;if(!loan)return;setOfferForm({amount:Number(loan.amount||0),duration:Number(loan.duration||1),interestRate:Number((_ref=(_loan$interestRate=loan.interestRate)!==null&&_loan$interestRate!==void 0?_loan$interestRate:loan.apr)!==null&&_ref!==void 0?_ref:0),message:''});},[loan]);useEffect(()=>{if(searchParams.get('tab')==='discussion'&&loan){setTimeout(()=>{const el=document.getElementById('discussion-thread');if(el)el.scrollIntoView({behavior:'smooth',block:'start'});},0);}},[searchParams,loan]);const handleSendMessage=async()=>{if(!newMessage.trim())return;try{const res=await fetch(\"/api/loans/\".concat(loanId,\"/messages\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)},body:JSON.stringify({content:newMessage})});const data=await res.json();setMessages(prev=>[...prev,data]);setNewMessage('');}catch(err){console.error('Error sending message:',err);}};const handleAcceptOffer=offer=>{setSelectedOffer(offer);setShowContractModal(true);};const toggleOffer=offerId=>setExpandedOffer(prev=>_objectSpread(_objectSpread({},prev),{},{[offerId]:!prev[offerId]}));// Who am I in this context?\nconst iAmBorrower=userId===(loan===null||loan===void 0?void 0:(_loan$borrower=loan.borrower)===null||_loan$borrower===void 0?void 0:_loan$borrower.id);// Detect if *my* offer was accepted -> I'm the lender for this loan\nconst isLenderOnThisLoan=!!(loan!==null&&loan!==void 0&&(_loan$loanOffers=loan.loanOffers)!==null&&_loan$loanOffers!==void 0&&_loan$loanOffers.some(o=>{var _o$lender;return String((_o$lender=o.lender)===null||_o$lender===void 0?void 0:_o$lender.id)===String(userId)&&(o.status||'OPEN').toUpperCase()==='ACCEPTED';}));if(!loan)return/*#__PURE__*/_jsx(\"p\",{children:\"Loading loan details...\"});const statusUpper=(loan.status||'').toUpperCase();const bannerStyle={margin:'12px 0',padding:'10px 12px',borderRadius:8,border:'1px solid #e2e8f0',background:statusUpper==='FUNDED'?'#ecfdf5':statusUpper==='PROCESSING'?'#eff6ff':statusUpper==='FAILED'?'#fef2f2':'#f8fafc',color:'#0f172a'};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'2rem',position:'relative'},children:[/*#__PURE__*/_jsxs(\"h2\",{children:[\"Loan Request by \",((_loan$borrower2=loan.borrower)===null||_loan$borrower2===void 0?void 0:_loan$borrower2.name)||'Unknown User']}),/*#__PURE__*/_jsx(\"div\",{style:{display:'flex',gap:'12px',alignItems:'flex-start',marginBottom:'1rem'},children:/*#__PURE__*/_jsx(UserProfileModal,{user:loan.borrower})}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Amount:\"}),\" $\",loan.amount]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Duration:\"}),\" \",loan.duration,\" months\"]}),/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Reason:\"}),\" \",loan.purpose]}),/*#__PURE__*/_jsxs(\"div\",{style:bannerStyle,children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",loan.status,statusUpper==='FAILED'&&/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:6,color:'#b91c1c'},children:\"(You can retry disbursement once issues are resolved.)\"}),statusUpper==='PROCESSING'&&/*#__PURE__*/_jsx(\"span\",{style:{marginLeft:6,color:'#334155'},children:\"Transfer in progress \\u2014 refresh shortly to see the final state.\"})]}),isLenderOnThisLoan&&['ACCEPTED','PROCESSING'].includes(statusUpper)&&/*#__PURE__*/_jsx(LoanFundingPanel,{loan:loan,walletAvailableCents:walletAvailableCents,onWalletSynced:cents=>setWalletAvailableCents(cents),onNeedMoreFunds:()=>setShowWalletPanel(true),onFunded:async()=>{// after funding completes, refresh the loan\nawait fetchLoanDetails();}}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsx(\"h3\",{children:\"Offers\"}),((_loan$loanOffers2=loan.loanOffers)===null||_loan$loanOffers2===void 0?void 0:_loan$loanOffers2.length)>0?loan.loanOffers.map(offer=>{var _offer$lender;const isOpen=!!expandedOffer[offer.id];const statusLabel=(offer.status||'').toUpperCase()==='ACCEPTED'?'Accepted':'Pending';const badgeStyle=statusLabel==='Accepted'?{background:'#dcfce7',color:'#166534',borderColor:'#86efac'}:{background:'#fef3c7',color:'#92400e',borderColor:'#fde68a'};return/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #e2e8f0',borderRadius:12,background:'#fff',marginBottom:12,overflow:'hidden'},children:[/*#__PURE__*/_jsxs(\"button\",{onClick:()=>toggleOffer(offer.id),\"aria-expanded\":isOpen,style:{width:'100%',textAlign:'left',background:'#f8fafc',border:0,padding:'12px 14px',display:'flex',alignItems:'center',justifyContent:'space-between',cursor:'pointer'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:10},children:[/*#__PURE__*/_jsx(\"span\",{style:{width:8,height:8,borderRadius:999,background:'#6366f1',display:'inline-block'}}),/*#__PURE__*/_jsxs(\"span\",{style:{fontWeight:700,color:'#0f172a'},children:[\"Offer from \",((_offer$lender=offer.lender)===null||_offer$lender===void 0?void 0:_offer$lender.name)||'Unknown']})]}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:12,alignItems:'center',color:'#334155',fontSize:14},children:[/*#__PURE__*/_jsxs(\"span\",{children:[\"$\",Number(offer.amount||0).toFixed(2)]}),/*#__PURE__*/_jsxs(\"span\",{children:[offer.interestRate,\"%\"]}),/*#__PURE__*/_jsxs(\"span\",{children:[offer.duration,\" mo\"]}),/*#__PURE__*/_jsx(\"span\",{style:_objectSpread({borderRadius:999,padding:'2px 8px',fontSize:12,fontWeight:700,border:'1px solid'},badgeStyle),children:statusLabel}),/*#__PURE__*/_jsx(\"span\",{style:{fontSize:18,color:'#64748b'},children:isOpen?'▾':'▸'})]})]}),isOpen&&/*#__PURE__*/_jsxs(\"div\",{style:{padding:'12px 14px 14px',borderTop:'1px solid #e2e8f0'},children:[/*#__PURE__*/_jsxs(\"p\",{children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Message:\"}),\" \",offer.message||'—']}),statusUpper==='OPEN'&&iAmBorrower&&/*#__PURE__*/_jsx(\"button\",{onClick:()=>handleAcceptOffer(offer),style:{background:'#4f46e5',border:'1px solid #4f46e5',color:'#fff',fontWeight:700,padding:'8px 12px',borderRadius:10,cursor:'pointer'},children:\"Accept Offer\"})]})]},offer.id);}):/*#__PURE__*/_jsx(\"p\",{children:\"No offers yet.\"}),statusUpper==='ACCEPTED'&&iAmBorrower&&!hasLoanBank&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'2rem',padding:'1rem',border:'1px solid #e2e8f0',borderRadius:10,background:'#f8fafc'},children:[/*#__PURE__*/_jsx(\"h3\",{style:{marginTop:0},children:\"Before we disburse your loan\\u2026\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#334155'},children:\"You must link a bank account in order to receive your loan funds.\"}),/*#__PURE__*/_jsx(LinkLoanBankButton,{onLinked:()=>setHasLoanBank(true)})]}),statusUpper==='FUNDED'&&iAmBorrower&&/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'2rem'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Repayments\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setShowRepaymentForm(true),children:\"Make a Payment\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(\"/loan/\".concat(loan.id,\"/repayments\")),children:\"View Repayment Tracker\"}),showRepaymentForm&&/*#__PURE__*/_jsx(RepaymentForm,{loanId:loan.id})]}),/*#__PURE__*/_jsx(\"hr\",{}),/*#__PURE__*/_jsxs(\"div\",{id:\"discussion-thread\",style:{marginTop:'1.5rem'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Public Discussion\"}),messages.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No messages yet. Start the conversation!\"}):messages.map(m=>{var _m$user;return/*#__PURE__*/_jsxs(\"div\",{style:{borderTop:'1px solid #e5e7eb',padding:'8px 0'},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[((_m$user=m.user)===null||_m$user===void 0?void 0:_m$user.name)||'User',\":\"]}),\" \",m.content]},m.id);}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,marginTop:8},children:[/*#__PURE__*/_jsx(\"textarea\",{placeholder:\"Write your message\\u2026\",value:newMessage,onChange:e=>setNewMessage(e.target.value),style:{flex:1,padding:8,border:'1px solid #e5e7eb',borderRadius:8}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSendMessage,style:{background:'#4f46e5',border:'1px solid #4f46e5',color:'#fff',fontWeight:700,padding:'8px 12px',borderRadius:10,cursor:'pointer',height:40,alignSelf:'center'},children:\"Send\"})]})]}),showContractModal&&selectedOffer&&/*#__PURE__*/_jsx(ContractModal,{offer:selectedOffer,borrower:loan.borrower,onConfirm:async()=>{try{const res=await fetch(\"/api/loans/offers/\".concat(selectedOffer.id,\"/accept\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)}});if(!res.ok){const errorText=await res.text();alert(\"\\u274C \".concat(errorText||'Something went wrong'));return;}await res.json();alert('✅ Loan contract created and saved!');setShowContractModal(false);navigate('/dashboard');}catch(err){console.error('❌ Error finalizing contract:',err);alert('Network or server error occurred.');}},onCancel:()=>setShowContractModal(false)}),showWalletPanel&&/*#__PURE__*/_jsx(\"div\",{style:{position:'fixed',inset:0,background:'rgba(15, 23, 42, 0.45)',display:'flex',alignItems:'center',justifyContent:'center',zIndex:40},children:/*#__PURE__*/_jsx(\"div\",{style:{background:'#ffffff',borderRadius:12,padding:16,minWidth:320,maxWidth:420,boxShadow:'0 10px 15px -3px rgba(15, 23, 42, 0.2), 0 4px 6px -2px rgba(15, 23, 42, 0.1)'},children:/*#__PURE__*/_jsx(WalletPanel,{onClose:()=>setShowWalletPanel(false),onBalanceUpdated:cents=>{setWalletAvailableCents(cents);setShowWalletPanel(false);}})})})]});};export default LoanDetails;","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","useSearchParams","RepaymentForm","ContractModal","UserProfileModal","LinkLoanBankButton","LoanFundingPanel","WalletPanel","jsx","_jsx","jsxs","_jsxs","LoanDetails","_loan$borrower","_loan$loanOffers","_loan$borrower2","_loan$loanOffers2","loanId","navigate","searchParams","loan","setLoan","messages","setMessages","newMessage","setNewMessage","showRepaymentForm","setShowRepaymentForm","selectedOffer","setSelectedOffer","showContractModal","setShowContractModal","hasLoanBank","setHasLoanBank","expandedOffer","setExpandedOffer","offerForm","setOfferForm","amount","duration","interestRate","message","walletAvailableCents","setWalletAvailableCents","showWalletPanel","setShowWalletPanel","token","localStorage","getItem","userId","JSON","parse","atob","split","handleOfferChange","e","name","value","target","prev","_objectSpread","submitOffer","payload","Number","trim","undefined","isFinite","alert","res","fetch","concat","method","headers","Authorization","body","stringify","ok","Error","text","data","json","loanOffers","f","err","console","error","fetchLoanDetails","_data$borrower","borrower","id","pmRes","pmData","hasLoanPaymentMethod","warn","_ref","_loan$interestRate","apr","get","setTimeout","el","document","getElementById","scrollIntoView","behavior","block","handleSendMessage","content","handleAcceptOffer","offer","toggleOffer","offerId","iAmBorrower","isLenderOnThisLoan","some","o","_o$lender","String","lender","status","toUpperCase","children","statusUpper","bannerStyle","margin","padding","borderRadius","border","background","color","style","position","display","gap","alignItems","marginBottom","user","purpose","marginLeft","includes","onWalletSynced","cents","onNeedMoreFunds","onFunded","length","map","_offer$lender","isOpen","statusLabel","badgeStyle","borderColor","overflow","onClick","width","textAlign","justifyContent","cursor","height","fontWeight","fontSize","toFixed","borderTop","marginTop","onLinked","m","_m$user","placeholder","onChange","flex","alignSelf","onConfirm","errorText","onCancel","inset","zIndex","minWidth","maxWidth","boxShadow","onClose","onBalanceUpdated"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/LoanDetails.jsx"],"sourcesContent":["// src/features/loans/LoanDetails.jsx\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport RepaymentForm from './RepaymentForm';\nimport ContractModal from '../../components/ContractModal';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LinkLoanBankButton from './LinkLoanBankButton';\nimport LoanFundingPanel from './LoanFundingPanel';\nimport WalletPanel from '../wallet/WalletPanel';\n\nconst LoanDetails = () => {\n  const { loanId } = useParams();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n\n  const [loan, setLoan] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [showRepaymentForm, setShowRepaymentForm] = useState(false);\n  const [selectedOffer, setSelectedOffer] = useState(null);\n  const [showContractModal, setShowContractModal] = useState(false);\n  const [hasLoanBank, setHasLoanBank] = useState(false);\n\n  const [expandedOffer, setExpandedOffer] = useState({});\n  const [offerForm, setOfferForm] = useState({\n    amount: '',\n    duration: '',\n    interestRate: '',\n    message: '',\n  });\n\n  // New: wallet + funding UX state (lender)\n  const [walletAvailableCents, setWalletAvailableCents] = useState(null);\n  const [showWalletPanel, setShowWalletPanel] = useState(false);\n\n  const token = localStorage.getItem('token');\n  const userId = token ? JSON.parse(atob(token.split('.')[1])).userId : null;\n\n  const handleOfferChange = (e) => {\n    const { name, value } = e.target;\n    setOfferForm((prev) => ({ ...prev, [name]: value }));\n  };\n\n  const submitOffer = async () => {\n    try {\n      const payload = {\n        amount: Number(loan.amount),\n        duration: Number(offerForm.duration),\n        interestRate: Number(offerForm.interestRate),\n        message: (offerForm.message || '').trim() || undefined,\n      };\n\n      if (!Number.isFinite(payload.duration) || payload.duration < 1) {\n        alert('Please enter a valid duration (months).');\n        return;\n      }\n      if (!Number.isFinite(payload.interestRate) || payload.interestRate < 0) {\n        alert('Please enter a valid interest rate (APR).');\n        return;\n      }\n\n      const res = await fetch(`/api/loans/${loanId}/offers`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!res.ok) throw new Error((await res.text()) || 'Failed to submit offer');\n      const data = await res.json();\n      alert('Offer submitted!');\n      setLoan((prev) => ({\n        ...prev,\n        loanOffers: [data, ...(prev.loanOffers || [])],\n      }));\n      setOfferForm((f) => ({ ...f, message: '' }));\n    } catch (err) {\n      console.error('Error submitting offer:', err);\n      alert('There was a problem submitting your offer.');\n    }\n  };\n\n  const fetchLoanDetails = async () => {\n    try {\n      const res = await fetch(`/api/loans/${loanId}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const data = await res.json();\n      setLoan(data);\n      setMessages(data.messages || []);\n\n      // If I am the borrower, check if I already have a loan funding payment method\n      if (data.borrower?.id === userId) {\n        try {\n          const pmRes = await fetch('/api/stripe/has-loan-payment-method', {\n            headers: { Authorization: `Bearer ${token}` },\n          });\n          if (pmRes.ok) {\n            const pmData = await pmRes.json();\n            setHasLoanBank(!!pmData.hasLoanPaymentMethod);\n          } else {\n            setHasLoanBank(false);\n          }\n        } catch (err) {\n          console.warn('Error checking loan payment method:', err);\n          setHasLoanBank(false);\n        }\n      }\n    } catch (err) {\n      console.error('Error fetching loan details:', err);\n    }\n  };\n\n  useEffect(() => {\n    fetchLoanDetails();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loanId]);\n\n  useEffect(() => {\n    if (!loan) return;\n    setOfferForm({\n      amount: Number(loan.amount || 0),\n      duration: Number(loan.duration || 1),\n      interestRate: Number(loan.interestRate ?? loan.apr ?? 0),\n      message: '',\n    });\n  }, [loan]);\n\n  useEffect(() => {\n    if (searchParams.get('tab') === 'discussion' && loan) {\n      setTimeout(() => {\n        const el = document.getElementById('discussion-thread');\n        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }, 0);\n    }\n  }, [searchParams, loan]);\n\n  const handleSendMessage = async () => {\n    if (!newMessage.trim()) return;\n    try {\n      const res = await fetch(`/api/loans/${loanId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({ content: newMessage }),\n      });\n      const data = await res.json();\n      setMessages((prev) => [...prev, data]);\n      setNewMessage('');\n    } catch (err) {\n      console.error('Error sending message:', err);\n    }\n  };\n\n  const handleAcceptOffer = (offer) => {\n    setSelectedOffer(offer);\n    setShowContractModal(true);\n  };\n\n  const toggleOffer = (offerId) =>\n    setExpandedOffer((prev) => ({ ...prev, [offerId]: !prev[offerId] }));\n\n  // Who am I in this context?\n  const iAmBorrower = userId === loan?.borrower?.id;\n  // Detect if *my* offer was accepted -> I'm the lender for this loan\n  const isLenderOnThisLoan =\n    !!loan?.loanOffers?.some(\n      (o) =>\n        String(o.lender?.id) === String(userId) &&\n        (o.status || 'OPEN').toUpperCase() === 'ACCEPTED'\n    );\n\n  if (!loan) return <p>Loading loan details...</p>;\n\n  const statusUpper = (loan.status || '').toUpperCase();\n  const bannerStyle = {\n    margin: '12px 0',\n    padding: '10px 12px',\n    borderRadius: 8,\n    border: '1px solid #e2e8f0',\n    background:\n      statusUpper === 'FUNDED'\n        ? '#ecfdf5'\n        : statusUpper === 'PROCESSING'\n        ? '#eff6ff'\n        : statusUpper === 'FAILED'\n        ? '#fef2f2'\n        : '#f8fafc',\n    color: '#0f172a',\n  };\n\n  return (\n    <div style={{ padding: '2rem', position: 'relative' }}>\n      <h2>Loan Request by {loan.borrower?.name || 'Unknown User'}</h2>\n\n      <div\n        style={{\n          display: 'flex',\n          gap: '12px',\n          alignItems: 'flex-start',\n          marginBottom: '1rem',\n        }}\n      >\n        <UserProfileModal user={loan.borrower} />\n      </div>\n\n      <p>\n        <strong>Amount:</strong> ${loan.amount}\n      </p>\n      <p>\n        <strong>Duration:</strong> {loan.duration} months\n      </p>\n      <p>\n        <strong>Reason:</strong> {loan.purpose}\n      </p>\n\n      {/* Status banner */}\n      <div style={bannerStyle}>\n        <strong>Status:</strong> {loan.status}\n        {statusUpper === 'FAILED' && (\n          <span style={{ marginLeft: 6, color: '#b91c1c' }}>\n            (You can retry disbursement once issues are resolved.)\n          </span>\n        )}\n        {statusUpper === 'PROCESSING' && (\n          <span style={{ marginLeft: 6, color: '#334155' }}>\n            Transfer in progress — refresh shortly to see the final state.\n          </span>\n        )}\n      </div>\n\n      {/* Lender funding panel, when borrower has accepted our offer */}\n      {isLenderOnThisLoan && ['ACCEPTED', 'PROCESSING'].includes(statusUpper) && (\n        <LoanFundingPanel\n          loan={loan}\n          walletAvailableCents={walletAvailableCents}\n          onWalletSynced={(cents) => setWalletAvailableCents(cents)}\n          onNeedMoreFunds={() => setShowWalletPanel(true)}\n          onFunded={async () => {\n            // after funding completes, refresh the loan\n            await fetchLoanDetails();\n          }}\n        />\n      )}\n\n      <hr />\n      <h3>Offers</h3>\n\n      {loan.loanOffers?.length > 0 ? (\n        loan.loanOffers.map((offer) => {\n          const isOpen = !!expandedOffer[offer.id];\n          const statusLabel =\n            (offer.status || '').toUpperCase() === 'ACCEPTED'\n              ? 'Accepted'\n              : 'Pending';\n          const badgeStyle =\n            statusLabel === 'Accepted'\n              ? {\n                  background: '#dcfce7',\n                  color: '#166534',\n                  borderColor: '#86efac',\n                }\n              : {\n                  background: '#fef3c7',\n                  color: '#92400e',\n                  borderColor: '#fde68a',\n                };\n\n          return (\n            <div\n              key={offer.id}\n              style={{\n                border: '1px solid #e2e8f0',\n                borderRadius: 12,\n                background: '#fff',\n                marginBottom: 12,\n                overflow: 'hidden',\n              }}\n            >\n              {/* Header row */}\n              <button\n                onClick={() => toggleOffer(offer.id)}\n                aria-expanded={isOpen}\n                style={{\n                  width: '100%',\n                  textAlign: 'left',\n                  background: '#f8fafc',\n                  border: 0,\n                  padding: '12px 14px',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'space-between',\n                  cursor: 'pointer',\n                }}\n              >\n                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                  <span\n                    style={{\n                      width: 8,\n                      height: 8,\n                      borderRadius: 999,\n                      background: '#6366f1',\n                      display: 'inline-block',\n                    }}\n                  />\n                  <span\n                    style={{ fontWeight: 700, color: '#0f172a' }}\n                  >\n                    Offer from {offer.lender?.name || 'Unknown'}\n                  </span>\n                </div>\n\n                <div\n                  style={{\n                    display: 'flex',\n                    gap: 12,\n                    alignItems: 'center',\n                    color: '#334155',\n                    fontSize: 14,\n                  }}\n                >\n                  <span>${Number(offer.amount || 0).toFixed(2)}</span>\n                  <span>{offer.interestRate}%</span>\n                  <span>{offer.duration} mo</span>\n                  <span\n                    style={{\n                      borderRadius: 999,\n                      padding: '2px 8px',\n                      fontSize: 12,\n                      fontWeight: 700,\n                      border: '1px solid',\n                      ...badgeStyle,\n                    }}\n                  >\n                    {statusLabel}\n                  </span>\n                  <span style={{ fontSize: 18, color: '#64748b' }}>\n                    {isOpen ? '▾' : '▸'}\n                  </span>\n                </div>\n              </button>\n\n              {/* Body */}\n              {isOpen && (\n                <div\n                  style={{\n                    padding: '12px 14px 14px',\n                    borderTop: '1px solid #e2e8f0',\n                  }}\n                >\n                  <p>\n                    <strong>Message:</strong> {offer.message || '—'}\n                  </p>\n\n                  {statusUpper === 'OPEN' && iAmBorrower && (\n                    <button\n                      onClick={() => handleAcceptOffer(offer)}\n                      style={{\n                        background: '#4f46e5',\n                        border: '1px solid #4f46e5',\n                        color: '#fff',\n                        fontWeight: 700,\n                        padding: '8px 12px',\n                        borderRadius: 10,\n                        cursor: 'pointer',\n                      }}\n                    >\n                      Accept Offer\n                    </button>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })\n      ) : (\n        <p>No offers yet.</p>\n      )}\n\n      {/* Borrower: link bank for receiving funds */}\n      {statusUpper === 'ACCEPTED' && iAmBorrower && !hasLoanBank && (\n        <div\n          style={{\n            marginTop: '2rem',\n            padding: '1rem',\n            border: '1px solid #e2e8f0',\n            borderRadius: 10,\n            background: '#f8fafc',\n          }}\n        >\n          <h3 style={{ marginTop: 0 }}>Before we disburse your loan…</h3>\n          <p style={{ color: '#334155' }}>\n            You must link a bank account in order to receive your loan funds.\n          </p>\n          <LinkLoanBankButton onLinked={() => setHasLoanBank(true)} />\n        </div>\n      )}\n\n      {/* Repayment section (borrower) */}\n      {statusUpper === 'FUNDED' && iAmBorrower && (\n        <div style={{ marginTop: '2rem' }}>\n          <h3>Repayments</h3>\n          <button onClick={() => setShowRepaymentForm(true)}>\n            Make a Payment\n          </button>\n          <button onClick={() => navigate(`/loan/${loan.id}/repayments`)}>\n            View Repayment Tracker\n          </button>\n          {showRepaymentForm && <RepaymentForm loanId={loan.id} />}\n        </div>\n      )}\n\n      <hr />\n\n      {/* Discussion thread */}\n      <div id=\"discussion-thread\" style={{ marginTop: '1.5rem' }}>\n        <h3>Public Discussion</h3>\n        {messages.length === 0 ? (\n          <p>No messages yet. Start the conversation!</p>\n        ) : (\n          messages.map((m) => (\n            <div\n              key={m.id}\n              style={{\n                borderTop: '1px solid #e5e7eb',\n                padding: '8px 0',\n              }}\n            >\n              <strong>{m.user?.name || 'User'}:</strong> {m.content}\n            </div>\n          ))\n        )}\n        <div style={{ display: 'flex', gap: 8, marginTop: 8 }}>\n          <textarea\n            placeholder=\"Write your message…\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            style={{\n              flex: 1,\n              padding: 8,\n              border: '1px solid #e5e7eb',\n              borderRadius: 8,\n            }}\n          />\n          <button\n            onClick={handleSendMessage}\n            style={{\n              background: '#4f46e5',\n              border: '1px solid #4f46e5',\n              color: '#fff',\n              fontWeight: 700,\n              padding: '8px 12px',\n              borderRadius: 10,\n              cursor: 'pointer',\n              height: 40,\n              alignSelf: 'center',\n            }}\n          >\n            Send\n          </button>\n        </div>\n      </div>\n\n      {showContractModal && selectedOffer && (\n        <ContractModal\n          offer={selectedOffer}\n          borrower={loan.borrower}\n          onConfirm={async () => {\n            try {\n              const res = await fetch(\n                `/api/loans/offers/${selectedOffer.id}/accept`,\n                {\n                  method: 'POST',\n                  headers: {\n                    'Content-Type': 'application/json',\n                    Authorization: `Bearer ${token}`,\n                  },\n                }\n              );\n\n              if (!res.ok) {\n                const errorText = await res.text();\n                alert(`❌ ${errorText || 'Something went wrong'}`);\n                return;\n              }\n\n              await res.json();\n              alert('✅ Loan contract created and saved!');\n              setShowContractModal(false);\n              navigate('/dashboard');\n            } catch (err) {\n              console.error('❌ Error finalizing contract:', err);\n              alert('Network or server error occurred.');\n            }\n          }}\n          onCancel={() => setShowContractModal(false)}\n        />\n      )}\n\n      {/* Wallet modal for adding funds (lender) */}\n      {showWalletPanel && (\n        <div\n          style={{\n            position: 'fixed',\n            inset: 0,\n            background: 'rgba(15, 23, 42, 0.45)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            zIndex: 40,\n          }}\n        >\n          <div\n            style={{\n              background: '#ffffff',\n              borderRadius: 12,\n              padding: 16,\n              minWidth: 320,\n              maxWidth: 420,\n              boxShadow:\n                '0 10px 15px -3px rgba(15, 23, 42, 0.2), 0 4px 6px -2px rgba(15, 23, 42, 0.1)',\n            }}\n          >\n            <WalletPanel\n              onClose={() => setShowWalletPanel(false)}\n              onBalanceUpdated={(cents) => {\n                setWalletAvailableCents(cents);\n                setShowWalletPanel(false);\n              }}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LoanDetails;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}