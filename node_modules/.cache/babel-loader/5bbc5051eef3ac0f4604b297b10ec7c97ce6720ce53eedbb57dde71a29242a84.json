{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams,useNavigate}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const Messaging=()=>{const{loanId}=useParams();const navigate=useNavigate();const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');useEffect(()=>{if(!loanId||loanId==='undefined'){console.warn('Loan ID is undefined. Skipping fetch.');return;}const fetchMessages=async()=>{try{const res=await fetch(\"/api/loans/\".concat(loanId,\"/messages\"),{headers:{Authorization:\"Bearer \".concat(localStorage.getItem('token'))}});if(!res.ok)throw new Error('Failed to load messages');const data=await res.json();setMessages(data);}catch(err){console.error('Error loading messages:',err.message);}};fetchMessages();},[loanId]);const handleSend=async()=>{if(!newMessage.trim()||!loanId||loanId==='undefined')return;try{const res=await fetch(\"/api/loans/\".concat(loanId,\"/messages\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(localStorage.getItem('token'))},body:JSON.stringify({text:newMessage})});if(!res.ok)throw new Error('Failed to send message');const updated=await res.json();setMessages(prev=>[...prev,updated]);setNewMessage('');}catch(err){console.error('Error sending message:',err.message);alert('Failed to send message.');}};return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'2rem'},children:[/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/create-loan'),children:\"Request a Loan\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/loan-marketplace'),children:\"View Open Loans\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/money-summary'),children:\"My Money Summary\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/messages'),children:\"My Messages\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/history'),children:\"History\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/profile'),children:\"Edit Profile\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/payment-method'),children:\"My Payment Method\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate('/documents'),children:\"My Documents\"})]}),/*#__PURE__*/_jsxs(\"h2\",{children:[\"\\uD83D\\uDCE8 Direct Messaging \",loanId?\"for Loan #\".concat(loanId):'(No Loan Selected)']}),/*#__PURE__*/_jsx(\"div\",{style:{border:'1px solid #ccc',padding:'1rem',height:'300px',overflowY:'scroll'},children:messages.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No messages yet.\"}):messages.map((msg,index)=>{var _msg$sender;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem'},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[((_msg$sender=msg.sender)===null||_msg$sender===void 0?void 0:_msg$sender.name)||'Unknown',\":\"]}),\" \",msg.text]},index);})}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'1rem'},children:[/*#__PURE__*/_jsx(\"input\",{type:\"text\",placeholder:\"Type your message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value),style:{width:'70%'}}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSend,style:{marginLeft:'1rem'},disabled:!loanId||loanId==='undefined',children:\"Send\"})]})]});};export default Messaging;","map":{"version":3,"names":["React","useEffect","useState","useParams","useNavigate","jsx","_jsx","jsxs","_jsxs","Messaging","loanId","navigate","messages","setMessages","newMessage","setNewMessage","console","warn","fetchMessages","res","fetch","concat","headers","Authorization","localStorage","getItem","ok","Error","data","json","err","error","message","handleSend","trim","method","body","JSON","stringify","text","updated","prev","alert","style","padding","children","marginBottom","onClick","border","height","overflowY","length","map","msg","index","_msg$sender","sender","name","marginTop","type","placeholder","value","onChange","e","target","width","marginLeft","disabled"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/messaging/Messaging.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\n\nconst Messaging = () => {\n  const { loanId } = useParams();\n  const navigate = useNavigate();\n\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n\n  useEffect(() => {\n    if (!loanId || loanId === 'undefined') {\n      console.warn('Loan ID is undefined. Skipping fetch.');\n      return;\n    }\n\n    const fetchMessages = async () => {\n      try {\n        const res = await fetch(`/api/loans/${loanId}/messages`, {\n          headers: {\n            Authorization: `Bearer ${localStorage.getItem('token')}`,\n          },\n        });\n        if (!res.ok) throw new Error('Failed to load messages');\n        const data = await res.json();\n        setMessages(data);\n      } catch (err) {\n        console.error('Error loading messages:', err.message);\n      }\n    };\n\n    fetchMessages();\n  }, [loanId]);\n\n  const handleSend = async () => {\n    if (!newMessage.trim() || !loanId || loanId === 'undefined') return;\n\n    try {\n      const res = await fetch(`/api/loans/${loanId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\n        },\n        body: JSON.stringify({ text: newMessage }),\n      });\n\n      if (!res.ok) throw new Error('Failed to send message');\n      const updated = await res.json();\n      setMessages((prev) => [...prev, updated]);\n      setNewMessage('');\n    } catch (err) {\n      console.error('Error sending message:', err.message);\n      alert('Failed to send message.');\n    }\n  };\n\n  return (\n    <div style={{ padding: '2rem' }}>\n      {/* Navigation */}\n      <div style={{ marginBottom: '1rem' }}>\n        <button onClick={() => navigate('/create-loan')}>Request a Loan</button>\n        <button onClick={() => navigate('/loan-marketplace')}>View Open Loans</button>\n        <button onClick={() => navigate('/money-summary')}>My Money Summary</button>\n        <button onClick={() => navigate('/messages')}>My Messages</button>\n        <button onClick={() => navigate('/history')}>History</button>\n        <button onClick={() => navigate('/profile')}>Edit Profile</button>\n        <button onClick={() => navigate('/payment-method')}>My Payment Method</button>\n        <button onClick={() => navigate('/documents')}>My Documents</button>\n      </div>\n\n      <h2>ðŸ“¨ Direct Messaging {loanId ? `for Loan #${loanId}` : '(No Loan Selected)'}</h2>\n\n      <div style={{ border: '1px solid #ccc', padding: '1rem', height: '300px', overflowY: 'scroll' }}>\n        {messages.length === 0 ? (\n          <p>No messages yet.</p>\n        ) : (\n          messages.map((msg, index) => (\n            <div key={index} style={{ marginBottom: '1rem' }}>\n              <strong>{msg.sender?.name || 'Unknown'}:</strong> {msg.text}\n            </div>\n          ))\n        )}\n      </div>\n\n      <div style={{ marginTop: '1rem' }}>\n        <input\n          type=\"text\"\n          placeholder=\"Type your message...\"\n          value={newMessage}\n          onChange={(e) => setNewMessage(e.target.value)}\n          style={{ width: '70%' }}\n        />\n        <button onClick={handleSend} style={{ marginLeft: '1rem' }} disabled={!loanId || loanId === 'undefined'}>\n          Send\n        </button>\n      </div>\n    </div>\n  );\n};\n\nexport default Messaging;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}