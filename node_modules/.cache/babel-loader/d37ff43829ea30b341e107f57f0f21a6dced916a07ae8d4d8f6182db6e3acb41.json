{"ast":null,"code":"// src/features/auth/VerifiedRoute.jsx\nimport React,{useEffect,useState}from'react';import{Navigate}from'react-router-dom';import{jsx as _jsx}from\"react/jsx-runtime\";const VerifiedRoute=_ref=>{let{children}=_ref;const[loading,setLoading]=useState(true);const[allow,setAllow]=useState(false);useEffect(()=>{const token=localStorage.getItem('token');if(!token){setLoading(false);setAllow(false);return;}const run=async()=>{try{const headers={Authorization:\"Bearer \".concat(token)};// 1) Load profile so we can see the user's role\nconst profileRes=await fetch('/api/users/profile',{headers});if(!profileRes.ok){throw new Error('Failed to load profile');}const profile=await profileRes.json();// If ADMIN, skip verification entirely\nif(profile.role==='ADMIN'){setAllow(true);setLoading(false);return;}// 2) For normal users, check verification status\nconst verRes=await fetch('/api/verification/status',{headers});if(!verRes.ok){throw new Error('Failed to load verification status');}const data=await verRes.json();// Expect data.status from your verification controller\nif(data.status==='APPROVED'){setAllow(true);}else{// PENDING / REJECTED / anything else → must go to /verify\nsetAllow(false);}}catch(err){console.error('VerifiedRoute error:',err);// On error, be safe and send user to /verify instead of crashing\nsetAllow(false);}finally{setLoading(false);}};run();},[]);if(loading){return/*#__PURE__*/_jsx(\"div\",{style:{padding:24},children:\"Checking your account status\\u2026\"});}if(!allow){return/*#__PURE__*/_jsx(Navigate,{to:\"/verify\",replace:true});}return children;};export default VerifiedRoute;","map":{"version":3,"names":["React","useEffect","useState","Navigate","jsx","_jsx","VerifiedRoute","_ref","children","loading","setLoading","allow","setAllow","token","localStorage","getItem","run","headers","Authorization","concat","profileRes","fetch","ok","Error","profile","json","role","verRes","data","status","err","console","error","style","padding","to","replace"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/auth/VerifiedRoute.jsx"],"sourcesContent":["// src/features/auth/VerifiedRoute.jsx\nimport React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\n\nconst VerifiedRoute = ({ children }) => {\n  const [loading, setLoading] = useState(true);\n  const [allow, setAllow] = useState(false);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setLoading(false);\n      setAllow(false);\n      return;\n    }\n\n    const run = async () => {\n      try {\n        const headers = { Authorization: `Bearer ${token}` };\n\n        // 1) Load profile so we can see the user's role\n        const profileRes = await fetch('/api/users/profile', { headers });\n        if (!profileRes.ok) {\n          throw new Error('Failed to load profile');\n        }\n        const profile = await profileRes.json();\n\n        // If ADMIN, skip verification entirely\n        if (profile.role === 'ADMIN') {\n          setAllow(true);\n          setLoading(false);\n          return;\n        }\n\n        // 2) For normal users, check verification status\n        const verRes = await fetch('/api/verification/status', { headers });\n        if (!verRes.ok) {\n          throw new Error('Failed to load verification status');\n        }\n        const data = await verRes.json();\n\n        // Expect data.status from your verification controller\n        if (data.status === 'APPROVED') {\n          setAllow(true);\n        } else {\n          // PENDING / REJECTED / anything else → must go to /verify\n          setAllow(false);\n        }\n      } catch (err) {\n        console.error('VerifiedRoute error:', err);\n        // On error, be safe and send user to /verify instead of crashing\n        setAllow(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    run();\n  }, []);\n\n  if (loading) {\n    return (\n      <div style={{ padding: 24 }}>\n        Checking your account status…\n      </div>\n    );\n  }\n\n  if (!allow) {\n    return <Navigate to=\"/verify\" replace />;\n  }\n\n  return children;\n};\n\nexport default VerifiedRoute;\n"],"mappings":"AAAA;AACA,MAAO,CAAAA,KAAK,EAAIC,SAAS,CAAEC,QAAQ,KAAQ,OAAO,CAClD,OAASC,QAAQ,KAAQ,kBAAkB,CAAC,OAAAC,GAAA,IAAAC,IAAA,yBAE5C,KAAM,CAAAC,aAAa,CAAGC,IAAA,EAAkB,IAAjB,CAAEC,QAAS,CAAC,CAAAD,IAAA,CACjC,KAAM,CAACE,OAAO,CAAEC,UAAU,CAAC,CAAGR,QAAQ,CAAC,IAAI,CAAC,CAC5C,KAAM,CAACS,KAAK,CAAEC,QAAQ,CAAC,CAAGV,QAAQ,CAAC,KAAK,CAAC,CAEzCD,SAAS,CAAC,IAAM,CACd,KAAM,CAAAY,KAAK,CAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC,CAC3C,GAAI,CAACF,KAAK,CAAE,CACVH,UAAU,CAAC,KAAK,CAAC,CACjBE,QAAQ,CAAC,KAAK,CAAC,CACf,OACF,CAEA,KAAM,CAAAI,GAAG,CAAG,KAAAA,CAAA,GAAY,CACtB,GAAI,CACF,KAAM,CAAAC,OAAO,CAAG,CAAEC,aAAa,WAAAC,MAAA,CAAYN,KAAK,CAAG,CAAC,CAEpD;AACA,KAAM,CAAAO,UAAU,CAAG,KAAM,CAAAC,KAAK,CAAC,oBAAoB,CAAE,CAAEJ,OAAQ,CAAC,CAAC,CACjE,GAAI,CAACG,UAAU,CAACE,EAAE,CAAE,CAClB,KAAM,IAAI,CAAAC,KAAK,CAAC,wBAAwB,CAAC,CAC3C,CACA,KAAM,CAAAC,OAAO,CAAG,KAAM,CAAAJ,UAAU,CAACK,IAAI,CAAC,CAAC,CAEvC;AACA,GAAID,OAAO,CAACE,IAAI,GAAK,OAAO,CAAE,CAC5Bd,QAAQ,CAAC,IAAI,CAAC,CACdF,UAAU,CAAC,KAAK,CAAC,CACjB,OACF,CAEA;AACA,KAAM,CAAAiB,MAAM,CAAG,KAAM,CAAAN,KAAK,CAAC,0BAA0B,CAAE,CAAEJ,OAAQ,CAAC,CAAC,CACnE,GAAI,CAACU,MAAM,CAACL,EAAE,CAAE,CACd,KAAM,IAAI,CAAAC,KAAK,CAAC,oCAAoC,CAAC,CACvD,CACA,KAAM,CAAAK,IAAI,CAAG,KAAM,CAAAD,MAAM,CAACF,IAAI,CAAC,CAAC,CAEhC;AACA,GAAIG,IAAI,CAACC,MAAM,GAAK,UAAU,CAAE,CAC9BjB,QAAQ,CAAC,IAAI,CAAC,CAChB,CAAC,IAAM,CACL;AACAA,QAAQ,CAAC,KAAK,CAAC,CACjB,CACF,CAAE,MAAOkB,GAAG,CAAE,CACZC,OAAO,CAACC,KAAK,CAAC,sBAAsB,CAAEF,GAAG,CAAC,CAC1C;AACAlB,QAAQ,CAAC,KAAK,CAAC,CACjB,CAAC,OAAS,CACRF,UAAU,CAAC,KAAK,CAAC,CACnB,CACF,CAAC,CAEDM,GAAG,CAAC,CAAC,CACP,CAAC,CAAE,EAAE,CAAC,CAEN,GAAIP,OAAO,CAAE,CACX,mBACEJ,IAAA,QAAK4B,KAAK,CAAE,CAAEC,OAAO,CAAE,EAAG,CAAE,CAAA1B,QAAA,CAAC,oCAE7B,CAAK,CAAC,CAEV,CAEA,GAAI,CAACG,KAAK,CAAE,CACV,mBAAON,IAAA,CAACF,QAAQ,EAACgC,EAAE,CAAC,SAAS,CAACC,OAAO,MAAE,CAAC,CAC1C,CAEA,MAAO,CAAA5B,QAAQ,CACjB,CAAC,CAED,cAAe,CAAAF,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}