{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\nimport React, { useEffect, useState } from 'react';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY);\nexport default function PaymentMethodPage() {\n  _s();\n  const [clientSecret, setClientSecret] = useState(null);\n  const [hasDefault, setHasDefault] = useState(false);\n  const [linking, setLinking] = useState(false);\n  useEffect(() => {\n    fetch('/api/payments/has-default-payment-method', {\n      credentials: 'include'\n    }).then(r => r.json()).then(d => setHasDefault(d.hasDefault)).catch(() => setHasDefault(false));\n  }, []);\n  const startBankLink = async () => {\n    setLinking(true);\n    try {\n      const r = await fetch('/api/payments/create-setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        credentials: 'include'\n      });\n      const {\n        clientSecret\n      } = await r.json();\n      setClientSecret(clientSecret);\n    } finally {\n      setLinking(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: \"Payment Method\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 36,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: hasDefault ? 'Bank account on file.' : 'No bank account on file.'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 37,\n      columnNumber: 7\n    }, this), !hasDefault && /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: startBankLink,\n      disabled: linking,\n      children: linking ? 'Starting…' : 'Link Bank Account'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 40,\n      columnNumber: 9\n    }, this), clientSecret && /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      options: {\n        clientSecret\n      },\n      children: /*#__PURE__*/_jsxDEV(BankLinkFlow, {\n        clientSecret: clientSecret,\n        onComplete: () => setHasDefault(true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 47,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 46,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 35,\n    columnNumber: 5\n  }, this);\n}\n_s(PaymentMethodPage, \"Av2o9sjiFyN5pAMDvEioJKbQUEk=\");\n_c = PaymentMethodPage;\nfunction BankLinkFlow({\n  clientSecret,\n  onComplete\n}) {\n  _s2();\n  const stripe = useStripe();\n  const handleLink = async () => {\n    const {\n      error: collectError\n    } = await stripe.collectBankAccountForSetup({\n      clientSecret,\n      params: {\n        payment_method_type: 'us_bank_account'\n      }\n    });\n    if (collectError) return alert(collectError.message);\n    const {\n      error: confirmError\n    } = await stripe.confirmUsBankAccountSetup(clientSecret);\n    if (confirmError) return alert(confirmError.message);\n    alert('Bank account saved.');\n    onComplete === null || onComplete === void 0 ? void 0 : onComplete();\n  };\n  return /*#__PURE__*/_jsxDEV(\"button\", {\n    onClick: handleLink,\n    children: \"Connect and Save Bank\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 10\n  }, this);\n}\n_s2(BankLinkFlow, \"idaYC8DiWdfB9k82Pr6iCdOULZw=\", false, function () {\n  return [useStripe];\n});\n_c2 = BankLinkFlow;\nvar _c, _c2;\n$RefreshReg$(_c, \"PaymentMethodPage\");\n$RefreshReg$(_c2, \"BankLinkFlow\");","map":{"version":3,"names":["React","useEffect","useState","loadStripe","Elements","useStripe","jsxDEV","_jsxDEV","stripePromise","import","meta","env","VITE_STRIPE_PUBLISHABLE_KEY","PaymentMethodPage","_s","clientSecret","setClientSecret","hasDefault","setHasDefault","linking","setLinking","fetch","credentials","then","r","json","d","catch","startBankLink","method","headers","children","fileName","_jsxFileName","lineNumber","columnNumber","onClick","disabled","stripe","options","BankLinkFlow","onComplete","_c","_s2","handleLink","error","collectError","collectBankAccountForSetup","params","payment_method_type","alert","message","confirmError","confirmUsBankAccountSetup","_c2","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\r\n\r\nconst stripePromise = loadStripe(import.meta.env.VITE_STRIPE_PUBLISHABLE_KEY);\r\n\r\nexport default function PaymentMethodPage() {\r\n  const [clientSecret, setClientSecret] = useState(null);\r\n  const [hasDefault, setHasDefault] = useState(false);\r\n  const [linking, setLinking] = useState(false);\r\n\r\n  useEffect(() => {\r\n    fetch('/api/payments/has-default-payment-method', { credentials: 'include' })\r\n      .then(r => r.json())\r\n      .then(d => setHasDefault(d.hasDefault))\r\n      .catch(() => setHasDefault(false));\r\n  }, []);\r\n\r\n  const startBankLink = async () => {\r\n    setLinking(true);\r\n    try {\r\n      const r = await fetch('/api/payments/create-setup-intent', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        credentials: 'include',\r\n      });\r\n      const { clientSecret } = await r.json();\r\n      setClientSecret(clientSecret);\r\n    } finally {\r\n      setLinking(false);\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div>\r\n      <h2>Payment Method</h2>\r\n      <p>{hasDefault ? 'Bank account on file.' : 'No bank account on file.'}</p>\r\n\r\n      {!hasDefault && (\r\n        <button onClick={startBankLink} disabled={linking}>\r\n          {linking ? 'Starting…' : 'Link Bank Account'}\r\n        </button>\r\n      )}\r\n\r\n      {clientSecret && (\r\n        <Elements stripe={stripePromise} options={{ clientSecret }}>\r\n          <BankLinkFlow clientSecret={clientSecret} onComplete={() => setHasDefault(true)} />\r\n        </Elements>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction BankLinkFlow({ clientSecret, onComplete }) {\r\n  const stripe = useStripe();\r\n\r\n  const handleLink = async () => {\r\n    const { error: collectError } = await stripe.collectBankAccountForSetup({\r\n      clientSecret,\r\n      params: { payment_method_type: 'us_bank_account' },\r\n    });\r\n    if (collectError) return alert(collectError.message);\r\n\r\n    const { error: confirmError } = await stripe.confirmUsBankAccountSetup(clientSecret);\r\n    if (confirmError) return alert(confirmError.message);\r\n\r\n    alert('Bank account saved.');\r\n    onComplete?.();\r\n  };\r\n\r\n  return <button onClick={handleLink}>Connect and Save Bank</button>;\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}