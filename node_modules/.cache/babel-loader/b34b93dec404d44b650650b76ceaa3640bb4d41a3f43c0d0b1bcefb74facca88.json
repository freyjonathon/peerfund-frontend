{"ast":null,"code":"import _objectSpread from\"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/features/repayments/RepaymentButton.jsx\nimport React,{useState}from'react';import axios from'axios';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function getAuthHeader(){let t=localStorage.getItem('token')||'';t=t.replace(/^\"|\"$/g,'');return t?{Authorization:\"Bearer \".concat(t)}:{};}/**\n * Props:\n *  - loanId: string\n *  - amount: number (installment this period â€“ display only)\n *  - onPaid?: () => void | Promise<void>\n */export default function RepaymentButton(_ref){let{loanId,amount,onPaid}=_ref;const[source,setSource]=useState('wallet');// 'wallet' | 'bank'\nconst[loading,setLoading]=useState(false);const[errorMsg,setErrorMsg]=useState('');const[okMsg,setOkMsg]=useState('');const handlePay=async()=>{setLoading(true);setErrorMsg('');setOkMsg('');try{const res=await axios.post(\"/api/loans/\".concat(loanId,\"/pay-next\"),{source},// ðŸ‘ˆ send selected source\n{headers:_objectSpread({'Content-Type':'application/json'},getAuthHeader()),withCredentials:true});setOkMsg('Payment submitted successfully.');if(typeof onPaid==='function'){await onPaid();}}catch(err){var _err$response,_err$response$data;console.error('payNextInstallment error',err);const msg=(err===null||err===void 0?void 0:(_err$response=err.response)===null||_err$response===void 0?void 0:(_err$response$data=_err$response.data)===null||_err$response$data===void 0?void 0:_err$response$data.error)||(err===null||err===void 0?void 0:err.message)||'Payment failed';setErrorMsg(msg);}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',flexWrap:'wrap',gap:12,alignItems:'center',marginBottom:8,fontSize:13,color:'#475569'},children:[/*#__PURE__*/_jsx(\"span\",{style:{fontWeight:600},children:\"Pay from:\"}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'inline-flex',alignItems:'center',gap:4},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"pay-source-\".concat(loanId),value:\"wallet\",checked:source==='wallet',onChange:()=>setSource('wallet')}),\"PeerFund wallet balance\"]}),/*#__PURE__*/_jsxs(\"label\",{style:{display:'inline-flex',alignItems:'center',gap:4},children:[/*#__PURE__*/_jsx(\"input\",{type:\"radio\",name:\"pay-source-\".concat(loanId),value:\"bank\",checked:source==='bank',onChange:()=>setSource('bank')}),\"Linked bank (payment method)\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:handlePay,disabled:loading,style:{background:'#4f46e5',color:'#fff',border:'1px solid #4f46e5',padding:'10px 16px',borderRadius:999,fontWeight:800,cursor:loading?'not-allowed':'pointer'},children:loading?'Processingâ€¦':'Pay next installment'}),errorMsg&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:6,fontSize:12,color:'#b91c1c',background:'#fee2e2',borderRadius:8,padding:'4px 8px'},children:errorMsg}),okMsg&&/*#__PURE__*/_jsx(\"div\",{style:{marginTop:6,fontSize:12,color:'#166534',background:'#dcfce7',borderRadius:8,padding:'4px 8px'},children:okMsg})]});}","map":{"version":3,"names":["React","useState","axios","jsx","_jsx","jsxs","_jsxs","getAuthHeader","t","localStorage","getItem","replace","Authorization","concat","RepaymentButton","_ref","loanId","amount","onPaid","source","setSource","loading","setLoading","errorMsg","setErrorMsg","okMsg","setOkMsg","handlePay","res","post","headers","_objectSpread","withCredentials","err","_err$response","_err$response$data","console","error","msg","response","data","message","style","marginTop","children","display","flexWrap","gap","alignItems","marginBottom","fontSize","color","fontWeight","type","name","value","checked","onChange","onClick","disabled","background","border","padding","borderRadius","cursor"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/RepaymentButton.jsx"],"sourcesContent":["// src/features/repayments/RepaymentButton.jsx\nimport React, { useState } from 'react';\nimport PropTypes from 'prop-types';\nimport axios from 'axios';\n\nfunction getAuthHeader() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, '');\n  return t ? { Authorization: `Bearer ${t}` } : {};\n}\n\n/**\n * Props:\n *  - loanId: string\n *  - amount: number (installment this period â€“ display only)\n *  - onPaid?: () => void | Promise<void>\n */\nexport default function RepaymentButton({ loanId, amount, onPaid }) {\n  const [source, setSource] = useState('wallet'); // 'wallet' | 'bank'\n  const [loading, setLoading] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n  const [okMsg, setOkMsg] = useState('');\n\n  const handlePay = async () => {\n    setLoading(true);\n    setErrorMsg('');\n    setOkMsg('');\n\n    try {\n      const res = await axios.post(\n        `/api/loans/${loanId}/pay-next`,\n        { source }, // ðŸ‘ˆ send selected source\n        {\n          headers: {\n            'Content-Type': 'application/json',\n            ...getAuthHeader(),\n          },\n          withCredentials: true,\n        }\n      );\n\n      setOkMsg('Payment submitted successfully.');\n      if (typeof onPaid === 'function') {\n        await onPaid();\n      }\n    } catch (err) {\n      console.error('payNextInstallment error', err);\n      const msg =\n        err?.response?.data?.error ||\n        err?.message ||\n        'Payment failed';\n      setErrorMsg(msg);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: 12 }}>\n     \n      {/* Source selector */}\n      <div\n        style={{\n          display: 'flex',\n          flexWrap: 'wrap',\n          gap: 12,\n          alignItems: 'center',\n          marginBottom: 8,\n          fontSize: 13,\n          color: '#475569',\n        }}\n      >\n        <span style={{ fontWeight: 600 }}>Pay from:</span>\n\n        <label style={{ display: 'inline-flex', alignItems: 'center', gap: 4 }}>\n          <input\n            type=\"radio\"\n            name={`pay-source-${loanId}`}\n            value=\"wallet\"\n            checked={source === 'wallet'}\n            onChange={() => setSource('wallet')}\n          />\n          PeerFund wallet balance\n        </label>\n\n        <label style={{ display: 'inline-flex', alignItems: 'center', gap: 4 }}>\n          <input\n            type=\"radio\"\n            name={`pay-source-${loanId}`}\n            value=\"bank\"\n            checked={source === 'bank'}\n            onChange={() => setSource('bank')}\n          />\n          Linked bank (payment method)\n        </label>\n      </div>\n\n      <button\n        onClick={handlePay}\n        disabled={loading}\n        style={{\n          background: '#4f46e5',\n          color: '#fff',\n          border: '1px solid #4f46e5',\n          padding: '10px 16px',\n          borderRadius: 999,\n          fontWeight: 800,\n          cursor: loading ? 'not-allowed' : 'pointer',\n        }}\n      >\n        {loading ? 'Processingâ€¦' : 'Pay next installment'}\n      </button>\n\n      {errorMsg && (\n        <div\n          style={{\n            marginTop: 6,\n            fontSize: 12,\n            color: '#b91c1c',\n            background: '#fee2e2',\n            borderRadius: 8,\n            padding: '4px 8px',\n          }}\n        >\n          {errorMsg}\n        </div>\n      )}\n\n      {okMsg && (\n        <div\n          style={{\n            marginTop: 6,\n            fontSize: 12,\n            color: '#166534',\n            background: '#dcfce7',\n            borderRadius: 8,\n            padding: '4px 8px',\n          }}\n        >\n          {okMsg}\n        </div>\n      )}\n    </div>\n  );\n}\n\nRepaymentButton.propTypes = {\n  loanId: PropTypes.string.isRequired,\n  amount: PropTypes.number,\n  onPaid: PropTypes.func,\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}