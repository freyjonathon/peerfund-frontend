{"ast":null,"code":"// src/features/wallet/SaveFundingCard.jsx\nimport React,{useState}from'react';import{CardElement,useStripe,useElements}from'@stripe/react-stripe-js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function SaveFundingCard(_ref){var _localStorage$getItem;let{onSaved}=_ref;const stripe=useStripe();const elements=useElements();const[busy,setBusy]=useState(false);const token=((_localStorage$getItem=localStorage.getItem('token'))===null||_localStorage$getItem===void 0?void 0:_localStorage$getItem.replace(/^\"|\"$/g,''))||'';const handleSave=async()=>{if(!stripe||!elements)return;try{setBusy(true);// 1. Ask backend for SetupIntent\nconst r=await fetch('/api/billing/card/setup-intent',{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)}});if(!r.ok)throw new Error(await r.text());const{clientSecret}=await r.json();// 2. Confirm card setup with CardElement\nconst card=elements.getElement(CardElement);const{error,setupIntent}=await stripe.confirmCardSetup(clientSecret,{payment_method:{card}});if(error)throw error;// 3. Tell backend which payment_method to store\nconst pmId=setupIntent.payment_method;const r2=await fetch('/api/billing/card/set-funding-method',{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(token)},body:JSON.stringify({paymentMethodId:pmId})});if(!r2.ok)throw new Error(await r2.text());alert('Funding card saved!');onSaved===null||onSaved===void 0?void 0:onSaved();}catch(e){console.error(e);alert(e.message||'Failed to save card');}finally{setBusy(false);}};return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:'1.5rem'},children:[/*#__PURE__*/_jsx(\"h3\",{children:\"Funding card\"}),/*#__PURE__*/_jsx(\"p\",{style:{fontSize:14,color:'#4b5563'},children:\"This card will be used for deposits, repayments, and SuperUser fees.\"}),/*#__PURE__*/_jsx(\"div\",{style:{border:'1px solid #e5e7eb',borderRadius:8,padding:10,margin:'8px 0 12px',background:'#fff'},children:/*#__PURE__*/_jsx(CardElement,{options:{hidePostalCode:false}})}),/*#__PURE__*/_jsx(\"button\",{onClick:handleSave,disabled:busy||!stripe,style:{background:'#4f46e5',border:'1px solid #4f46e5',color:'#fff',fontWeight:600,padding:'8px 14px',borderRadius:999,cursor:busy?'not-allowed':'pointer'},children:busy?'Saving…':'Save funding card'})]});}","map":{"version":3,"names":["React","useState","CardElement","useStripe","useElements","jsx","_jsx","jsxs","_jsxs","SaveFundingCard","_ref","_localStorage$getItem","onSaved","stripe","elements","busy","setBusy","token","localStorage","getItem","replace","handleSave","r","fetch","method","headers","Authorization","concat","ok","Error","text","clientSecret","json","card","getElement","error","setupIntent","confirmCardSetup","payment_method","pmId","r2","body","JSON","stringify","paymentMethodId","alert","e","console","message","style","marginTop","children","fontSize","color","border","borderRadius","padding","margin","background","options","hidePostalCode","onClick","disabled","fontWeight","cursor"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/SaveFundingCard.jsx"],"sourcesContent":["// src/features/wallet/SaveFundingCard.jsx\nimport React, { useState } from 'react';\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\nexport default function SaveFundingCard({ onSaved }) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const [busy, setBusy] = useState(false);\n\n  const token = localStorage.getItem('token')?.replace(/^\"|\"$/g, '') || '';\n\n  const handleSave = async () => {\n    if (!stripe || !elements) return;\n\n    try {\n      setBusy(true);\n\n      // 1. Ask backend for SetupIntent\n      const r = await fetch('/api/billing/card/setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n      });\n      if (!r.ok) throw new Error(await r.text());\n      const { clientSecret } = await r.json();\n\n      // 2. Confirm card setup with CardElement\n      const card = elements.getElement(CardElement);\n      const { error, setupIntent } = await stripe.confirmCardSetup(clientSecret, {\n        payment_method: { card },\n      });\n      if (error) throw error;\n\n      // 3. Tell backend which payment_method to store\n      const pmId = setupIntent.payment_method;\n      const r2 = await fetch('/api/billing/card/set-funding-method', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({ paymentMethodId: pmId }),\n      });\n      if (!r2.ok) throw new Error(await r2.text());\n\n      alert('Funding card saved!');\n      onSaved?.();\n    } catch (e) {\n      console.error(e);\n      alert(e.message || 'Failed to save card');\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: '1.5rem' }}>\n      <h3>Funding card</h3>\n      <p style={{ fontSize: 14, color: '#4b5563' }}>\n        This card will be used for deposits, repayments, and SuperUser fees.\n      </p>\n\n      <div\n        style={{\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          padding: 10,\n          margin: '8px 0 12px',\n          background: '#fff',\n        }}\n      >\n        <CardElement options={{ hidePostalCode: false }} />\n      </div>\n\n      <button\n        onClick={handleSave}\n        disabled={busy || !stripe}\n        style={{\n          background: '#4f46e5',\n          border: '1px solid #4f46e5',\n          color: '#fff',\n          fontWeight: 600,\n          padding: '8px 14px',\n          borderRadius: 999,\n          cursor: busy ? 'not-allowed' : 'pointer',\n        }}\n      >\n        {busy ? 'Saving…' : 'Save funding card'}\n      </button>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}