{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx\",\n  _s = $RefreshSig$();\n// src/features/money/MoneySummary.jsx\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport './MoneySummary.css';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LoanThreadModal from '../loans/LoanThreadModal';\n\n// helper: decode JWT for current user id\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction getCurrentUserId() {\n  ÃŸ;\n  const t = localStorage.getItem('token');\n  if (!t) return null;\n  try {\n    var _payload$userId;\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\n    return (_payload$userId = payload === null || payload === void 0 ? void 0 : payload.userId) !== null && _payload$userId !== void 0 ? _payload$userId : null;\n  } catch {\n    return null;\n  }\n}\nconst fmtMoney = n => typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\nconst MoneySummary = () => {\n  _s();\n  const [summary, setSummary] = useState({\n    loansGiven: [],\n    loansReceived: [],\n    myOpenRequests: []\n  });\n  const [loading, setLoading] = useState(true);\n\n  // expanded loan contract panels\n  const [expandedLoans, setExpandedLoans] = useState({});\n  // section accordions\n  const [openSec, setOpenSec] = useState({\n    open: true,\n    given: true,\n    received: true\n  });\n  const [payLoading, setPayLoading] = useState({});\n  const [profileUserId, setProfileUserId] = useState(null);\n\n  // NEW: controls the discussion modal\n  const [threadLoanId, setThreadLoanId] = useState(null);\n  const token = localStorage.getItem('token');\n  const navigate = useNavigate();\n  const fetchSummary = useCallback(async () => {\n    if (!token) return;\n    setLoading(true);\n    try {\n      // main summary\n      const res = await fetch('/api/users/my-money-summary', {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (!res.ok) throw new Error('Failed to fetch summary');\n      const data = await res.json();\n      const loansGiven = Array.isArray(data.loansGiven) ? data.loansGiven : Array.isArray(data.loansAsLender) ? data.loansAsLender : [];\n      const loansReceived = Array.isArray(data.loansReceived) ? data.loansReceived : Array.isArray(data.loansAsBorrower) ? data.loansAsBorrower : [];\n      let myOpenRequests = Array.isArray(data.myOpenRequests) ? data.myOpenRequests : [];\n\n      // fallback for open requests\n      if (!myOpenRequests.length) {\n        try {\n          const resOpen = await fetch('/api/loans/open', {\n            headers: {\n              Authorization: `Bearer ${token}`\n            }\n          });\n          if (resOpen.ok) {\n            const openListRaw = await resOpen.json();\n            const openList = Array.isArray(openListRaw) ? openListRaw : Array.isArray(openListRaw === null || openListRaw === void 0 ? void 0 : openListRaw.items) ? openListRaw.items : [];\n            const me = getCurrentUserId();\n            const mine = openList.filter(r => {\n              var _r$borrower;\n              const borrowerId = (r === null || r === void 0 ? void 0 : (_r$borrower = r.borrower) === null || _r$borrower === void 0 ? void 0 : _r$borrower.id) || (r === null || r === void 0 ? void 0 : r.borrowerId);\n              return me && borrowerId && borrowerId === me;\n            });\n            myOpenRequests = mine.map(r => {\n              var _r$borrower2, _r$borrower3;\n              return {\n                id: r.id,\n                amount: Number(r.amount),\n                duration: Number(r.duration),\n                interestRate: Number(r.interestRate),\n                purpose: r.purpose || '',\n                createdAt: r.createdAt || null,\n                borrowerName: (r === null || r === void 0 ? void 0 : (_r$borrower2 = r.borrower) === null || _r$borrower2 === void 0 ? void 0 : _r$borrower2.name) || '',\n                borrowerId: (r === null || r === void 0 ? void 0 : (_r$borrower3 = r.borrower) === null || _r$borrower3 === void 0 ? void 0 : _r$borrower3.id) || (r === null || r === void 0 ? void 0 : r.borrowerId) || null\n              };\n            });\n          }\n        } catch (e) {\n          console.warn('Fallback /api/loans/open failed', e);\n        }\n      }\n      setSummary({\n        loansGiven,\n        loansReceived,\n        myOpenRequests\n      });\n    } catch (err) {\n      console.error('Error fetching money summary:', err);\n      setSummary({\n        loansGiven: [],\n        loansReceived: [],\n        myOpenRequests: []\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [token]);\n  useEffect(() => {\n    fetchSummary();\n  }, [fetchSummary]);\n  const loanKey = (loan, idx) => (loan === null || loan === void 0 ? void 0 : loan.id) || (loan === null || loan === void 0 ? void 0 : loan._id) || String(idx);\n  const toggleLoanDetails = loanId => {\n    setExpandedLoans(prev => ({\n      ...Object.keys(prev).reduce((acc, id) => ({\n        ...acc,\n        [id]: false\n      }), {}),\n      [loanId]: !prev[loanId]\n    }));\n  };\n  const payNext = async loan => {\n    var _loan$installmentAmou;\n    const key = loanKey(loan);\n    const amount = (_loan$installmentAmou = loan === null || loan === void 0 ? void 0 : loan.installmentAmount) !== null && _loan$installmentAmou !== void 0 ? _loan$installmentAmou : 0;\n    if (!window.confirm(`Pay the next installment (${fmtMoney(amount)})?`)) return;\n    try {\n      setPayLoading(m => ({\n        ...m,\n        [key]: true\n      }));\n      const res = await fetch(`/api/loans/${loan.id || loan._id}/pay-next`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        credentials: 'include'\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error((data === null || data === void 0 ? void 0 : data.error) || 'Payment failed');\n      const paid = typeof data.amount === 'number' ? data.amount : amount;\n      alert(`Payment successful! Amount: ${fmtMoney(paid)}`);\n      await fetchSummary();\n    } catch (e) {\n      alert(e.message);\n    } finally {\n      setPayLoading(m => ({\n        ...m,\n        [key]: false\n      }));\n    }\n  };\n  const renderLoanCard = (loan, isLender, idx) => {\n    const key = loanKey(loan, idx);\n    const isExpanded = !!expandedLoans[key];\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\n    const canPay = !isLender && typeof loan.installmentAmount === 'number' && loan.installmentAmount > 0 && !!loan.nextDueDate;\n    const badgeClass = (loan.status || '').toUpperCase() === 'FUNDED' ? 'ms-badge ms-badge--ok' : 'ms-badge ms-badge--warn';\n    const fundedDate = loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-card-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: isLender ? 'Borrower' : 'Lender'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: otherParty || 'Unknown'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 181,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Amount\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 184,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fmtMoney(loan.amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 185,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 183,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Funded Date\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 188,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fundedDate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 189,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 187,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'right'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: badgeClass,\n            children: loan.status || 'â€”'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 192,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 191,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 178,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setThreadLoanId(loan.id || loan._id),\n          className: \"action-btn\",\n          title: \"Open conversation\",\n          children: \"\\uD83D\\uDCAC Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 199,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => toggleLoanDetails(key),\n          className: \"action-btn\",\n          children: isExpanded ? 'ðŸ”½ Hide Contract' : 'ðŸ“„ View Contract'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 197,\n        columnNumber: 9\n      }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-details\",\n        children: [loan.status && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 220,\n            columnNumber: 17\n          }, this), \" \", loan.status]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Interest Rate:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 224,\n            columnNumber: 15\n          }, this), ' ', typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 223,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Duration:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }, this), ' ', typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 227,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Next Due Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 232,\n            columnNumber: 15\n          }, this), ' ', loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 231,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Installment (this period):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 15\n          }, this), \" \", fmtMoney(loan.installmentAmount)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 13\n        }, this), isLender && typeof loan.amountCollected === 'number' && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Amount collected on loan:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 241,\n            columnNumber: 17\n          }, this), \" \", fmtMoney(loan.amountCollected)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 240,\n          columnNumber: 15\n        }, this), !isLender && canPay && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-6\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"action-btn primary\",\n            onClick: () => payNext(loan),\n            disabled: !!payLoading[key],\n            title: \"Pay next installment\",\n            children: payLoading[key] ? 'Processingâ€¦' : 'ðŸ’³ Make Payment'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 247,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 217,\n        columnNumber: 11\n      }, this)]\n    }, key, true, {\n      fileName: _jsxFileName,\n      lineNumber: 176,\n      columnNumber: 7\n    }, this);\n  };\n  const renderOpenRequestCard = req => /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-card\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card-row\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Borrower\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 268,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: req.borrowerName || 'You'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 269,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 267,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Amount\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 272,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: fmtMoney(req.amount)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 273,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 271,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Created\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 276,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 277,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 275,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          textAlign: 'right'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"ms-badge ms-badge--warn\",\n          children: \"Open\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 282,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 281,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-actions\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"action-btn\",\n        onClick: () => navigate(`/loan/${req.id}`),\n        title: \"View offers / discussion\",\n        children: \"View Offers / Discussion\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 288,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 287,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-details\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Duration:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 298,\n          columnNumber: 12\n        }, this), \" \", Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 298,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Interest Rate:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 299,\n          columnNumber: 29\n        }, this), \" \", Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 299,\n        columnNumber: 9\n      }, this), req.purpose ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Reason:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 300,\n          columnNumber: 44\n        }, this), \" \", req.purpose]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 300,\n        columnNumber: 24\n      }, this) : null]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 297,\n      columnNumber: 7\n    }, this)]\n  }, req.id, true, {\n    fileName: _jsxFileName,\n    lineNumber: 264,\n    columnNumber: 5\n  }, this);\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"ms-loading ms-container\",\n    children: \"Loading money summary...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 305,\n    columnNumber: 23\n  }, this);\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"ms-heading\",\n      children: \"\\uD83D\\uDCB5 My Money Summary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          open: !s.open\n        })),\n        \"aria-expanded\": openSec.open,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"My Open Loan Requests\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 322,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.open ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 323,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 317,\n        columnNumber: 9\n      }, this), openSec.open && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: myOpen.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"You have no open requests.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 328,\n          columnNumber: 15\n        }, this) : myOpen.map(renderOpenRequestCard)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 326,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 316,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          given: !s.given\n        })),\n        \"aria-expanded\": openSec.given,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Given (I'm the Lender)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.given ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 344,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 338,\n        columnNumber: 9\n      }, this), openSec.given && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: given.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans given yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 15\n        }, this) : given.map((loan, idx) => renderLoanCard(loan, true, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 347,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 337,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          received: !s.received\n        })),\n        \"aria-expanded\": openSec.received,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Received (I'm the Borrower)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 364,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.received ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 9\n      }, this), openSec.received && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: received.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans received yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 370,\n          columnNumber: 15\n        }, this) : received.map((loan, idx) => renderLoanCard(loan, false, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 368,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 358,\n      columnNumber: 7\n    }, this), profileUserId && /*#__PURE__*/_jsxDEV(UserProfileModal, {\n      userId: profileUserId,\n      onClose: () => setProfileUserId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 379,\n      columnNumber: 9\n    }, this), threadLoanId && /*#__PURE__*/_jsxDEV(LoanThreadModal, {\n      loanId: threadLoanId,\n      onClose: () => setThreadLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 384,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 312,\n    columnNumber: 5\n  }, this);\n};\n_s(MoneySummary, \"Yw7FuQLv8+7oHjMzrDhEEp2DTYk=\", false, function () {\n  return [useNavigate];\n});\n_c = MoneySummary;\nexport default MoneySummary;\nvar _c;\n$RefreshReg$(_c, \"MoneySummary\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","useNavigate","UserProfileModal","LoanThreadModal","jsxDEV","_jsxDEV","getCurrentUserId","ÃŸ","t","localStorage","getItem","_payload$userId","payload","JSON","parse","atob","split","userId","fmtMoney","n","Number","isNaN","toFixed","MoneySummary","_s","summary","setSummary","loansGiven","loansReceived","myOpenRequests","loading","setLoading","expandedLoans","setExpandedLoans","openSec","setOpenSec","open","given","received","payLoading","setPayLoading","profileUserId","setProfileUserId","threadLoanId","setThreadLoanId","token","navigate","fetchSummary","res","fetch","headers","Authorization","ok","Error","data","json","Array","isArray","loansAsLender","loansAsBorrower","length","resOpen","openListRaw","openList","items","me","mine","filter","r","_r$borrower","borrowerId","borrower","id","map","_r$borrower2","_r$borrower3","amount","duration","interestRate","purpose","createdAt","borrowerName","name","e","console","warn","err","error","loanKey","loan","idx","_id","String","toggleLoanDetails","loanId","prev","Object","keys","reduce","acc","payNext","_loan$installmentAmou","key","installmentAmount","window","confirm","m","method","credentials","paid","alert","message","renderLoanCard","isLender","isExpanded","otherParty","lenderName","canPay","nextDueDate","badgeClass","status","toUpperCase","fundedDate","Date","toLocaleDateString","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","textAlign","onClick","title","amountCollected","disabled","renderOpenRequestCard","req","isFinite","myOpen","s","onClose","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx"],"sourcesContent":["// src/features/money/MoneySummary.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './MoneySummary.css';\r\nimport UserProfileModal from '../../components/UserProfileModal';\r\nimport LoanThreadModal from '../loans/LoanThreadModal';\r\n\r\n// helper: decode JWT for current user id\r\nfunction getCurrentUserId() {ÃŸ\r\n  const t = localStorage.getItem('token');\r\n  if (!t) return null;\r\n  try {\r\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\r\n    return payload?.userId ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nconst fmtMoney = (n) =>\r\n  typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\r\n\r\nconst MoneySummary = () => {\r\n  const [summary, setSummary] = useState({\r\n    loansGiven: [],\r\n    loansReceived: [],\r\n    myOpenRequests: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // expanded loan contract panels\r\n  const [expandedLoans, setExpandedLoans] = useState({});\r\n  // section accordions\r\n  const [openSec, setOpenSec] = useState({\r\n    open: true,\r\n    given: true,\r\n    received: true,\r\n  });\r\n\r\n  const [payLoading, setPayLoading] = useState({});\r\n  const [profileUserId, setProfileUserId] = useState(null);\r\n\r\n  // NEW: controls the discussion modal\r\n  const [threadLoanId, setThreadLoanId] = useState(null);\r\n\r\n  const token = localStorage.getItem('token');\r\n  const navigate = useNavigate();\r\n\r\n  const fetchSummary = useCallback(async () => {\r\n    if (!token) return;\r\n    setLoading(true);\r\n    try {\r\n      // main summary\r\n      const res = await fetch('/api/users/my-money-summary', {\r\n        headers: { Authorization: `Bearer ${token}` },\r\n      });\r\n      if (!res.ok) throw new Error('Failed to fetch summary');\r\n      const data = await res.json();\r\n\r\n      const loansGiven = Array.isArray(data.loansGiven)\r\n        ? data.loansGiven\r\n        : Array.isArray(data.loansAsLender)\r\n        ? data.loansAsLender\r\n        : [];\r\n\r\n      const loansReceived = Array.isArray(data.loansReceived)\r\n        ? data.loansReceived\r\n        : Array.isArray(data.loansAsBorrower)\r\n        ? data.loansAsBorrower\r\n        : [];\r\n\r\n      let myOpenRequests = Array.isArray(data.myOpenRequests)\r\n        ? data.myOpenRequests\r\n        : [];\r\n\r\n      // fallback for open requests\r\n      if (!myOpenRequests.length) {\r\n        try {\r\n          const resOpen = await fetch('/api/loans/open', {\r\n            headers: { Authorization: `Bearer ${token}` },\r\n          });\r\n          if (resOpen.ok) {\r\n            const openListRaw = await resOpen.json();\r\n            const openList = Array.isArray(openListRaw)\r\n              ? openListRaw\r\n              : Array.isArray(openListRaw?.items)\r\n              ? openListRaw.items\r\n              : [];\r\n            const me = getCurrentUserId();\r\n            const mine = openList.filter((r) => {\r\n              const borrowerId = r?.borrower?.id || r?.borrowerId;\r\n              return me && borrowerId && borrowerId === me;\r\n            });\r\n            myOpenRequests = mine.map((r) => ({\r\n              id: r.id,\r\n              amount: Number(r.amount),\r\n              duration: Number(r.duration),\r\n              interestRate: Number(r.interestRate),\r\n              purpose: r.purpose || '',\r\n              createdAt: r.createdAt || null,\r\n              borrowerName: r?.borrower?.name || '',\r\n              borrowerId: r?.borrower?.id || r?.borrowerId || null,\r\n            }));\r\n          }\r\n        } catch (e) {\r\n          console.warn('Fallback /api/loans/open failed', e);\r\n        }\r\n      }\r\n\r\n      setSummary({ loansGiven, loansReceived, myOpenRequests });\r\n    } catch (err) {\r\n      console.error('Error fetching money summary:', err);\r\n      setSummary({ loansGiven: [], loansReceived: [], myOpenRequests: [] });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [token]);\r\n\r\n  useEffect(() => {\r\n    fetchSummary();\r\n  }, [fetchSummary]);\r\n\r\n  const loanKey = (loan, idx) => loan?.id || loan?._id || String(idx);\r\n\r\n  const toggleLoanDetails = (loanId) => {\r\n    setExpandedLoans((prev) => ({\r\n      ...(Object.keys(prev).reduce((acc, id) => ({ ...acc, [id]: false }), {})),\r\n      [loanId]: !prev[loanId],\r\n    }));\r\n  };\r\n\r\n  const payNext = async (loan) => {\r\n    const key = loanKey(loan);\r\n    const amount = loan?.installmentAmount ?? 0;\r\n    if (!window.confirm(`Pay the next installment (${fmtMoney(amount)})?`)) return;\r\n    try {\r\n      setPayLoading((m) => ({ ...m, [key]: true }));\r\n      const res = await fetch(`/api/loans/${loan.id || loan._id}/pay-next`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${token}`,\r\n        },\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data?.error || 'Payment failed');\r\n      const paid = typeof data.amount === 'number' ? data.amount : amount;\r\n      alert(`Payment successful! Amount: ${fmtMoney(paid)}`);\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      alert(e.message);\r\n    } finally {\r\n      setPayLoading((m) => ({ ...m, [key]: false }));\r\n    }\r\n  };\r\n\r\n  const renderLoanCard = (loan, isLender, idx) => {\r\n    const key = loanKey(loan, idx);\r\n    const isExpanded = !!expandedLoans[key];\r\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\r\n\r\n    const canPay =\r\n      !isLender &&\r\n      typeof loan.installmentAmount === 'number' &&\r\n      loan.installmentAmount > 0 &&\r\n      !!loan.nextDueDate;\r\n\r\n    const badgeClass =\r\n      (loan.status || '').toUpperCase() === 'FUNDED' ? 'ms-badge ms-badge--ok' : 'ms-badge ms-badge--warn';\r\n\r\n    const fundedDate =\r\n      loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\r\n\r\n    return (\r\n      <div className=\"ms-card\" key={key}>\r\n        {/* Collapsed row */}\r\n        <div className=\"ms-card-row\">\r\n          <div>\r\n            <div className=\"ms-label\">{isLender ? 'Borrower' : 'Lender'}</div>\r\n            <div className=\"ms-value-strong\">{otherParty || 'Unknown'}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(loan.amount)}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Funded Date</div>\r\n            <div className=\"ms-value-strong\">{fundedDate}</div>\r\n          </div>\r\n          <div style={{ textAlign: 'right' }}>\r\n            <span className={badgeClass}>{loan.status || 'â€”'}</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Action row */}\r\n        <div className=\"ms-actions\">\r\n          {/* UPDATED: open thread in a modal instead of navigating away */}\r\n          <button\r\n            onClick={() => setThreadLoanId(loan.id || loan._id)}\r\n            className=\"action-btn\"\r\n            title=\"Open conversation\"\r\n          >\r\n            ðŸ’¬ Messages\r\n          </button>\r\n\r\n          <button\r\n            onClick={() => toggleLoanDetails(key)}\r\n            className=\"action-btn\"\r\n          >\r\n            {isExpanded ? 'ðŸ”½ Hide Contract' : 'ðŸ“„ View Contract'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Details */}\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            {loan.status && (\r\n              <p className=\"mt-6\">\r\n                <strong>Status:</strong> {loan.status}\r\n              </p>\r\n            )}\r\n            <p className=\"mt-6\">\r\n              <strong>Interest Rate:</strong>{' '}\r\n              {typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Duration:</strong>{' '}\r\n              {typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Next Due Date:</strong>{' '}\r\n              {loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Installment (this period):</strong> {fmtMoney(loan.installmentAmount)}\r\n            </p>\r\n\r\n            {isLender && typeof loan.amountCollected === 'number' && (\r\n              <p className=\"mt-6\">\r\n                <strong>Amount collected on loan:</strong> {fmtMoney(loan.amountCollected)}\r\n              </p>\r\n            )}\r\n\r\n            {!isLender && canPay && (\r\n              <div className=\"mt-6\">\r\n                <button\r\n                  className=\"action-btn primary\"\r\n                  onClick={() => payNext(loan)}\r\n                  disabled={!!payLoading[key]}\r\n                  title=\"Pay next installment\"\r\n                >\r\n                  {payLoading[key] ? 'Processingâ€¦' : 'ðŸ’³ Make Payment'}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderOpenRequestCard = (req) => (\r\n    <div className=\"ms-card\" key={req.id}>\r\n      {/* Collapsed row */}\r\n      <div className=\"ms-card-row\">\r\n        <div>\r\n          <div className=\"ms-label\">Borrower</div>\r\n          <div className=\"ms-value-strong\">{req.borrowerName || 'You'}</div>\r\n        </div>\r\n        <div>\r\n          <div className=\"ms-label\">Amount</div>\r\n          <div className=\"ms-value-strong\">{fmtMoney(req.amount)}</div>\r\n        </div>\r\n        <div>\r\n          <div className=\"ms-label\">Created</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'}\r\n          </div>\r\n        </div>\r\n        <div style={{ textAlign: 'right' }}>\r\n          <span className=\"ms-badge ms-badge--warn\">Open</span>\r\n        </div>\r\n      </div>\r\n\r\n      {/* actions + details */}\r\n      <div className=\"ms-actions\">\r\n        <button\r\n          className=\"action-btn\"\r\n          onClick={() => navigate(`/loan/${req.id}`)}\r\n          title=\"View offers / discussion\"\r\n        >\r\n          View Offers / Discussion\r\n        </button>\r\n      </div>\r\n\r\n      <div className=\"ms-details\">\r\n        <p><strong>Duration:</strong> {Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”'}</p>\r\n        <p className=\"mt-6\"><strong>Interest Rate:</strong> {Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”'}</p>\r\n        {req.purpose ? <p className=\"mt-6\"><strong>Reason:</strong> {req.purpose}</p> : null}\r\n      </div>\r\n    </div>\r\n  );\r\n\r\n  if (loading) return <p className=\"ms-loading ms-container\">Loading money summary...</p>;\r\n\r\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\r\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\r\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\r\n\r\n  return (\r\n    <div className=\"ms-container\">\r\n      <h2 className=\"ms-heading\">ðŸ’µ My Money Summary</h2>\r\n\r\n      {/* Section: Open Requests */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, open: !s.open }))}\r\n          aria-expanded={openSec.open}\r\n        >\r\n          <div className=\"ms-subheading\">My Open Loan Requests</div>\r\n          <div className=\"ms-caret\">{openSec.open ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.open && (\r\n          <div className=\"ms-section-body\">\r\n            {myOpen.length === 0 ? (\r\n              <p className=\"ms-empty\">You have no open requests.</p>\r\n            ) : (\r\n              myOpen.map(renderOpenRequestCard)\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Given */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, given: !s.given }))}\r\n          aria-expanded={openSec.given}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Given (I'm the Lender)</div>\r\n          <div className=\"ms-caret\">{openSec.given ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.given && (\r\n          <div className=\"ms-section-body\">\r\n            {given.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans given yet.</p>\r\n            ) : (\r\n              given.map((loan, idx) => renderLoanCard(loan, true, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Received */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, received: !s.received }))}\r\n          aria-expanded={openSec.received}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Received (I'm the Borrower)</div> \r\n          <div className=\"ms-caret\">{openSec.received ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.received && (\r\n          <div className=\"ms-section-body\">\r\n            {received.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans received yet.</p>\r\n            ) : (\r\n              received.map((loan, idx) => renderLoanCard(loan, false, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {profileUserId && (\r\n        <UserProfileModal userId={profileUserId} onClose={() => setProfileUserId(null)} />\r\n      )}\r\n\r\n      {/* NEW: thread modal mount */}\r\n      {threadLoanId && (\r\n        <LoanThreadModal loanId={threadLoanId} onClose={() => setThreadLoanId(null)} />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MoneySummary;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}