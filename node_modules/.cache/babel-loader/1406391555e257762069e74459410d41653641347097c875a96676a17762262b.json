{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/WalletPanel.jsx\",\n  _s = $RefreshSig$();\n// src/features/wallet/WalletPanel.jsx\nimport React, { useState } from 'react';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { createDepositIntent, fetchWallet } from './walletApi';\n\n/* ---------- Stripe publishable key (CRA style) ---------- */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\nconst stripePk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\nconst stripePromise = stripePk ? loadStripe(stripePk) : null;\nexport default function WalletPanel({\n  onClose,\n  onBalanceUpdated\n}) {\n  _s();\n  const [amount, setAmount] = useState('25.00');\n  const [busy, setBusy] = useState(false);\n\n  // Strip non-numeric chars but keep decimal\n  const cleanNumber = Number(amount.replace(/[^0-9.]/g, '')) || 0;\n  const deposit = async () => {\n    try {\n      const dollars = cleanNumber;\n      if (!Number.isFinite(dollars) || dollars <= 0) {\n        alert('Please enter a valid amount.');\n        return;\n      }\n      setBusy(true);\n\n      // Backend expects { amount } in dollars\n      const {\n        clientSecret,\n        simulated\n      } = await createDepositIntent({\n        amount: dollars\n      });\n      if (!simulated && stripePromise && clientSecret) {\n        const stripe = await stripePromise;\n        const result = await stripe.confirmCardPayment(clientSecret);\n        if (result.error) throw new Error(result.error.message);\n      }\n      // If simulated, backend will mark it PENDING and you can confirm via dev endpoint\n\n      // Refresh wallet balance from backend\n      const w = await fetchWallet();\n      if (onBalanceUpdated) {\n        // prefer cents if available, fall back to dollars * 100\n        const cents = typeof w.availableCents === 'number' ? w.availableCents : Math.round((w.available || 0) * 100);\n        onBalanceUpdated(cents);\n      }\n      onClose && onClose();\n    } catch (e) {\n      console.error('Deposit failed:', e);\n      alert(e.message || 'Deposit failed');\n    } finally {\n      setBusy(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"wallet-panel\",\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Add funds\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this), !stripePk && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginBottom: 8,\n        fontSize: 12,\n        color: '#b91c1c',\n        background: '#fef2f2',\n        border: '1px solid #fecaca',\n        borderRadius: 6,\n        padding: '6px 8px'\n      },\n      children: [\"Stripe publishable key missing (\", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"REACT_APP_STRIPE_PUBLISHABLE_KEY\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 78,\n        columnNumber: 12\n      }, this), \"). Deposits will use simulated mode only.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 66,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row\",\n      children: [/*#__PURE__*/_jsxDEV(\"label\", {\n        children: \"Amount\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 84,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"input-wrap\",\n        children: [/*#__PURE__*/_jsxDEV(\"span\", {\n          children: \"$\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 86,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          value: amount,\n          onChange: e => setAmount(e.target.value),\n          inputMode: \"decimal\",\n          placeholder: \"25.00\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 85,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"row right\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn\",\n        onClick: onClose,\n        disabled: busy,\n        children: \"Cancel\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"btn primary\",\n        onClick: deposit,\n        disabled: busy,\n        children: busy ? 'Processing…' : 'Continue'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 100,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 62,\n    columnNumber: 5\n  }, this);\n}\n_s(WalletPanel, \"MpJ01GfBDZGkHwrnlliXkhM4MYk=\");\n_c = WalletPanel;\nvar _c;\n$RefreshReg$(_c, \"WalletPanel\");","map":{"version":3,"names":["React","useState","loadStripe","createDepositIntent","fetchWallet","jsxDEV","_jsxDEV","rawPk","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","trim","stripePk","test","stripePromise","WalletPanel","onClose","onBalanceUpdated","_s","amount","setAmount","busy","setBusy","cleanNumber","Number","replace","deposit","dollars","isFinite","alert","clientSecret","simulated","stripe","result","confirmCardPayment","error","Error","message","w","cents","availableCents","Math","round","available","e","console","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","marginBottom","fontSize","color","background","border","borderRadius","padding","value","onChange","target","inputMode","placeholder","onClick","disabled","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/WalletPanel.jsx"],"sourcesContent":["// src/features/wallet/WalletPanel.jsx\nimport React, { useState } from 'react';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { createDepositIntent, fetchWallet } from './walletApi';\n\n/* ---------- Stripe publishable key (CRA style) ---------- */\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\nconst stripePk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\nconst stripePromise = stripePk ? loadStripe(stripePk) : null;\n\nexport default function WalletPanel({ onClose, onBalanceUpdated }) {\n  const [amount, setAmount] = useState('25.00');\n  const [busy, setBusy] = useState(false);\n\n  // Strip non-numeric chars but keep decimal\n  const cleanNumber = Number(amount.replace(/[^0-9.]/g, '')) || 0;\n\n  const deposit = async () => {\n    try {\n      const dollars = cleanNumber;\n\n      if (!Number.isFinite(dollars) || dollars <= 0) {\n        alert('Please enter a valid amount.');\n        return;\n      }\n\n      setBusy(true);\n\n      // Backend expects { amount } in dollars\n      const { clientSecret, simulated } = await createDepositIntent({\n        amount: dollars,\n      });\n\n      if (!simulated && stripePromise && clientSecret) {\n        const stripe = await stripePromise;\n        const result = await stripe.confirmCardPayment(clientSecret);\n        if (result.error) throw new Error(result.error.message);\n      }\n      // If simulated, backend will mark it PENDING and you can confirm via dev endpoint\n\n      // Refresh wallet balance from backend\n      const w = await fetchWallet();\n      if (onBalanceUpdated) {\n        // prefer cents if available, fall back to dollars * 100\n        const cents =\n          typeof w.availableCents === 'number'\n            ? w.availableCents\n            : Math.round((w.available || 0) * 100);\n        onBalanceUpdated(cents);\n      }\n\n      onClose && onClose();\n    } catch (e) {\n      console.error('Deposit failed:', e);\n      alert(e.message || 'Deposit failed');\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  return (\n    <div className=\"wallet-panel\">\n      <h3>Add funds</h3>\n\n      {!stripePk && (\n        <div\n          style={{\n            marginBottom: 8,\n            fontSize: 12,\n            color: '#b91c1c',\n            background: '#fef2f2',\n            border: '1px solid #fecaca',\n            borderRadius: 6,\n            padding: '6px 8px',\n          }}\n        >\n          Stripe publishable key missing\n          (<code>REACT_APP_STRIPE_PUBLISHABLE_KEY</code>). Deposits will use\n          simulated mode only.\n        </div>\n      )}\n\n      <div className=\"row\">\n        <label>Amount</label>\n        <div className=\"input-wrap\">\n          <span>$</span>\n          <input\n            value={amount}\n            onChange={(e) => setAmount(e.target.value)}\n            inputMode=\"decimal\"\n            placeholder=\"25.00\"\n          />\n        </div>\n      </div>\n\n      <div className=\"row right\">\n        <button className=\"btn\" onClick={onClose} disabled={busy}>\n          Cancel\n        </button>\n        <button className=\"btn primary\" onClick={deposit} disabled={busy}>\n          {busy ? 'Processing…' : 'Continue'}\n        </button>\n      </div>\n    </div>\n  );\n}\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,QAAQ,QAAQ,OAAO;AACvC,SAASC,UAAU,QAAQ,mBAAmB;AAC9C,SAASC,mBAAmB,EAAEC,WAAW,QAAQ,aAAa;;AAE9D;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,MAAMC,KAAK,GAAG,CAACC,OAAO,CAACC,GAAG,CAACC,gCAAgC,IAAI,EAAE,EAAEC,IAAI,CAAC,CAAC;AACzE,MAAMC,QAAQ,GAAG,gCAAgC,CAACC,IAAI,CAACN,KAAK,CAAC,GAAGA,KAAK,GAAG,EAAE;AAC1E,MAAMO,aAAa,GAAGF,QAAQ,GAAGV,UAAU,CAACU,QAAQ,CAAC,GAAG,IAAI;AAE5D,eAAe,SAASG,WAAWA,CAAC;EAAEC,OAAO;EAAEC;AAAiB,CAAC,EAAE;EAAAC,EAAA;EACjE,MAAM,CAACC,MAAM,EAAEC,SAAS,CAAC,GAAGnB,QAAQ,CAAC,OAAO,CAAC;EAC7C,MAAM,CAACoB,IAAI,EAAEC,OAAO,CAAC,GAAGrB,QAAQ,CAAC,KAAK,CAAC;;EAEvC;EACA,MAAMsB,WAAW,GAAGC,MAAM,CAACL,MAAM,CAACM,OAAO,CAAC,UAAU,EAAE,EAAE,CAAC,CAAC,IAAI,CAAC;EAE/D,MAAMC,OAAO,GAAG,MAAAA,CAAA,KAAY;IAC1B,IAAI;MACF,MAAMC,OAAO,GAAGJ,WAAW;MAE3B,IAAI,CAACC,MAAM,CAACI,QAAQ,CAACD,OAAO,CAAC,IAAIA,OAAO,IAAI,CAAC,EAAE;QAC7CE,KAAK,CAAC,8BAA8B,CAAC;QACrC;MACF;MAEAP,OAAO,CAAC,IAAI,CAAC;;MAEb;MACA,MAAM;QAAEQ,YAAY;QAAEC;MAAU,CAAC,GAAG,MAAM5B,mBAAmB,CAAC;QAC5DgB,MAAM,EAAEQ;MACV,CAAC,CAAC;MAEF,IAAI,CAACI,SAAS,IAAIjB,aAAa,IAAIgB,YAAY,EAAE;QAC/C,MAAME,MAAM,GAAG,MAAMlB,aAAa;QAClC,MAAMmB,MAAM,GAAG,MAAMD,MAAM,CAACE,kBAAkB,CAACJ,YAAY,CAAC;QAC5D,IAAIG,MAAM,CAACE,KAAK,EAAE,MAAM,IAAIC,KAAK,CAACH,MAAM,CAACE,KAAK,CAACE,OAAO,CAAC;MACzD;MACA;;MAEA;MACA,MAAMC,CAAC,GAAG,MAAMlC,WAAW,CAAC,CAAC;MAC7B,IAAIa,gBAAgB,EAAE;QACpB;QACA,MAAMsB,KAAK,GACT,OAAOD,CAAC,CAACE,cAAc,KAAK,QAAQ,GAChCF,CAAC,CAACE,cAAc,GAChBC,IAAI,CAACC,KAAK,CAAC,CAACJ,CAAC,CAACK,SAAS,IAAI,CAAC,IAAI,GAAG,CAAC;QAC1C1B,gBAAgB,CAACsB,KAAK,CAAC;MACzB;MAEAvB,OAAO,IAAIA,OAAO,CAAC,CAAC;IACtB,CAAC,CAAC,OAAO4B,CAAC,EAAE;MACVC,OAAO,CAACV,KAAK,CAAC,iBAAiB,EAAES,CAAC,CAAC;MACnCf,KAAK,CAACe,CAAC,CAACP,OAAO,IAAI,gBAAgB,CAAC;IACtC,CAAC,SAAS;MACRf,OAAO,CAAC,KAAK,CAAC;IAChB;EACF,CAAC;EAED,oBACEhB,OAAA;IAAKwC,SAAS,EAAC,cAAc;IAAAC,QAAA,gBAC3BzC,OAAA;MAAAyC,QAAA,EAAI;IAAS;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,EAEjB,CAACvC,QAAQ,iBACRN,OAAA;MACE8C,KAAK,EAAE;QACLC,YAAY,EAAE,CAAC;QACfC,QAAQ,EAAE,EAAE;QACZC,KAAK,EAAE,SAAS;QAChBC,UAAU,EAAE,SAAS;QACrBC,MAAM,EAAE,mBAAmB;QAC3BC,YAAY,EAAE,CAAC;QACfC,OAAO,EAAE;MACX,CAAE;MAAAZ,QAAA,GACH,kCAEE,eAAAzC,OAAA;QAAAyC,QAAA,EAAM;MAAgC;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAM,CAAC,6CAEhD;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CACN,eAED7C,OAAA;MAAKwC,SAAS,EAAC,KAAK;MAAAC,QAAA,gBAClBzC,OAAA;QAAAyC,QAAA,EAAO;MAAM;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAO,CAAC,eACrB7C,OAAA;QAAKwC,SAAS,EAAC,YAAY;QAAAC,QAAA,gBACzBzC,OAAA;UAAAyC,QAAA,EAAM;QAAC;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC,eACd7C,OAAA;UACEsD,KAAK,EAAEzC,MAAO;UACd0C,QAAQ,EAAGjB,CAAC,IAAKxB,SAAS,CAACwB,CAAC,CAACkB,MAAM,CAACF,KAAK,CAAE;UAC3CG,SAAS,EAAC,SAAS;UACnBC,WAAW,EAAC;QAAO;UAAAhB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpB,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACC,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACH,CAAC,eAEN7C,OAAA;MAAKwC,SAAS,EAAC,WAAW;MAAAC,QAAA,gBACxBzC,OAAA;QAAQwC,SAAS,EAAC,KAAK;QAACmB,OAAO,EAAEjD,OAAQ;QAACkD,QAAQ,EAAE7C,IAAK;QAAA0B,QAAA,EAAC;MAE1D;QAAAC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAQ,CAAC,eACT7C,OAAA;QAAQwC,SAAS,EAAC,aAAa;QAACmB,OAAO,EAAEvC,OAAQ;QAACwC,QAAQ,EAAE7C,IAAK;QAAA0B,QAAA,EAC9D1B,IAAI,GAAG,aAAa,GAAG;MAAU;QAAA2B,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC5B,CAAC;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACN,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OACH,CAAC;AAEV;AAACjC,EAAA,CA/FuBH,WAAW;AAAAoD,EAAA,GAAXpD,WAAW;AAAA,IAAAoD,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}