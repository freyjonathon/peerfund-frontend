{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/auth/VerifiedRoute.jsx\",\n  _s = $RefreshSig$();\n// src/features/auth/VerifiedRoute.jsx\nimport React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst VerifiedRoute = ({\n  children\n}) => {\n  _s();\n  const [loading, setLoading] = useState(true);\n  const [allow, setAllow] = useState(false);\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setLoading(false);\n      setAllow(false);\n      return;\n    }\n    const run = async () => {\n      try {\n        const headers = {\n          Authorization: `Bearer ${token}`\n        };\n\n        // 1) Load profile so we can see the user's role\n        const profileRes = await fetch('/api/users/profile', {\n          headers\n        });\n        if (!profileRes.ok) {\n          throw new Error('Failed to load profile');\n        }\n        const profile = await profileRes.json();\n\n        // If ADMIN, skip verification entirely\n        if (profile.role === 'ADMIN') {\n          setAllow(true);\n          setLoading(false);\n          return;\n        }\n\n        // 2) For normal users, check verification status\n        const verRes = await fetch('/api/verification/status', {\n          headers\n        });\n        if (!verRes.ok) {\n          throw new Error('Failed to load verification status');\n        }\n        const data = await verRes.json();\n\n        // Expect data.status from your verification controller\n        if (data.status === 'APPROVED') {\n          setAllow(true);\n        } else {\n          // PENDING / REJECTED / anything else → must go to /verify\n          setAllow(false);\n        }\n      } catch (err) {\n        console.error('VerifiedRoute error:', err);\n        // On error, be safe and send user to /verify instead of crashing\n        setAllow(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n    run();\n  }, []);\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        padding: 24\n      },\n      children: \"Checking your account status\\u2026\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 63,\n      columnNumber: 7\n    }, this);\n  }\n  if (!allow) {\n    return /*#__PURE__*/_jsxDEV(Navigate, {\n      to: \"/verify\",\n      replace: true\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 12\n    }, this);\n  }\n  return children;\n};\n_s(VerifiedRoute, \"3FesVAEXHwzqTzH83SOdZv7IjZA=\");\n_c = VerifiedRoute;\nexport default VerifiedRoute;\nvar _c;\n$RefreshReg$(_c, \"VerifiedRoute\");","map":{"version":3,"names":["React","useEffect","useState","Navigate","jsxDEV","_jsxDEV","VerifiedRoute","children","_s","loading","setLoading","allow","setAllow","token","localStorage","getItem","run","headers","Authorization","profileRes","fetch","ok","Error","profile","json","role","verRes","data","status","err","console","error","style","padding","fileName","_jsxFileName","lineNumber","columnNumber","to","replace","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/auth/VerifiedRoute.jsx"],"sourcesContent":["// src/features/auth/VerifiedRoute.jsx\nimport React, { useEffect, useState } from 'react';\nimport { Navigate } from 'react-router-dom';\n\nconst VerifiedRoute = ({ children }) => {\n  const [loading, setLoading] = useState(true);\n  const [allow, setAllow] = useState(false);\n\n  useEffect(() => {\n    const token = localStorage.getItem('token');\n    if (!token) {\n      setLoading(false);\n      setAllow(false);\n      return;\n    }\n\n    const run = async () => {\n      try {\n        const headers = { Authorization: `Bearer ${token}` };\n\n        // 1) Load profile so we can see the user's role\n        const profileRes = await fetch('/api/users/profile', { headers });\n        if (!profileRes.ok) {\n          throw new Error('Failed to load profile');\n        }\n        const profile = await profileRes.json();\n\n        // If ADMIN, skip verification entirely\n        if (profile.role === 'ADMIN') {\n          setAllow(true);\n          setLoading(false);\n          return;\n        }\n\n        // 2) For normal users, check verification status\n        const verRes = await fetch('/api/verification/status', { headers });\n        if (!verRes.ok) {\n          throw new Error('Failed to load verification status');\n        }\n        const data = await verRes.json();\n\n        // Expect data.status from your verification controller\n        if (data.status === 'APPROVED') {\n          setAllow(true);\n        } else {\n          // PENDING / REJECTED / anything else → must go to /verify\n          setAllow(false);\n        }\n      } catch (err) {\n        console.error('VerifiedRoute error:', err);\n        // On error, be safe and send user to /verify instead of crashing\n        setAllow(false);\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    run();\n  }, []);\n\n  if (loading) {\n    return (\n      <div style={{ padding: 24 }}>\n        Checking your account status…\n      </div>\n    );\n  }\n\n  if (!allow) {\n    return <Navigate to=\"/verify\" replace />;\n  }\n\n  return children;\n};\n\nexport default VerifiedRoute;\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,SAASC,QAAQ,QAAQ,kBAAkB;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAE5C,MAAMC,aAAa,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,EAAA;EACtC,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAGR,QAAQ,CAAC,IAAI,CAAC;EAC5C,MAAM,CAACS,KAAK,EAAEC,QAAQ,CAAC,GAAGV,QAAQ,CAAC,KAAK,CAAC;EAEzCD,SAAS,CAAC,MAAM;IACd,MAAMY,KAAK,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;IAC3C,IAAI,CAACF,KAAK,EAAE;MACVH,UAAU,CAAC,KAAK,CAAC;MACjBE,QAAQ,CAAC,KAAK,CAAC;MACf;IACF;IAEA,MAAMI,GAAG,GAAG,MAAAA,CAAA,KAAY;MACtB,IAAI;QACF,MAAMC,OAAO,GAAG;UAAEC,aAAa,EAAE,UAAUL,KAAK;QAAG,CAAC;;QAEpD;QACA,MAAMM,UAAU,GAAG,MAAMC,KAAK,CAAC,oBAAoB,EAAE;UAAEH;QAAQ,CAAC,CAAC;QACjE,IAAI,CAACE,UAAU,CAACE,EAAE,EAAE;UAClB,MAAM,IAAIC,KAAK,CAAC,wBAAwB,CAAC;QAC3C;QACA,MAAMC,OAAO,GAAG,MAAMJ,UAAU,CAACK,IAAI,CAAC,CAAC;;QAEvC;QACA,IAAID,OAAO,CAACE,IAAI,KAAK,OAAO,EAAE;UAC5Bb,QAAQ,CAAC,IAAI,CAAC;UACdF,UAAU,CAAC,KAAK,CAAC;UACjB;QACF;;QAEA;QACA,MAAMgB,MAAM,GAAG,MAAMN,KAAK,CAAC,0BAA0B,EAAE;UAAEH;QAAQ,CAAC,CAAC;QACnE,IAAI,CAACS,MAAM,CAACL,EAAE,EAAE;UACd,MAAM,IAAIC,KAAK,CAAC,oCAAoC,CAAC;QACvD;QACA,MAAMK,IAAI,GAAG,MAAMD,MAAM,CAACF,IAAI,CAAC,CAAC;;QAEhC;QACA,IAAIG,IAAI,CAACC,MAAM,KAAK,UAAU,EAAE;UAC9BhB,QAAQ,CAAC,IAAI,CAAC;QAChB,CAAC,MAAM;UACL;UACAA,QAAQ,CAAC,KAAK,CAAC;QACjB;MACF,CAAC,CAAC,OAAOiB,GAAG,EAAE;QACZC,OAAO,CAACC,KAAK,CAAC,sBAAsB,EAAEF,GAAG,CAAC;QAC1C;QACAjB,QAAQ,CAAC,KAAK,CAAC;MACjB,CAAC,SAAS;QACRF,UAAU,CAAC,KAAK,CAAC;MACnB;IACF,CAAC;IAEDM,GAAG,CAAC,CAAC;EACP,CAAC,EAAE,EAAE,CAAC;EAEN,IAAIP,OAAO,EAAE;IACX,oBACEJ,OAAA;MAAK2B,KAAK,EAAE;QAAEC,OAAO,EAAE;MAAG,CAAE;MAAA1B,QAAA,EAAC;IAE7B;MAAA2B,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAK,CAAC;EAEV;EAEA,IAAI,CAAC1B,KAAK,EAAE;IACV,oBAAON,OAAA,CAACF,QAAQ;MAACmC,EAAE,EAAC,SAAS;MAACC,OAAO;IAAA;MAAAL,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAC1C;EAEA,OAAO9B,QAAQ;AACjB,CAAC;AAACC,EAAA,CArEIF,aAAa;AAAAkC,EAAA,GAAblC,aAAa;AAuEnB,eAAeA,aAAa;AAAC,IAAAkC,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}