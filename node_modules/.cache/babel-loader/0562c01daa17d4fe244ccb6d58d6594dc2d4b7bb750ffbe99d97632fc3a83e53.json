{"ast":null,"code":"// NOT USED? \n// src/features/loans/LinkLoanBankButton.jsx\nimport React,{useState}from'react';import{useStripe}from'@stripe/react-stripe-js';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";export default function LinkLoanBankButton(_ref){let{onLinked}=_ref;const stripe=useStripe();const[loading,setLoading]=useState(false);const[error,setError]=useState('');const linkBankForLoan=async()=>{try{var _confirmed$setupInten;setLoading(true);setError('');// Step 0️⃣: Ensure Stripe Customer exists (borrower identity)\nawait fetch('/api/stripe/ensure-customer',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'}});// Step 1️⃣: Create SetupIntent specifically for loan ACH funding\nconst res=await fetch('/api/stripe/create-bank-setup-intent',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'}});const data=await res.json();if(!data.client_secret)throw new Error('Missing client secret from SetupIntent');// Step 2️⃣: Collect bank account using Financial Connections\nconst result=await stripe.collectBankAccountForSetup({clientSecret:data.client_secret,params:{payment_method_type:'us_bank_account'}});if(result.error)throw result.error;// Step 3️⃣: Confirm and attach to customer\nconst confirmed=await stripe.confirmBankAccountSetup(data.client_secret);if(confirmed.error)throw confirmed.error;const paymentMethodId=confirmed===null||confirmed===void 0?void 0:(_confirmed$setupInten=confirmed.setupIntent)===null||_confirmed$setupInten===void 0?void 0:_confirmed$setupInten.payment_method;if(!paymentMethodId)throw new Error('No paymentMethod returned from Stripe');// Step 4️⃣: Tell backend to save PM AS LOAN FUNDING PM (isForLoans=true)\nconst saveRes=await fetch('/api/stripe/save-loan-payment-method',{method:'POST',credentials:'include',headers:{'Content-Type':'application/json'},body:JSON.stringify({paymentMethodId})});const saveJson=await saveRes.json();if(!saveJson.success)throw new Error(saveJson.error||'Failed to save loan PM');if(onLinked)onLinked(paymentMethodId);alert('✅ Bank linked for loan funding successfully!');}catch(err){console.error('Loan bank linking error:',err);setError(err.message||'Failed to link bank for loan funding');}finally{setLoading(false);}};return/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:10},children:[/*#__PURE__*/_jsx(\"button\",{onClick:linkBankForLoan,disabled:loading||!stripe,style:{background:'#4f46e5',color:'white',padding:'8px 12px',borderRadius:6,cursor:loading?'not-allowed':'pointer'},children:loading?'Linking…':'Link Bank for Loan Funding'}),error&&/*#__PURE__*/_jsx(\"div\",{style:{color:'red',marginTop:8},children:error})]});}","map":{"version":3,"names":["React","useState","useStripe","jsx","_jsx","jsxs","_jsxs","LinkLoanBankButton","_ref","onLinked","stripe","loading","setLoading","error","setError","linkBankForLoan","_confirmed$setupInten","fetch","method","credentials","headers","res","data","json","client_secret","Error","result","collectBankAccountForSetup","clientSecret","params","payment_method_type","confirmed","confirmBankAccountSetup","paymentMethodId","setupIntent","payment_method","saveRes","body","JSON","stringify","saveJson","success","alert","err","console","message","style","marginTop","children","onClick","disabled","background","color","padding","borderRadius","cursor"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/LinkLoanBankButton.jsx"],"sourcesContent":["// NOT USED? \n// src/features/loans/LinkLoanBankButton.jsx\nimport React, { useState } from 'react';\nimport { useStripe } from '@stripe/react-stripe-js';\n\nexport default function LinkLoanBankButton({ onLinked }) {\n  const stripe = useStripe();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const linkBankForLoan = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      // Step 0️⃣: Ensure Stripe Customer exists (borrower identity)\n      await fetch('/api/stripe/ensure-customer', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      // Step 1️⃣: Create SetupIntent specifically for loan ACH funding\n      const res = await fetch('/api/stripe/create-bank-setup-intent', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const data = await res.json();\n      if (!data.client_secret) throw new Error('Missing client secret from SetupIntent');\n\n      // Step 2️⃣: Collect bank account using Financial Connections\n      const result = await stripe.collectBankAccountForSetup({\n        clientSecret: data.client_secret,\n        params: { payment_method_type: 'us_bank_account' },\n      });\n\n      if (result.error) throw result.error;\n\n      // Step 3️⃣: Confirm and attach to customer\n      const confirmed = await stripe.confirmBankAccountSetup(data.client_secret);\n      if (confirmed.error) throw confirmed.error;\n\n      const paymentMethodId = confirmed?.setupIntent?.payment_method;\n      if (!paymentMethodId) throw new Error('No paymentMethod returned from Stripe');\n\n      // Step 4️⃣: Tell backend to save PM AS LOAN FUNDING PM (isForLoans=true)\n      const saveRes = await fetch('/api/stripe/save-loan-payment-method', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ paymentMethodId }),\n      });\n\n      const saveJson = await saveRes.json();\n      if (!saveJson.success) throw new Error(saveJson.error || 'Failed to save loan PM');\n\n      if (onLinked) onLinked(paymentMethodId);\n      alert('✅ Bank linked for loan funding successfully!');\n    } catch (err) {\n      console.error('Loan bank linking error:', err);\n      setError(err.message || 'Failed to link bank for loan funding');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: 10 }}>\n      <button\n        onClick={linkBankForLoan}\n        disabled={loading || !stripe}\n        style={{\n          background: '#4f46e5',\n          color: 'white',\n          padding: '8px 12px',\n          borderRadius: 6,\n          cursor: loading ? 'not-allowed' : 'pointer'\n        }}\n      >\n        {loading ? 'Linking…' : 'Link Bank for Loan Funding'}\n      </button>\n      {error && (\n        <div style={{ color: 'red', marginTop: 8 }}>\n          {error}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}