{"ast":null,"code":"import React,{useEffect,useState}from'react';import{useParams}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const LoanThread=()=>{const{loanId}=useParams();const[messages,setMessages]=useState([]);const[newMessage,setNewMessage]=useState('');const[loading,setLoading]=useState(true);const fetchMessages=async()=>{try{const res=await fetch(\"/api/loans/\".concat(loanId,\"/messages\"),{headers:{Authorization:\"Bearer \".concat(localStorage.getItem('token'))}});if(!res.ok)throw new Error('Failed to load messages');const data=await res.json();setMessages(data);}catch(err){console.error('Error fetching messages:',err);}finally{setLoading(false);}};const sendMessage=async()=>{if(!newMessage.trim())return;try{const res=await fetch(\"/api/loans/\".concat(loanId,\"/messages\"),{method:'POST',headers:{'Content-Type':'application/json',Authorization:\"Bearer \".concat(localStorage.getItem('token'))},body:JSON.stringify({content:newMessage})});if(!res.ok)throw new Error('Failed to send message');setNewMessage('');fetchMessages();// Refresh messages\n}catch(err){console.error('Error sending message:',err);}};useEffect(()=>{fetchMessages();},[loanId]);return/*#__PURE__*/_jsxs(\"div\",{style:{padding:'2rem',maxWidth:'700px',margin:'auto'},children:[/*#__PURE__*/_jsx(\"h2\",{children:\"\\uD83D\\uDCAC Loan Messages\"}),loading?/*#__PURE__*/_jsx(\"p\",{children:\"Loading messages...\"}):/*#__PURE__*/_jsx(\"div\",{style:{marginBottom:'2rem'},children:messages.length===0?/*#__PURE__*/_jsx(\"p\",{children:\"No messages yet. Start the conversation!\"}):messages.map(msg=>{var _msg$sender;return/*#__PURE__*/_jsxs(\"div\",{style:{marginBottom:'1rem',padding:'1rem',borderRadius:'8px',backgroundColor:msg.senderId===msg.currentUserId?'#e8f5e9':'#f1f1f1'},children:[/*#__PURE__*/_jsxs(\"strong\",{children:[((_msg$sender=msg.sender)===null||_msg$sender===void 0?void 0:_msg$sender.name)||'User',\":\"]}),/*#__PURE__*/_jsx(\"p\",{children:msg.content}),/*#__PURE__*/_jsx(\"small\",{children:new Date(msg.createdAt).toLocaleString()})]},msg.id);})}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"textarea\",{rows:\"3\",style:{width:'100%',marginBottom:'1rem'},placeholder:\"Type your message...\",value:newMessage,onChange:e=>setNewMessage(e.target.value)}),/*#__PURE__*/_jsx(\"button\",{onClick:sendMessage,children:\"Send Message\"})]})]});};export default LoanThread;","map":{"version":3,"names":["React","useEffect","useState","useParams","jsx","_jsx","jsxs","_jsxs","LoanThread","loanId","messages","setMessages","newMessage","setNewMessage","loading","setLoading","fetchMessages","res","fetch","concat","headers","Authorization","localStorage","getItem","ok","Error","data","json","err","console","error","sendMessage","trim","method","body","JSON","stringify","content","style","padding","maxWidth","margin","children","marginBottom","length","map","msg","_msg$sender","borderRadius","backgroundColor","senderId","currentUserId","sender","name","Date","createdAt","toLocaleString","id","rows","width","placeholder","value","onChange","e","target","onClick"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/messaging/LoanThread.jsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport { useParams } from 'react-router-dom';\r\n\r\nconst LoanThread = () => {\r\n  const { loanId } = useParams();\r\n  const [messages, setMessages] = useState([]);\r\n  const [newMessage, setNewMessage] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const fetchMessages = async () => {\r\n    try {\r\n      const res = await fetch(`/api/loans/${loanId}/messages`, {\r\n        headers: {\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n      });\r\n      if (!res.ok) throw new Error('Failed to load messages');\r\n      const data = await res.json();\r\n      setMessages(data);\r\n    } catch (err) {\r\n      console.error('Error fetching messages:', err);\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  };\r\n\r\n  const sendMessage = async () => {\r\n    if (!newMessage.trim()) return;\r\n\r\n    try {\r\n      const res = await fetch(`/api/loans/${loanId}/messages`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          Authorization: `Bearer ${localStorage.getItem('token')}`,\r\n        },\r\n        body: JSON.stringify({ content: newMessage }),\r\n      });\r\n\r\n      if (!res.ok) throw new Error('Failed to send message');\r\n      setNewMessage('');\r\n      fetchMessages(); // Refresh messages\r\n    } catch (err) {\r\n      console.error('Error sending message:', err);\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    fetchMessages();\r\n  }, [loanId]);\r\n\r\n  return (\r\n    <div style={{ padding: '2rem', maxWidth: '700px', margin: 'auto' }}>\r\n      <h2>ðŸ’¬ Loan Messages</h2>\r\n\r\n      {loading ? (\r\n        <p>Loading messages...</p>\r\n      ) : (\r\n        <div style={{ marginBottom: '2rem' }}>\r\n          {messages.length === 0 ? (\r\n            <p>No messages yet. Start the conversation!</p>\r\n          ) : (\r\n            messages.map((msg) => (\r\n              <div\r\n                key={msg.id}\r\n                style={{\r\n                  marginBottom: '1rem',\r\n                  padding: '1rem',\r\n                  borderRadius: '8px',\r\n                  backgroundColor: msg.senderId === msg.currentUserId ? '#e8f5e9' : '#f1f1f1',\r\n                }}\r\n              >\r\n                <strong>{msg.sender?.name || 'User'}:</strong>\r\n                <p>{msg.content}</p>\r\n                <small>{new Date(msg.createdAt).toLocaleString()}</small>\r\n              </div>\r\n            ))\r\n          )}\r\n        </div>\r\n      )}\r\n\r\n      <div>\r\n        <textarea\r\n          rows=\"3\"\r\n          style={{ width: '100%', marginBottom: '1rem' }}\r\n          placeholder=\"Type your message...\"\r\n          value={newMessage}\r\n          onChange={(e) => setNewMessage(e.target.value)}\r\n        />\r\n        <button onClick={sendMessage}>Send Message</button>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default LoanThread;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}