{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$(),\n  _s3 = $RefreshSig$();\n// src/features/wallet/PaymentMethod.jsx\nimport { useEffect, useMemo, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\nimport { fetchWallet, createDepositIntent, devConfirmDeposit } from '../wallet/walletApi';\nimport ConnectPayoutsCard from '../wallet/ConnectPayoutsCard';\n\n/* ---------------- Stripe publishable key ---------------- */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\n\n/* ---------------- Auth header helpers ---------------- */\nfunction getToken() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, '');\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\n  return t || null;\n}\nfunction authHeaders() {\n  const t = getToken();\n  return t ? {\n    Authorization: `Bearer ${t}`\n  } : {};\n}\n\n/* ---------------- Stripe init (cached) ---------------- */\nlet cachedStripePromise;\nfunction getStripePromise() {\n  if (!pk) return null;\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\n  return cachedStripePromise;\n}\n\n/* ================================================================== */\n/*                           Payment Method                           */\n/* ================================================================== */\n\nexport default function PaymentMethodPage() {\n  _s();\n  var _wallet$availableCent, _wallet$pendingCents;\n  const [clientSecret, setClientSecret] = useState(null);\n\n  // saved methods\n  const [myPMs, setMyPMs] = useState([]);\n  const [hasDefault, setHasDefault] = useState(false);\n\n  // UI state\n  const [linking, setLinking] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n  const [loading, setLoading] = useState(true);\n\n  // deposit UI\n  const [amount, setAmount] = useState('25.00');\n  const [depositing, setDepositing] = useState(false);\n  const [wallet, setWallet] = useState(null);\n\n  // Prefilled identity\n  const [fullName, setFullName] = useState('');\n  const [email, setEmail] = useState('');\n  const stripePromise = useMemo(getStripePromise, [pk]);\n\n  // Load: profile, payment methods, wallet\n  useEffect(() => {\n    const ac = new AbortController();\n    (async () => {\n      try {\n        // 1) Profile for name/email prefill\n        try {\n          const r = await fetch('/api/users/profile', {\n            headers: {\n              ...authHeaders()\n            },\n            signal: ac.signal\n          });\n          if (r.ok) {\n            const u = await r.json();\n            if (u !== null && u !== void 0 && u.name) setFullName(u.name);\n            if (u !== null && u !== void 0 && u.email) setEmail(u.email);\n          }\n        } catch {}\n\n        // 2) My payment methods\n        await refreshMyPaymentMethods(ac.signal);\n\n        // 3) Wallet balances\n        try {\n          const w = await fetchWallet();\n          setWallet(w);\n        } catch {}\n      } finally {\n        setLoading(false);\n      }\n    })();\n    return () => ac.abort();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  async function refreshMyPaymentMethods(signal) {\n    try {\n      const r = await fetch('/api/payment-method/mine', {\n        headers: {\n          ...authHeaders()\n        },\n        signal\n      });\n      if (r.ok) {\n        const d = await r.json();\n        const items = Array.isArray(d === null || d === void 0 ? void 0 : d.items) ? d.items : [];\n        setMyPMs(items);\n        setHasDefault(items.some(it => !!it.isDefault));\n      } else {\n        setMyPMs([]);\n        setHasDefault(false);\n      }\n    } catch {\n      setMyPMs([]);\n      setHasDefault(false);\n    }\n  }\n  async function refreshWallet() {\n    try {\n      const w = await fetchWallet();\n      setWallet(w);\n    } catch {}\n  }\n\n  /* ---------------- Replace / Update bank (SetupIntent) ---------------- */\n  async function startBankLink() {\n    setLinking(true);\n    setErrorMsg('');\n    try {\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        }\n      });\n      if (r.status === 401) {\n        setErrorMsg('Your session expired. Please log in again, then return to Payment Method.');\n        return;\n      }\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\n      const {\n        client_secret\n      } = await r.json();\n      if (!client_secret) throw new Error('No client_secret returned from server.');\n      setClientSecret(client_secret);\n    } catch (e) {\n      setErrorMsg(e.message || 'Something went wrong starting bank link.');\n    } finally {\n      setLinking(false);\n    }\n  }\n\n  /* ---------------- Simple actions: set default / set payout ---------------- */\n  async function setDefault(id) {\n    setErrorMsg('');\n    try {\n      const r = await fetch('/api/payment-method/set-default', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        },\n        body: JSON.stringify({\n          id\n        })\n      });\n      if (!r.ok) throw new Error(await r.text());\n      await refreshMyPaymentMethods();\n    } catch (e) {\n      setErrorMsg((e === null || e === void 0 ? void 0 : e.message) || 'Failed to set default.');\n    }\n  }\n  async function setPayout(id) {\n    setErrorMsg('');\n    try {\n      const r = await fetch('/api/payment-method/set-loan-bank', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        },\n        body: JSON.stringify({\n          id\n        })\n      });\n      if (!r.ok) throw new Error(await r.text());\n      await refreshMyPaymentMethods();\n    } catch (e) {\n      setErrorMsg((e === null || e === void 0 ? void 0 : e.message) || 'Failed to set payout account.');\n    }\n  }\n  const primary = myPMs.find(x => x.isDefault) || myPMs[0] || null;\n  const hasAny = myPMs.length > 0;\n  const disabledReplaceBtn = linking || !pk || !stripePromise || !fullName;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 780,\n      margin: '0 auto',\n      padding: 16\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        marginTop: 0\n      },\n      children: \"Payment Method\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 185,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(ConnectPayoutsCard, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 188,\n      columnNumber: 7\n    }, this), !pk && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fef2f2',\n        border: '1px solid #fecaca',\n        color: '#7f1d1d',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: [\"Missing or invalid Stripe publishable key.\", /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 193,\n        columnNumber: 53\n      }, this), \"Add \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"REACT_APP_STRIPE_PUBLISHABLE_KEY=pk_test_\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 15\n      }, this), \" to \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \".env\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 194,\n        columnNumber: 74\n      }, this), \" and restart the dev server.\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 9\n    }, this), errorMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fff7ed',\n        border: '1px solid #fed7aa',\n        color: '#7c2d12',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: errorMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 199,\n      columnNumber: 9\n    }, this), wallet && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#f1f5f9',\n        border: '1px solid #e2e8f0',\n        padding: 10,\n        borderRadius: 8,\n        marginBottom: 16,\n        fontSize: 14\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Wallet\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 11\n      }, this), \" \\u2014 Available:\", ' ', \"$\", (((_wallet$availableCent = wallet.availableCents) !== null && _wallet$availableCent !== void 0 ? _wallet$availableCent : 0) / 100).toFixed(2), \" \\u2022 Pending:\", ' ', \"$\", (((_wallet$pendingCents = wallet.pendingCents) !== null && _wallet$pendingCents !== void 0 ? _wallet$pendingCents : 0) / 100).toFixed(2)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      style: {\n        marginBottom: 16\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          border: '1px solid #e2e8f0',\n          borderRadius: 10,\n          padding: 14,\n          background: '#ffffff'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            gap: 12\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontWeight: 800,\n                fontSize: 16,\n                marginBottom: 4\n              },\n              children: hasAny ? (primary === null || primary === void 0 ? void 0 : primary.brand) || 'Bank' : 'No bank account on file'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 222,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: 13,\n                color: '#475569'\n              },\n              children: hasAny ? primary !== null && primary !== void 0 && primary.last4 ? `•••• ${primary.last4}` : '—' : 'Add your bank to send/receive funds.'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 225,\n              columnNumber: 15\n            }, this), hasAny && /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                gap: 6,\n                marginTop: 6\n              },\n              children: [(primary === null || primary === void 0 ? void 0 : primary.isDefault) && /*#__PURE__*/_jsxDEV(\"span\", {\n                style: badgeStyle('#e0e7ff', '#3730a3'),\n                children: \"Default\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 230,\n                columnNumber: 42\n              }, this), (primary === null || primary === void 0 ? void 0 : primary.isForLoans) && /*#__PURE__*/_jsxDEV(\"span\", {\n                style: badgeStyle('#dcfce7', '#166534'),\n                children: \"Loan Payout\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 231,\n                columnNumber: 43\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 221,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: startBankLink,\n              disabled: disabledReplaceBtn,\n              style: {\n                background: '#4f46e5',\n                color: '#fff',\n                border: '1px solid #4f46e5',\n                padding: '8px 14px',\n                borderRadius: 8,\n                cursor: disabledReplaceBtn ? 'not-allowed' : 'pointer',\n                fontWeight: 700\n              },\n              children: hasAny ? linking ? 'Starting…' : 'Update bank account' : linking ? 'Starting…' : 'Add bank account'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 238,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 236,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 220,\n          columnNumber: 11\n        }, this), !hasAny && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            display: 'grid',\n            gap: 8,\n            marginTop: 12,\n            background: '#fafafa',\n            border: '1px solid #e5e7eb',\n            borderRadius: 8,\n            padding: 10\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 14,\n              color: '#6b7280'\n            },\n            children: \"Account holder\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            value: fullName,\n            onChange: e => setFullName(e.target.value),\n            placeholder: \"Account holder full name\",\n            style: {\n              padding: '8px 10px',\n              border: '1px solid #e2e8f0',\n              borderRadius: 8\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 260,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"email\",\n            value: email,\n            onChange: e => setEmail(e.target.value),\n            placeholder: \"Email (optional, recommended)\",\n            style: {\n              padding: '8px 10px',\n              border: '1px solid #e2e8f0',\n              borderRadius: 8\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n            style: {\n              color: '#6b7280'\n            },\n            children: \"We\\u2019ll pass this to Stripe only to label your bank method.\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 274,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 216,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 215,\n      columnNumber: 7\n    }, this), hasAny && /*#__PURE__*/_jsxDEV(\"section\", {\n      style: {\n        marginBottom: 16\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          fontWeight: 700,\n          marginBottom: 8\n        },\n        children: \"Manage saved bank methods\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 285,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gap: 8\n        },\n        children: myPMs.map(pm => /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            border: '1px solid #e2e8f0',\n            borderRadius: 8,\n            padding: '10px 12px',\n            display: 'flex',\n            justifyContent: 'space-between',\n            alignItems: 'center',\n            gap: 10\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontWeight: 700\n              },\n              children: pm.brand || 'Bank'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 293,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontSize: 13,\n                color: '#475569'\n              },\n              children: pm.last4 ? `•••• ${pm.last4}` : '—'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 294,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                display: 'flex',\n                gap: 6,\n                marginTop: 6\n              },\n              children: [pm.isDefault && /*#__PURE__*/_jsxDEV(\"span\", {\n                style: badgeStyle('#e0e7ff', '#3730a3'),\n                children: \"Default\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 296,\n                columnNumber: 38\n              }, this), pm.isForLoans && /*#__PURE__*/_jsxDEV(\"span\", {\n                style: badgeStyle('#dcfce7', '#166534'),\n                children: \"Loan Payout\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 297,\n                columnNumber: 39\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 295,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 292,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              gap: 8\n            },\n            children: [!pm.isDefault && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setDefault(pm.id),\n              className: \"pm-btn\",\n              style: btnStyle(),\n              children: \"Make Default\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 302,\n              columnNumber: 21\n            }, this), !pm.isForLoans && /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: () => setPayout(pm.id),\n              className: \"pm-btn\",\n              style: btnStyle('#0ea5e9'),\n              children: \"Use for Payouts\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 311,\n              columnNumber: 21\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 17\n          }, this)]\n        }, pm.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 288,\n          columnNumber: 15\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 286,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 284,\n      columnNumber: 9\n    }, this), clientSecret && stripePromise && /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      children: /*#__PURE__*/_jsxDEV(BankLinkFlow, {\n        clientSecret: clientSecret,\n        fullName: fullName,\n        email: email,\n        onSaved: async () => {\n          setClientSecret(null);\n          await refreshMyPaymentMethods();\n          await refreshWallet();\n        },\n        onError: setErrorMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 329,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 328,\n      columnNumber: 9\n    }, this), hasDefault && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: 20,\n        padding: 12,\n        borderRadius: 8,\n        border: '1px solid #e2e8f0',\n        background: '#ffffff'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        style: {\n          margin: '0 0 8px'\n        },\n        children: \"Deposit to PeerFund Balance\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 349,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          marginTop: 0,\n          color: '#475569'\n        },\n        children: \"Funds will be debited from your linked bank and added to your available balance.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 350,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(DepositBox, {\n        amount: amount,\n        setAmount: setAmount,\n        depositing: depositing,\n        setDepositing: setDepositing,\n        onSuccess: async () => {\n          await refreshWallet();\n          alert('Deposit initiated successfully.');\n        },\n        onError: setErrorMsg\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 354,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 345,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 184,\n    columnNumber: 5\n  }, this);\n}\n_s(PaymentMethodPage, \"XVUr7FqLe4JO/HTUqzsJWQjQLKc=\");\n_c = PaymentMethodPage;\nfunction badgeStyle(bg, fg) {\n  return {\n    background: bg,\n    color: fg,\n    border: `1px solid ${bg}`,\n    borderRadius: 999,\n    padding: '2px 8px',\n    fontSize: 12,\n    fontWeight: 700\n  };\n}\nfunction btnStyle(color = '#4f46e5') {\n  return {\n    background: color,\n    color: '#fff',\n    border: `1px solid ${color}`,\n    padding: '8px 12px',\n    borderRadius: 8,\n    fontWeight: 700,\n    cursor: 'pointer'\n  };\n}\n\n/* ---------------- BankLinkFlow: collect + confirm + SAVE ---------------- */\n\nfunction BankLinkFlow({\n  clientSecret,\n  fullName,\n  email,\n  onSaved,\n  onError\n}) {\n  _s2();\n  const stripe = useStripe();\n  const [working, setWorking] = useState(false);\n  async function saveToBackend(paymentMethodId) {\n    // Persist per-user PM (make the newly linked one the default & payout)\n    const r = await fetch('/api/payment-method/save', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...authHeaders()\n      },\n      body: JSON.stringify({\n        paymentMethodId,\n        makeDefault: true,\n        useForLoans: true\n      })\n    });\n    if (!r.ok) {\n      const t = await r.text().catch(() => '');\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\n    }\n  }\n  async function handleLink() {\n    if (!stripe) {\n      onError === null || onError === void 0 ? void 0 : onError('Stripe not ready yet.');\n      return;\n    }\n    if (!fullName) {\n      onError === null || onError === void 0 ? void 0 : onError('Please enter the account holder’s full name.');\n      return;\n    }\n    setWorking(true);\n    try {\n      // 1) Open Financial Connections\n      const {\n        error: collectError\n      } = await stripe.collectBankAccountForSetup({\n        clientSecret,\n        params: {\n          payment_method_type: 'us_bank_account',\n          payment_method_data: {\n            billing_details: {\n              name: fullName,\n              ...(email ? {\n                email\n              } : {})\n            }\n          }\n        }\n      });\n      if (collectError) throw collectError;\n\n      // 2) Confirm the SetupIntent (saves PM to the Stripe customer)\n      const {\n        setupIntent,\n        error: confirmError\n      } = await stripe.confirmUsBankAccountSetup(clientSecret);\n      if (confirmError) throw confirmError;\n      const pmId = setupIntent === null || setupIntent === void 0 ? void 0 : setupIntent.payment_method;\n      if (!pmId) throw new Error('Missing payment method id from Stripe.');\n\n      // 3) SAVE into DB (mark as default + payout)\n      await saveToBackend(pmId);\n\n      // 4) UX feedback\n      switch (setupIntent.status) {\n        case 'succeeded':\n          alert('Bank account updated.');\n          break;\n        case 'requires_action':\n          {\n            const na = setupIntent.next_action;\n            if ((na === null || na === void 0 ? void 0 : na.type) === 'verify_with_microdeposits') {\n              alert('Bank linked. Stripe is sending two micro-deposits for verification (1–2 business days).');\n            } else {\n              alert('Bank linked; additional verification is required.');\n            }\n            break;\n          }\n        default:\n          alert(`Setup in progress (status: ${setupIntent.status}).`);\n      }\n      onSaved === null || onSaved === void 0 ? void 0 : onSaved();\n    } catch (e) {\n      onError === null || onError === void 0 ? void 0 : onError((e === null || e === void 0 ? void 0 : e.message) || 'Failed to link bank account.');\n    } finally {\n      setWorking(false);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: 12\n    },\n    children: /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleLink,\n      disabled: !stripe || working,\n      style: {\n        background: '#10b981',\n        color: '#fff',\n        border: '1px solid #10b981',\n        padding: '8px 14px',\n        borderRadius: 8,\n        fontWeight: 700,\n        cursor: !stripe || working ? 'not-allowed' : 'pointer'\n      },\n      children: working ? 'Connecting…' : 'Continue bank update'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 464,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 463,\n    columnNumber: 5\n  }, this);\n}\n_s2(BankLinkFlow, \"xI/djp9IF4sg6WO7GmySD1OaJqo=\", false, function () {\n  return [useStripe];\n});\n_c2 = BankLinkFlow;\nBankLinkFlow.propTypes = {\n  clientSecret: PropTypes.string.isRequired,\n  fullName: PropTypes.string.isRequired,\n  email: PropTypes.string,\n  onSaved: PropTypes.func,\n  onError: PropTypes.func\n};\n\n/* -------- DepositBox: create + confirm PaymentIntent (ACH) -------- */\n\nfunction DepositBox({\n  amount,\n  setAmount,\n  depositing,\n  setDepositing,\n  onSuccess,\n  onError\n}) {\n  _s3();\n  const stripe = useStripe();\n  async function handleDeposit() {\n    const n = Number(amount);\n    if (!Number.isFinite(n) || n <= 0) {\n      onError === null || onError === void 0 ? void 0 : onError('Enter a valid deposit amount.');\n      return;\n    }\n    setDepositing(true);\n    onError === null || onError === void 0 ? void 0 : onError('');\n    try {\n      const {\n        clientSecret,\n        ledgerId,\n        simulated\n      } = await createDepositIntent(n);\n\n      // dev mode (backend simulates money movement)\n      if (simulated) {\n        await devConfirmDeposit(ledgerId);\n        onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess();\n        return;\n      }\n      if (!stripe) throw new Error('Stripe not ready.');\n      const {\n        paymentIntent,\n        error\n      } = await stripe.confirmUsBankAccountPayment(clientSecret);\n      if (error) throw error;\n      const status = paymentIntent === null || paymentIntent === void 0 ? void 0 : paymentIntent.status;\n      if (status === 'succeeded' || status === 'processing') {\n        onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess();\n      } else if (status === 'requires_action') {\n        const na = paymentIntent.next_action;\n        if ((na === null || na === void 0 ? void 0 : na.type) === 'verify_with_microdeposits') {\n          alert('Deposit initiated. Funds will appear after micro-deposit verification.');\n          onSuccess === null || onSuccess === void 0 ? void 0 : onSuccess();\n        } else {\n          onError === null || onError === void 0 ? void 0 : onError('Additional action is required to complete this deposit.');\n        }\n      } else {\n        onError === null || onError === void 0 ? void 0 : onError(`Deposit status: ${status || 'unknown'}.`);\n      }\n    } catch (e) {\n      onError === null || onError === void 0 ? void 0 : onError((e === null || e === void 0 ? void 0 : e.message) || 'Deposit failed.');\n    } finally {\n      setDepositing(false);\n    }\n  }\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      display: 'flex',\n      gap: 8,\n      alignItems: 'center'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        alignItems: 'center',\n        gap: 6\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"span\", {\n        children: \"$\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 540,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n        type: \"number\",\n        step: \"0.01\",\n        min: \"1\",\n        value: amount,\n        onChange: e => setAmount(e.target.value),\n        style: {\n          width: 120,\n          padding: '8px 10px',\n          border: '1px solid #e2e8f0',\n          borderRadius: 8\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 541,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 539,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleDeposit,\n      disabled: depositing,\n      style: {\n        background: '#4f46e5',\n        color: '#fff',\n        border: '1px solid #4f46e5',\n        padding: '8px 14px',\n        borderRadius: 8,\n        fontWeight: 700,\n        cursor: depositing ? 'not-allowed' : 'pointer'\n      },\n      children: depositing ? 'Processing…' : 'Deposit'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 550,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 538,\n    columnNumber: 5\n  }, this);\n}\n_s3(DepositBox, \"idaYC8DiWdfB9k82Pr6iCdOULZw=\", false, function () {\n  return [useStripe];\n});\n_c3 = DepositBox;\nDepositBox.propTypes = {\n  amount: PropTypes.string.isRequired,\n  setAmount: PropTypes.func.isRequired,\n  depositing: PropTypes.bool.isRequired,\n  setDepositing: PropTypes.func,\n  onSuccess: PropTypes.func,\n  onError: PropTypes.func\n};\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"PaymentMethodPage\");\n$RefreshReg$(_c2, \"BankLinkFlow\");\n$RefreshReg$(_c3, \"DepositBox\");","map":{"version":3,"names":["useEffect","useMemo","useState","PropTypes","loadStripe","Elements","useStripe","fetchWallet","createDepositIntent","devConfirmDeposit","ConnectPayoutsCard","jsxDEV","_jsxDEV","rawPk","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","trim","pk","test","getToken","t","localStorage","getItem","replace","toLowerCase","startsWith","slice","authHeaders","Authorization","cachedStripePromise","getStripePromise","PaymentMethodPage","_s","_wallet$availableCent","_wallet$pendingCents","clientSecret","setClientSecret","myPMs","setMyPMs","hasDefault","setHasDefault","linking","setLinking","errorMsg","setErrorMsg","loading","setLoading","amount","setAmount","depositing","setDepositing","wallet","setWallet","fullName","setFullName","email","setEmail","stripePromise","ac","AbortController","r","fetch","headers","signal","ok","u","json","name","refreshMyPaymentMethods","w","abort","d","items","Array","isArray","some","it","isDefault","refreshWallet","startBankLink","method","status","Error","text","client_secret","e","message","setDefault","id","body","JSON","stringify","setPayout","primary","find","x","hasAny","length","disabledReplaceBtn","style","maxWidth","margin","padding","children","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","background","border","color","borderRadius","marginBottom","fontSize","availableCents","toFixed","pendingCents","display","justifyContent","alignItems","gap","fontWeight","brand","last4","badgeStyle","isForLoans","onClick","disabled","cursor","type","value","onChange","target","placeholder","map","pm","className","btnStyle","stripe","BankLinkFlow","onSaved","onError","DepositBox","onSuccess","alert","_c","bg","fg","_s2","working","setWorking","saveToBackend","paymentMethodId","makeDefault","useForLoans","catch","handleLink","error","collectError","collectBankAccountForSetup","params","payment_method_type","payment_method_data","billing_details","setupIntent","confirmError","confirmUsBankAccountSetup","pmId","payment_method","na","next_action","_c2","propTypes","string","isRequired","func","_s3","handleDeposit","n","Number","isFinite","ledgerId","simulated","paymentIntent","confirmUsBankAccountPayment","step","min","width","_c3","bool","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/PaymentMethod.jsx"],"sourcesContent":["// src/features/wallet/PaymentMethod.jsx\r\nimport { useEffect, useMemo, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\r\n\r\nimport { fetchWallet, createDepositIntent, devConfirmDeposit } from '../wallet/walletApi';\r\nimport ConnectPayoutsCard from '../wallet/ConnectPayoutsCard';\r\n\r\n/* ---------------- Stripe publishable key ---------------- */\r\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\r\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\r\n\r\n/* ---------------- Auth header helpers ---------------- */\r\nfunction getToken() {\r\n  let t = localStorage.getItem('token') || '';\r\n  t = t.replace(/^\"|\"$/g, '');\r\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\r\n  return t || null;\r\n}\r\nfunction authHeaders() {\r\n  const t = getToken();\r\n  return t ? { Authorization: `Bearer ${t}` } : {};\r\n}\r\n\r\n/* ---------------- Stripe init (cached) ---------------- */\r\nlet cachedStripePromise;\r\nfunction getStripePromise() {\r\n  if (!pk) return null;\r\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\r\n  return cachedStripePromise;\r\n}\r\n\r\n/* ================================================================== */\r\n/*                           Payment Method                           */\r\n/* ================================================================== */\r\n\r\nexport default function PaymentMethodPage() {\r\n  const [clientSecret, setClientSecret] = useState(null);\r\n\r\n  // saved methods\r\n  const [myPMs, setMyPMs] = useState([]);\r\n  const [hasDefault, setHasDefault] = useState(false);\r\n\r\n  // UI state\r\n  const [linking, setLinking] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // deposit UI\r\n  const [amount, setAmount] = useState('25.00');\r\n  const [depositing, setDepositing] = useState(false);\r\n  const [wallet, setWallet] = useState(null);\r\n\r\n  // Prefilled identity\r\n  const [fullName, setFullName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n\r\n  const stripePromise = useMemo(getStripePromise, [pk]);\r\n\r\n  // Load: profile, payment methods, wallet\r\n  useEffect(() => {\r\n    const ac = new AbortController();\r\n    (async () => {\r\n      try {\r\n        // 1) Profile for name/email prefill\r\n        try {\r\n          const r = await fetch('/api/users/profile', { headers: { ...authHeaders() }, signal: ac.signal });\r\n          if (r.ok) {\r\n            const u = await r.json();\r\n            if (u?.name) setFullName(u.name);\r\n            if (u?.email) setEmail(u.email);\r\n          }\r\n        } catch {}\r\n\r\n        // 2) My payment methods\r\n        await refreshMyPaymentMethods(ac.signal);\r\n\r\n        // 3) Wallet balances\r\n        try {\r\n          const w = await fetchWallet();\r\n          setWallet(w);\r\n        } catch {}\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n    return () => ac.abort();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function refreshMyPaymentMethods(signal) {\r\n    try {\r\n      const r = await fetch('/api/payment-method/mine', {\r\n        headers: { ...authHeaders() },\r\n        signal,\r\n      });\r\n      if (r.ok) {\r\n        const d = await r.json();\r\n        const items = Array.isArray(d?.items) ? d.items : [];\r\n        setMyPMs(items);\r\n        setHasDefault(items.some((it) => !!it.isDefault));\r\n      } else {\r\n        setMyPMs([]);\r\n        setHasDefault(false);\r\n      }\r\n    } catch {\r\n      setMyPMs([]);\r\n      setHasDefault(false);\r\n    }\r\n  }\r\n\r\n  async function refreshWallet() {\r\n    try {\r\n      const w = await fetchWallet();\r\n      setWallet(w);\r\n    } catch {}\r\n  }\r\n\r\n  /* ---------------- Replace / Update bank (SetupIntent) ---------------- */\r\n  async function startBankLink() {\r\n    setLinking(true);\r\n    setErrorMsg('');\r\n    try {\r\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      });\r\n\r\n      if (r.status === 401) {\r\n        setErrorMsg('Your session expired. Please log in again, then return to Payment Method.');\r\n        return;\r\n      }\r\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\r\n\r\n      const { client_secret } = await r.json();\r\n      if (!client_secret) throw new Error('No client_secret returned from server.');\r\n\r\n      setClientSecret(client_secret);\r\n    } catch (e) {\r\n      setErrorMsg(e.message || 'Something went wrong starting bank link.');\r\n    } finally {\r\n      setLinking(false);\r\n    }\r\n  }\r\n\r\n  /* ---------------- Simple actions: set default / set payout ---------------- */\r\n  async function setDefault(id) {\r\n    setErrorMsg('');\r\n    try {\r\n      const r = await fetch('/api/payment-method/set-default', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n        body: JSON.stringify({ id }),\r\n      });\r\n      if (!r.ok) throw new Error(await r.text());\r\n      await refreshMyPaymentMethods();\r\n    } catch (e) {\r\n      setErrorMsg(e?.message || 'Failed to set default.');\r\n    }\r\n  }\r\n\r\n  async function setPayout(id) {\r\n    setErrorMsg('');\r\n    try {\r\n      const r = await fetch('/api/payment-method/set-loan-bank', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n        body: JSON.stringify({ id }),\r\n      });\r\n      if (!r.ok) throw new Error(await r.text());\r\n      await refreshMyPaymentMethods();\r\n    } catch (e) {\r\n      setErrorMsg(e?.message || 'Failed to set payout account.');\r\n    }\r\n  }\r\n\r\n  const primary = myPMs.find((x) => x.isDefault) || myPMs[0] || null;\r\n  const hasAny = myPMs.length > 0;\r\n\r\n  const disabledReplaceBtn = linking || !pk || !stripePromise || !fullName;\r\n\r\n  return (\r\n    <div style={{ maxWidth: 780, margin: '0 auto', padding: 16 }}>\r\n      <h2 style={{ marginTop: 0 }}>Payment Method</h2>\r\n\r\n      {/* Connect payouts (Express account) */}\r\n      <ConnectPayoutsCard />\r\n\r\n      {!pk && (\r\n        <div style={{ background: '#fef2f2', border: '1px solid #fecaca', color: '#7f1d1d',\r\n                      padding: '10px 12px', borderRadius: 8, marginBottom: 12 }}>\r\n          Missing or invalid Stripe publishable key.<br />\r\n          Add <code>REACT_APP_STRIPE_PUBLISHABLE_KEY=pk_test_…</code> to <code>.env</code> and restart the dev server.\r\n        </div>\r\n      )}\r\n\r\n      {errorMsg && (\r\n        <div style={{ background: '#fff7ed', border: '1px solid #fed7aa', color: '#7c2d12',\r\n                      padding: '10px 12px', borderRadius: 8, marginBottom: 12 }}>\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n\r\n      {wallet && (\r\n        <div style={{ background: '#f1f5f9', border: '1px solid #e2e8f0', padding: 10,\r\n                      borderRadius: 8, marginBottom: 16, fontSize: 14 }}>\r\n          <strong>Wallet</strong> — Available:{' '}\r\n          ${(((wallet.availableCents ?? 0) / 100).toFixed(2))} • Pending:{' '}\r\n          ${(((wallet.pendingCents ?? 0) / 100).toFixed(2))}\r\n        </div>\r\n      )}\r\n\r\n      {/* Primary bank summary + Replace */}\r\n      <section style={{ marginBottom: 16 }}>\r\n        <div style={{\r\n          border: '1px solid #e2e8f0', borderRadius: 10, padding: 14,\r\n          background: '#ffffff'\r\n        }}>\r\n          <div style={{ display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 12 }}>\r\n            <div>\r\n              <div style={{ fontWeight: 800, fontSize: 16, marginBottom: 4 }}>\r\n                {hasAny ? (primary?.brand || 'Bank') : 'No bank account on file'}\r\n              </div>\r\n              <div style={{ fontSize: 13, color: '#475569' }}>\r\n                {hasAny ? (primary?.last4 ? `•••• ${primary.last4}` : '—') : 'Add your bank to send/receive funds.'}\r\n              </div>\r\n              {hasAny && (\r\n                <div style={{ display: 'flex', gap: 6, marginTop: 6 }}>\r\n                  {primary?.isDefault && <span style={badgeStyle('#e0e7ff', '#3730a3')}>Default</span>}\r\n                  {primary?.isForLoans && <span style={badgeStyle('#dcfce7', '#166534')}>Loan Payout</span>}\r\n                </div>\r\n              )}\r\n            </div>\r\n\r\n            <div>\r\n              {/* Replace / Update always allowed */}\r\n              <button\r\n                onClick={startBankLink}\r\n                disabled={disabledReplaceBtn}\r\n                style={{\r\n                  background: '#4f46e5', color: '#fff', border: '1px solid #4f46e5',\r\n                  padding: '8px 14px', borderRadius: 8,\r\n                  cursor: disabledReplaceBtn ? 'not-allowed' : 'pointer',\r\n                  fontWeight: 700\r\n                }}\r\n              >\r\n                {hasAny ? (linking ? 'Starting…' : 'Update bank account') : (linking ? 'Starting…' : 'Add bank account')}\r\n              </button>\r\n            </div>\r\n          </div>\r\n\r\n          {/* Small identity form only when there is NO method yet (first link) */}\r\n          {!hasAny && (\r\n            <div style={{\r\n              display: 'grid', gap: 8, marginTop: 12,\r\n              background: '#fafafa', border: '1px solid #e5e7eb', borderRadius: 8, padding: 10,\r\n            }}>\r\n              <div style={{ fontSize: 14, color: '#6b7280' }}>Account holder</div>\r\n              <input\r\n                type=\"text\"\r\n                value={fullName}\r\n                onChange={(e) => setFullName(e.target.value)}\r\n                placeholder=\"Account holder full name\"\r\n                style={{ padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n              />\r\n              <input\r\n                type=\"email\"\r\n                value={email}\r\n                onChange={(e) => setEmail(e.target.value)}\r\n                placeholder=\"Email (optional, recommended)\"\r\n                style={{ padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n              />\r\n              <small style={{ color: '#6b7280' }}>\r\n                We’ll pass this to Stripe only to label your bank method.\r\n              </small>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </section>\r\n\r\n      {/* Manage all saved methods */}\r\n      {hasAny && (\r\n        <section style={{ marginBottom: 16 }}>\r\n          <div style={{ fontWeight: 700, marginBottom: 8 }}>Manage saved bank methods</div>\r\n          <div style={{ display: 'grid', gap: 8 }}>\r\n            {myPMs.map((pm) => (\r\n              <div key={pm.id} style={{\r\n                border: '1px solid #e2e8f0', borderRadius: 8, padding: '10px 12px',\r\n                display: 'flex', justifyContent: 'space-between', alignItems: 'center', gap: 10\r\n              }}>\r\n                <div>\r\n                  <div style={{ fontWeight: 700 }}>{pm.brand || 'Bank'}</div>\r\n                  <div style={{ fontSize: 13, color: '#475569' }}>{pm.last4 ? `•••• ${pm.last4}` : '—'}</div>\r\n                  <div style={{ display: 'flex', gap: 6, marginTop: 6 }}>\r\n                    {pm.isDefault && <span style={badgeStyle('#e0e7ff', '#3730a3')}>Default</span>}\r\n                    {pm.isForLoans && <span style={badgeStyle('#dcfce7', '#166534')}>Loan Payout</span>}\r\n                  </div>\r\n                </div>\r\n                <div style={{ display: 'flex', gap: 8 }}>\r\n                  {!pm.isDefault && (\r\n                    <button\r\n                      onClick={() => setDefault(pm.id)}\r\n                      className=\"pm-btn\"\r\n                      style={btnStyle()}\r\n                    >\r\n                      Make Default\r\n                    </button>\r\n                  )}\r\n                  {!pm.isForLoans && (\r\n                    <button\r\n                      onClick={() => setPayout(pm.id)}\r\n                      className=\"pm-btn\"\r\n                      style={btnStyle('#0ea5e9')}\r\n                    >\r\n                      Use for Payouts\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              </div>\r\n            ))}\r\n          </div>\r\n        </section>\r\n      )}\r\n\r\n      {/* Stripe bank link + SAVE to backend */}\r\n      {clientSecret && stripePromise && (\r\n        <Elements stripe={stripePromise}>\r\n          <BankLinkFlow\r\n            clientSecret={clientSecret}\r\n            fullName={fullName}\r\n            email={email}\r\n            onSaved={async () => {\r\n              setClientSecret(null);\r\n              await refreshMyPaymentMethods();\r\n              await refreshWallet();\r\n            }}\r\n            onError={setErrorMsg}\r\n          />\r\n        </Elements>\r\n      )}\r\n\r\n      {/* Deposit panel appears once a default method exists */}\r\n      {hasDefault && (\r\n        <div style={{\r\n          marginTop: 20, padding: 12, borderRadius: 8,\r\n          border: '1px solid #e2e8f0', background: '#ffffff',\r\n        }}>\r\n          <h3 style={{ margin: '0 0 8px' }}>Deposit to PeerFund Balance</h3>\r\n          <p style={{ marginTop: 0, color: '#475569' }}>\r\n            Funds will be debited from your linked bank and added to your available balance.\r\n          </p>\r\n\r\n          <DepositBox\r\n            amount={amount}\r\n            setAmount={setAmount}\r\n            depositing={depositing}\r\n            setDepositing={setDepositing}\r\n            onSuccess={async () => {\r\n              await refreshWallet();\r\n              alert('Deposit initiated successfully.');\r\n            }}\r\n            onError={setErrorMsg}\r\n          />\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\nfunction badgeStyle(bg, fg) {\r\n  return {\r\n    background: bg, color: fg, border: `1px solid ${bg}`,\r\n    borderRadius: 999, padding: '2px 8px', fontSize: 12, fontWeight: 700\r\n  };\r\n}\r\nfunction btnStyle(color = '#4f46e5') {\r\n  return {\r\n    background: color, color: '#fff', border: `1px solid ${color}`,\r\n    padding: '8px 12px', borderRadius: 8, fontWeight: 700, cursor: 'pointer'\r\n  };\r\n}\r\n\r\n/* ---------------- BankLinkFlow: collect + confirm + SAVE ---------------- */\r\n\r\nfunction BankLinkFlow({ clientSecret, fullName, email, onSaved, onError }) {\r\n  const stripe = useStripe();\r\n  const [working, setWorking] = useState(false);\r\n\r\n  async function saveToBackend(paymentMethodId) {\r\n    // Persist per-user PM (make the newly linked one the default & payout)\r\n    const r = await fetch('/api/payment-method/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      body: JSON.stringify({\r\n        paymentMethodId,\r\n        makeDefault: true,\r\n        useForLoans: true,\r\n      }),\r\n    });\r\n    if (!r.ok) {\r\n      const t = await r.text().catch(() => '');\r\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\r\n    }\r\n  }\r\n\r\n  async function handleLink() {\r\n    if (!stripe) { onError?.('Stripe not ready yet.'); return; }\r\n    if (!fullName) { onError?.('Please enter the account holder’s full name.'); return; }\r\n\r\n    setWorking(true);\r\n    try {\r\n      // 1) Open Financial Connections\r\n      const { error: collectError } = await stripe.collectBankAccountForSetup({\r\n        clientSecret,\r\n        params: {\r\n          payment_method_type: 'us_bank_account',\r\n          payment_method_data: {\r\n            billing_details: { name: fullName, ...(email ? { email } : {}) },\r\n          },\r\n        },\r\n      });\r\n      if (collectError) throw collectError;\r\n\r\n      // 2) Confirm the SetupIntent (saves PM to the Stripe customer)\r\n      const { setupIntent, error: confirmError } =\r\n        await stripe.confirmUsBankAccountSetup(clientSecret);\r\n      if (confirmError) throw confirmError;\r\n\r\n      const pmId = setupIntent?.payment_method;\r\n      if (!pmId) throw new Error('Missing payment method id from Stripe.');\r\n\r\n      // 3) SAVE into DB (mark as default + payout)\r\n      await saveToBackend(pmId);\r\n\r\n      // 4) UX feedback\r\n      switch (setupIntent.status) {\r\n        case 'succeeded':\r\n          alert('Bank account updated.');\r\n          break;\r\n        case 'requires_action': {\r\n          const na = setupIntent.next_action;\r\n          if (na?.type === 'verify_with_microdeposits') {\r\n            alert('Bank linked. Stripe is sending two micro-deposits for verification (1–2 business days).');\r\n          } else {\r\n            alert('Bank linked; additional verification is required.');\r\n          }\r\n          break;\r\n        }\r\n        default:\r\n          alert(`Setup in progress (status: ${setupIntent.status}).`);\r\n      }\r\n\r\n      onSaved?.();\r\n    } catch (e) {\r\n      onError?.(e?.message || 'Failed to link bank account.');\r\n    } finally {\r\n      setWorking(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ marginTop: 12 }}>\r\n      <button\r\n        onClick={handleLink}\r\n        disabled={!stripe || working}\r\n        style={{\r\n          background: '#10b981', color: '#fff', border: '1px solid #10b981',\r\n          padding: '8px 14px', borderRadius: 8, fontWeight: 700,\r\n          cursor: !stripe || working ? 'not-allowed' : 'pointer',\r\n        }}\r\n      >\r\n        {working ? 'Connecting…' : 'Continue bank update'}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nBankLinkFlow.propTypes = {\r\n  clientSecret: PropTypes.string.isRequired,\r\n  fullName: PropTypes.string.isRequired,\r\n  email: PropTypes.string,\r\n  onSaved: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n\r\n/* -------- DepositBox: create + confirm PaymentIntent (ACH) -------- */\r\n\r\nfunction DepositBox({ amount, setAmount, depositing, setDepositing, onSuccess, onError }) {\r\n  const stripe = useStripe();\r\n\r\n  async function handleDeposit() {\r\n    const n = Number(amount);\r\n    if (!Number.isFinite(n) || n <= 0) {\r\n      onError?.('Enter a valid deposit amount.');\r\n      return;\r\n    }\r\n    setDepositing(true);\r\n    onError?.('');\r\n\r\n    try {\r\n      const { clientSecret, ledgerId, simulated } = await createDepositIntent(n);\r\n\r\n      // dev mode (backend simulates money movement)\r\n      if (simulated) {\r\n        await devConfirmDeposit(ledgerId);\r\n        onSuccess?.();\r\n        return;\r\n      }\r\n\r\n      if (!stripe) throw new Error('Stripe not ready.');\r\n      const { paymentIntent, error } =\r\n        await stripe.confirmUsBankAccountPayment(clientSecret);\r\n      if (error) throw error;\r\n\r\n      const status = paymentIntent?.status;\r\n      if (status === 'succeeded' || status === 'processing') {\r\n        onSuccess?.();\r\n      } else if (status === 'requires_action') {\r\n        const na = paymentIntent.next_action;\r\n        if (na?.type === 'verify_with_microdeposits') {\r\n          alert('Deposit initiated. Funds will appear after micro-deposit verification.');\r\n          onSuccess?.();\r\n        } else {\r\n          onError?.('Additional action is required to complete this deposit.');\r\n        }\r\n      } else {\r\n        onError?.(`Deposit status: ${status || 'unknown'}.`);\r\n      }\r\n    } catch (e) {\r\n      onError?.(e?.message || 'Deposit failed.');\r\n    } finally {\r\n      setDepositing(false);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div style={{ display: 'flex', gap: 8, alignItems: 'center' }}>\r\n      <div style={{ display: 'flex', alignItems: 'center', gap: 6 }}>\r\n        <span>$</span>\r\n        <input\r\n          type=\"number\"\r\n          step=\"0.01\"\r\n          min=\"1\"\r\n          value={amount}\r\n          onChange={(e) => setAmount(e.target.value)}\r\n          style={{ width: 120, padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n        />\r\n      </div>\r\n      <button\r\n        onClick={handleDeposit}\r\n        disabled={depositing}\r\n        style={{\r\n          background: '#4f46e5', color: '#fff', border: '1px solid #4f46e5',\r\n          padding: '8px 14px', borderRadius: 8, fontWeight: 700,\r\n          cursor: depositing ? 'not-allowed' : 'pointer',\r\n        }}\r\n      >\r\n        {depositing ? 'Processing…' : 'Deposit'}\r\n      </button>\r\n    </div>\r\n  );\r\n}\r\n\r\nDepositBox.propTypes = {\r\n  amount: PropTypes.string.isRequired,\r\n  setAmount: PropTypes.func.isRequired,\r\n  depositing: PropTypes.bool.isRequired,\r\n  setDepositing: PropTypes.func,\r\n  onSuccess: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}