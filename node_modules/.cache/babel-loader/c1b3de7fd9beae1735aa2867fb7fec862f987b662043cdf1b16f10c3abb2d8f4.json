{"ast":null,"code":"import _objectSpread from\"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/features/wallet/PaymentMethod.jsx\nimport{useEffect,useMemo,useRef,useState}from'react';import{loadStripe}from'@stripe/stripe-js';import{Elements,useStripe}from'@stripe/react-stripe-js';/* ---------------- Stripe publishable key ---------------- */import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const rawPk=(process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY||'').trim();const pk=/^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk)?rawPk:'';/* ---------------- Auth header helpers ---------------- */function getToken(){let t=localStorage.getItem('token')||'';t=t.replace(/^\"|\"$/g,'');if(t.toLowerCase().startsWith('bearer '))t=t.slice(7);return t||null;}function authHeaders(){const t=getToken();return t?{Authorization:\"Bearer \".concat(t)}:{};}/* ---------------- Stripe init (cached) ---------------- */let cachedStripePromise;function getStripePromise(){if(!pk)return null;if(!cachedStripePromise)cachedStripePromise=loadStripe(pk);return cachedStripePromise;}/* ================================================================== *//*                     One-card Bank Setup / Management                *//* ================================================================== */export default function PaymentMethodPage(){const[clientSecret,setClientSecret]=useState(null);// current primary method (default or first)\nconst[currentPM,setCurrentPM]=useState(null);// UI state\nconst[linking,setLinking]=useState(false);const[errorMsg,setErrorMsg]=useState('');const[loading,setLoading]=useState(true);// Prefilled identity for first-time link\nconst[fullName,setFullName]=useState('');const[email,setEmail]=useState('');const stripePromise=useMemo(getStripePromise,[pk]);useEffect(()=>{const ac=new AbortController();(async()=>{try{// Prefill name/email\ntry{const r=await fetch('/api/users/profile',{headers:_objectSpread({},authHeaders()),signal:ac.signal});if(r.ok){const u=await r.json();if(u!==null&&u!==void 0&&u.name)setFullName(u.name);if(u!==null&&u!==void 0&&u.email)setEmail(u.email);}}catch(_unused){/* noop */}await refreshPrimary(ac.signal);}finally{setLoading(false);}})();return()=>ac.abort();// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);async function refreshPrimary(signal){try{const r=await fetch('/api/payment-method/mine',{headers:_objectSpread({},authHeaders()),signal});if(!r.ok){setCurrentPM(null);return;}const d=await r.json();const list=Array.isArray(d===null||d===void 0?void 0:d.items)?d.items:[];const primary=list.find(x=>x.isDefault)||list[0]||null;setCurrentPM(primary);}catch(_unused2){setCurrentPM(null);}}async function startBankLink(){setLinking(true);setErrorMsg('');try{const r=await fetch('/api/stripe/create-bank-setup-intent',{method:'POST',headers:_objectSpread({'Content-Type':'application/json'},authHeaders())});if(r.status===401){setErrorMsg('Your session expired. Please log in again, then return here.');return;}if(!r.ok)throw new Error((await r.text())||'Failed to create SetupIntent.');const{client_secret}=await r.json();if(!client_secret)throw new Error('No client_secret returned from server.');setClientSecret(client_secret);}catch(e){setErrorMsg(e.message||'Could not start bank link.');}finally{setLinking(false);}}const hasPM=!!currentPM;const stripeReady=!!pk&&!!stripePromise;const disabledBtn=linking||!stripeReady||!hasPM&&!fullName;return/*#__PURE__*/_jsxs(\"div\",{style:{maxWidth:720,margin:'0 auto',padding:16},children:[/*#__PURE__*/_jsx(\"h2\",{style:{marginTop:0},children:\"Payment Method\"}),!pk&&/*#__PURE__*/_jsxs(\"div\",{style:{background:'#fef2f2',border:'1px solid #fecaca',color:'#7f1d1d',padding:'10px 12px',borderRadius:8,marginBottom:12},children:[\"Missing Stripe publishable key. Add\",' ',/*#__PURE__*/_jsx(\"code\",{children:\"REACT_APP_STRIPE_PUBLISHABLE_KEY\"}),\" to your \",/*#__PURE__*/_jsx(\"code\",{children:\".env\"}),\".\"]}),errorMsg&&/*#__PURE__*/_jsx(\"div\",{style:{background:'#fff7ed',border:'1px solid #fed7aa',color:'#7c2d12',padding:'10px 12px',borderRadius:8,marginBottom:12},children:errorMsg}),/*#__PURE__*/_jsxs(\"section\",{style:{border:'1px solid #e2e8f0',borderRadius:12,background:'#fff',padding:14,opacity:loading?0.7:1},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',alignItems:'center',gap:12},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:800,fontSize:16,marginBottom:4},children:hasPM?(currentPM===null||currentPM===void 0?void 0:currentPM.brand)||'Bank account':'No bank account on file'}),/*#__PURE__*/_jsx(\"div\",{style:{fontSize:13,color:'#475569',marginBottom:6},children:hasPM?currentPM!==null&&currentPM!==void 0&&currentPM.last4?\"\\u2022\\u2022\\u2022\\u2022 \".concat(currentPM.last4):'—':'Link your bank to send and receive money on PeerFund.'}),hasPM&&/*#__PURE__*/_jsxs(\"small\",{style:{color:'#64748b'},children:[\"Used for \",/*#__PURE__*/_jsx(\"strong\",{children:\"both\"}),\" funding and payouts. Updating replaces your current bank.\"]})]}),/*#__PURE__*/_jsx(\"button\",{onClick:startBankLink,disabled:disabledBtn,style:{background:'#4f46e5',color:'#fff',border:'1px solid #4f46e5',padding:'10px 14px',borderRadius:10,fontWeight:800,cursor:disabledBtn?'not-allowed':'pointer',whiteSpace:'nowrap'},children:hasPM?linking?'Starting…':'Update bank account':linking?'Starting…':'Link bank account'})]}),!hasPM&&/*#__PURE__*/_jsxs(\"div\",{style:{display:'grid',gap:8,marginTop:12,background:'#fafafa',border:'1px solid #e5e7eb',borderRadius:8,padding:10},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontSize:14,color:'#6b7280'},children:\"Account holder\"}),/*#__PURE__*/_jsx(\"input\",{type:\"text\",value:fullName,onChange:e=>setFullName(e.target.value),placeholder:\"Account holder full name\",style:{padding:'8px 10px',border:'1px solid #e2e8f0',borderRadius:8}}),/*#__PURE__*/_jsx(\"small\",{style:{color:'#6b7280'},children:\"We pass this to Stripe only to label your bank method.\"})]})]}),clientSecret&&stripePromise&&/*#__PURE__*/_jsx(Elements,{stripe:stripePromise,children:/*#__PURE__*/_jsx(BankLinkFlow,{clientSecret:clientSecret,fullName:fullName,email:email,onSaved:async()=>{setClientSecret(null);await refreshPrimary();},onError:msg=>{setClientSecret(null);// hide the flow if user cancels/errors\nsetErrorMsg(msg);}})})]});}/* ---------------- Flow: collect + confirm + SAVE (auto-run) ---------------- */function BankLinkFlow(_ref){let{clientSecret,fullName,email,onSaved,onError}=_ref;const stripe=useStripe();const[working,setWorking]=useState(true);const startedRef=useRef(false);async function saveToBackend(paymentMethodId){const r=await fetch('/api/payment-method/save',{method:'POST',headers:_objectSpread({'Content-Type':'application/json'},authHeaders()),body:JSON.stringify({paymentMethodId,makeDefault:true,useForLoans:true})});if(!r.ok){const t=await r.text().catch(()=>'');throw new Error(t||'Failed to save payment method to your PeerFund account.');}}useEffect(()=>{if(!stripe||!clientSecret||startedRef.current)return;if(!fullName){onError===null||onError===void 0?void 0:onError('Please enter the account holder’s full name.');return;}startedRef.current=true;(async()=>{try{// 1) Open Financial Connections immediately\nconst{error:collectError}=await stripe.collectBankAccountForSetup({clientSecret,params:{payment_method_type:'us_bank_account',payment_method_data:{billing_details:_objectSpread({name:fullName},email?{email}:{})}}});if(collectError)throw collectError;// 2) Confirm the SetupIntent\nconst{setupIntent,error:confirmError}=await stripe.confirmUsBankAccountSetup(clientSecret);if(confirmError)throw confirmError;const pmId=setupIntent===null||setupIntent===void 0?void 0:setupIntent.payment_method;if(!pmId)throw new Error('Missing payment method id from Stripe.');// 3) Persist as default + payout\nawait saveToBackend(pmId);// 4) Finish quietly; parent will refresh and show last4\nonSaved===null||onSaved===void 0?void 0:onSaved();}catch(e){onError===null||onError===void 0?void 0:onError((e===null||e===void 0?void 0:e.message)||'Failed to link bank account.');}finally{setWorking(false);}})();},[stripe,clientSecret,fullName,email,onSaved,onError]);// Minimal inline “working” hint while the Stripe modal opens/finishes.\nreturn/*#__PURE__*/_jsx(\"div\",{style:{marginTop:12,background:'#f8fafc',border:'1px solid #e2e8f0',borderRadius:8,padding:'10px 12px',fontSize:14,color:'#334155'},children:working?'Opening secure bank link…':'Done.'});}","map":{"version":3,"names":["useEffect","useMemo","useRef","useState","loadStripe","Elements","useStripe","jsx","_jsx","jsxs","_jsxs","rawPk","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","trim","pk","test","getToken","t","localStorage","getItem","replace","toLowerCase","startsWith","slice","authHeaders","Authorization","concat","cachedStripePromise","getStripePromise","PaymentMethodPage","clientSecret","setClientSecret","currentPM","setCurrentPM","linking","setLinking","errorMsg","setErrorMsg","loading","setLoading","fullName","setFullName","email","setEmail","stripePromise","ac","AbortController","r","fetch","headers","_objectSpread","signal","ok","u","json","name","_unused","refreshPrimary","abort","d","list","Array","isArray","items","primary","find","x","isDefault","_unused2","startBankLink","method","status","Error","text","client_secret","e","message","hasPM","stripeReady","disabledBtn","style","maxWidth","margin","padding","children","marginTop","background","border","color","borderRadius","marginBottom","opacity","display","justifyContent","alignItems","gap","fontWeight","fontSize","brand","last4","onClick","disabled","cursor","whiteSpace","type","value","onChange","target","placeholder","stripe","BankLinkFlow","onSaved","onError","msg","_ref","working","setWorking","startedRef","saveToBackend","paymentMethodId","body","JSON","stringify","makeDefault","useForLoans","catch","current","error","collectError","collectBankAccountForSetup","params","payment_method_type","payment_method_data","billing_details","setupIntent","confirmError","confirmUsBankAccountSetup","pmId","payment_method"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/PaymentMethod.jsx"],"sourcesContent":["// src/features/wallet/PaymentMethod.jsx\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\r\n\r\n/* ---------------- Stripe publishable key ---------------- */\r\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\r\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\r\n\r\n/* ---------------- Auth header helpers ---------------- */\r\nfunction getToken() {\r\n  let t = localStorage.getItem('token') || '';\r\n  t = t.replace(/^\"|\"$/g, '');\r\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\r\n  return t || null;\r\n}\r\nfunction authHeaders() {\r\n  const t = getToken();\r\n  return t ? { Authorization: `Bearer ${t}` } : {};\r\n}\r\n\r\n/* ---------------- Stripe init (cached) ---------------- */\r\nlet cachedStripePromise;\r\nfunction getStripePromise() {\r\n  if (!pk) return null;\r\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\r\n  return cachedStripePromise;\r\n}\r\n\r\n/* ================================================================== */\r\n/*                     One-card Bank Setup / Management                */\r\n/* ================================================================== */\r\n\r\nexport default function PaymentMethodPage() {\r\n  const [clientSecret, setClientSecret] = useState(null);\r\n\r\n  // current primary method (default or first)\r\n  const [currentPM, setCurrentPM] = useState(null);\r\n\r\n  // UI state\r\n  const [linking, setLinking] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Prefilled identity for first-time link\r\n  const [fullName, setFullName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n\r\n  const stripePromise = useMemo(getStripePromise, [pk]);\r\n\r\n  useEffect(() => {\r\n    const ac = new AbortController();\r\n    (async () => {\r\n      try {\r\n        // Prefill name/email\r\n        try {\r\n          const r = await fetch('/api/users/profile', {\r\n            headers: { ...authHeaders() },\r\n            signal: ac.signal,\r\n          });\r\n          if (r.ok) {\r\n            const u = await r.json();\r\n            if (u?.name) setFullName(u.name);\r\n            if (u?.email) setEmail(u.email);\r\n          }\r\n        } catch {\r\n          /* noop */\r\n        }\r\n\r\n        await refreshPrimary(ac.signal);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => ac.abort();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function refreshPrimary(signal) {\r\n    try {\r\n      const r = await fetch('/api/payment-method/mine', {\r\n        headers: { ...authHeaders() },\r\n        signal,\r\n      });\r\n      if (!r.ok) {\r\n        setCurrentPM(null);\r\n        return;\r\n      }\r\n      const d = await r.json();\r\n      const list = Array.isArray(d?.items) ? d.items : [];\r\n      const primary = list.find((x) => x.isDefault) || list[0] || null;\r\n      setCurrentPM(primary);\r\n    } catch {\r\n      setCurrentPM(null);\r\n    }\r\n  }\r\n\r\n  async function startBankLink() {\r\n    setLinking(true);\r\n    setErrorMsg('');\r\n    try {\r\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      });\r\n      if (r.status === 401) {\r\n        setErrorMsg('Your session expired. Please log in again, then return here.');\r\n        return;\r\n      }\r\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\r\n      const { client_secret } = await r.json();\r\n      if (!client_secret) throw new Error('No client_secret returned from server.');\r\n      setClientSecret(client_secret);\r\n    } catch (e) {\r\n      setErrorMsg(e.message || 'Could not start bank link.');\r\n    } finally {\r\n      setLinking(false);\r\n    }\r\n  }\r\n\r\n  const hasPM = !!currentPM;\r\n  const stripeReady = !!pk && !!stripePromise;\r\n  const disabledBtn = linking || !stripeReady || (!hasPM && !fullName);\r\n\r\n  return (\r\n    <div style={{ maxWidth: 720, margin: '0 auto', padding: 16 }}>\r\n      <h2 style={{ marginTop: 0 }}>Payment Method</h2>\r\n\r\n      {!pk && (\r\n        <div\r\n          style={{\r\n            background: '#fef2f2',\r\n            border: '1px solid #fecaca',\r\n            color: '#7f1d1d',\r\n            padding: '10px 12px',\r\n            borderRadius: 8,\r\n            marginBottom: 12,\r\n          }}\r\n        >\r\n          Missing Stripe publishable key. Add{' '}\r\n          <code>REACT_APP_STRIPE_PUBLISHABLE_KEY</code> to your <code>.env</code>.\r\n        </div>\r\n      )}\r\n\r\n      {errorMsg && (\r\n        <div\r\n          style={{\r\n            background: '#fff7ed',\r\n            border: '1px solid #fed7aa',\r\n            color: '#7c2d12',\r\n            padding: '10px 12px',\r\n            borderRadius: 8,\r\n            marginBottom: 12,\r\n          }}\r\n        >\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n\r\n      <section\r\n        style={{\r\n          border: '1px solid #e2e8f0',\r\n          borderRadius: 12,\r\n          background: '#fff',\r\n          padding: 14,\r\n          opacity: loading ? 0.7 : 1,\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            gap: 12,\r\n          }}\r\n        >\r\n          <div>\r\n            <div style={{ fontWeight: 800, fontSize: 16, marginBottom: 4 }}>\r\n              {hasPM ? currentPM?.brand || 'Bank account' : 'No bank account on file'}\r\n            </div>\r\n            <div style={{ fontSize: 13, color: '#475569', marginBottom: 6 }}>\r\n              {hasPM\r\n                ? currentPM?.last4\r\n                  ? `•••• ${currentPM.last4}`\r\n                  : '—'\r\n                : 'Link your bank to send and receive money on PeerFund.'}\r\n            </div>\r\n            {hasPM && (\r\n              <small style={{ color: '#64748b' }}>\r\n                Used for <strong>both</strong> funding and payouts. Updating replaces your current\r\n                bank.\r\n              </small>\r\n            )}\r\n          </div>\r\n\r\n          <button\r\n            onClick={startBankLink}\r\n            disabled={disabledBtn}\r\n            style={{\r\n              background: '#4f46e5',\r\n              color: '#fff',\r\n              border: '1px solid #4f46e5',\r\n              padding: '10px 14px',\r\n              borderRadius: 10,\r\n              fontWeight: 800,\r\n              cursor: disabledBtn ? 'not-allowed' : 'pointer',\r\n              whiteSpace: 'nowrap',\r\n            }}\r\n          >\r\n            {hasPM ? (linking ? 'Starting…' : 'Update bank account') : linking ? 'Starting…' : 'Link bank account'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* First-time: show identity fields below the button */}\r\n        {!hasPM && (\r\n          <div\r\n            style={{\r\n              display: 'grid',\r\n              gap: 8,\r\n              marginTop: 12,\r\n              background: '#fafafa',\r\n              border: '1px solid #e5e7eb',\r\n              borderRadius: 8,\r\n              padding: 10,\r\n            }}\r\n          >\r\n            <div style={{ fontSize: 14, color: '#6b7280' }}>Account holder</div>\r\n            <input\r\n              type=\"text\"\r\n              value={fullName}\r\n              onChange={(e) => setFullName(e.target.value)}\r\n              placeholder=\"Account holder full name\"\r\n              style={{ padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n            />\r\n          \r\n            <small style={{ color: '#6b7280' }}>\r\n              We pass this to Stripe only to label your bank method.\r\n            </small>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      {/* Stripe bank link + SAVE to backend (makes it Default + Payout) */}\r\n      {clientSecret && stripePromise && (\r\n        <Elements stripe={stripePromise}>\r\n          <BankLinkFlow\r\n            clientSecret={clientSecret}\r\n            fullName={fullName}\r\n            email={email}\r\n            onSaved={async () => {\r\n              setClientSecret(null);\r\n              await refreshPrimary();\r\n            }}\r\n            onError={(msg) => {\r\n              setClientSecret(null); // hide the flow if user cancels/errors\r\n              setErrorMsg(msg);\r\n            }}\r\n          />\r\n        </Elements>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ---------------- Flow: collect + confirm + SAVE (auto-run) ---------------- */\r\nfunction BankLinkFlow({ clientSecret, fullName, email, onSaved, onError }) {\r\n  const stripe = useStripe();\r\n  const [working, setWorking] = useState(true);\r\n  const startedRef = useRef(false);\r\n\r\n  async function saveToBackend(paymentMethodId) {\r\n    const r = await fetch('/api/payment-method/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      body: JSON.stringify({\r\n        paymentMethodId,\r\n        makeDefault: true,\r\n        useForLoans: true,\r\n      }),\r\n    });\r\n    if (!r.ok) {\r\n      const t = await r.text().catch(() => '');\r\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!stripe || !clientSecret || startedRef.current) return;\r\n    if (!fullName) {\r\n      onError?.('Please enter the account holder’s full name.');\r\n      return;\r\n    }\r\n\r\n    startedRef.current = true;\r\n\r\n    (async () => {\r\n      try {\r\n        // 1) Open Financial Connections immediately\r\n        const { error: collectError } = await stripe.collectBankAccountForSetup({\r\n          clientSecret,\r\n          params: {\r\n            payment_method_type: 'us_bank_account',\r\n            payment_method_data: {\r\n              billing_details: { name: fullName, ...(email ? { email } : {}) },\r\n            },\r\n          },\r\n        });\r\n        if (collectError) throw collectError;\r\n\r\n        // 2) Confirm the SetupIntent\r\n        const { setupIntent, error: confirmError } =\r\n          await stripe.confirmUsBankAccountSetup(clientSecret);\r\n        if (confirmError) throw confirmError;\r\n\r\n        const pmId = setupIntent?.payment_method;\r\n        if (!pmId) throw new Error('Missing payment method id from Stripe.');\r\n\r\n        // 3) Persist as default + payout\r\n        await saveToBackend(pmId);\r\n\r\n        // 4) Finish quietly; parent will refresh and show last4\r\n        onSaved?.();\r\n      } catch (e) {\r\n        onError?.(e?.message || 'Failed to link bank account.');\r\n      } finally {\r\n        setWorking(false);\r\n      }\r\n    })();\r\n  }, [stripe, clientSecret, fullName, email, onSaved, onError]);\r\n\r\n  // Minimal inline “working” hint while the Stripe modal opens/finishes.\r\n  return (\r\n    <div\r\n      style={{\r\n        marginTop: 12,\r\n        background: '#f8fafc',\r\n        border: '1px solid #e2e8f0',\r\n        borderRadius: 8,\r\n        padding: '10px 12px',\r\n        fontSize: 14,\r\n        color: '#334155',\r\n      }}\r\n    >\r\n      {working ? 'Opening secure bank link…' : 'Done.'}\r\n    </div>\r\n  );\r\n}\r\n\r\nBankLinkFlow.propTypes = {\r\n  clientSecret: PropTypes.string.isRequired,\r\n  fullName: PropTypes.string.isRequired,\r\n  email: PropTypes.string,\r\n  onSaved: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}