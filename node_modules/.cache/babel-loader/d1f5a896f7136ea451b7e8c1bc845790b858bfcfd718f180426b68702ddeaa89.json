{"ast":null,"code":"import _objectSpread from\"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";// src/features/money/MoneySummary.jsx\nimport React,{useEffect,useState,useCallback}from'react';import'./MoneySummary.css';import LoanThreadModal from'../loans/LoanThreadModal';import OfferModal from'../../components/OfferModal';import RepaymentButton from'../loans/RepaymentButton';/* ----------------------- helpers ----------------------- */// decode JWT for current user id\nimport{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";function getCurrentUserId(){const t=localStorage.getItem('token');if(!t)return null;try{var _payload$userId;const payload=JSON.parse(atob(t.split('.')[1]||''));return(_payload$userId=payload===null||payload===void 0?void 0:payload.userId)!==null&&_payload$userId!==void 0?_payload$userId:null;}catch(err){// Invalid/expired token or malformed payload\nreturn null;}}const fmtMoney=n=>typeof n==='number'&&!Number.isNaN(n)?\"$\".concat(n.toFixed(2)):'â€”';// compact row layout\nconst ROW_GRID={display:'grid',gridTemplateColumns:'minmax(140px,1fr) 120px 140px auto auto',alignItems:'center',gap:10};async function authFetch(url){let options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};const token=localStorage.getItem('token');const headers=_objectSpread(_objectSpread({},options.headers||{}),token?{Authorization:\"Bearer \".concat(token)}:{});const res=await fetch(url,_objectSpread(_objectSpread({},options),{},{headers,credentials:'include'}));if(res.status===401){try{console.warn('401 on',url,await res.text());}catch(err){// Could not read body; ignore\n}window.location.assign('/login');throw new Error('Unauthorized');}return res;}function isLoanPaidOff(loan){const s=(loan.status||'').toUpperCase();// Explicit status flags\nif(['PAID_OFF','COMPLETED','CLOSED'].includes(s))return true;// Remaining principal flags\nif(typeof loan.remainingPrincipal==='number'&&loan.remainingPrincipal<=0){return true;}if(typeof loan.remainingPrincipalCents==='number'&&loan.remainingPrincipalCents<=0){return true;}// Frontend-only inference (no next due date + no installment amount)\nconst hasNextDue=!!loan.nextDueDate;const installment=typeof loan.installmentAmount==='number'?loan.installmentAmount:null;if(!hasNextDue&&(installment===null||installment<=0)){return true;}return false;}function sortLoansWithPaidOffLast(list){return[...list].sort((a,b)=>{const aDone=isLoanPaidOff(a);const bDone=isLoanPaidOff(b);if(aDone===bDone)return 0;return aDone?1:-1;// active first, paid-off last\n});}/* ------------------------- Small inline modal ------------------------- */function LinkBankFirstModal(_ref){let{open,onClose}=_ref;if(!open)return null;return/*#__PURE__*/_jsx(\"div\",{role:\"dialog\",\"aria-modal\":\"true\",style:{position:'fixed',inset:0,background:'rgba(0,0,0,0.35)',display:'flex',alignItems:'center',justifyContent:'center',padding:16,zIndex:1000},onClick:onClose,children:/*#__PURE__*/_jsxs(\"div\",{onClick:e=>e.stopPropagation(),style:{width:'100%',maxWidth:520,background:'#fff',border:'1px solid #e5e7eb',borderRadius:12,boxShadow:'0 10px 30px rgba(0,0,0,0.12)',padding:20},children:[/*#__PURE__*/_jsx(\"h3\",{style:{margin:0},children:\"Add a bank to receive funds\"}),/*#__PURE__*/_jsx(\"p\",{style:{color:'#334155',marginTop:8},children:\"Before you can accept an offer, please link a bank account for loan disbursement on the Payment Method page.\"}),/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',gap:8,justifyContent:'flex-end',marginTop:14},children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm\",onClick:onClose,children:\"Close\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm primary\",onClick:()=>{window.location.assign('/payment-method');},children:\"Go to Payment Method\"})]})]})});}/* ------------------------- Open request row ------------------------- */function OpenRequestRow(_ref2){var _req$status;let{req,isExpanded,onToggle,actionLoading,offersContent,// React node for market/borrower offers list\nonMakeOffer,// fn for market/lender to open OfferModal\nonAcceptDirect,// fn for direct approve\nonDeclineDirect// fn for direct decline\n}=_ref2;const isMarket=req.type==='market';const isBorrowing=req.role==='Borrowing';return/*#__PURE__*/_jsxs(\"div\",{className:\"ms-card\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ms-card-row\",style:ROW_GRID,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-label\",children:\"Counterparty\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ms-value-strong\",children:[req.counterpartyName||'Unknown',/*#__PURE__*/_jsxs(\"span\",{style:{marginLeft:8,color:'#64748b',fontWeight:600},children:[\"\\u2022 \",req.role]})]})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-label\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-value-strong\",children:fmtMoney(req.amount)})]}),/*#__PURE__*/_jsx(\"div\",{style:{justifySelf:'end'},children:/*#__PURE__*/_jsx(\"span\",{className:\"ms-badge ms-badge--warn\",children:\"Open\"})}),/*#__PURE__*/_jsx(\"div\",{style:{justifySelf:'end',display:'flex',gap:8},children:/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm\",onClick:onToggle,title:\"View request\",children:isExpanded?'ðŸ”½ Hide':'ðŸ“„ View'})})]}),isExpanded&&/*#__PURE__*/_jsxs(\"div\",{className:\"ms-details\",children:[/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",(_req$status=req.status)!==null&&_req$status!==void 0?_req$status:'OPEN']}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Interest Rate:\"}),' ',Number.isFinite(req.interestRate)?\"\".concat(req.interestRate,\"%\"):'â€”']}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Duration:\"}),' ',Number.isFinite(req.duration)?\"\".concat(req.duration,\" months\"):'â€”']}),req.purpose?/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Reason:\"}),\" \",req.purpose]}):null,isMarket&&isBorrowing&&offersContent,isMarket&&!isBorrowing&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-8\",style:{display:'flex',justifyContent:'flex-end'},children:/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm primary\",onClick:onMakeOffer,children:\"\\uD83D\\uDCB5 Make Offer\"})}),!isMarket&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8\",style:{display:'flex',gap:8,justifyContent:'flex-end'},children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm primary\",onClick:onAcceptDirect,disabled:!!actionLoading[req.id],children:actionLoading[req.id]?'Workingâ€¦':'Accept'}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm\",onClick:onDeclineDirect,disabled:!!actionLoading[req.id],children:actionLoading[req.id]?'Workingâ€¦':'Decline'})]})]})]},req.id);}/* -------------------------------- Parent -------------------------------- */export default function MoneySummary(){const[summary,setSummary]=useState({loansGiven:[],loansReceived:[],myOpenRequests:[]});const[loading,setLoading]=useState(true);const[expanded,setExpanded]=useState({});const[openSec,setOpenSec]=useState({open:true,given:true,received:true});const[actionLoading,setActionLoading]=useState({});const[threadLoanId,setThreadLoanId]=useState(null);// marketplace offers cache per loanId\nconst[offersByLoanId,setOffersByLoanId]=useState({});const[offersLoading,setOffersLoading]=useState({});const[offerWorking,setOfferWorking]=useState({});const[offerModalLoanId,setOfferModalLoanId]=useState(null);// cached: does borrower have a payment method for loan funding\nconst[hasLoanPM,setHasLoanPM]=useState(null);// null=unknown, true/false known\nconst[showLinkModal,setShowLinkModal]=useState(false);const checkHasLoanPaymentMethod=useCallback(async()=>{if(hasLoanPM!==null)return hasLoanPM;try{const r=await authFetch('/api/stripe/has-loan-payment-method');if(!r.ok)throw new Error('has-loan-payment-method failed');const d=await r.json();const val=!!(d!==null&&d!==void 0&&d.hasLoanPaymentMethod);setHasLoanPM(val);return val;}catch(err){// Endpoint failed or user has no saved payment method yet\nsetHasLoanPM(false);return false;}},[hasLoanPM]);/* ------------------ Fetch helpers (market + direct) ------------------ */const fetchMarketOpenRequests=useCallback(async()=>{const me=getCurrentUserId();if(!me)return[];const rows=[];// (A) Requests where I am the LENDER (Iâ€™ve made an offer)\ntry{const r=await authFetch('/api/loans/offers/mine');if(r.ok){const data=await r.json();const items=Array.isArray(data===null||data===void 0?void 0:data.items)?data.items:Array.isArray(data)?data:[];for(const it of items){var _it$myOffer$interestR,_it$myOffer,_it$borrower,_it$borrower2,_it$borrower3;rows.push({type:'market',id:it.id,// loanRequest id\namount:Number(it.amount),duration:Number(it.duration),interestRate:Number((_it$myOffer$interestR=(_it$myOffer=it.myOffer)===null||_it$myOffer===void 0?void 0:_it$myOffer.interestRate)!==null&&_it$myOffer$interestR!==void 0?_it$myOffer$interestR:it.interestRate),purpose:it.purpose||'',createdAt:it.createdAt||null,borrowerId:(_it$borrower=it.borrower)===null||_it$borrower===void 0?void 0:_it$borrower.id,borrowerName:((_it$borrower2=it.borrower)===null||_it$borrower2===void 0?void 0:_it$borrower2.name)||'Borrower',counterpartyName:((_it$borrower3=it.borrower)===null||_it$borrower3===void 0?void 0:_it$borrower3.name)||'Borrower',role:'Lending',status:it.status||'OPEN',myOffer:it.myOffer?{id:it.myOffer.id,amount:Number(it.myOffer.amount),duration:Number(it.myOffer.duration),interestRate:Number(it.myOffer.interestRate),createdAt:it.myOffer.createdAt}:null});}}}catch(err){// Non-fatal: this section can fail and we still render the page\n// console.warn('fetchMarketOpenRequests section failed', err);\n}// (B) My OPEN requests that already have offers\nlet mineOpen=[];try{const rAll=await authFetch('/api/loans/open');if(rAll.ok){const rawAll=await rAll.json();const listAll=Array.isArray(rawAll)?rawAll:(rawAll===null||rawAll===void 0?void 0:rawAll.items)||[];mineOpen=listAll.filter(x=>{var _x$borrower;return(x.status||'OPEN').toUpperCase()==='OPEN'&&String(x.borrowerId||(x===null||x===void 0?void 0:(_x$borrower=x.borrower)===null||_x$borrower===void 0?void 0:_x$borrower.id))===String(me);});}}catch(err){// Non-fatal: this section can fail and we still render the page\n// console.warn('fetchMarketOpenRequests section failed', err);\n}const keepNow=[];const toProbe=[];for(const req of mineOpen){var _req$_count;const offersArr=Array.isArray(req.loanOffers)?req.loanOffers:[];const offerCount=typeof(req===null||req===void 0?void 0:(_req$_count=req._count)===null||_req$_count===void 0?void 0:_req$_count.loanOffers)==='number'?req._count.loanOffers:offersArr.length;if(offerCount>0)keepNow.push(req);else toProbe.push(req);}if(toProbe.length){const probed=await Promise.all(toProbe.map(async req=>{try{const r=await authFetch(\"/api/loans/\".concat(req.id,\"/offers\"));const arr=r.ok?await r.json():[];if(Array.isArray(arr)&&arr.length>0){setOffersByLoanId(m=>_objectSpread(_objectSpread({},m),{},{[req.id]:arr}));return req;}}catch(err){// Non-fatal: probing offers failed for this request\n}return null;}));keepNow.push(...probed.filter(Boolean));}for(const req of keepNow){var _req$borrower,_req$duration,_req$interestRate,_req$borrower2;const borrowerId=req.borrowerId||(req===null||req===void 0?void 0:(_req$borrower=req.borrower)===null||_req$borrower===void 0?void 0:_req$borrower.id)||me;rows.push({type:'market',id:req.id,amount:Number(req.amount),duration:Number((_req$duration=req.duration)!==null&&_req$duration!==void 0?_req$duration:req.months),interestRate:Number((_req$interestRate=req.interestRate)!==null&&_req$interestRate!==void 0?_req$interestRate:req.apr),purpose:req.purpose||'',createdAt:req.createdAt||null,borrowerId,borrowerName:(req===null||req===void 0?void 0:(_req$borrower2=req.borrower)===null||_req$borrower2===void 0?void 0:_req$borrower2.name)||'You',counterpartyName:'â€” Borrowing',role:'Borrowing',status:req.status||'OPEN'});}const seen=new Set();return rows.filter(r=>seen.has(r.id)?false:(seen.add(r.id),true));},[]);const fetchDirectOpenRequests=useCallback(async()=>{const me=getCurrentUserId();if(!me)return[];try{const r=await authFetch('/api/direct-requests/open/mine');if(!r.ok)return[];const rows=await r.json();return(Array.isArray(rows)?rows:[]).map(d=>{var _d$borrower,_d$lender,_d$months,_d$apr,_d$borrower2,_d$lender2,_d$lender3,_d$borrower3;const borrowerId=d.borrowerId||(d===null||d===void 0?void 0:(_d$borrower=d.borrower)===null||_d$borrower===void 0?void 0:_d$borrower.id);const lenderId=d.lenderId||(d===null||d===void 0?void 0:(_d$lender=d.lender)===null||_d$lender===void 0?void 0:_d$lender.id);const iAmBorrower=String(borrowerId)===String(me);return{type:'direct',id:d.id,amount:Number(d.amount),duration:Number((_d$months=d.months)!==null&&_d$months!==void 0?_d$months:d.duration),interestRate:Number((_d$apr=d.apr)!==null&&_d$apr!==void 0?_d$apr:d.interestRate),createdAt:d.createdAt||null,borrowerId,borrowerName:(d===null||d===void 0?void 0:(_d$borrower2=d.borrower)===null||_d$borrower2===void 0?void 0:_d$borrower2.name)||(iAmBorrower?'You':''),lenderId,lenderName:(d===null||d===void 0?void 0:(_d$lender2=d.lender)===null||_d$lender2===void 0?void 0:_d$lender2.name)||(!iAmBorrower?'You':''),counterpartyName:iAmBorrower?(d===null||d===void 0?void 0:(_d$lender3=d.lender)===null||_d$lender3===void 0?void 0:_d$lender3.name)||'Lender':(d===null||d===void 0?void 0:(_d$borrower3=d.borrower)===null||_d$borrower3===void 0?void 0:_d$borrower3.name)||'Borrower',role:iAmBorrower?'Borrowing':'Lending',status:d.status||'PENDING'};});}catch(err){// Non-fatal: if this fetch fails, just treat as no results\nreturn[];}},[]);const fetchSummary=useCallback(async()=>{const token=localStorage.getItem('token');if(!token)return;setLoading(true);try{const res=await authFetch('/api/users/my-money-summary');let loansGiven=[];let loansReceived=[];if(res.ok){const data=await res.json();loansGiven=Array.isArray(data.loansGiven)?data.loansGiven:Array.isArray(data.loansAsLender)?data.loansAsLender:[];loansReceived=Array.isArray(data.loansReceived)?data.loansReceived:Array.isArray(data.loansAsBorrower)?data.loansAsBorrower:[];}const[marketOpen,directOpen]=await Promise.all([fetchMarketOpenRequests(),fetchDirectOpenRequests()]);setSummary({loansGiven:sortLoansWithPaidOffLast(loansGiven),loansReceived:sortLoansWithPaidOffLast(loansReceived),myOpenRequests:[...marketOpen,...directOpen]});}catch(err){console.error('Error fetching money summary:',err);setSummary({loansGiven:[],loansReceived:[],myOpenRequests:[]});}finally{setLoading(false);}},[fetchMarketOpenRequests,fetchDirectOpenRequests]);useEffect(()=>{fetchSummary();},[fetchSummary]);const toggleDetails=async req=>{setExpanded(prev=>{const collapsed=Object.keys(prev).reduce((acc,k)=>_objectSpread(_objectSpread({},acc),{},{[k]:false}),{});return _objectSpread(_objectSpread({},collapsed),{},{[req.id]:!prev[req.id]});});if(req.type==='market'&&req.role==='Borrowing'){if(!offersByLoanId[req.id]&&!offersLoading[req.id]){await loadOffers(req.id);}}};/* -------------------- Offers (marketplace) -------------------- */const loadOffers=async loanId=>{setOffersLoading(m=>_objectSpread(_objectSpread({},m),{},{[loanId]:true}));try{const r=await authFetch(\"/api/loans/\".concat(loanId,\"/offers\"));const items=r.ok?await r.json():[];setOffersByLoanId(m=>_objectSpread(_objectSpread({},m),{},{[loanId]:Array.isArray(items)?items:[]}));}catch(e){console.error('loadOffers error',e);setOffersByLoanId(m=>_objectSpread(_objectSpread({},m),{},{[loanId]:[]}));}finally{setOffersLoading(m=>_objectSpread(_objectSpread({},m),{},{[loanId]:false}));}};const acceptOffer=async offer=>{setOfferWorking(m=>_objectSpread(_objectSpread({},m),{},{[offer.id]:true}));try{var _data$loan;// 1) Optional: ensure borrower has payout method on file\nconst ok=await checkHasLoanPaymentMethod();if(!ok){setShowLinkModal(true);setOfferWorking(m=>_objectSpread(_objectSpread({},m),{},{[offer.id]:false}));return;}// 2) Accept the offer -> server creates the Loan (status: ACCEPTED)\nconst r=await authFetch(\"/api/loans/offers/\".concat(offer.id,\"/accept\"),{method:'POST',headers:{'Content-Type':'application/json'}});const data=r.ok?await r.json():null;if(!r.ok||!(data!==null&&data!==void 0&&(_data$loan=data.loan)!==null&&_data$loan!==void 0&&_data$loan.id)){const t=!r.ok?await r.text().catch(()=>''):'';throw new Error(t||(data===null||data===void 0?void 0:data.error)||'Failed to accept offer');}console.log('âœ… Offer accepted response:',data);// 3) Just refresh the summary; funding is done later by the lender\nawait fetchSummary();alert('Loan accepted and contract saved. Waiting for lender to fund from their PeerFund wallet.');}catch(e){console.error(e);alert(\"Action failed:\\n\".concat(e.message||e));}finally{setOfferWorking(m=>_objectSpread(_objectSpread({},m),{},{[offer.id]:false}));}};/* -------------------- Direct request actions -------------------- */async function tryEndpoints(methods,url,body){const optionsBase={headers:{'Content-Type':'application/json'},body:body?JSON.stringify(body):undefined};let lastErr=null;for(const method of methods){try{const r=await authFetch(url,_objectSpread({method},optionsBase));if(r.ok)return r;const txt=await r.text().catch(()=>'');lastErr=new Error(\"\".concat(r.status,\" \").concat(r.statusText).concat(txt?\" \\u2022 \".concat(txt):''));}catch(e){lastErr=e;}}throw lastErr||new Error('All methods failed');}const acceptDirect=async req=>{setActionLoading(m=>_objectSpread(_objectSpread({},m),{},{[req.id]:true}));try{const urls=[\"/api/direct-requests/\".concat(req.id,\"/approve\"),\"/api/direct-requests/\".concat(req.id,\"/accept\"),\"/api/direct-requests/\".concat(req.id,\"/respond?action=ACCEPT\")];let ok=false;let last=null;for(const u of urls){try{await tryEndpoints(['POST','PUT','PATCH'],u);ok=true;break;}catch(e){last=e;}}if(!ok)throw last||new Error('Approve failed');await fetchSummary();}catch(e){console.error(e);alert(\"Action failed:\\n\".concat(e.message||e));}finally{setActionLoading(m=>_objectSpread(_objectSpread({},m),{},{[req.id]:false}));}};const declineDirect=async req=>{setActionLoading(m=>_objectSpread(_objectSpread({},m),{},{[req.id]:true}));try{const urls=[\"/api/direct-requests/\".concat(req.id,\"/decline\"),\"/api/direct-requests/\".concat(req.id,\"/reject\"),\"/api/direct-requests/\".concat(req.id,\"/respond?action=DECLINE\")];let ok=false;let last=null;for(const u of urls){try{await tryEndpoints(['POST','PUT','PATCH'],u);ok=true;break;}catch(e){last=e;}}if(!ok)throw last||new Error('Decline failed');await fetchSummary();}catch(e){console.error(e);alert(\"Action failed:\\n\".concat(e.message||e));}finally{setActionLoading(m=>_objectSpread(_objectSpread({},m),{},{[req.id]:false}));}};/* ------------------------------- Funding (lender-side) ------------------------------- */const[funding,setFunding]=useState({});// track loading per-loan\nconst handleFundLoan=async loanId=>{if(!loanId)return;setFunding(m=>_objectSpread(_objectSpread({},m),{},{[loanId]:true}));try{const res=await authFetch(\"/api/loans/\".concat(loanId,\"/fund\"),{method:'POST',headers:{'Content-Type':'application/json'}});if(!res.ok){const txt=await res.text().catch(()=>'');console.error('Fund loan failed:',res.status,txt);alert(\"Funding failed (\".concat(res.status,\").\\n\").concat(txt||'Check backend logs for details.'));return;}const data=await res.json().catch(()=>({}));console.log('âœ… Loan funded response:',data);alert('Loan successfully funded from your PeerFund wallet.');// Refresh Money Summary + wallets/transactions in UI\nawait fetchSummary();}catch(err){console.error('Fund loan error:',err);alert(\"Funding error:\\n\".concat(err.message||err));}finally{setFunding(m=>_objectSpread(_objectSpread({},m),{},{[loanId]:false}));}};/* ------------------------------- Renderers ------------------------------- */const renderOffersBlock=loanId=>{const loading=!!offersLoading[loanId];const offers=offersByLoanId[loanId]||[];return/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8\",children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',alignItems:'center',gap:8,marginBottom:6},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Active Offers\"}),/*#__PURE__*/_jsx(\"button\",{className:\"action-btn xs\",onClick:()=>loadOffers(loanId),disabled:loading,title:\"Refresh offers\",children:loading?'Refreshingâ€¦':'Refresh'})]}),loading?/*#__PURE__*/_jsx(\"p\",{className:\"ms-muted\",children:\"Loading offers\\u2026\"}):offers.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"ms-muted\",children:\"No offers yet\\u2014be the first!\"}):/*#__PURE__*/_jsx(\"div\",{style:{display:'grid',gap:8},children:offers.map(of=>{var _of$lender;return/*#__PURE__*/_jsxs(\"div\",{style:{border:'1px solid #e2e8f0',borderRadius:10,padding:'8px 10px',display:'grid',gridTemplateColumns:'minmax(160px,1fr) 120px 120px 120px auto',gap:8,alignItems:'center'},children:[/*#__PURE__*/_jsx(\"div\",{style:{fontWeight:600},children:(of===null||of===void 0?void 0:(_of$lender=of.lender)===null||_of$lender===void 0?void 0:_of$lender.name)||'Lender'}),/*#__PURE__*/_jsx(\"div\",{children:fmtMoney(Number(of.amount)||0)}),/*#__PURE__*/_jsx(\"div\",{children:Number.isFinite(of.duration)?\"\".concat(of.duration,\" mo\"):'â€”'}),/*#__PURE__*/_jsx(\"div\",{children:Number.isFinite(of.interestRate)?\"\".concat(of.interestRate,\"%\"):'â€”'}),/*#__PURE__*/_jsx(\"div\",{style:{justifySelf:'end',display:'flex',gap:6},children:/*#__PURE__*/_jsx(\"button\",{className:\"action-btn xs primary\",onClick:()=>acceptOffer(of),disabled:!!offerWorking[of.id],children:offerWorking[of.id]?'Workingâ€¦':'Accept'})}),of.message?/*#__PURE__*/_jsxs(\"div\",{style:{gridColumn:'1 / -1',color:'#334155',fontSize:13},children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Message:\"}),\" \",of.message]}):null]},of.id);})})]});};const renderLoanCard=(loan,isLender,idx)=>{const key=(loan===null||loan===void 0?void 0:loan.id)||(loan===null||loan===void 0?void 0:loan._id)||String(idx);const loanId=loan.id||loan._id;const isExpanded=!!expanded[key];const otherParty=isLender?loan.borrowerName:loan.lenderName;const rawStatus=(loan.status||'').toUpperCase();const isPaidOff=isLoanPaidOff(loan);const isBorrower=!isLender;const badgeClass=isPaidOff?'ms-badge ms-badge--muted':rawStatus==='FUNDED'?'ms-badge ms-badge--ok':'ms-badge ms-badge--warn';const cardClass=\"ms-card\".concat(isPaidOff?' ms-card--paid-off':'');return/*#__PURE__*/_jsxs(\"div\",{className:cardClass,children:[/*#__PURE__*/_jsxs(\"div\",{className:\"ms-card-row\",style:ROW_GRID,children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-label\",children:isLender?'Borrower':'Lender'}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-value-strong\",children:otherParty||'Unknown'})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-label\",children:\"Amount\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-value-strong\",children:fmtMoney(loan.amount)})]}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-label\",children:\"Status\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-value-strong\",children:/*#__PURE__*/_jsx(\"span\",{className:badgeClass,children:loan.status||'â€”'})})]}),/*#__PURE__*/_jsxs(\"div\",{style:{justifySelf:'end',display:'flex',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{onClick:()=>setThreadLoanId(loanId),className:\"action-btn sm\",title:\"Open conversation\",children:\"\\uD83D\\uDCAC Messages\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>setExpanded(m=>_objectSpread(_objectSpread({},m),{},{[key]:!isExpanded})),className:\"action-btn sm\",title:\"View contract\",children:isExpanded?'ðŸ”½ Hide':'ðŸ“„ View'})]})]}),isExpanded&&/*#__PURE__*/_jsxs(\"div\",{className:\"ms-details\",children:[loan.status&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Status:\"}),\" \",loan.status]}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Interest Rate:\"}),' ',typeof loan.interestRate==='number'?\"\".concat(loan.interestRate,\"%\"):'â€”']}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Duration:\"}),' ',typeof loan.duration==='number'?\"\".concat(loan.duration,\" months\"):'â€”']}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Next Due Date:\"}),' ',loan.nextDueDate?new Date(loan.nextDueDate).toLocaleDateString():'â€”']}),/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Installment (this period):\"}),' ',fmtMoney(loan.installmentAmount)]}),isPaidOff&&/*#__PURE__*/_jsxs(\"p\",{className:\"mt-6 ms-muted\",children:[/*#__PURE__*/_jsx(\"strong\",{children:\"Repayment:\"}),\" Loan fully repaid. No further installments.\"]}),isBorrower&&!isPaidOff&&/*#__PURE__*/_jsx(\"div\",{className:\"mt-8\",children:/*#__PURE__*/_jsx(RepaymentButton,{loanId:loanId,onPaid:fetchSummary})}),isLender&&!isPaidOff&&rawStatus==='ACCEPTED'&&/*#__PURE__*/_jsxs(\"div\",{className:\"mt-8\",style:{display:'flex',gap:8},children:[/*#__PURE__*/_jsx(\"button\",{className:\"action-btn sm primary\",onClick:()=>handleFundLoan(loanId),disabled:!!funding[loanId],children:funding[loanId]?'Fundingâ€¦':'Fund from PeerFund wallet'}),/*#__PURE__*/_jsx(\"span\",{className:\"ms-muted\",style:{alignSelf:'center'},children:\"Requires enough wallet balance\"})]})]})]},key);};/* ------------------------------- Render ------------------------------- */if(loading)return/*#__PURE__*/_jsx(\"p\",{className:\"ms-loading ms-container\",children:\"Loading money summary...\"});const given=Array.isArray(summary.loansGiven)?summary.loansGiven:[];const received=Array.isArray(summary.loansReceived)?summary.loansReceived:[];const myOpen=Array.isArray(summary.myOpenRequests)?summary.myOpenRequests:[];return/*#__PURE__*/_jsxs(\"div\",{className:\"ms-container\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"ms-heading\",children:\"\\uD83D\\uDCB5 My Money Summary\"}),/*#__PURE__*/_jsxs(\"div\",{className:\"ms-section\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"ms-section-head\",onClick:()=>setOpenSec(s=>_objectSpread(_objectSpread({},s),{},{open:!s.open})),\"aria-expanded\":openSec.open,children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-subheading\",children:\"My Open Loan Requests\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-caret\",children:openSec.open?'â–¾':'â–¸'})]}),openSec.open&&/*#__PURE__*/_jsx(\"div\",{className:\"ms-section-body\",children:myOpen.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"ms-empty\",children:\"You have no open requests.\"}):myOpen.map(req=>/*#__PURE__*/_jsx(OpenRequestRow,{req:req,isExpanded:!!expanded[req.id],onToggle:()=>toggleDetails(req),actionLoading:actionLoading// MARKET + Borrowing: offers block (as a React node)\n,offersContent:req.type==='market'&&req.role==='Borrowing'?renderOffersBlock(req.id):undefined// MARKET + Lending: open OfferModal\n,onMakeOffer:req.type==='market'&&req.role==='Lending'?()=>setOfferModalLoanId(req.id):undefined// DIRECT actions\n,onAcceptDirect:req.type==='direct'?()=>acceptDirect(req):undefined,onDeclineDirect:req.type==='direct'?()=>declineDirect(req):undefined},req.id))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ms-section\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"ms-section-head\",onClick:()=>setOpenSec(s=>_objectSpread(_objectSpread({},s),{},{given:!s.given})),\"aria-expanded\":openSec.given,children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-subheading\",children:\"Loans Given (I'm the Lender)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-caret\",children:openSec.given?'â–¾':'â–¸'})]}),openSec.given&&/*#__PURE__*/_jsx(\"div\",{className:\"ms-section-body\",children:given.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"ms-empty\",children:\"No loans given yet.\"}):given.map((loan,idx)=>renderLoanCard(loan,true,idx))})]}),/*#__PURE__*/_jsxs(\"div\",{className:\"ms-section\",children:[/*#__PURE__*/_jsxs(\"button\",{className:\"ms-section-head\",onClick:()=>setOpenSec(s=>_objectSpread(_objectSpread({},s),{},{received:!s.received})),\"aria-expanded\":openSec.received,children:[/*#__PURE__*/_jsx(\"div\",{className:\"ms-subheading\",children:\"Loans Received (I'm the Borrower)\"}),/*#__PURE__*/_jsx(\"div\",{className:\"ms-caret\",children:openSec.received?'â–¾':'â–¸'})]}),openSec.received&&/*#__PURE__*/_jsx(\"div\",{className:\"ms-section-body\",children:received.length===0?/*#__PURE__*/_jsx(\"p\",{className:\"ms-empty\",children:\"No loans received yet.\"}):received.map((loan,idx)=>renderLoanCard(loan,false,idx))})]}),threadLoanId&&/*#__PURE__*/_jsx(LoanThreadModal,{loanId:threadLoanId,onClose:()=>setThreadLoanId(null)}),offerModalLoanId&&/*#__PURE__*/_jsx(OfferModal,{loanId:offerModalLoanId,onClose:()=>setOfferModalLoanId(null)}),/*#__PURE__*/_jsx(LinkBankFirstModal,{open:showLinkModal,onClose:()=>setShowLinkModal(false)})]});}","map":{"version":3,"names":["React","useEffect","useState","useCallback","LoanThreadModal","OfferModal","RepaymentButton","jsx","_jsx","jsxs","_jsxs","getCurrentUserId","t","localStorage","getItem","_payload$userId","payload","JSON","parse","atob","split","userId","err","fmtMoney","n","Number","isNaN","concat","toFixed","ROW_GRID","display","gridTemplateColumns","alignItems","gap","authFetch","url","options","arguments","length","undefined","token","headers","_objectSpread","Authorization","res","fetch","credentials","status","console","warn","text","window","location","assign","Error","isLoanPaidOff","loan","s","toUpperCase","includes","remainingPrincipal","remainingPrincipalCents","hasNextDue","nextDueDate","installment","installmentAmount","sortLoansWithPaidOffLast","list","sort","a","b","aDone","bDone","LinkBankFirstModal","_ref","open","onClose","role","style","position","inset","background","justifyContent","padding","zIndex","onClick","children","e","stopPropagation","width","maxWidth","border","borderRadius","boxShadow","margin","color","marginTop","className","OpenRequestRow","_ref2","_req$status","req","isExpanded","onToggle","actionLoading","offersContent","onMakeOffer","onAcceptDirect","onDeclineDirect","isMarket","type","isBorrowing","counterpartyName","marginLeft","fontWeight","amount","justifySelf","title","isFinite","interestRate","duration","purpose","disabled","id","MoneySummary","summary","setSummary","loansGiven","loansReceived","myOpenRequests","loading","setLoading","expanded","setExpanded","openSec","setOpenSec","given","received","setActionLoading","threadLoanId","setThreadLoanId","offersByLoanId","setOffersByLoanId","offersLoading","setOffersLoading","offerWorking","setOfferWorking","offerModalLoanId","setOfferModalLoanId","hasLoanPM","setHasLoanPM","showLinkModal","setShowLinkModal","checkHasLoanPaymentMethod","r","ok","d","json","val","hasLoanPaymentMethod","fetchMarketOpenRequests","me","rows","data","items","Array","isArray","it","_it$myOffer$interestR","_it$myOffer","_it$borrower","_it$borrower2","_it$borrower3","push","myOffer","createdAt","borrowerId","borrower","borrowerName","name","mineOpen","rAll","rawAll","listAll","filter","x","_x$borrower","String","keepNow","toProbe","_req$_count","offersArr","loanOffers","offerCount","_count","probed","Promise","all","map","arr","m","Boolean","_req$borrower","_req$duration","_req$interestRate","_req$borrower2","months","apr","seen","Set","has","add","fetchDirectOpenRequests","_d$borrower","_d$lender","_d$months","_d$apr","_d$borrower2","_d$lender2","_d$lender3","_d$borrower3","lenderId","lender","iAmBorrower","lenderName","fetchSummary","loansAsLender","loansAsBorrower","marketOpen","directOpen","error","toggleDetails","prev","collapsed","Object","keys","reduce","acc","k","loadOffers","loanId","acceptOffer","offer","_data$loan","method","catch","log","alert","message","tryEndpoints","methods","body","optionsBase","stringify","lastErr","txt","statusText","acceptDirect","urls","last","u","declineDirect","funding","setFunding","handleFundLoan","renderOffersBlock","offers","marginBottom","of","_of$lender","gridColumn","fontSize","renderLoanCard","isLender","idx","key","_id","otherParty","rawStatus","isPaidOff","isBorrower","badgeClass","cardClass","Date","toLocaleDateString","onPaid","alignSelf","myOpen"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx"],"sourcesContent":["// src/features/money/MoneySummary.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport './MoneySummary.css';\r\nimport LoanThreadModal from '../loans/LoanThreadModal';\r\nimport OfferModal from '../../components/OfferModal';\r\nimport RepaymentButton from '../loans/RepaymentButton';\r\n\r\n/* ----------------------- helpers ----------------------- */\r\n\r\n// decode JWT for current user id\r\nfunction getCurrentUserId() {\r\n  const t = localStorage.getItem('token');\r\n  if (!t) return null;\r\n  try {\r\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\r\n    return payload?.userId ?? null;\r\n    } catch (err) {\r\n    // Invalid/expired token or malformed payload\r\n    return null;\r\n  }\r\n}\r\n\r\nconst fmtMoney = (n) =>\r\n  typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\r\n\r\n// compact row layout\r\nconst ROW_GRID = {\r\n  display: 'grid',\r\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\r\n  alignItems: 'center',\r\n  gap: 10,\r\n};\r\n\r\nasync function authFetch(url, options = {}) {\r\n  const token = localStorage.getItem('token');\r\n  const headers = {\r\n    ...(options.headers || {}),\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n  };\r\n  const res = await fetch(url, {\r\n    ...options,\r\n    headers,\r\n    credentials: 'include',\r\n  });\r\n    if (res.status === 401) {\r\n    try {\r\n      console.warn('401 on', url, await res.text());\r\n    } catch (err) {\r\n      // Could not read body; ignore\r\n    }\r\n    window.location.assign('/login');\r\n    throw new Error('Unauthorized');\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction isLoanPaidOff(loan) {\r\n  const s = (loan.status || '').toUpperCase();\r\n\r\n  // Explicit status flags\r\n  if (['PAID_OFF', 'COMPLETED', 'CLOSED'].includes(s)) return true;\r\n\r\n  // Remaining principal flags\r\n  if (typeof loan.remainingPrincipal === 'number' && loan.remainingPrincipal <= 0) {\r\n    return true;\r\n  }\r\n  if (\r\n    typeof loan.remainingPrincipalCents === 'number' &&\r\n    loan.remainingPrincipalCents <= 0\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  // Frontend-only inference (no next due date + no installment amount)\r\n  const hasNextDue = !!loan.nextDueDate;\r\n  const installment =\r\n    typeof loan.installmentAmount === 'number' ? loan.installmentAmount : null;\r\n\r\n  if (!hasNextDue && (installment === null || installment <= 0)) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction sortLoansWithPaidOffLast(list) {\r\n  return [...list].sort((a, b) => {\r\n    const aDone = isLoanPaidOff(a);\r\n    const bDone = isLoanPaidOff(b);\r\n    if (aDone === bDone) return 0;\r\n    return aDone ? 1 : -1; // active first, paid-off last\r\n  });\r\n}\r\n\r\n/* ------------------------- Small inline modal ------------------------- */\r\n\r\nfunction LinkBankFirstModal({ open, onClose }) {\r\n  if (!open) return null;\r\n  return (\r\n    <div\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      style={{\r\n        position: 'fixed',\r\n        inset: 0,\r\n        background: 'rgba(0,0,0,0.35)',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        padding: 16,\r\n        zIndex: 1000,\r\n      }}\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        onClick={(e) => e.stopPropagation()}\r\n        style={{\r\n          width: '100%',\r\n          maxWidth: 520,\r\n          background: '#fff',\r\n          border: '1px solid #e5e7eb',\r\n          borderRadius: 12,\r\n          boxShadow: '0 10px 30px rgba(0,0,0,0.12)',\r\n          padding: 20,\r\n        }}\r\n      >\r\n        <h3 style={{ margin: 0 }}>Add a bank to receive funds</h3>\r\n        <p style={{ color: '#334155', marginTop: 8 }}>\r\n          Before you can accept an offer, please link a bank account for loan\r\n          disbursement on the Payment Method page.\r\n        </p>\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            gap: 8,\r\n            justifyContent: 'flex-end',\r\n            marginTop: 14,\r\n          }}\r\n        >\r\n          <button className=\"action-btn sm\" onClick={onClose}>\r\n            Close\r\n          </button>\r\n          <button\r\n            className=\"action-btn sm primary\"\r\n            onClick={() => {\r\n              window.location.assign('/payment-method');\r\n            }}\r\n          >\r\n            Go to Payment Method\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------- Open request row ------------------------- */\r\n\r\nfunction OpenRequestRow({\r\n  req,\r\n  isExpanded,\r\n  onToggle,\r\n  actionLoading,\r\n  offersContent, // React node for market/borrower offers list\r\n  onMakeOffer, // fn for market/lender to open OfferModal\r\n  onAcceptDirect, // fn for direct approve\r\n  onDeclineDirect, // fn for direct decline\r\n}) {\r\n  const isMarket = req.type === 'market';\r\n  const isBorrowing = req.role === 'Borrowing';\r\n\r\n  return (\r\n    <div className=\"ms-card\" key={req.id}>\r\n      {/* ONE-LINE TOP ROW */}\r\n      <div className=\"ms-card-row\" style={ROW_GRID}>\r\n        <div>\r\n          <div className=\"ms-label\">Counterparty</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.counterpartyName || 'Unknown'}\r\n            <span style={{ marginLeft: 8, color: '#64748b', fontWeight: 600 }}>\r\n              â€¢ {req.role}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"ms-label\">Amount</div>\r\n          <div className=\"ms-value-strong\">{fmtMoney(req.amount)}</div>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end' }}>\r\n          <span className=\"ms-badge ms-badge--warn\">Open</span>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n          <button\r\n            className=\"action-btn sm\"\r\n            onClick={onToggle}\r\n            title=\"View request\"\r\n          >\r\n            {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* DETAILS */}\r\n      {isExpanded && (\r\n        <div className=\"ms-details\">\r\n          <p className=\"mt-6\">\r\n            <strong>Status:</strong> {req.status ?? 'OPEN'}\r\n          </p>\r\n          <p className=\"mt-6\">\r\n            <strong>Interest Rate:</strong>{' '}\r\n            {Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”'}\r\n          </p>\r\n          <p className=\"mt-6\">\r\n            <strong>Duration:</strong>{' '}\r\n            {Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”'}\r\n          </p>\r\n          {req.purpose ? (\r\n            <p className=\"mt-6\">\r\n              <strong>Reason:</strong> {req.purpose}\r\n            </p>\r\n          ) : null}\r\n\r\n          {/* MARKET: Borrowing => show the actual offers placed by lenders */}\r\n          {isMarket && isBorrowing && offersContent}\r\n\r\n          {/* MARKET: Lending => allow me to place an offer */}\r\n          {isMarket && !isBorrowing && (\r\n            <div\r\n              className=\"mt-8\"\r\n              style={{ display: 'flex', justifyContent: 'flex-end' }}\r\n            >\r\n              <button className=\"action-btn sm primary\" onClick={onMakeOffer}>\r\n                ðŸ’µ Make Offer\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* DIRECT requests => approve/decline */}\r\n          {!isMarket && (\r\n            <div\r\n              className=\"mt-8\"\r\n              style={{\r\n                display: 'flex',\r\n                gap: 8,\r\n                justifyContent: 'flex-end',\r\n              }}\r\n            >\r\n              <button\r\n                className=\"action-btn sm primary\"\r\n                onClick={onAcceptDirect}\r\n                disabled={!!actionLoading[req.id]}\r\n              >\r\n                {actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'}\r\n              </button>\r\n              <button\r\n                className=\"action-btn sm\"\r\n                onClick={onDeclineDirect}\r\n                disabled={!!actionLoading[req.id]}\r\n              >\r\n                {actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -------------------------------- Parent -------------------------------- */\r\n\r\nexport default function MoneySummary() {\r\n  const [summary, setSummary] = useState({\r\n    loansGiven: [],\r\n    loansReceived: [],\r\n    myOpenRequests: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [expanded, setExpanded] = useState({});\r\n  const [openSec, setOpenSec] = useState({\r\n    open: true,\r\n    given: true,\r\n    received: true,\r\n  });\r\n\r\n  const [actionLoading, setActionLoading] = useState({});\r\n  const [threadLoanId, setThreadLoanId] = useState(null);\r\n\r\n  // marketplace offers cache per loanId\r\n  const [offersByLoanId, setOffersByLoanId] = useState({});\r\n  const [offersLoading, setOffersLoading] = useState({});\r\n  const [offerWorking, setOfferWorking] = useState({});\r\n  const [offerModalLoanId, setOfferModalLoanId] = useState(null);\r\n\r\n  // cached: does borrower have a payment method for loan funding\r\n  const [hasLoanPM, setHasLoanPM] = useState(null); // null=unknown, true/false known\r\n  const [showLinkModal, setShowLinkModal] = useState(false);\r\n\r\n  const checkHasLoanPaymentMethod = useCallback(async () => {\r\n    if (hasLoanPM !== null) return hasLoanPM;\r\n    try {\r\n      const r = await authFetch('/api/stripe/has-loan-payment-method');\r\n      if (!r.ok) throw new Error('has-loan-payment-method failed');\r\n      const d = await r.json();\r\n      const val = !!d?.hasLoanPaymentMethod;\r\n      setHasLoanPM(val);\r\n      return val;\r\n        } catch (err) {\r\n      // Endpoint failed or user has no saved payment method yet\r\n      setHasLoanPM(false);\r\n      return false;\r\n    }\r\n  }, [hasLoanPM]);\r\n\r\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\r\n\r\n  const fetchMarketOpenRequests = useCallback(async () => {\r\n    const me = getCurrentUserId();\r\n    if (!me) return [];\r\n\r\n    const rows = [];\r\n\r\n    // (A) Requests where I am the LENDER (Iâ€™ve made an offer)\r\n    try {\r\n      const r = await authFetch('/api/loans/offers/mine');\r\n      if (r.ok) {\r\n        const data = await r.json();\r\n        const items = Array.isArray(data?.items)\r\n          ? data.items\r\n          : Array.isArray(data)\r\n          ? data\r\n          : [];\r\n        for (const it of items) {\r\n          rows.push({\r\n            type: 'market',\r\n            id: it.id, // loanRequest id\r\n            amount: Number(it.amount),\r\n            duration: Number(it.duration),\r\n            interestRate: Number(it.myOffer?.interestRate ?? it.interestRate),\r\n            purpose: it.purpose || '',\r\n            createdAt: it.createdAt || null,\r\n            borrowerId: it.borrower?.id,\r\n            borrowerName: it.borrower?.name || 'Borrower',\r\n            counterpartyName: it.borrower?.name || 'Borrower',\r\n            role: 'Lending',\r\n            status: it.status || 'OPEN',\r\n            myOffer: it.myOffer\r\n              ? {\r\n                  id: it.myOffer.id,\r\n                  amount: Number(it.myOffer.amount),\r\n                  duration: Number(it.myOffer.duration),\r\n                  interestRate: Number(it.myOffer.interestRate),\r\n                  createdAt: it.myOffer.createdAt,\r\n                }\r\n              : null,\r\n          });\r\n        }\r\n      }\r\n        } catch (err) {\r\n      // Non-fatal: this section can fail and we still render the page\r\n      // console.warn('fetchMarketOpenRequests section failed', err);\r\n    }\r\n\r\n    // (B) My OPEN requests that already have offers\r\n    let mineOpen = [];\r\n    try {\r\n      const rAll = await authFetch('/api/loans/open');\r\n      if (rAll.ok) {\r\n        const rawAll = await rAll.json();\r\n        const listAll = Array.isArray(rawAll) ? rawAll : rawAll?.items || [];\r\n        mineOpen = listAll.filter(\r\n          (x) =>\r\n            (x.status || 'OPEN').toUpperCase() === 'OPEN' &&\r\n            String(x.borrowerId || x?.borrower?.id) === String(me)\r\n        );\r\n      }\r\n        } catch (err) {\r\n      // Non-fatal: this section can fail and we still render the page\r\n      // console.warn('fetchMarketOpenRequests section failed', err);\r\n    }\r\n\r\n\r\n    const keepNow = [];\r\n    const toProbe = [];\r\n    for (const req of mineOpen) {\r\n      const offersArr = Array.isArray(req.loanOffers) ? req.loanOffers : [];\r\n      const offerCount =\r\n        typeof req?._count?.loanOffers === 'number'\r\n          ? req._count.loanOffers\r\n          : offersArr.length;\r\n\r\n      if (offerCount > 0) keepNow.push(req);\r\n      else toProbe.push(req);\r\n    }\r\n\r\n    if (toProbe.length) {\r\n      const probed = await Promise.all(\r\n        toProbe.map(async (req) => {\r\n          try {\r\n            const r = await authFetch(`/api/loans/${req.id}/offers`);\r\n            const arr = r.ok ? await r.json() : [];\r\n            if (Array.isArray(arr) && arr.length > 0) {\r\n              setOffersByLoanId((m) => ({ ...m, [req.id]: arr }));\r\n              return req;\r\n            }\r\n            } catch (err) {\r\n            // Non-fatal: probing offers failed for this request\r\n          }\r\n\r\n          return null;\r\n        })\r\n      );\r\n      keepNow.push(...probed.filter(Boolean));\r\n    }\r\n\r\n    for (const req of keepNow) {\r\n      const borrowerId = req.borrowerId || req?.borrower?.id || me;\r\n      rows.push({\r\n        type: 'market',\r\n        id: req.id,\r\n        amount: Number(req.amount),\r\n        duration: Number(req.duration ?? req.months),\r\n        interestRate: Number(req.interestRate ?? req.apr),\r\n        purpose: req.purpose || '',\r\n        createdAt: req.createdAt || null,\r\n        borrowerId,\r\n        borrowerName: req?.borrower?.name || 'You',\r\n        counterpartyName: 'â€” Borrowing',\r\n        role: 'Borrowing',\r\n        status: req.status || 'OPEN',\r\n      });\r\n    }\r\n\r\n    const seen = new Set();\r\n    return rows.filter((r) => (seen.has(r.id) ? false : (seen.add(r.id), true)));\r\n  }, []);\r\n\r\n  const fetchDirectOpenRequests = useCallback(async () => {\r\n    const me = getCurrentUserId();\r\n    if (!me) return [];\r\n    try {\r\n      const r = await authFetch('/api/direct-requests/open/mine');\r\n      if (!r.ok) return [];\r\n      const rows = await r.json();\r\n      return (Array.isArray(rows) ? rows : []).map((d) => {\r\n        const borrowerId = d.borrowerId || d?.borrower?.id;\r\n        const lenderId = d.lenderId || d?.lender?.id;\r\n        const iAmBorrower = String(borrowerId) === String(me);\r\n        return {\r\n          type: 'direct',\r\n          id: d.id,\r\n          amount: Number(d.amount),\r\n          duration: Number(d.months ?? d.duration),\r\n          interestRate: Number(d.apr ?? d.interestRate),\r\n          createdAt: d.createdAt || null,\r\n          borrowerId,\r\n          borrowerName: d?.borrower?.name || (iAmBorrower ? 'You' : ''),\r\n          lenderId,\r\n          lenderName: d?.lender?.name || (!iAmBorrower ? 'You' : ''),\r\n          counterpartyName: iAmBorrower\r\n            ? d?.lender?.name || 'Lender'\r\n            : d?.borrower?.name || 'Borrower',\r\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\r\n          status: d.status || 'PENDING',\r\n        };\r\n      });\r\n    } catch (err) {\r\n  // Non-fatal: if this fetch fails, just treat as no results\r\n  return [];\r\n}\r\n  }, []);\r\n\r\n  const fetchSummary = useCallback(\r\n    async () => {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) return;\r\n      setLoading(true);\r\n      try {\r\n        const res = await authFetch('/api/users/my-money-summary');\r\n        let loansGiven = [];\r\n        let loansReceived = [];\r\n\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          loansGiven = Array.isArray(data.loansGiven)\r\n            ? data.loansGiven\r\n            : Array.isArray(data.loansAsLender)\r\n            ? data.loansAsLender\r\n            : [];\r\n          loansReceived = Array.isArray(data.loansReceived)\r\n            ? data.loansReceived\r\n            : Array.isArray(data.loansAsBorrower)\r\n            ? data.loansAsBorrower\r\n            : [];\r\n        }\r\n\r\n        const [marketOpen, directOpen] = await Promise.all([\r\n          fetchMarketOpenRequests(),\r\n          fetchDirectOpenRequests(),\r\n        ]);\r\n\r\n        setSummary({\r\n          loansGiven: sortLoansWithPaidOffLast(loansGiven),\r\n          loansReceived: sortLoansWithPaidOffLast(loansReceived),\r\n          myOpenRequests: [...marketOpen, ...directOpen],\r\n        });\r\n      } catch (err) {\r\n        console.error('Error fetching money summary:', err);\r\n        setSummary({ loansGiven: [], loansReceived: [], myOpenRequests: [] });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [fetchMarketOpenRequests, fetchDirectOpenRequests]\r\n  );\r\n\r\n  useEffect(() => {\r\n    fetchSummary();\r\n  }, [fetchSummary]);\r\n\r\n  const toggleDetails = async (req) => {\r\n    setExpanded((prev) => {\r\n      const collapsed = Object.keys(prev).reduce(\r\n        (acc, k) => ({ ...acc, [k]: false }),\r\n        {}\r\n      );\r\n      return { ...collapsed, [req.id]: !prev[req.id] };\r\n    });\r\n\r\n    if (req.type === 'market' && req.role === 'Borrowing') {\r\n      if (!offersByLoanId[req.id] && !offersLoading[req.id]) {\r\n        await loadOffers(req.id);\r\n      }\r\n    }\r\n  };\r\n\r\n  /* -------------------- Offers (marketplace) -------------------- */\r\n\r\n  const loadOffers = async (loanId) => {\r\n    setOffersLoading((m) => ({ ...m, [loanId]: true }));\r\n    try {\r\n      const r = await authFetch(`/api/loans/${loanId}/offers`);\r\n      const items = r.ok ? await r.json() : [];\r\n      setOffersByLoanId((m) => ({\r\n        ...m,\r\n        [loanId]: Array.isArray(items) ? items : [],\r\n      }));\r\n    } catch (e) {\r\n      console.error('loadOffers error', e);\r\n      setOffersByLoanId((m) => ({ ...m, [loanId]: [] }));\r\n    } finally {\r\n      setOffersLoading((m) => ({ ...m, [loanId]: false }));\r\n    }\r\n  };\r\n\r\n  const acceptOffer = async (offer) => {\r\n    setOfferWorking((m) => ({ ...m, [offer.id]: true }));\r\n\r\n    try {\r\n      // 1) Optional: ensure borrower has payout method on file\r\n      const ok = await checkHasLoanPaymentMethod();\r\n      if (!ok) {\r\n        setShowLinkModal(true);\r\n        setOfferWorking((m) => ({ ...m, [offer.id]: false }));\r\n        return;\r\n      }\r\n\r\n      // 2) Accept the offer -> server creates the Loan (status: ACCEPTED)\r\n      const r = await authFetch(`/api/loans/offers/${offer.id}/accept`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n\r\n      const data = r.ok ? await r.json() : null;\r\n\r\n      if (!r.ok || !data?.loan?.id) {\r\n        const t = !r.ok ? await r.text().catch(() => '') : '';\r\n        throw new Error(t || data?.error || 'Failed to accept offer');\r\n      }\r\n\r\n      console.log('âœ… Offer accepted response:', data);\r\n\r\n      // 3) Just refresh the summary; funding is done later by the lender\r\n      await fetchSummary();\r\n      alert('Loan accepted and contract saved. Waiting for lender to fund from their PeerFund wallet.');\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setOfferWorking((m) => ({ ...m, [offer.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* -------------------- Direct request actions -------------------- */\r\n\r\n  async function tryEndpoints(methods, url, body) {\r\n    const optionsBase = {\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    };\r\n    let lastErr = null;\r\n    for (const method of methods) {\r\n      try {\r\n        const r = await authFetch(url, { method, ...optionsBase });\r\n        if (r.ok) return r;\r\n        const txt = await r.text().catch(() => '');\r\n        lastErr = new Error(\r\n          `${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`\r\n        );\r\n      } catch (e) {\r\n        lastErr = e;\r\n      }\r\n    }\r\n    throw lastErr || new Error('All methods failed');\r\n  }\r\n\r\n  const acceptDirect = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      const urls = [\r\n        `/api/direct-requests/${req.id}/approve`,\r\n        `/api/direct-requests/${req.id}/accept`,\r\n        `/api/direct-requests/${req.id}/respond?action=ACCEPT`,\r\n      ];\r\n      let ok = false;\r\n      let last = null;\r\n      for (const u of urls) {\r\n        try {\r\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\r\n          ok = true;\r\n          break;\r\n        } catch (e) {\r\n          last = e;\r\n        }\r\n      }\r\n      if (!ok) throw last || new Error('Approve failed');\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  const declineDirect = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      const urls = [\r\n        `/api/direct-requests/${req.id}/decline`,\r\n        `/api/direct-requests/${req.id}/reject`,\r\n        `/api/direct-requests/${req.id}/respond?action=DECLINE`,\r\n      ];\r\n      let ok = false;\r\n      let last = null;\r\n      for (const u of urls) {\r\n        try {\r\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\r\n          ok = true;\r\n          break;\r\n        } catch (e) {\r\n          last = e;\r\n        }\r\n      }\r\n      if (!ok) throw last || new Error('Decline failed');\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* ------------------------------- Funding (lender-side) ------------------------------- */\r\n\r\n  const [funding, setFunding] = useState({}); // track loading per-loan\r\n\r\n  const handleFundLoan = async (loanId) => {\r\n    if (!loanId) return;\r\n    setFunding((m) => ({ ...m, [loanId]: true }));\r\n    try {\r\n      const res = await authFetch(`/api/loans/${loanId}/fund`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const txt = await res.text().catch(() => '');\r\n        console.error('Fund loan failed:', res.status, txt);\r\n        alert(\r\n          `Funding failed (${res.status}).\\n${\r\n            txt || 'Check backend logs for details.'\r\n          }`\r\n        );\r\n        return;\r\n      }\r\n\r\n      const data = await res.json().catch(() => ({}));\r\n      console.log('âœ… Loan funded response:', data);\r\n      alert('Loan successfully funded from your PeerFund wallet.');\r\n      // Refresh Money Summary + wallets/transactions in UI\r\n      await fetchSummary();\r\n    } catch (err) {\r\n      console.error('Fund loan error:', err);\r\n      alert(`Funding error:\\n${err.message || err}`);\r\n    } finally {\r\n      setFunding((m) => ({ ...m, [loanId]: false }));\r\n    }\r\n  };\r\n\r\n  /* ------------------------------- Renderers ------------------------------- */\r\n\r\n  const renderOffersBlock = (loanId) => {\r\n    const loading = !!offersLoading[loanId];\r\n    const offers = offersByLoanId[loanId] || [];\r\n    return (\r\n      <div className=\"mt-8\">\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: 8,\r\n            marginBottom: 6,\r\n          }}\r\n        >\r\n          <strong>Active Offers</strong>\r\n          <button\r\n            className=\"action-btn xs\"\r\n            onClick={() => loadOffers(loanId)}\r\n            disabled={loading}\r\n            title=\"Refresh offers\"\r\n          >\r\n            {loading ? 'Refreshingâ€¦' : 'Refresh'}\r\n          </button>\r\n        </div>\r\n        {loading ? (\r\n          <p className=\"ms-muted\">Loading offersâ€¦</p>\r\n        ) : offers.length === 0 ? (\r\n          <p className=\"ms-muted\">No offers yetâ€”be the first!</p>\r\n        ) : (\r\n          <div style={{ display: 'grid', gap: 8 }}>\r\n            {offers.map((of) => (\r\n              <div\r\n                key={of.id}\r\n                style={{\r\n                  border: '1px solid #e2e8f0',\r\n                  borderRadius: 10,\r\n                  padding: '8px 10px',\r\n                  display: 'grid',\r\n                  gridTemplateColumns:\r\n                    'minmax(160px,1fr) 120px 120px 120px auto',\r\n                  gap: 8,\r\n                  alignItems: 'center',\r\n                }}\r\n              >\r\n                <div style={{ fontWeight: 600 }}>\r\n                  {of?.lender?.name || 'Lender'}\r\n                </div>\r\n                <div>{fmtMoney(Number(of.amount) || 0)}</div>\r\n                <div>\r\n                  {Number.isFinite(of.duration) ? `${of.duration} mo` : 'â€”'}\r\n                </div>\r\n                <div>\r\n                  {Number.isFinite(of.interestRate)\r\n                    ? `${of.interestRate}%`\r\n                    : 'â€”'}\r\n                </div>\r\n                <div\r\n                  style={{\r\n                    justifySelf: 'end',\r\n                    display: 'flex',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <button\r\n                    className=\"action-btn xs primary\"\r\n                    onClick={() => acceptOffer(of)}\r\n                    disabled={!!offerWorking[of.id]}\r\n                  >\r\n                    {offerWorking[of.id] ? 'Workingâ€¦' : 'Accept'}\r\n                  </button>\r\n                </div>\r\n                {of.message ? (\r\n                  <div\r\n                    style={{\r\n                      gridColumn: '1 / -1',\r\n                      color: '#334155',\r\n                      fontSize: 13,\r\n                    }}\r\n                  >\r\n                    <strong>Message:</strong> {of.message}\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderLoanCard = (loan, isLender, idx) => {\r\n    const key = loan?.id || loan?._id || String(idx);\r\n    const loanId = loan.id || loan._id;\r\n    const isExpanded = !!expanded[key];\r\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\r\n\r\n    const rawStatus = (loan.status || '').toUpperCase();\r\n    const isPaidOff = isLoanPaidOff(loan);\r\n    const isBorrower = !isLender;\r\n\r\n    const badgeClass =\r\n      isPaidOff\r\n        ? 'ms-badge ms-badge--muted'\r\n        : rawStatus === 'FUNDED'\r\n        ? 'ms-badge ms-badge--ok'\r\n        : 'ms-badge ms-badge--warn';\r\n\r\n    const cardClass = `ms-card${isPaidOff ? ' ms-card--paid-off' : ''}`;\r\n\r\n    return (\r\n      <div className={cardClass} key={key}>\r\n        <div className=\"ms-card-row\" style={ROW_GRID}>\r\n          <div>\r\n            <div className=\"ms-label\">{isLender ? 'Borrower' : 'Lender'}</div>\r\n            <div className=\"ms-value-strong\">{otherParty || 'Unknown'}</div>\r\n          </div>\r\n\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(loan.amount)}</div>\r\n          </div>\r\n\r\n          {/* simple status in the header row */}\r\n          <div>\r\n            <div className=\"ms-label\">Status</div>\r\n            <div className=\"ms-value-strong\">\r\n              <span className={badgeClass}>{loan.status || 'â€”'}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n            <button\r\n              onClick={() => setThreadLoanId(loanId)}\r\n              className=\"action-btn sm\"\r\n              title=\"Open conversation\"\r\n            >\r\n              ðŸ’¬ Messages\r\n            </button>\r\n            <button\r\n              onClick={() => setExpanded((m) => ({ ...m, [key]: !isExpanded }))}\r\n              className=\"action-btn sm\"\r\n              title=\"View contract\"\r\n            >\r\n              {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            {loan.status && (\r\n              <p className=\"mt-6\">\r\n                <strong>Status:</strong> {loan.status}\r\n              </p>\r\n            )}\r\n            <p className=\"mt-6\">\r\n              <strong>Interest Rate:</strong>{' '}\r\n              {typeof loan.interestRate === 'number'\r\n                ? `${loan.interestRate}%`\r\n                : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Duration:</strong>{' '}\r\n              {typeof loan.duration === 'number'\r\n                ? `${loan.duration} months`\r\n                : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Next Due Date:</strong>{' '}\r\n              {loan.nextDueDate\r\n                ? new Date(loan.nextDueDate).toLocaleDateString()\r\n                : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Installment (this period):</strong>{' '}\r\n              {fmtMoney(loan.installmentAmount)}\r\n            </p>\r\n\r\n            {/* Paid-off note */}\r\n            {isPaidOff && (\r\n              <p className=\"mt-6 ms-muted\">\r\n                <strong>Repayment:</strong> Loan fully repaid. No further\r\n                installments.\r\n              </p>\r\n            )}\r\n\r\n            {/* Borrower view: pay next installment */}\r\n            {isBorrower && !isPaidOff && (\r\n              <div className=\"mt-8\">\r\n                <RepaymentButton loanId={loanId} onPaid={fetchSummary} />\r\n              </div>\r\n            )}\r\n\r\n            {/* Lender view: fund ACCEPTED loans from wallet */}\r\n            {isLender && !isPaidOff && rawStatus === 'ACCEPTED' && (\r\n              <div className=\"mt-8\" style={{ display: 'flex', gap: 8 }}>\r\n                <button\r\n                  className=\"action-btn sm primary\"\r\n                  onClick={() => handleFundLoan(loanId)}\r\n                  disabled={!!funding[loanId]}\r\n                >\r\n                  {funding[loanId] ? 'Fundingâ€¦' : 'Fund from PeerFund wallet'}\r\n                </button>\r\n                <span className=\"ms-muted\" style={{ alignSelf: 'center' }}>\r\n                  Requires enough wallet balance\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /* ------------------------------- Render ------------------------------- */\r\n\r\n  if (loading)\r\n    return (\r\n      <p className=\"ms-loading ms-container\">Loading money summary...</p>\r\n    );\r\n\r\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\r\n  const received = Array.isArray(summary.loansReceived)\r\n    ? summary.loansReceived\r\n    : [];\r\n  const myOpen = Array.isArray(summary.myOpenRequests)\r\n    ? summary.myOpenRequests\r\n    : [];\r\n\r\n  return (\r\n    <div className=\"ms-container\">\r\n      <h2 className=\"ms-heading\">ðŸ’µ My Money Summary</h2>\r\n\r\n      {/* Section: Open Requests */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, open: !s.open }))}\r\n          aria-expanded={openSec.open}\r\n        >\r\n          <div className=\"ms-subheading\">My Open Loan Requests</div>\r\n          <div className=\"ms-caret\">{openSec.open ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.open && (\r\n          <div className=\"ms-section-body\">\r\n            {myOpen.length === 0 ? (\r\n              <p className=\"ms-empty\">You have no open requests.</p>\r\n            ) : (\r\n              myOpen.map((req) => (\r\n                <OpenRequestRow\r\n                  key={req.id}\r\n                  req={req}\r\n                  isExpanded={!!expanded[req.id]}\r\n                  onToggle={() => toggleDetails(req)}\r\n                  actionLoading={actionLoading}\r\n                  // MARKET + Borrowing: offers block (as a React node)\r\n                  offersContent={\r\n                    req.type === 'market' && req.role === 'Borrowing'\r\n                      ? renderOffersBlock(req.id)\r\n                      : undefined\r\n                  }\r\n                  // MARKET + Lending: open OfferModal\r\n                  onMakeOffer={\r\n                    req.type === 'market' && req.role === 'Lending'\r\n                      ? () => setOfferModalLoanId(req.id)\r\n                      : undefined\r\n                  }\r\n                  // DIRECT actions\r\n                  onAcceptDirect={\r\n                    req.type === 'direct'\r\n                      ? () => acceptDirect(req)\r\n                      : undefined\r\n                  }\r\n                  onDeclineDirect={\r\n                    req.type === 'direct'\r\n                      ? () => declineDirect(req)\r\n                      : undefined\r\n                  }\r\n                />\r\n              ))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Given */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, given: !s.given }))}\r\n          aria-expanded={openSec.given}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Given (I&apos;m the Lender)</div>\r\n          <div className=\"ms-caret\">{openSec.given ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.given && (\r\n          <div className=\"ms-section-body\">\r\n            {given.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans given yet.</p>\r\n            ) : (\r\n              given.map((loan, idx) => renderLoanCard(loan, true, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Received */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() =>\r\n            setOpenSec((s) => ({ ...s, received: !s.received }))\r\n          }\r\n          aria-expanded={openSec.received}\r\n        >\r\n          <div className=\"ms-subheading\">\r\n            Loans Received (I&apos;m the Borrower)\r\n          </div>\r\n          <div className=\"ms-caret\">{openSec.received ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.received && (\r\n          <div className=\"ms-section-body\">\r\n            {received.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans received yet.</p>\r\n            ) : (\r\n              received.map((loan, idx) => renderLoanCard(loan, false, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {threadLoanId && (\r\n        <LoanThreadModal\r\n          loanId={threadLoanId}\r\n          onClose={() => setThreadLoanId(null)}\r\n        />\r\n      )}\r\n\r\n      {offerModalLoanId && (\r\n        <OfferModal\r\n          loanId={offerModalLoanId}\r\n          onClose={() => setOfferModalLoanId(null)}\r\n        />\r\n      )}\r\n\r\n      <LinkBankFirstModal\r\n        open={showLinkModal}\r\n        onClose={() => setShowLinkModal(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}