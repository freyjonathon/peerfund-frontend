{"ast":null,"code":"// src/components/DocumentViewer.jsx\nimport React,{useEffect,useState}from'react';import{useNavigate,useParams}from'react-router-dom';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const DocumentViewer=()=>{const{documentId}=useParams();const navigate=useNavigate();const[loading,setLoading]=useState(true);const[err,setErr]=useState('');const[doc,setDoc]=useState(null);const[objectUrl,setObjectUrl]=useState('');useEffect(()=>{let alive=true;const load=async()=>{try{setLoading(true);setErr('');const token=localStorage.getItem('token');if(!token){navigate('/login',{replace:true});return;}const res=await fetch(\"/api/documents/\".concat(documentId),{headers:{Authorization:\"Bearer \".concat(token)}});// If unauthorized, force re-login\nif(res.status===401){navigate('/login',{replace:true});return;}if(!res.ok){const text=await res.text();throw new Error(text||'Failed to load document');}// Expecting JSON like: { id, title, mimeType, fileName, base64 }\nconst data=await res.json();if(!alive)return;setDoc(data);// If backend returns base64 for binary docs, create a blob URL\nif(data!==null&&data!==void 0&&data.base64&&data!==null&&data!==void 0&&data.mimeType){const byteChars=atob(data.base64);const byteNumbers=new Array(byteChars.length);for(let i=0;i<byteChars.length;i++){byteNumbers[i]=byteChars.charCodeAt(i);}const byteArray=new Uint8Array(byteNumbers);const blob=new Blob([byteArray],{type:data.mimeType});const url=URL.createObjectURL(blob);setObjectUrl(url);}}catch(e){console.error('DocumentViewer load error:',e);if(alive)setErr(e.message||'Error: Document not found');}finally{if(alive)setLoading(false);}};load();return()=>{alive=false;if(objectUrl)URL.revokeObjectURL(objectUrl);};// eslint-disable-next-line react-hooks/exhaustive-deps\n},[documentId]);if(loading)return/*#__PURE__*/_jsx(\"div\",{style:{padding:16},children:\"Loading\\u2026\"});if(err)return/*#__PURE__*/_jsxs(\"div\",{style:{padding:16},children:[\"Error: \",err]});if(!doc)return/*#__PURE__*/_jsx(\"div\",{style:{padding:16},children:\"Error: Document not found\"});const mime=doc.mimeType||'';const isImage=mime.startsWith('image/');const isPdf=mime==='application/pdf';return/*#__PURE__*/_jsxs(\"div\",{style:{padding:16},children:[/*#__PURE__*/_jsxs(\"div\",{style:{display:'flex',justifyContent:'space-between',gap:12},children:[/*#__PURE__*/_jsx(\"h2\",{style:{margin:0},children:doc.title||doc.fileName||'Document'}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>navigate(-1),children:\"\\u2190 Back\"})]}),/*#__PURE__*/_jsxs(\"div\",{style:{marginTop:12,color:'#64748b'},children:[/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"Type:\"}),\" \",doc.type||'—']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"File:\"}),\" \",doc.fileName||'—']}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"b\",{children:\"MIME:\"}),\" \",doc.mimeType||'—']})]}),/*#__PURE__*/_jsx(\"hr\",{style:{margin:'16px 0'}}),!objectUrl?/*#__PURE__*/_jsx(\"div\",{children:\"No preview available.\"}):isImage?/*#__PURE__*/_jsx(\"img\",{src:objectUrl,alt:doc.title||doc.fileName||'Uploaded document',style:{maxWidth:'100%',borderRadius:12,border:'1px solid #e5e7eb'}}):isPdf?/*#__PURE__*/_jsx(\"iframe\",{title:\"PDF Preview\",src:objectUrl,style:{width:'100%',height:'80vh',border:'1px solid #e5e7eb',borderRadius:12}}):/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsx(\"p\",{children:\"This file type can\\u2019t be previewed here.\"}),/*#__PURE__*/_jsx(\"a\",{href:objectUrl,download:doc.fileName||'document',children:\"Download file\"})]})]});};export default DocumentViewer;","map":{"version":3,"names":["React","useEffect","useState","useNavigate","useParams","jsx","_jsx","jsxs","_jsxs","DocumentViewer","documentId","navigate","loading","setLoading","err","setErr","doc","setDoc","objectUrl","setObjectUrl","alive","load","token","localStorage","getItem","replace","res","fetch","concat","headers","Authorization","status","ok","text","Error","data","json","base64","mimeType","byteChars","atob","byteNumbers","Array","length","i","charCodeAt","byteArray","Uint8Array","blob","Blob","type","url","URL","createObjectURL","e","console","error","message","revokeObjectURL","style","padding","children","mime","isImage","startsWith","isPdf","display","justifyContent","gap","margin","title","fileName","onClick","marginTop","color","src","alt","maxWidth","borderRadius","border","width","height","href","download"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/components/DocumentViewer.jsx"],"sourcesContent":["// src/components/DocumentViewer.jsx\r\nimport React, { useEffect, useState } from 'react';\r\nimport { useNavigate, useParams } from 'react-router-dom';\r\n\r\nconst DocumentViewer = () => {\r\n  const { documentId } = useParams();\r\n  const navigate = useNavigate();\r\n\r\n  const [loading, setLoading] = useState(true);\r\n  const [err, setErr] = useState('');\r\n  const [doc, setDoc] = useState(null);\r\n  const [objectUrl, setObjectUrl] = useState('');\r\n\r\n  useEffect(() => {\r\n    let alive = true;\r\n\r\n    const load = async () => {\r\n      try {\r\n        setLoading(true);\r\n        setErr('');\r\n\r\n        const token = localStorage.getItem('token');\r\n        if (!token) {\r\n          navigate('/login', { replace: true });\r\n          return;\r\n        }\r\n\r\n        const res = await fetch(`/api/documents/${documentId}`, {\r\n          headers: { Authorization: `Bearer ${token}` },\r\n        });\r\n\r\n        // If unauthorized, force re-login\r\n        if (res.status === 401) {\r\n          navigate('/login', { replace: true });\r\n          return;\r\n        }\r\n\r\n        if (!res.ok) {\r\n          const text = await res.text();\r\n          throw new Error(text || 'Failed to load document');\r\n        }\r\n\r\n        // Expecting JSON like: { id, title, mimeType, fileName, base64 }\r\n        const data = await res.json();\r\n\r\n        if (!alive) return;\r\n        setDoc(data);\r\n\r\n        // If backend returns base64 for binary docs, create a blob URL\r\n        if (data?.base64 && data?.mimeType) {\r\n          const byteChars = atob(data.base64);\r\n          const byteNumbers = new Array(byteChars.length);\r\n          for (let i = 0; i < byteChars.length; i++) {\r\n            byteNumbers[i] = byteChars.charCodeAt(i);\r\n          }\r\n          const byteArray = new Uint8Array(byteNumbers);\r\n          const blob = new Blob([byteArray], { type: data.mimeType });\r\n          const url = URL.createObjectURL(blob);\r\n          setObjectUrl(url);\r\n        }\r\n      } catch (e) {\r\n        console.error('DocumentViewer load error:', e);\r\n        if (alive) setErr(e.message || 'Error: Document not found');\r\n      } finally {\r\n        if (alive) setLoading(false);\r\n      }\r\n    };\r\n\r\n    load();\r\n\r\n    return () => {\r\n      alive = false;\r\n      if (objectUrl) URL.revokeObjectURL(objectUrl);\r\n    };\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, [documentId]);\r\n\r\n  if (loading) return <div style={{ padding: 16 }}>Loading…</div>;\r\n  if (err) return <div style={{ padding: 16 }}>Error: {err}</div>;\r\n  if (!doc) return <div style={{ padding: 16 }}>Error: Document not found</div>;\r\n\r\n  const mime = doc.mimeType || '';\r\n  const isImage = mime.startsWith('image/');\r\n  const isPdf = mime === 'application/pdf';\r\n\r\n  return (\r\n    <div style={{ padding: 16 }}>\r\n      <div style={{ display: 'flex', justifyContent: 'space-between', gap: 12 }}>\r\n        <h2 style={{ margin: 0 }}>{doc.title || doc.fileName || 'Document'}</h2>\r\n        <button onClick={() => navigate(-1)}>← Back</button>\r\n      </div>\r\n\r\n      <div style={{ marginTop: 12, color: '#64748b' }}>\r\n        <div><b>Type:</b> {doc.type || '—'}</div>\r\n        <div><b>File:</b> {doc.fileName || '—'}</div>\r\n        <div><b>MIME:</b> {doc.mimeType || '—'}</div>\r\n      </div>\r\n\r\n      <hr style={{ margin: '16px 0' }} />\r\n\r\n      {!objectUrl ? (\r\n        <div>No preview available.</div>\r\n      ) : isImage ? (\r\n        <img\r\n          src={objectUrl}\r\n          alt={doc.title || doc.fileName || 'Uploaded document'}\r\n          style={{ maxWidth: '100%', borderRadius: 12, border: '1px solid #e5e7eb' }}\r\n        />\r\n      ) : isPdf ? (\r\n        <iframe\r\n          title=\"PDF Preview\"\r\n          src={objectUrl}\r\n          style={{ width: '100%', height: '80vh', border: '1px solid #e5e7eb', borderRadius: 12 }}\r\n        />\r\n      ) : (\r\n        <div>\r\n          <p>This file type can’t be previewed here.</p>\r\n          <a href={objectUrl} download={doc.fileName || 'document'}>\r\n            Download file\r\n          </a>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default DocumentViewer;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}