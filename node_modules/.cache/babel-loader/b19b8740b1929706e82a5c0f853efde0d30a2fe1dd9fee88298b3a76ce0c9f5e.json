{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/SaveFundingCard.jsx\",\n  _s = $RefreshSig$();\n// src/features/wallet/SaveFundingCard.jsx\nimport React, { useState } from 'react';\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function SaveFundingCard({\n  onSaved\n}) {\n  _s();\n  var _localStorage$getItem;\n  const stripe = useStripe();\n  const elements = useElements();\n  const [busy, setBusy] = useState(false);\n  const token = ((_localStorage$getItem = localStorage.getItem('token')) === null || _localStorage$getItem === void 0 ? void 0 : _localStorage$getItem.replace(/^\"|\"$/g, '')) || '';\n  const handleSave = async () => {\n    if (!stripe || !elements) return;\n    try {\n      setBusy(true);\n\n      // 1. Ask backend for SetupIntent\n      const r = await fetch('/api/billing/card/setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        }\n      });\n      if (!r.ok) throw new Error(await r.text());\n      const {\n        clientSecret\n      } = await r.json();\n\n      // 2. Confirm card setup with CardElement\n      const card = elements.getElement(CardElement);\n      const {\n        error,\n        setupIntent\n      } = await stripe.confirmCardSetup(clientSecret, {\n        payment_method: {\n          card\n        }\n      });\n      if (error) throw error;\n\n      // 3. Tell backend which payment_method to store\n      const pmId = setupIntent.payment_method;\n      const r2 = await fetch('/api/billing/card/set-funding-method', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          paymentMethodId: pmId\n        })\n      });\n      if (!r2.ok) throw new Error(await r2.text());\n      alert('Funding card saved!');\n      onSaved === null || onSaved === void 0 ? void 0 : onSaved();\n    } catch (e) {\n      console.error(e);\n      alert(e.message || 'Failed to save card');\n    } finally {\n      setBusy(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: '1.5rem'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Funding card\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 60,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      style: {\n        fontSize: 14,\n        color: '#4b5563'\n      },\n      children: \"This card will be used for deposits, repayments, and SuperUser fees.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        border: '1px solid #e5e7eb',\n        borderRadius: 8,\n        padding: 10,\n        margin: '8px 0 12px',\n        background: '#fff'\n      },\n      children: /*#__PURE__*/_jsxDEV(CardElement, {\n        options: {\n          hidePostalCode: false\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 74,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: handleSave,\n      disabled: busy || !stripe,\n      style: {\n        background: '#4f46e5',\n        border: '1px solid #4f46e5',\n        color: '#fff',\n        fontWeight: 600,\n        padding: '8px 14px',\n        borderRadius: 999,\n        cursor: busy ? 'not-allowed' : 'pointer'\n      },\n      children: busy ? 'Saving…' : 'Save funding card'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 59,\n    columnNumber: 5\n  }, this);\n}\n_s(SaveFundingCard, \"NJ5GnMwYdLxsqYlqHprVqnU7sLw=\", false, function () {\n  return [useStripe, useElements];\n});\n_c = SaveFundingCard;\nvar _c;\n$RefreshReg$(_c, \"SaveFundingCard\");","map":{"version":3,"names":["React","useState","CardElement","useStripe","useElements","jsxDEV","_jsxDEV","SaveFundingCard","onSaved","_s","_localStorage$getItem","stripe","elements","busy","setBusy","token","localStorage","getItem","replace","handleSave","r","fetch","method","headers","Authorization","ok","Error","text","clientSecret","json","card","getElement","error","setupIntent","confirmCardSetup","payment_method","pmId","r2","body","JSON","stringify","paymentMethodId","alert","e","console","message","style","marginTop","children","fileName","_jsxFileName","lineNumber","columnNumber","fontSize","color","border","borderRadius","padding","margin","background","options","hidePostalCode","onClick","disabled","fontWeight","cursor","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/SaveFundingCard.jsx"],"sourcesContent":["// src/features/wallet/SaveFundingCard.jsx\nimport React, { useState } from 'react';\nimport { CardElement, useStripe, useElements } from '@stripe/react-stripe-js';\n\nexport default function SaveFundingCard({ onSaved }) {\n  const stripe = useStripe();\n  const elements = useElements();\n  const [busy, setBusy] = useState(false);\n\n  const token = localStorage.getItem('token')?.replace(/^\"|\"$/g, '') || '';\n\n  const handleSave = async () => {\n    if (!stripe || !elements) return;\n\n    try {\n      setBusy(true);\n\n      // 1. Ask backend for SetupIntent\n      const r = await fetch('/api/billing/card/setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n      });\n      if (!r.ok) throw new Error(await r.text());\n      const { clientSecret } = await r.json();\n\n      // 2. Confirm card setup with CardElement\n      const card = elements.getElement(CardElement);\n      const { error, setupIntent } = await stripe.confirmCardSetup(clientSecret, {\n        payment_method: { card },\n      });\n      if (error) throw error;\n\n      // 3. Tell backend which payment_method to store\n      const pmId = setupIntent.payment_method;\n      const r2 = await fetch('/api/billing/card/set-funding-method', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({ paymentMethodId: pmId }),\n      });\n      if (!r2.ok) throw new Error(await r2.text());\n\n      alert('Funding card saved!');\n      onSaved?.();\n    } catch (e) {\n      console.error(e);\n      alert(e.message || 'Failed to save card');\n    } finally {\n      setBusy(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: '1.5rem' }}>\n      <h3>Funding card</h3>\n      <p style={{ fontSize: 14, color: '#4b5563' }}>\n        This card will be used for deposits, repayments, and SuperUser fees.\n      </p>\n\n      <div\n        style={{\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          padding: 10,\n          margin: '8px 0 12px',\n          background: '#fff',\n        }}\n      >\n        <CardElement options={{ hidePostalCode: false }} />\n      </div>\n\n      <button\n        onClick={handleSave}\n        disabled={busy || !stripe}\n        style={{\n          background: '#4f46e5',\n          border: '1px solid #4f46e5',\n          color: '#fff',\n          fontWeight: 600,\n          padding: '8px 14px',\n          borderRadius: 999,\n          cursor: busy ? 'not-allowed' : 'pointer',\n        }}\n      >\n        {busy ? 'Saving…' : 'Save funding card'}\n      </button>\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}