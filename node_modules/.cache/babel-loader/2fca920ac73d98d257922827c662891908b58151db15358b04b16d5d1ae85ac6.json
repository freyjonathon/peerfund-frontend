{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx\",\n  _s = $RefreshSig$();\n// src/features/money/MoneySummary.jsx\nimport React, { useEffect, useState, useCallback } from 'react';\nimport './MoneySummary.css';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LoanThreadModal from '../loans/LoanThreadModal';\nimport OfferModal from '../../components/OfferModal';\n\n/* ----------------------- helpers ----------------------- */\n\n// decode JWT for current user id\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction getCurrentUserId() {\n  const t = localStorage.getItem('token');\n  if (!t) return null;\n  try {\n    var _payload$userId;\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\n    return (_payload$userId = payload === null || payload === void 0 ? void 0 : payload.userId) !== null && _payload$userId !== void 0 ? _payload$userId : null;\n  } catch {\n    return null;\n  }\n}\nconst fmtMoney = n => typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\n\n// compact row layout\nconst ROW_GRID = {\n  display: 'grid',\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\n  alignItems: 'center',\n  gap: 10\n};\nasync function authFetch(url, options = {}) {\n  const token = localStorage.getItem('token');\n  const headers = {\n    ...(options.headers || {}),\n    ...(token ? {\n      Authorization: `Bearer ${token}`\n    } : {})\n  };\n  const res = await fetch(url, {\n    ...options,\n    headers,\n    credentials: 'include'\n  });\n  if (res.status === 401) {\n    try {\n      console.warn('401 on', url, await res.text());\n    } catch {}\n    window.location.assign('/login');\n    throw new Error('Unauthorized');\n  }\n  return res;\n}\n\n/* ------------------------- Open request row ------------------------- */\n\nfunction OpenRequestRow({\n  req,\n  isExpanded,\n  onToggle,\n  actionLoading,\n  offersContent,\n  // React node for market/borrower offers list\n  onMakeOffer,\n  // fn for market/lender to open OfferModal\n  onAcceptDirect,\n  // fn for direct approve\n  onDeclineDirect // fn for direct decline\n}) {\n  var _req$status;\n  const isMarket = req.type === 'market';\n  const isBorrowing = req.role === 'Borrowing';\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-card\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card-row\",\n      style: ROW_GRID,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Counterparty\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 72,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: [req.counterpartyName || 'Unknown', /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              marginLeft: 8,\n              color: '#64748b',\n              fontWeight: 600\n            },\n            children: [\"\\u2022 \", req.role]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 75,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Amount\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: fmtMoney(req.amount)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Created\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 88,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          justifySelf: 'end'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"ms-badge ms-badge--warn\",\n          children: \"Open\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 94,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 93,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          justifySelf: 'end',\n          display: 'flex',\n          gap: 8\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onToggle,\n          title: \"View request\",\n          children: isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 97,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-details\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Status:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 31\n        }, this), \" \", (_req$status = req.status) !== null && _req$status !== void 0 ? _req$status : 'OPEN']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Interest Rate:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 108,\n          columnNumber: 31\n        }, this), \" \", Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 108,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Duration:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 109,\n          columnNumber: 31\n        }, this), \" \", Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 109,\n        columnNumber: 11\n      }, this), req.purpose ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Reason:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 33\n        }, this), \" \", req.purpose]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 111,\n        columnNumber: 13\n      }, this) : null, isMarket && isBorrowing && offersContent, isMarket && !isBorrowing && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-8\",\n        style: {\n          display: 'flex',\n          justifyContent: 'flex-end'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm primary\",\n          onClick: onMakeOffer,\n          children: \"\\uD83D\\uDCB5 Make Offer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 120,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 119,\n        columnNumber: 13\n      }, this), !isMarket && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-8\",\n        style: {\n          display: 'flex',\n          gap: 8,\n          justifyContent: 'flex-end'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm primary\",\n          onClick: onAcceptDirect,\n          disabled: !!actionLoading[req.id],\n          children: actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 129,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onDeclineDirect,\n          disabled: !!actionLoading[req.id],\n          children: actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 136,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }, this)]\n  }, req.id, true, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 5\n  }, this);\n}\n\n/* -------------------------------- Parent -------------------------------- */\n_c = OpenRequestRow;\nexport default function MoneySummary() {\n  _s();\n  const [summary, setSummary] = useState({\n    loansGiven: [],\n    loansReceived: [],\n    myOpenRequests: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [expanded, setExpanded] = useState({});\n  const [openSec, setOpenSec] = useState({\n    open: true,\n    given: true,\n    received: true\n  });\n  const [actionLoading, setActionLoading] = useState({});\n  const [threadLoanId, setThreadLoanId] = useState(null);\n  const [profileUserId, setProfileUserId] = useState(null);\n\n  // marketplace offers cache per loanId\n  const [offersByLoanId, setOffersByLoanId] = useState({});\n  const [offersLoading, setOffersLoading] = useState({});\n  const [offerWorking, setOfferWorking] = useState({});\n  const [offerModalLoanId, setOfferModalLoanId] = useState(null);\n  const me = getCurrentUserId();\n\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\n\n  // MARKET requests â€“ only OPEN requests I've already offered on.\n  // Tries fast endpoint, falls back to /api/loans/open and filters to my offers.\n  const fetchMarketOpenRequests = useCallback(async () => {\n    const me = getCurrentUserId();\n    if (!me) return [];\n\n    // --- Try fast endpoint first ---\n    try {\n      const r = await authFetch('/api/loans/offers/mine');\n      if (r.ok) {\n        const data = await r.json();\n        const items = Array.isArray(data === null || data === void 0 ? void 0 : data.items) ? data.items : Array.isArray(data) ? data : [];\n        if (items.length) {\n          return items.map(row => {\n            var _row$myOffer$interest, _row$myOffer, _row$borrower, _row$borrower2, _row$borrower3;\n            return {\n              type: 'market',\n              id: row.id,\n              // loanRequest id\n              amount: Number(row.amount),\n              duration: Number(row.duration),\n              interestRate: Number((_row$myOffer$interest = (_row$myOffer = row.myOffer) === null || _row$myOffer === void 0 ? void 0 : _row$myOffer.interestRate) !== null && _row$myOffer$interest !== void 0 ? _row$myOffer$interest : row.interestRate),\n              purpose: row.purpose || '',\n              createdAt: row.createdAt || null,\n              borrowerId: (_row$borrower = row.borrower) === null || _row$borrower === void 0 ? void 0 : _row$borrower.id,\n              borrowerName: ((_row$borrower2 = row.borrower) === null || _row$borrower2 === void 0 ? void 0 : _row$borrower2.name) || 'Borrower',\n              counterpartyName: ((_row$borrower3 = row.borrower) === null || _row$borrower3 === void 0 ? void 0 : _row$borrower3.name) || 'Borrower',\n              role: 'Lending',\n              // these are requests YOU offered on\n              status: row.status || 'OPEN',\n              myOffer: row.myOffer ? {\n                id: row.myOffer.id,\n                amount: Number(row.myOffer.amount),\n                duration: Number(row.myOffer.duration),\n                interestRate: Number(row.myOffer.interestRate),\n                createdAt: row.myOffer.createdAt\n              } : null\n            };\n          });\n        }\n      }\n    } catch {/* ignore and fall back */}\n\n    // --- Fallback: /api/loans/open then filter to \"my offers\" if offers are included ---\n    try {\n      const r2 = await authFetch('/api/loans/open');\n      if (!r2.ok) return [];\n      const raw = await r2.json();\n      const list = Array.isArray(raw) ? raw : (raw === null || raw === void 0 ? void 0 : raw.items) || [];\n\n      // Keep only requests where I (me) have an offer\n      const mine = list.filter(req => {\n        const offers = Array.isArray(req.loanOffers) ? req.loanOffers : [];\n        return offers.some(o => {\n          var _o$lender;\n          return String(o.lenderId || (o === null || o === void 0 ? void 0 : (_o$lender = o.lender) === null || _o$lender === void 0 ? void 0 : _o$lender.id)) === String(me);\n        });\n      });\n      return mine.map(req => {\n        var _req$borrower, _req$duration, _ref, _myOffer$interestRate, _req$borrower2, _req$borrower3;\n        const offers = Array.isArray(req.loanOffers) ? req.loanOffers : [];\n        const myOffer = offers.find(o => {\n          var _o$lender2;\n          return String(o.lenderId || (o === null || o === void 0 ? void 0 : (_o$lender2 = o.lender) === null || _o$lender2 === void 0 ? void 0 : _o$lender2.id)) === String(me);\n        });\n        const borrowerId = req.borrowerId || (req === null || req === void 0 ? void 0 : (_req$borrower = req.borrower) === null || _req$borrower === void 0 ? void 0 : _req$borrower.id);\n        return {\n          type: 'market',\n          id: req.id,\n          amount: Number(req.amount),\n          duration: Number((_req$duration = req.duration) !== null && _req$duration !== void 0 ? _req$duration : req.months),\n          interestRate: Number((_ref = (_myOffer$interestRate = myOffer === null || myOffer === void 0 ? void 0 : myOffer.interestRate) !== null && _myOffer$interestRate !== void 0 ? _myOffer$interestRate : req.interestRate) !== null && _ref !== void 0 ? _ref : req.apr),\n          purpose: req.purpose || '',\n          createdAt: req.createdAt || null,\n          borrowerId,\n          borrowerName: (req === null || req === void 0 ? void 0 : (_req$borrower2 = req.borrower) === null || _req$borrower2 === void 0 ? void 0 : _req$borrower2.name) || 'Borrower',\n          counterpartyName: (req === null || req === void 0 ? void 0 : (_req$borrower3 = req.borrower) === null || _req$borrower3 === void 0 ? void 0 : _req$borrower3.name) || 'Borrower',\n          role: 'Lending',\n          status: req.status || 'OPEN',\n          myOffer: myOffer ? {\n            id: myOffer.id,\n            amount: Number(myOffer.amount),\n            duration: Number(myOffer.duration),\n            interestRate: Number(myOffer.interestRate),\n            createdAt: myOffer.createdAt\n          } : null\n        };\n      });\n    } catch {\n      return [];\n    }\n  }, []);\n\n  // DIRECT requests (leave your existing body, just wrap in useCallback)\n  const fetchDirectOpenRequests = useCallback(async () => {\n    const me = getCurrentUserId();\n    if (!me) return [];\n    try {\n      const r = await authFetch('/api/direct-requests/open/mine');\n      if (!r.ok) return [];\n      const rows = await r.json();\n      return (Array.isArray(rows) ? rows : []).map(d => {\n        var _d$borrower, _d$lender, _d$months, _d$apr, _d$borrower2, _d$lender2, _d$lender3, _d$borrower3;\n        const borrowerId = d.borrowerId || (d === null || d === void 0 ? void 0 : (_d$borrower = d.borrower) === null || _d$borrower === void 0 ? void 0 : _d$borrower.id);\n        const lenderId = d.lenderId || (d === null || d === void 0 ? void 0 : (_d$lender = d.lender) === null || _d$lender === void 0 ? void 0 : _d$lender.id);\n        const iAmBorrower = String(borrowerId) === String(me);\n        return {\n          type: 'direct',\n          id: d.id,\n          amount: Number(d.amount),\n          duration: Number((_d$months = d.months) !== null && _d$months !== void 0 ? _d$months : d.duration),\n          interestRate: Number((_d$apr = d.apr) !== null && _d$apr !== void 0 ? _d$apr : d.interestRate),\n          createdAt: d.createdAt || null,\n          borrowerId,\n          borrowerName: (d === null || d === void 0 ? void 0 : (_d$borrower2 = d.borrower) === null || _d$borrower2 === void 0 ? void 0 : _d$borrower2.name) || (iAmBorrower ? 'You' : ''),\n          lenderId,\n          lenderName: (d === null || d === void 0 ? void 0 : (_d$lender2 = d.lender) === null || _d$lender2 === void 0 ? void 0 : _d$lender2.name) || (!iAmBorrower ? 'You' : ''),\n          counterpartyName: iAmBorrower ? (d === null || d === void 0 ? void 0 : (_d$lender3 = d.lender) === null || _d$lender3 === void 0 ? void 0 : _d$lender3.name) || 'Lender' : (d === null || d === void 0 ? void 0 : (_d$borrower3 = d.borrower) === null || _d$borrower3 === void 0 ? void 0 : _d$borrower3.name) || 'Borrower',\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\n          status: d.status || 'PENDING'\n        };\n      });\n    } catch {\n      return [];\n    }\n  }, []);\n  const fetchSummary = useCallback(async () => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    setLoading(true);\n    try {\n      // funded/active loans\n      const res = await authFetch('/api/users/my-money-summary');\n      let loansGiven = [];\n      let loansReceived = [];\n      if (res.ok) {\n        const data = await res.json();\n        loansGiven = Array.isArray(data.loansGiven) ? data.loansGiven : Array.isArray(data.loansAsLender) ? data.loansAsLender : [];\n        loansReceived = Array.isArray(data.loansReceived) ? data.loansReceived : Array.isArray(data.loansAsBorrower) ? data.loansAsBorrower : [];\n      }\n      const [marketOpen, directOpen] = await Promise.all([fetchMarketOpenRequests(), fetchDirectOpenRequests()]);\n      const myOpenRequests = [...marketOpen, ...directOpen];\n      setSummary({\n        loansGiven,\n        loansReceived,\n        myOpenRequests\n      });\n    } catch (err) {\n      console.error('Error fetching money summary:', err);\n      setSummary({\n        loansGiven: [],\n        loansReceived: [],\n        myOpenRequests: []\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [me]);\n  useEffect(() => {\n    fetchSummary();\n  }, [fetchSummary]);\n  const toggleDetails = async req => {\n    setExpanded(prev => {\n      const collapsed = Object.keys(prev).reduce((acc, k) => ({\n        ...acc,\n        [k]: false\n      }), {});\n      return {\n        ...collapsed,\n        [req.id]: !prev[req.id]\n      };\n    });\n\n    // Lazy load offers for MARKET + Borrowing\n    if (req.type === 'market' && req.role === 'Borrowing') {\n      if (!offersByLoanId[req.id] && !offersLoading[req.id]) {\n        await loadOffers(req.id);\n      }\n    }\n  };\n\n  /* -------------------- Offers (marketplace) -------------------- */\n\n  const loadOffers = async loanId => {\n    setOffersLoading(m => ({\n      ...m,\n      [loanId]: true\n    }));\n    try {\n      const r = await authFetch(`/api/loans/${loanId}/offers`);\n      const items = r.ok ? await r.json() : [];\n      setOffersByLoanId(m => ({\n        ...m,\n        [loanId]: Array.isArray(items) ? items : []\n      }));\n    } catch (e) {\n      console.error('loadOffers error', e);\n      setOffersByLoanId(m => ({\n        ...m,\n        [loanId]: []\n      }));\n    } finally {\n      setOffersLoading(m => ({\n        ...m,\n        [loanId]: false\n      }));\n    }\n  };\n  const acceptOffer = async offer => {\n    setOfferWorking(m => ({\n      ...m,\n      [offer.id]: true\n    }));\n    try {\n      const r = await authFetch(`/api/loans/offers/${offer.id}/accept`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!r.ok) {\n        const t = await r.text().catch(() => '');\n        throw new Error(t || 'Failed to accept offer');\n      }\n      alert('âœ… Offer accepted! Loan has been created.');\n      await fetchSummary(); // the request should disappear (FUNDED)\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setOfferWorking(m => ({\n        ...m,\n        [offer.id]: false\n      }));\n    }\n  };\n\n  /* -------------------- Direct request actions -------------------- */\n\n  async function tryEndpoints(methods, url, body) {\n    const optionsBase = {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: body ? JSON.stringify(body) : undefined\n    };\n    let lastErr = null;\n    for (const method of methods) {\n      try {\n        const r = await authFetch(url, {\n          method,\n          ...optionsBase\n        });\n        if (r.ok) return r;\n        const txt = await r.text().catch(() => '');\n        lastErr = new Error(`${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`);\n      } catch (e) {\n        lastErr = e;\n      }\n    }\n    throw lastErr || new Error('All methods failed');\n  }\n  const acceptDirect = async req => {\n    setActionLoading(m => ({\n      ...m,\n      [req.id]: true\n    }));\n    try {\n      const urls = [`/api/direct-requests/${req.id}/approve`, `/api/direct-requests/${req.id}/accept`, `/api/direct-requests/${req.id}/respond?action=ACCEPT`];\n      let ok = false;\n      let last = null;\n      for (const u of urls) {\n        try {\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\n          ok = true;\n          break;\n        } catch (e) {\n          last = e;\n        }\n      }\n      if (!ok) throw last || new Error('Approve failed');\n      await fetchSummary();\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setActionLoading(m => ({\n        ...m,\n        [req.id]: false\n      }));\n    }\n  };\n  const declineDirect = async req => {\n    setActionLoading(m => ({\n      ...m,\n      [req.id]: true\n    }));\n    try {\n      const urls = [`/api/direct-requests/${req.id}/decline`, `/api/direct-requests/${req.id}/reject`, `/api/direct-requests/${req.id}/respond?action=DECLINE`];\n      let ok = false;\n      let last = null;\n      for (const u of urls) {\n        try {\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\n          ok = true;\n          break;\n        } catch (e) {\n          last = e;\n        }\n      }\n      if (!ok) throw last || new Error('Decline failed');\n      await fetchSummary();\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setActionLoading(m => ({\n        ...m,\n        [req.id]: false\n      }));\n    }\n  };\n\n  /* ------------------------------- Renderers ------------------------------- */\n\n  const renderOffersBlock = loanId => {\n    const loading = !!offersLoading[loanId];\n    const offers = offersByLoanId[loanId] || [];\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 6\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Active Offers\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 465,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn xs\",\n          onClick: () => loadOffers(loanId),\n          disabled: loading,\n          title: \"Refresh offers\",\n          children: loading ? 'Refreshingâ€¦' : 'Refresh'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 466,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 464,\n        columnNumber: 9\n      }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"ms-muted\",\n        children: \"Loading offers\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 476,\n        columnNumber: 11\n      }, this) : offers.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"ms-muted\",\n        children: \"No offers yet\\u2014be the first!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gap: 8\n        },\n        children: offers.map(of => {\n          var _of$lender;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              border: '1px solid #e2e8f0',\n              borderRadius: 10,\n              padding: '8px 10px',\n              display: 'grid',\n              gridTemplateColumns: 'minmax(160px,1fr) 120px 120px 120px auto',\n              gap: 8,\n              alignItems: 'center'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontWeight: 600\n              },\n              children: (of === null || of === void 0 ? void 0 : (_of$lender = of.lender) === null || _of$lender === void 0 ? void 0 : _of$lender.name) || 'Lender'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 494,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: fmtMoney(Number(of.amount) || 0)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 495,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: Number.isFinite(of.duration) ? `${of.duration} mo` : 'â€”'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 496,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: Number.isFinite(of.interestRate) ? `${of.interestRate}%` : 'â€”'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 497,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                justifySelf: 'end',\n                display: 'flex',\n                gap: 6\n              },\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"action-btn xs primary\",\n                onClick: () => acceptOffer(of),\n                disabled: !!offerWorking[of.id],\n                children: offerWorking[of.id] ? 'Workingâ€¦' : 'Accept'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 499,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 498,\n              columnNumber: 17\n            }, this), of.message ? /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                gridColumn: '1 / -1',\n                color: '#334155',\n                fontSize: 13\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Message:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 509,\n                columnNumber: 21\n              }, this), \" \", of.message]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 508,\n              columnNumber: 19\n            }, this) : null]\n          }, of.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 482,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 480,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 463,\n      columnNumber: 7\n    }, this);\n  };\n  const renderLoanCard = (loan, isLender, idx) => {\n    const key = (loan === null || loan === void 0 ? void 0 : loan.id) || (loan === null || loan === void 0 ? void 0 : loan._id) || String(idx);\n    const isExpanded = !!expanded[key];\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\n    const badgeClass = (loan.status || '').toUpperCase() === 'FUNDED' ? 'ms-badge ms-badge--ok' : 'ms-badge ms-badge--warn';\n    const fundedDate = loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-card-row\",\n        style: ROW_GRID,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: isLender ? 'Borrower' : 'Lender'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 537,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: otherParty || 'Unknown'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 538,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 536,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Amount\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 541,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fmtMoney(loan.amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 542,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 540,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Funded Date\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 545,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fundedDate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 546,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 544,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            justifySelf: 'end'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: badgeClass,\n            children: loan.status || 'â€”'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 549,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 548,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            justifySelf: 'end',\n            display: 'flex',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setThreadLoanId(loan.id || loan._id),\n            className: \"action-btn sm\",\n            title: \"Open conversation\",\n            children: \"\\uD83D\\uDCAC Messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 552,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setExpanded(m => ({\n              ...m,\n              [key]: !isExpanded\n            })),\n            className: \"action-btn sm\",\n            title: \"View contract\",\n            children: isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 559,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 551,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 535,\n        columnNumber: 9\n      }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-details\",\n        children: [loan.status && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 571,\n            columnNumber: 49\n          }, this), \" \", loan.status]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 571,\n          columnNumber: 29\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Interest Rate:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 572,\n            columnNumber: 33\n          }, this), \" \", typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 572,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Duration:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 573,\n            columnNumber: 33\n          }, this), \" \", typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 573,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Next Due Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 574,\n            columnNumber: 33\n          }, this), \" \", loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 574,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Installment (this period):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 575,\n            columnNumber: 33\n          }, this), \" \", fmtMoney(loan.installmentAmount)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 575,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 570,\n        columnNumber: 11\n      }, this)]\n    }, key, true, {\n      fileName: _jsxFileName,\n      lineNumber: 534,\n      columnNumber: 7\n    }, this);\n  };\n\n  /* ------------------------------- Render ------------------------------- */\n\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"ms-loading ms-container\",\n    children: \"Loading money summary...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 584,\n    columnNumber: 23\n  }, this);\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"ms-heading\",\n      children: \"\\uD83D\\uDCB5 My Money Summary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 592,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          open: !s.open\n        })),\n        \"aria-expanded\": openSec.open,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"My Open Loan Requests\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 601,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.open ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 602,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 596,\n        columnNumber: 9\n      }, this), openSec.open && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: myOpen.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"You have no open requests.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 607,\n          columnNumber: 15\n        }, this) : myOpen.map(req => /*#__PURE__*/_jsxDEV(OpenRequestRow, {\n          req: req,\n          isExpanded: !!expanded[req.id],\n          onToggle: () => toggleDetails(req),\n          actionLoading: actionLoading\n          // MARKET + Borrowing: offers block (as a React node)\n          ,\n          offersContent: req.type === 'market' && req.role === 'Borrowing' ? renderOffersBlock(req.id) : undefined\n          // MARKET + Lending: open OfferModal\n          ,\n          onMakeOffer: req.type === 'market' && req.role === 'Lending' ? () => setOfferModalLoanId(req.id) : undefined\n          // DIRECT actions\n          ,\n          onAcceptDirect: req.type === 'direct' ? () => acceptDirect(req) : undefined,\n          onDeclineDirect: req.type === 'direct' ? () => declineDirect(req) : undefined\n        }, req.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 610,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 605,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          given: !s.given\n        })),\n        \"aria-expanded\": openSec.given,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Given (I'm the Lender)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 649,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.given ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 650,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 644,\n        columnNumber: 9\n      }, this), openSec.given && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: given.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans given yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 655,\n          columnNumber: 15\n        }, this) : given.map((loan, idx) => renderLoanCard(loan, true, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 653,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 643,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          received: !s.received\n        })),\n        \"aria-expanded\": openSec.received,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Received (I'm the Borrower)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 670,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.received ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 671,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 665,\n        columnNumber: 9\n      }, this), openSec.received && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: received.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans received yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 676,\n          columnNumber: 15\n        }, this) : received.map((loan, idx) => renderLoanCard(loan, false, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 674,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 664,\n      columnNumber: 7\n    }, this), profileUserId && /*#__PURE__*/_jsxDEV(UserProfileModal, {\n      userId: profileUserId,\n      onClose: () => setProfileUserId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 685,\n      columnNumber: 9\n    }, this), threadLoanId && /*#__PURE__*/_jsxDEV(LoanThreadModal, {\n      loanId: threadLoanId,\n      onClose: () => setThreadLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 688,\n      columnNumber: 9\n    }, this), offerModalLoanId && /*#__PURE__*/_jsxDEV(OfferModal, {\n      loanId: offerModalLoanId,\n      onClose: () => setOfferModalLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 693,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 591,\n    columnNumber: 5\n  }, this);\n}\n_s(MoneySummary, \"2xYUnk4H3L20qFs4Fo2K4YeYJxQ=\");\n_c2 = MoneySummary;\nvar _c, _c2;\n$RefreshReg$(_c, \"OpenRequestRow\");\n$RefreshReg$(_c2, \"MoneySummary\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","UserProfileModal","LoanThreadModal","OfferModal","jsxDEV","_jsxDEV","getCurrentUserId","t","localStorage","getItem","_payload$userId","payload","JSON","parse","atob","split","userId","fmtMoney","n","Number","isNaN","toFixed","ROW_GRID","display","gridTemplateColumns","alignItems","gap","authFetch","url","options","token","headers","Authorization","res","fetch","credentials","status","console","warn","text","window","location","assign","Error","OpenRequestRow","req","isExpanded","onToggle","actionLoading","offersContent","onMakeOffer","onAcceptDirect","onDeclineDirect","_req$status","isMarket","type","isBorrowing","role","className","children","style","fileName","_jsxFileName","lineNumber","columnNumber","counterpartyName","marginLeft","color","fontWeight","amount","createdAt","Date","toLocaleDateString","justifySelf","onClick","title","isFinite","interestRate","duration","purpose","justifyContent","disabled","id","_c","MoneySummary","_s","summary","setSummary","loansGiven","loansReceived","myOpenRequests","loading","setLoading","expanded","setExpanded","openSec","setOpenSec","open","given","received","setActionLoading","threadLoanId","setThreadLoanId","profileUserId","setProfileUserId","offersByLoanId","setOffersByLoanId","offersLoading","setOffersLoading","offerWorking","setOfferWorking","offerModalLoanId","setOfferModalLoanId","me","fetchMarketOpenRequests","r","ok","data","json","items","Array","isArray","length","map","row","_row$myOffer$interest","_row$myOffer","_row$borrower","_row$borrower2","_row$borrower3","myOffer","borrowerId","borrower","borrowerName","name","r2","raw","list","mine","filter","offers","loanOffers","some","o","_o$lender","String","lenderId","lender","_req$borrower","_req$duration","_ref","_myOffer$interestRate","_req$borrower2","_req$borrower3","find","_o$lender2","months","apr","fetchDirectOpenRequests","rows","d","_d$borrower","_d$lender","_d$months","_d$apr","_d$borrower2","_d$lender2","_d$lender3","_d$borrower3","iAmBorrower","lenderName","fetchSummary","loansAsLender","loansAsBorrower","marketOpen","directOpen","Promise","all","err","error","toggleDetails","prev","collapsed","Object","keys","reduce","acc","k","loadOffers","loanId","m","e","acceptOffer","offer","method","catch","alert","message","tryEndpoints","methods","body","optionsBase","stringify","undefined","lastErr","txt","statusText","acceptDirect","urls","last","u","declineDirect","renderOffersBlock","marginBottom","of","_of$lender","border","borderRadius","padding","gridColumn","fontSize","renderLoanCard","loan","isLender","idx","key","_id","otherParty","badgeClass","toUpperCase","fundedDate","nextDueDate","installmentAmount","myOpen","s","onClose","_c2","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx"],"sourcesContent":["// src/features/money/MoneySummary.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport './MoneySummary.css';\r\nimport UserProfileModal from '../../components/UserProfileModal';\r\nimport LoanThreadModal from '../loans/LoanThreadModal';\r\nimport OfferModal from '../../components/OfferModal';\r\n\r\n/* ----------------------- helpers ----------------------- */\r\n\r\n// decode JWT for current user id\r\nfunction getCurrentUserId() {\r\n  const t = localStorage.getItem('token');\r\n  if (!t) return null;\r\n  try {\r\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\r\n    return payload?.userId ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nconst fmtMoney = (n) =>\r\n  typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\r\n\r\n// compact row layout\r\nconst ROW_GRID = {\r\n  display: 'grid',\r\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\r\n  alignItems: 'center',\r\n  gap: 10,\r\n};\r\n\r\nasync function authFetch(url, options = {}) {\r\n  const token = localStorage.getItem('token');\r\n  const headers = {\r\n    ...(options.headers || {}),\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n  };\r\n  const res = await fetch(url, {\r\n    ...options,\r\n    headers,\r\n    credentials: 'include',\r\n  });\r\n  if (res.status === 401) {\r\n    try { console.warn('401 on', url, await res.text()); } catch {}\r\n    window.location.assign('/login');\r\n    throw new Error('Unauthorized');\r\n  }\r\n  return res;\r\n}\r\n\r\n/* ------------------------- Open request row ------------------------- */\r\n\r\nfunction OpenRequestRow({\r\n  req,\r\n  isExpanded,\r\n  onToggle,\r\n  actionLoading,\r\n  offersContent,   // React node for market/borrower offers list\r\n  onMakeOffer,     // fn for market/lender to open OfferModal\r\n  onAcceptDirect,  // fn for direct approve\r\n  onDeclineDirect, // fn for direct decline\r\n}) {\r\n  const isMarket = req.type === 'market';\r\n  const isBorrowing = req.role === 'Borrowing';\r\n\r\n  return (\r\n    <div className=\"ms-card\" key={req.id}>\r\n      {/* ONE-LINE TOP ROW */}\r\n      <div className=\"ms-card-row\" style={ROW_GRID}>\r\n        <div>\r\n          <div className=\"ms-label\">Counterparty</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.counterpartyName || 'Unknown'}\r\n            <span style={{ marginLeft: 8, color: '#64748b', fontWeight: 600 }}>\r\n              â€¢ {req.role}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"ms-label\">Amount</div>\r\n          <div className=\"ms-value-strong\">{fmtMoney(req.amount)}</div>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"ms-label\">Created</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'}\r\n          </div>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end' }}>\r\n          <span className=\"ms-badge ms-badge--warn\">Open</span>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n          <button className=\"action-btn sm\" onClick={onToggle} title=\"View request\">\r\n            {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* DETAILS */}\r\n      {isExpanded && (\r\n        <div className=\"ms-details\">\r\n          <p className=\"mt-6\"><strong>Status:</strong> {req.status ?? 'OPEN'}</p>\r\n          <p className=\"mt-6\"><strong>Interest Rate:</strong> {Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”'}</p>\r\n          <p className=\"mt-6\"><strong>Duration:</strong> {Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”'}</p>\r\n          {req.purpose ? (\r\n            <p className=\"mt-6\"><strong>Reason:</strong> {req.purpose}</p>\r\n          ) : null}\r\n\r\n          {/* MARKET: Borrowing => show the actual offers placed by lenders */}\r\n          {isMarket && isBorrowing && offersContent}\r\n\r\n          {/* MARKET: Lending => allow me to place an offer */}\r\n          {isMarket && !isBorrowing && (\r\n            <div className=\"mt-8\" style={{ display: 'flex', justifyContent: 'flex-end' }}>\r\n              <button className=\"action-btn sm primary\" onClick={onMakeOffer}>\r\n                ðŸ’µ Make Offer\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* DIRECT requests => approve/decline */}\r\n          {!isMarket && (\r\n            <div className=\"mt-8\" style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>\r\n              <button\r\n                className=\"action-btn sm primary\"\r\n                onClick={onAcceptDirect}\r\n                disabled={!!actionLoading[req.id]}\r\n              >\r\n                {actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'}\r\n              </button>\r\n              <button\r\n                className=\"action-btn sm\"\r\n                onClick={onDeclineDirect}\r\n                disabled={!!actionLoading[req.id]}\r\n              >\r\n                {actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -------------------------------- Parent -------------------------------- */\r\n\r\nexport default function MoneySummary() {\r\n  const [summary, setSummary] = useState({\r\n    loansGiven: [],\r\n    loansReceived: [],\r\n    myOpenRequests: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [expanded, setExpanded] = useState({});\r\n  const [openSec, setOpenSec] = useState({ open: true, given: true, received: true });\r\n\r\n  const [actionLoading, setActionLoading] = useState({});\r\n  const [threadLoanId, setThreadLoanId] = useState(null);\r\n  const [profileUserId, setProfileUserId] = useState(null);\r\n\r\n  // marketplace offers cache per loanId\r\n  const [offersByLoanId, setOffersByLoanId] = useState({});\r\n  const [offersLoading, setOffersLoading] = useState({});\r\n  const [offerWorking, setOfferWorking] = useState({});\r\n  const [offerModalLoanId, setOfferModalLoanId] = useState(null);\r\n\r\n  const me = getCurrentUserId();\r\n\r\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\r\n\r\n// MARKET requests â€“ only OPEN requests I've already offered on.\r\n// Tries fast endpoint, falls back to /api/loans/open and filters to my offers.\r\nconst fetchMarketOpenRequests = useCallback(async () => {\r\n  const me = getCurrentUserId();\r\n  if (!me) return [];\r\n\r\n  // --- Try fast endpoint first ---\r\n  try {\r\n    const r = await authFetch('/api/loans/offers/mine');\r\n    if (r.ok) {\r\n      const data = await r.json();\r\n      const items = Array.isArray(data?.items) ? data.items : (Array.isArray(data) ? data : []);\r\n      if (items.length) {\r\n        return items.map((row) => ({\r\n          type: 'market',\r\n          id: row.id, // loanRequest id\r\n          amount: Number(row.amount),\r\n          duration: Number(row.duration),\r\n          interestRate: Number(row.myOffer?.interestRate ?? row.interestRate),\r\n          purpose: row.purpose || '',\r\n          createdAt: row.createdAt || null,\r\n          borrowerId: row.borrower?.id,\r\n          borrowerName: row.borrower?.name || 'Borrower',\r\n          counterpartyName: row.borrower?.name || 'Borrower',\r\n          role: 'Lending',                     // these are requests YOU offered on\r\n          status: row.status || 'OPEN',\r\n          myOffer: row.myOffer\r\n            ? {\r\n                id: row.myOffer.id,\r\n                amount: Number(row.myOffer.amount),\r\n                duration: Number(row.myOffer.duration),\r\n                interestRate: Number(row.myOffer.interestRate),\r\n                createdAt: row.myOffer.createdAt,\r\n              }\r\n            : null,\r\n        }));\r\n      }\r\n    }\r\n  } catch { /* ignore and fall back */ }\r\n\r\n  // --- Fallback: /api/loans/open then filter to \"my offers\" if offers are included ---\r\n  try {\r\n    const r2 = await authFetch('/api/loans/open');\r\n    if (!r2.ok) return [];\r\n    const raw = await r2.json();\r\n    const list = Array.isArray(raw) ? raw : raw?.items || [];\r\n\r\n    // Keep only requests where I (me) have an offer\r\n    const mine = list.filter((req) => {\r\n      const offers = Array.isArray(req.loanOffers) ? req.loanOffers : [];\r\n      return offers.some((o) => String(o.lenderId || o?.lender?.id) === String(me));\r\n    });\r\n\r\n    return mine.map((req) => {\r\n      const offers = Array.isArray(req.loanOffers) ? req.loanOffers : [];\r\n      const myOffer = offers.find((o) => String(o.lenderId || o?.lender?.id) === String(me));\r\n\r\n      const borrowerId = req.borrowerId || req?.borrower?.id;\r\n      return {\r\n        type: 'market',\r\n        id: req.id,\r\n        amount: Number(req.amount),\r\n        duration: Number(req.duration ?? req.months),\r\n        interestRate: Number(myOffer?.interestRate ?? req.interestRate ?? req.apr),\r\n        purpose: req.purpose || '',\r\n        createdAt: req.createdAt || null,\r\n        borrowerId,\r\n        borrowerName: req?.borrower?.name || 'Borrower',\r\n        counterpartyName: req?.borrower?.name || 'Borrower',\r\n        role: 'Lending',\r\n        status: req.status || 'OPEN',\r\n        myOffer: myOffer\r\n          ? {\r\n              id: myOffer.id,\r\n              amount: Number(myOffer.amount),\r\n              duration: Number(myOffer.duration),\r\n              interestRate: Number(myOffer.interestRate),\r\n              createdAt: myOffer.createdAt,\r\n            }\r\n          : null,\r\n      };\r\n    });\r\n  } catch {\r\n    return [];\r\n  }\r\n}, []);\r\n\r\n  // DIRECT requests (leave your existing body, just wrap in useCallback)\r\nconst fetchDirectOpenRequests = useCallback(async () => {\r\n  const me = getCurrentUserId();\r\n  if (!me) return [];\r\n  try {\r\n    const r = await authFetch('/api/direct-requests/open/mine');\r\n    if (!r.ok) return [];\r\n    const rows = await r.json();\r\n    return (Array.isArray(rows) ? rows : []).map((d) => {\r\n      const borrowerId = d.borrowerId || d?.borrower?.id;\r\n      const lenderId = d.lenderId || d?.lender?.id;\r\n      const iAmBorrower = String(borrowerId) === String(me);\r\n      return {\r\n        type: 'direct',\r\n        id: d.id,\r\n        amount: Number(d.amount),\r\n        duration: Number(d.months ?? d.duration),\r\n        interestRate: Number(d.apr ?? d.interestRate),\r\n        createdAt: d.createdAt || null,\r\n        borrowerId,\r\n        borrowerName: d?.borrower?.name || (iAmBorrower ? 'You' : ''),\r\n        lenderId,\r\n        lenderName: d?.lender?.name || (!iAmBorrower ? 'You' : ''),\r\n        counterpartyName: iAmBorrower ? (d?.lender?.name || 'Lender') : (d?.borrower?.name || 'Borrower'),\r\n        role: iAmBorrower ? 'Borrowing' : 'Lending',\r\n        status: d.status || 'PENDING',\r\n      };\r\n    });\r\n  } catch {\r\n    return [];\r\n  }\r\n}, []);\r\n\r\n\r\n  const fetchSummary = useCallback(async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return;\r\n    setLoading(true);\r\n    try {\r\n      // funded/active loans\r\n      const res = await authFetch('/api/users/my-money-summary');\r\n      let loansGiven = [];\r\n      let loansReceived = [];\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        loansGiven = Array.isArray(data.loansGiven)\r\n          ? data.loansGiven\r\n          : Array.isArray(data.loansAsLender)\r\n          ? data.loansAsLender\r\n          : [];\r\n        loansReceived = Array.isArray(data.loansReceived)\r\n          ? data.loansReceived\r\n          : Array.isArray(data.loansAsBorrower)\r\n          ? data.loansAsBorrower\r\n          : [];\r\n      }\r\n\r\n      const [marketOpen, directOpen] = await Promise.all([\r\n        fetchMarketOpenRequests(),\r\n        fetchDirectOpenRequests(),\r\n      ]);\r\n\r\n      const myOpenRequests = [...marketOpen, ...directOpen];\r\n      setSummary({ loansGiven, loansReceived, myOpenRequests });\r\n    } catch (err) {\r\n      console.error('Error fetching money summary:', err);\r\n      setSummary({ loansGiven: [], loansReceived: [], myOpenRequests: [] });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [me]);\r\n\r\n  useEffect(() => { fetchSummary(); }, [fetchSummary]);\r\n\r\n  const toggleDetails = async (req) => {\r\n    setExpanded((prev) => {\r\n      const collapsed = Object.keys(prev).reduce((acc, k) => ({ ...acc, [k]: false }), {});\r\n      return { ...collapsed, [req.id]: !prev[req.id] };\r\n    });\r\n\r\n    // Lazy load offers for MARKET + Borrowing\r\n    if (req.type === 'market' && req.role === 'Borrowing') {\r\n      if (!offersByLoanId[req.id] && !offersLoading[req.id]) {\r\n        await loadOffers(req.id);\r\n      }\r\n    }\r\n  };\r\n\r\n  /* -------------------- Offers (marketplace) -------------------- */\r\n\r\n  const loadOffers = async (loanId) => {\r\n    setOffersLoading((m) => ({ ...m, [loanId]: true }));\r\n    try {\r\n      const r = await authFetch(`/api/loans/${loanId}/offers`);\r\n      const items = r.ok ? await r.json() : [];\r\n      setOffersByLoanId((m) => ({ ...m, [loanId]: Array.isArray(items) ? items : [] }));\r\n    } catch (e) {\r\n      console.error('loadOffers error', e);\r\n      setOffersByLoanId((m) => ({ ...m, [loanId]: [] }));\r\n    } finally {\r\n      setOffersLoading((m) => ({ ...m, [loanId]: false }));\r\n    }\r\n  };\r\n\r\n  const acceptOffer = async (offer) => {\r\n    setOfferWorking((m) => ({ ...m, [offer.id]: true }));\r\n    try {\r\n      const r = await authFetch(`/api/loans/offers/${offer.id}/accept`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n      if (!r.ok) {\r\n        const t = await r.text().catch(() => '');\r\n        throw new Error(t || 'Failed to accept offer');\r\n      }\r\n      alert('âœ… Offer accepted! Loan has been created.');\r\n      await fetchSummary(); // the request should disappear (FUNDED)\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setOfferWorking((m) => ({ ...m, [offer.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* -------------------- Direct request actions -------------------- */\r\n\r\n  async function tryEndpoints(methods, url, body) {\r\n    const optionsBase = {\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    };\r\n    let lastErr = null;\r\n    for (const method of methods) {\r\n      try {\r\n        const r = await authFetch(url, { method, ...optionsBase });\r\n        if (r.ok) return r;\r\n        const txt = await r.text().catch(() => '');\r\n        lastErr = new Error(`${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`);\r\n      } catch (e) {\r\n        lastErr = e;\r\n      }\r\n    }\r\n    throw lastErr || new Error('All methods failed');\r\n  }\r\n\r\n  const acceptDirect = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      const urls = [\r\n        `/api/direct-requests/${req.id}/approve`,\r\n        `/api/direct-requests/${req.id}/accept`,\r\n        `/api/direct-requests/${req.id}/respond?action=ACCEPT`,\r\n      ];\r\n      let ok = false; let last = null;\r\n      for (const u of urls) {\r\n        try { await tryEndpoints(['POST','PUT','PATCH'], u); ok = true; break; }\r\n        catch (e) { last = e; }\r\n      }\r\n      if (!ok) throw last || new Error('Approve failed');\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  const declineDirect = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      const urls = [\r\n        `/api/direct-requests/${req.id}/decline`,\r\n        `/api/direct-requests/${req.id}/reject`,\r\n        `/api/direct-requests/${req.id}/respond?action=DECLINE`,\r\n      ];\r\n      let ok = false; let last = null;\r\n      for (const u of urls) {\r\n        try { await tryEndpoints(['POST','PUT','PATCH'], u); ok = true; break; }\r\n        catch (e) { last = e; }\r\n      }\r\n      if (!ok) throw last || new Error('Decline failed');\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* ------------------------------- Renderers ------------------------------- */\r\n\r\n  const renderOffersBlock = (loanId) => {\r\n    const loading = !!offersLoading[loanId];\r\n    const offers = offersByLoanId[loanId] || [];\r\n    return (\r\n      <div className=\"mt-8\">\r\n        <div style={{ display: 'flex', alignItems: 'center', gap: 8, marginBottom: 6 }}>\r\n          <strong>Active Offers</strong>\r\n          <button\r\n            className=\"action-btn xs\"\r\n            onClick={() => loadOffers(loanId)}\r\n            disabled={loading}\r\n            title=\"Refresh offers\"\r\n          >\r\n            {loading ? 'Refreshingâ€¦' : 'Refresh'}\r\n          </button>\r\n        </div>\r\n        {loading ? (\r\n          <p className=\"ms-muted\">Loading offersâ€¦</p>\r\n        ) : offers.length === 0 ? (\r\n          <p className=\"ms-muted\">No offers yetâ€”be the first!</p>\r\n        ) : (\r\n          <div style={{ display: 'grid', gap: 8 }}>\r\n            {offers.map((of) => (\r\n              <div\r\n                key={of.id}\r\n                style={{\r\n                  border: '1px solid #e2e8f0',\r\n                  borderRadius: 10,\r\n                  padding: '8px 10px',\r\n                  display: 'grid',\r\n                  gridTemplateColumns: 'minmax(160px,1fr) 120px 120px 120px auto',\r\n                  gap: 8,\r\n                  alignItems: 'center',\r\n                }}\r\n              >\r\n                <div style={{ fontWeight: 600 }}>{of?.lender?.name || 'Lender'}</div>\r\n                <div>{fmtMoney(Number(of.amount) || 0)}</div>\r\n                <div>{Number.isFinite(of.duration) ? `${of.duration} mo` : 'â€”'}</div>\r\n                <div>{Number.isFinite(of.interestRate) ? `${of.interestRate}%` : 'â€”'}</div>\r\n                <div style={{ justifySelf: 'end', display: 'flex', gap: 6 }}>\r\n                  <button\r\n                    className=\"action-btn xs primary\"\r\n                    onClick={() => acceptOffer(of)}\r\n                    disabled={!!offerWorking[of.id]}\r\n                  >\r\n                    {offerWorking[of.id] ? 'Workingâ€¦' : 'Accept'}\r\n                  </button>\r\n                </div>\r\n                {of.message ? (\r\n                  <div style={{ gridColumn: '1 / -1', color: '#334155', fontSize: 13 }}>\r\n                    <strong>Message:</strong> {of.message}\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderLoanCard = (loan, isLender, idx) => {\r\n    const key = loan?.id || loan?._id || String(idx);\r\n    const isExpanded = !!expanded[key];\r\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\r\n\r\n    const badgeClass =\r\n      (loan.status || '').toUpperCase() === 'FUNDED'\r\n        ? 'ms-badge ms-badge--ok'\r\n        : 'ms-badge ms-badge--warn';\r\n\r\n    const fundedDate =\r\n      loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\r\n\r\n    return (\r\n      <div className=\"ms-card\" key={key}>\r\n        <div className=\"ms-card-row\" style={ROW_GRID}>\r\n          <div>\r\n            <div className=\"ms-label\">{isLender ? 'Borrower' : 'Lender'}</div>\r\n            <div className=\"ms-value-strong\">{otherParty || 'Unknown'}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(loan.amount)}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Funded Date</div>\r\n            <div className=\"ms-value-strong\">{fundedDate}</div>\r\n          </div>\r\n          <div style={{ justifySelf: 'end' }}>\r\n            <span className={badgeClass}>{loan.status || 'â€”'}</span>\r\n          </div>\r\n          <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n            <button\r\n              onClick={() => setThreadLoanId(loan.id || loan._id)}\r\n              className=\"action-btn sm\"\r\n              title=\"Open conversation\"\r\n            >\r\n              ðŸ’¬ Messages\r\n            </button>\r\n            <button\r\n              onClick={() => setExpanded((m) => ({ ...m, [key]: !isExpanded }))}\r\n              className=\"action-btn sm\"\r\n              title=\"View contract\"\r\n            >\r\n              {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            {loan.status && <p className=\"mt-6\"><strong>Status:</strong> {loan.status}</p>}\r\n            <p className=\"mt-6\"><strong>Interest Rate:</strong> {typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”'}</p>\r\n            <p className=\"mt-6\"><strong>Duration:</strong> {typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”'}</p>\r\n            <p className=\"mt-6\"><strong>Next Due Date:</strong> {loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”'}</p>\r\n            <p className=\"mt-6\"><strong>Installment (this period):</strong> {fmtMoney(loan.installmentAmount)}</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /* ------------------------------- Render ------------------------------- */\r\n\r\n  if (loading) return <p className=\"ms-loading ms-container\">Loading money summary...</p>;\r\n\r\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\r\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\r\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\r\n\r\n  return (\r\n    <div className=\"ms-container\">\r\n      <h2 className=\"ms-heading\">ðŸ’µ My Money Summary</h2>\r\n\r\n      {/* Section: Open Requests */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, open: !s.open }))}\r\n          aria-expanded={openSec.open}\r\n        >\r\n          <div className=\"ms-subheading\">My Open Loan Requests</div>\r\n          <div className=\"ms-caret\">{openSec.open ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.open && (\r\n          <div className=\"ms-section-body\">\r\n            {myOpen.length === 0 ? (\r\n              <p className=\"ms-empty\">You have no open requests.</p>\r\n            ) : (\r\n              myOpen.map((req) => (\r\n                <OpenRequestRow\r\n                  key={req.id}\r\n                  req={req}\r\n                  isExpanded={!!expanded[req.id]}\r\n                  onToggle={() => toggleDetails(req)}\r\n                  actionLoading={actionLoading}\r\n                  // MARKET + Borrowing: offers block (as a React node)\r\n                  offersContent={\r\n                    req.type === 'market' && req.role === 'Borrowing'\r\n                      ? renderOffersBlock(req.id)\r\n                      : undefined\r\n                  }\r\n                  // MARKET + Lending: open OfferModal\r\n                  onMakeOffer={\r\n                    req.type === 'market' && req.role === 'Lending'\r\n                      ? () => setOfferModalLoanId(req.id)\r\n                      : undefined\r\n                  }\r\n                  // DIRECT actions\r\n                  onAcceptDirect={\r\n                    req.type === 'direct' ? () => acceptDirect(req) : undefined\r\n                  }\r\n                  onDeclineDirect={\r\n                    req.type === 'direct' ? () => declineDirect(req) : undefined\r\n                  }\r\n                />\r\n              ))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Given */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, given: !s.given }))}\r\n          aria-expanded={openSec.given}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Given (I'm the Lender)</div>\r\n          <div className=\"ms-caret\">{openSec.given ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.given && (\r\n          <div className=\"ms-section-body\">\r\n            {given.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans given yet.</p>\r\n            ) : (\r\n              given.map((loan, idx) => renderLoanCard(loan, true, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Received */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, received: !s.received }))}\r\n          aria-expanded={openSec.received}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Received (I'm the Borrower)</div>\r\n          <div className=\"ms-caret\">{openSec.received ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.received && (\r\n          <div className=\"ms-section-body\">\r\n            {received.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans received yet.</p>\r\n            ) : (\r\n              received.map((loan, idx) => renderLoanCard(loan, false, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {profileUserId && (\r\n        <UserProfileModal userId={profileUserId} onClose={() => setProfileUserId(null)} />\r\n      )}\r\n      {threadLoanId && (\r\n        <LoanThreadModal loanId={threadLoanId} onClose={() => setThreadLoanId(null)} />\r\n      )}\r\n\r\n      {/* Offer modal for Lending action */}\r\n      {offerModalLoanId && (\r\n        <OfferModal loanId={offerModalLoanId} onClose={() => setOfferModalLoanId(null)} />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}