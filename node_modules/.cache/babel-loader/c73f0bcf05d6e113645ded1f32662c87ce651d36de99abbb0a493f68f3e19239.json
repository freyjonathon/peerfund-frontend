{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/LoanDetails.jsx\",\n  _s = $RefreshSig$();\n// src/features/loans/LoanDetails.jsx\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport RepaymentForm from './RepaymentForm';\nimport ContractModal from '../../components/ContractModal';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LinkLoanBankButton from './LinkLoanBankButton';\nimport LoanFundingPanel from './LoanFundingPanel';\nimport WalletPanel from '../wallet/WalletPanel';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst LoanDetails = () => {\n  _s();\n  var _loan$borrower, _loan$loanOffers, _loan$borrower2, _loan$loanOffers2;\n  const {\n    loanId\n  } = useParams();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n  const [loan, setLoan] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [showRepaymentForm, setShowRepaymentForm] = useState(false);\n  const [selectedOffer, setSelectedOffer] = useState(null);\n  const [showContractModal, setShowContractModal] = useState(false);\n  const [hasLoanBank, setHasLoanBank] = useState(false);\n  const [expandedOffer, setExpandedOffer] = useState({});\n  const [offerForm, setOfferForm] = useState({\n    amount: '',\n    duration: '',\n    interestRate: '',\n    message: ''\n  });\n\n  // New: wallet + funding UX state (lender)\n  const [walletAvailableCents, setWalletAvailableCents] = useState(null);\n  const [showWalletPanel, setShowWalletPanel] = useState(false);\n  const token = localStorage.getItem('token');\n  const userId = token ? JSON.parse(atob(token.split('.')[1])).userId : null;\n  const handleOfferChange = e => {\n    const {\n      name,\n      value\n    } = e.target;\n    setOfferForm(prev => ({\n      ...prev,\n      [name]: value\n    }));\n  };\n  const submitOffer = async () => {\n    try {\n      const payload = {\n        amount: Number(loan.amount),\n        duration: Number(offerForm.duration),\n        interestRate: Number(offerForm.interestRate),\n        message: (offerForm.message || '').trim() || undefined\n      };\n      if (!Number.isFinite(payload.duration) || payload.duration < 1) {\n        alert('Please enter a valid duration (months).');\n        return;\n      }\n      if (!Number.isFinite(payload.interestRate) || payload.interestRate < 0) {\n        alert('Please enter a valid interest rate (APR).');\n        return;\n      }\n      const res = await fetch(`/api/loans/${loanId}/offers`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify(payload)\n      });\n      if (!res.ok) throw new Error((await res.text()) || 'Failed to submit offer');\n      const data = await res.json();\n      alert('Offer submitted!');\n      setLoan(prev => ({\n        ...prev,\n        loanOffers: [data, ...(prev.loanOffers || [])]\n      }));\n      setOfferForm(f => ({\n        ...f,\n        message: ''\n      }));\n    } catch (err) {\n      console.error('Error submitting offer:', err);\n      alert('There was a problem submitting your offer.');\n    }\n  };\n  const fetchLoanDetails = async () => {\n    try {\n      var _data$borrower;\n      const res = await fetch(`/api/loans/${loanId}`, {\n        headers: {\n          Authorization: `Bearer ${token}`\n        }\n      });\n      const data = await res.json();\n      setLoan(data);\n      setMessages(data.messages || []);\n\n      // If I am the borrower, check if I already have a loan funding payment method\n      if (((_data$borrower = data.borrower) === null || _data$borrower === void 0 ? void 0 : _data$borrower.id) === userId) {\n        try {\n          const pmRes = await fetch('/api/stripe/has-loan-payment-method', {\n            headers: {\n              Authorization: `Bearer ${token}`\n            }\n          });\n          if (pmRes.ok) {\n            const pmData = await pmRes.json();\n            setHasLoanBank(!!pmData.hasLoanPaymentMethod);\n          } else {\n            setHasLoanBank(false);\n          }\n        } catch (err) {\n          console.warn('Error checking loan payment method:', err);\n          setHasLoanBank(false);\n        }\n      }\n    } catch (err) {\n      console.error('Error fetching loan details:', err);\n    }\n  };\n  useEffect(() => {\n    fetchLoanDetails();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loanId]);\n  useEffect(() => {\n    var _ref, _loan$interestRate;\n    if (!loan) return;\n    setOfferForm({\n      amount: Number(loan.amount || 0),\n      duration: Number(loan.duration || 1),\n      interestRate: Number((_ref = (_loan$interestRate = loan.interestRate) !== null && _loan$interestRate !== void 0 ? _loan$interestRate : loan.apr) !== null && _ref !== void 0 ? _ref : 0),\n      message: ''\n    });\n  }, [loan]);\n  useEffect(() => {\n    if (searchParams.get('tab') === 'discussion' && loan) {\n      setTimeout(() => {\n        const el = document.getElementById('discussion-thread');\n        if (el) el.scrollIntoView({\n          behavior: 'smooth',\n          block: 'start'\n        });\n      }, 0);\n    }\n  }, [searchParams, loan]);\n  const handleSendMessage = async () => {\n    if (!newMessage.trim()) return;\n    try {\n      const res = await fetch(`/api/loans/${loanId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`\n        },\n        body: JSON.stringify({\n          content: newMessage\n        })\n      });\n      const data = await res.json();\n      setMessages(prev => [...prev, data]);\n      setNewMessage('');\n    } catch (err) {\n      console.error('Error sending message:', err);\n    }\n  };\n  const handleAcceptOffer = offer => {\n    setSelectedOffer(offer);\n    setShowContractModal(true);\n  };\n  const toggleOffer = offerId => setExpandedOffer(prev => ({\n    ...prev,\n    [offerId]: !prev[offerId]\n  }));\n\n  // Who am I in this context?\n  const iAmBorrower = userId === (loan === null || loan === void 0 ? void 0 : (_loan$borrower = loan.borrower) === null || _loan$borrower === void 0 ? void 0 : _loan$borrower.id);\n  // Detect if *my* offer was accepted -> I'm the lender for this loan\n  const isLenderOnThisLoan = !!(loan !== null && loan !== void 0 && (_loan$loanOffers = loan.loanOffers) !== null && _loan$loanOffers !== void 0 && _loan$loanOffers.some(o => {\n    var _o$lender;\n    return String((_o$lender = o.lender) === null || _o$lender === void 0 ? void 0 : _o$lender.id) === String(userId) && (o.status || 'OPEN').toUpperCase() === 'ACCEPTED';\n  }));\n  if (!loan) return /*#__PURE__*/_jsxDEV(\"p\", {\n    children: \"Loading loan details...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 177,\n    columnNumber: 21\n  }, this);\n  const statusUpper = (loan.status || '').toUpperCase();\n  const bannerStyle = {\n    margin: '12px 0',\n    padding: '10px 12px',\n    borderRadius: 8,\n    border: '1px solid #e2e8f0',\n    background: statusUpper === 'FUNDED' ? '#ecfdf5' : statusUpper === 'PROCESSING' ? '#eff6ff' : statusUpper === 'FAILED' ? '#fef2f2' : '#f8fafc',\n    color: '#0f172a'\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      padding: '2rem',\n      position: 'relative'\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      children: [\"Loan Request by \", ((_loan$borrower2 = loan.borrower) === null || _loan$borrower2 === void 0 ? void 0 : _loan$borrower2.name) || 'Unknown User']\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 198,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        display: 'flex',\n        gap: '12px',\n        alignItems: 'flex-start',\n        marginBottom: '1rem'\n      },\n      children: /*#__PURE__*/_jsxDEV(UserProfileModal, {\n        user: loan.borrower\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 208,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 200,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Amount:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 212,\n        columnNumber: 9\n      }, this), \" $\", loan.amount]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Duration:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 215,\n        columnNumber: 9\n      }, this), \" \", loan.duration, \" months\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 214,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Reason:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 9\n      }, this), \" \", loan.purpose]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 217,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      style: bannerStyle,\n      children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n        children: \"Status:\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 223,\n        columnNumber: 9\n      }, this), \" \", loan.status, statusUpper === 'FAILED' && /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          marginLeft: 6,\n          color: '#b91c1c'\n        },\n        children: \"(You can retry disbursement once issues are resolved.)\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 225,\n        columnNumber: 11\n      }, this), statusUpper === 'PROCESSING' && /*#__PURE__*/_jsxDEV(\"span\", {\n        style: {\n          marginLeft: 6,\n          color: '#334155'\n        },\n        children: \"Transfer in progress \\u2014 refresh shortly to see the final state.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 230,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 222,\n      columnNumber: 7\n    }, this), isLenderOnThisLoan && ['ACCEPTED', 'PROCESSING'].includes(statusUpper) && /*#__PURE__*/_jsxDEV(LoanFundingPanel, {\n      loan: loan,\n      walletAvailableCents: walletAvailableCents,\n      onWalletSynced: cents => setWalletAvailableCents(cents),\n      onNeedMoreFunds: () => setShowWalletPanel(true),\n      onFunded: async () => {\n        // after funding completes, refresh the loan\n        await fetchLoanDetails();\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 238,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 250,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"h3\", {\n      children: \"Offers\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }, this), ((_loan$loanOffers2 = loan.loanOffers) === null || _loan$loanOffers2 === void 0 ? void 0 : _loan$loanOffers2.length) > 0 ? loan.loanOffers.map(offer => {\n      var _offer$lender;\n      const isOpen = !!expandedOffer[offer.id];\n      const statusLabel = (offer.status || '').toUpperCase() === 'ACCEPTED' ? 'Accepted' : 'Pending';\n      const badgeStyle = statusLabel === 'Accepted' ? {\n        background: '#dcfce7',\n        color: '#166534',\n        borderColor: '#86efac'\n      } : {\n        background: '#fef3c7',\n        color: '#92400e',\n        borderColor: '#fde68a'\n      };\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          border: '1px solid #e2e8f0',\n          borderRadius: 12,\n          background: '#fff',\n          marginBottom: 12,\n          overflow: 'hidden'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => toggleOffer(offer.id),\n          \"aria-expanded\": isOpen,\n          style: {\n            width: '100%',\n            textAlign: 'left',\n            background: '#f8fafc',\n            border: 0,\n            padding: '12px 14px',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'space-between',\n            cursor: 'pointer'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              alignItems: 'center',\n              gap: 10\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                width: 8,\n                height: 8,\n                borderRadius: 999,\n                background: '#6366f1',\n                display: 'inline-block'\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 301,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                fontWeight: 700,\n                color: '#0f172a'\n              },\n              children: [\"Offer from \", ((_offer$lender = offer.lender) === null || _offer$lender === void 0 ? void 0 : _offer$lender.name) || 'Unknown']\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 310,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 300,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              display: 'flex',\n              gap: 12,\n              alignItems: 'center',\n              color: '#334155',\n              fontSize: 14\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"span\", {\n              children: [\"$\", Number(offer.amount || 0).toFixed(2)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 326,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [offer.interestRate, \"%\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 327,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              children: [offer.duration, \" mo\"]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 328,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                borderRadius: 999,\n                padding: '2px 8px',\n                fontSize: 12,\n                fontWeight: 700,\n                border: '1px solid',\n                ...badgeStyle\n              },\n              children: statusLabel\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 329,\n              columnNumber: 19\n            }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n              style: {\n                fontSize: 18,\n                color: '#64748b'\n              },\n              children: isOpen ? '▾' : '▸'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 341,\n              columnNumber: 19\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 317,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 285,\n          columnNumber: 15\n        }, this), isOpen && /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            padding: '12px 14px 14px',\n            borderTop: '1px solid #e2e8f0'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"p\", {\n            children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"Message:\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 356,\n              columnNumber: 21\n            }, this), \" \", offer.message || '—']\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 355,\n            columnNumber: 19\n          }, this), statusUpper === 'OPEN' && iAmBorrower && /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => handleAcceptOffer(offer),\n            style: {\n              background: '#4f46e5',\n              border: '1px solid #4f46e5',\n              color: '#fff',\n              fontWeight: 700,\n              padding: '8px 12px',\n              borderRadius: 10,\n              cursor: 'pointer'\n            },\n            children: \"Accept Offer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 21\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 349,\n          columnNumber: 17\n        }, this)]\n      }, offer.id, true, {\n        fileName: _jsxFileName,\n        lineNumber: 274,\n        columnNumber: 13\n      }, this);\n    }) : /*#__PURE__*/_jsxDEV(\"p\", {\n      children: \"No offers yet.\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 381,\n      columnNumber: 9\n    }, this), statusUpper === 'ACCEPTED' && iAmBorrower && !hasLoanBank && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '2rem',\n        padding: '1rem',\n        border: '1px solid #e2e8f0',\n        borderRadius: 10,\n        background: '#f8fafc'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        style: {\n          marginTop: 0\n        },\n        children: \"Before we disburse your loan\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 395,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: '#334155'\n        },\n        children: \"You must link a bank account in order to receive your loan funds.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 396,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(LinkLoanBankButton, {\n        onLinked: () => setHasLoanBank(true)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 399,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 386,\n      columnNumber: 9\n    }, this), statusUpper === 'FUNDED' && iAmBorrower && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        marginTop: '2rem'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Repayments\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => setShowRepaymentForm(true),\n        children: \"Make a Payment\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 407,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n        onClick: () => navigate(`/loan/${loan.id}/repayments`),\n        children: \"View Repayment Tracker\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 410,\n        columnNumber: 11\n      }, this), showRepaymentForm && /*#__PURE__*/_jsxDEV(RepaymentForm, {\n        loanId: loan.id\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 413,\n        columnNumber: 33\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 417,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"discussion-thread\",\n      style: {\n        marginTop: '1.5rem'\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        children: \"Public Discussion\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 421,\n        columnNumber: 9\n      }, this), messages.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"No messages yet. Start the conversation!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 423,\n        columnNumber: 11\n      }, this) : messages.map(m => {\n        var _m$user;\n        return /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            borderTop: '1px solid #e5e7eb',\n            padding: '8px 0'\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: [((_m$user = m.user) === null || _m$user === void 0 ? void 0 : _m$user.name) || 'User', \":\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 433,\n            columnNumber: 15\n          }, this), \" \", m.content]\n        }, m.id, true, {\n          fileName: _jsxFileName,\n          lineNumber: 426,\n          columnNumber: 13\n        }, this);\n      }), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 8,\n          marginTop: 8\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"textarea\", {\n          placeholder: \"Write your message\\u2026\",\n          value: newMessage,\n          onChange: e => setNewMessage(e.target.value),\n          style: {\n            flex: 1,\n            padding: 8,\n            border: '1px solid #e5e7eb',\n            borderRadius: 8\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 438,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: handleSendMessage,\n          style: {\n            background: '#4f46e5',\n            border: '1px solid #4f46e5',\n            color: '#fff',\n            fontWeight: 700,\n            padding: '8px 12px',\n            borderRadius: 10,\n            cursor: 'pointer',\n            height: 40,\n            alignSelf: 'center'\n          },\n          children: \"Send\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 449,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 437,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 420,\n      columnNumber: 7\n    }, this), showContractModal && selectedOffer && /*#__PURE__*/_jsxDEV(ContractModal, {\n      offer: selectedOffer,\n      borrower: loan.borrower,\n      onConfirm: async () => {\n        try {\n          const res = await fetch(`/api/loans/offers/${selectedOffer.id}/accept`, {\n            method: 'POST',\n            headers: {\n              'Content-Type': 'application/json',\n              Authorization: `Bearer ${token}`\n            }\n          });\n          if (!res.ok) {\n            const errorText = await res.text();\n            alert(`❌ ${errorText || 'Something went wrong'}`);\n            return;\n          }\n          await res.json();\n          alert('✅ Loan contract created and saved!');\n          setShowContractModal(false);\n          navigate('/dashboard');\n        } catch (err) {\n          console.error('❌ Error finalizing contract:', err);\n          alert('Network or server error occurred.');\n        }\n      },\n      onCancel: () => setShowContractModal(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 469,\n      columnNumber: 9\n    }, this), showWalletPanel && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        position: 'fixed',\n        inset: 0,\n        background: 'rgba(15, 23, 42, 0.45)',\n        display: 'flex',\n        alignItems: 'center',\n        justifyContent: 'center',\n        zIndex: 40\n      },\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          background: '#ffffff',\n          borderRadius: 12,\n          padding: 16,\n          minWidth: 320,\n          maxWidth: 420,\n          boxShadow: '0 10px 15px -3px rgba(15, 23, 42, 0.2), 0 4px 6px -2px rgba(15, 23, 42, 0.1)'\n        },\n        children: /*#__PURE__*/_jsxDEV(WalletPanel, {\n          onClose: () => setShowWalletPanel(false),\n          onBalanceUpdated: cents => {\n            setWalletAvailableCents(cents);\n            setShowWalletPanel(false);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 528,\n          columnNumber: 13\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 517,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 506,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 197,\n    columnNumber: 5\n  }, this);\n};\n_s(LoanDetails, \"yNC6SqGGhVsdAVr/zK7P1S9SyAU=\", false, function () {\n  return [useParams, useNavigate, useSearchParams];\n});\n_c = LoanDetails;\nexport default LoanDetails;\nvar _c;\n$RefreshReg$(_c, \"LoanDetails\");","map":{"version":3,"names":["React","useState","useEffect","useParams","useNavigate","useSearchParams","RepaymentForm","ContractModal","UserProfileModal","LinkLoanBankButton","LoanFundingPanel","WalletPanel","jsxDEV","_jsxDEV","LoanDetails","_s","_loan$borrower","_loan$loanOffers","_loan$borrower2","_loan$loanOffers2","loanId","navigate","searchParams","loan","setLoan","messages","setMessages","newMessage","setNewMessage","showRepaymentForm","setShowRepaymentForm","selectedOffer","setSelectedOffer","showContractModal","setShowContractModal","hasLoanBank","setHasLoanBank","expandedOffer","setExpandedOffer","offerForm","setOfferForm","amount","duration","interestRate","message","walletAvailableCents","setWalletAvailableCents","showWalletPanel","setShowWalletPanel","token","localStorage","getItem","userId","JSON","parse","atob","split","handleOfferChange","e","name","value","target","prev","submitOffer","payload","Number","trim","undefined","isFinite","alert","res","fetch","method","headers","Authorization","body","stringify","ok","Error","text","data","json","loanOffers","f","err","console","error","fetchLoanDetails","_data$borrower","borrower","id","pmRes","pmData","hasLoanPaymentMethod","warn","_ref","_loan$interestRate","apr","get","setTimeout","el","document","getElementById","scrollIntoView","behavior","block","handleSendMessage","content","handleAcceptOffer","offer","toggleOffer","offerId","iAmBorrower","isLenderOnThisLoan","some","o","_o$lender","String","lender","status","toUpperCase","children","fileName","_jsxFileName","lineNumber","columnNumber","statusUpper","bannerStyle","margin","padding","borderRadius","border","background","color","style","position","display","gap","alignItems","marginBottom","user","purpose","marginLeft","includes","onWalletSynced","cents","onNeedMoreFunds","onFunded","length","map","_offer$lender","isOpen","statusLabel","badgeStyle","borderColor","overflow","onClick","width","textAlign","justifyContent","cursor","height","fontWeight","fontSize","toFixed","borderTop","marginTop","onLinked","m","_m$user","placeholder","onChange","flex","alignSelf","onConfirm","errorText","onCancel","inset","zIndex","minWidth","maxWidth","boxShadow","onClose","onBalanceUpdated","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/LoanDetails.jsx"],"sourcesContent":["// src/features/loans/LoanDetails.jsx\nimport React, { useState, useEffect } from 'react';\nimport { useParams, useNavigate, useSearchParams } from 'react-router-dom';\nimport RepaymentForm from './RepaymentForm';\nimport ContractModal from '../../components/ContractModal';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LinkLoanBankButton from './LinkLoanBankButton';\nimport LoanFundingPanel from './LoanFundingPanel';\nimport WalletPanel from '../wallet/WalletPanel';\n\nconst LoanDetails = () => {\n  const { loanId } = useParams();\n  const navigate = useNavigate();\n  const [searchParams] = useSearchParams();\n\n  const [loan, setLoan] = useState(null);\n  const [messages, setMessages] = useState([]);\n  const [newMessage, setNewMessage] = useState('');\n  const [showRepaymentForm, setShowRepaymentForm] = useState(false);\n  const [selectedOffer, setSelectedOffer] = useState(null);\n  const [showContractModal, setShowContractModal] = useState(false);\n  const [hasLoanBank, setHasLoanBank] = useState(false);\n\n  const [expandedOffer, setExpandedOffer] = useState({});\n  const [offerForm, setOfferForm] = useState({\n    amount: '',\n    duration: '',\n    interestRate: '',\n    message: '',\n  });\n\n  // New: wallet + funding UX state (lender)\n  const [walletAvailableCents, setWalletAvailableCents] = useState(null);\n  const [showWalletPanel, setShowWalletPanel] = useState(false);\n\n  const token = localStorage.getItem('token');\n  const userId = token ? JSON.parse(atob(token.split('.')[1])).userId : null;\n\n  const handleOfferChange = (e) => {\n    const { name, value } = e.target;\n    setOfferForm((prev) => ({ ...prev, [name]: value }));\n  };\n\n  const submitOffer = async () => {\n    try {\n      const payload = {\n        amount: Number(loan.amount),\n        duration: Number(offerForm.duration),\n        interestRate: Number(offerForm.interestRate),\n        message: (offerForm.message || '').trim() || undefined,\n      };\n\n      if (!Number.isFinite(payload.duration) || payload.duration < 1) {\n        alert('Please enter a valid duration (months).');\n        return;\n      }\n      if (!Number.isFinite(payload.interestRate) || payload.interestRate < 0) {\n        alert('Please enter a valid interest rate (APR).');\n        return;\n      }\n\n      const res = await fetch(`/api/loans/${loanId}/offers`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify(payload),\n      });\n\n      if (!res.ok) throw new Error((await res.text()) || 'Failed to submit offer');\n      const data = await res.json();\n      alert('Offer submitted!');\n      setLoan((prev) => ({\n        ...prev,\n        loanOffers: [data, ...(prev.loanOffers || [])],\n      }));\n      setOfferForm((f) => ({ ...f, message: '' }));\n    } catch (err) {\n      console.error('Error submitting offer:', err);\n      alert('There was a problem submitting your offer.');\n    }\n  };\n\n  const fetchLoanDetails = async () => {\n    try {\n      const res = await fetch(`/api/loans/${loanId}`, {\n        headers: { Authorization: `Bearer ${token}` },\n      });\n      const data = await res.json();\n      setLoan(data);\n      setMessages(data.messages || []);\n\n      // If I am the borrower, check if I already have a loan funding payment method\n      if (data.borrower?.id === userId) {\n        try {\n          const pmRes = await fetch('/api/stripe/has-loan-payment-method', {\n            headers: { Authorization: `Bearer ${token}` },\n          });\n          if (pmRes.ok) {\n            const pmData = await pmRes.json();\n            setHasLoanBank(!!pmData.hasLoanPaymentMethod);\n          } else {\n            setHasLoanBank(false);\n          }\n        } catch (err) {\n          console.warn('Error checking loan payment method:', err);\n          setHasLoanBank(false);\n        }\n      }\n    } catch (err) {\n      console.error('Error fetching loan details:', err);\n    }\n  };\n\n  useEffect(() => {\n    fetchLoanDetails();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [loanId]);\n\n  useEffect(() => {\n    if (!loan) return;\n    setOfferForm({\n      amount: Number(loan.amount || 0),\n      duration: Number(loan.duration || 1),\n      interestRate: Number(loan.interestRate ?? loan.apr ?? 0),\n      message: '',\n    });\n  }, [loan]);\n\n  useEffect(() => {\n    if (searchParams.get('tab') === 'discussion' && loan) {\n      setTimeout(() => {\n        const el = document.getElementById('discussion-thread');\n        if (el) el.scrollIntoView({ behavior: 'smooth', block: 'start' });\n      }, 0);\n    }\n  }, [searchParams, loan]);\n\n  const handleSendMessage = async () => {\n    if (!newMessage.trim()) return;\n    try {\n      const res = await fetch(`/api/loans/${loanId}/messages`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          Authorization: `Bearer ${token}`,\n        },\n        body: JSON.stringify({ content: newMessage }),\n      });\n      const data = await res.json();\n      setMessages((prev) => [...prev, data]);\n      setNewMessage('');\n    } catch (err) {\n      console.error('Error sending message:', err);\n    }\n  };\n\n  const handleAcceptOffer = (offer) => {\n    setSelectedOffer(offer);\n    setShowContractModal(true);\n  };\n\n  const toggleOffer = (offerId) =>\n    setExpandedOffer((prev) => ({ ...prev, [offerId]: !prev[offerId] }));\n\n  // Who am I in this context?\n  const iAmBorrower = userId === loan?.borrower?.id;\n  // Detect if *my* offer was accepted -> I'm the lender for this loan\n  const isLenderOnThisLoan =\n    !!loan?.loanOffers?.some(\n      (o) =>\n        String(o.lender?.id) === String(userId) &&\n        (o.status || 'OPEN').toUpperCase() === 'ACCEPTED'\n    );\n\n  if (!loan) return <p>Loading loan details...</p>;\n\n  const statusUpper = (loan.status || '').toUpperCase();\n  const bannerStyle = {\n    margin: '12px 0',\n    padding: '10px 12px',\n    borderRadius: 8,\n    border: '1px solid #e2e8f0',\n    background:\n      statusUpper === 'FUNDED'\n        ? '#ecfdf5'\n        : statusUpper === 'PROCESSING'\n        ? '#eff6ff'\n        : statusUpper === 'FAILED'\n        ? '#fef2f2'\n        : '#f8fafc',\n    color: '#0f172a',\n  };\n\n  return (\n    <div style={{ padding: '2rem', position: 'relative' }}>\n      <h2>Loan Request by {loan.borrower?.name || 'Unknown User'}</h2>\n\n      <div\n        style={{\n          display: 'flex',\n          gap: '12px',\n          alignItems: 'flex-start',\n          marginBottom: '1rem',\n        }}\n      >\n        <UserProfileModal user={loan.borrower} />\n      </div>\n\n      <p>\n        <strong>Amount:</strong> ${loan.amount}\n      </p>\n      <p>\n        <strong>Duration:</strong> {loan.duration} months\n      </p>\n      <p>\n        <strong>Reason:</strong> {loan.purpose}\n      </p>\n\n      {/* Status banner */}\n      <div style={bannerStyle}>\n        <strong>Status:</strong> {loan.status}\n        {statusUpper === 'FAILED' && (\n          <span style={{ marginLeft: 6, color: '#b91c1c' }}>\n            (You can retry disbursement once issues are resolved.)\n          </span>\n        )}\n        {statusUpper === 'PROCESSING' && (\n          <span style={{ marginLeft: 6, color: '#334155' }}>\n            Transfer in progress — refresh shortly to see the final state.\n          </span>\n        )}\n      </div>\n\n      {/* Lender funding panel, when borrower has accepted our offer */}\n      {isLenderOnThisLoan && ['ACCEPTED', 'PROCESSING'].includes(statusUpper) && (\n        <LoanFundingPanel\n          loan={loan}\n          walletAvailableCents={walletAvailableCents}\n          onWalletSynced={(cents) => setWalletAvailableCents(cents)}\n          onNeedMoreFunds={() => setShowWalletPanel(true)}\n          onFunded={async () => {\n            // after funding completes, refresh the loan\n            await fetchLoanDetails();\n          }}\n        />\n      )}\n\n      <hr />\n      <h3>Offers</h3>\n\n      {loan.loanOffers?.length > 0 ? (\n        loan.loanOffers.map((offer) => {\n          const isOpen = !!expandedOffer[offer.id];\n          const statusLabel =\n            (offer.status || '').toUpperCase() === 'ACCEPTED'\n              ? 'Accepted'\n              : 'Pending';\n          const badgeStyle =\n            statusLabel === 'Accepted'\n              ? {\n                  background: '#dcfce7',\n                  color: '#166534',\n                  borderColor: '#86efac',\n                }\n              : {\n                  background: '#fef3c7',\n                  color: '#92400e',\n                  borderColor: '#fde68a',\n                };\n\n          return (\n            <div\n              key={offer.id}\n              style={{\n                border: '1px solid #e2e8f0',\n                borderRadius: 12,\n                background: '#fff',\n                marginBottom: 12,\n                overflow: 'hidden',\n              }}\n            >\n              {/* Header row */}\n              <button\n                onClick={() => toggleOffer(offer.id)}\n                aria-expanded={isOpen}\n                style={{\n                  width: '100%',\n                  textAlign: 'left',\n                  background: '#f8fafc',\n                  border: 0,\n                  padding: '12px 14px',\n                  display: 'flex',\n                  alignItems: 'center',\n                  justifyContent: 'space-between',\n                  cursor: 'pointer',\n                }}\n              >\n                <div style={{ display: 'flex', alignItems: 'center', gap: 10 }}>\n                  <span\n                    style={{\n                      width: 8,\n                      height: 8,\n                      borderRadius: 999,\n                      background: '#6366f1',\n                      display: 'inline-block',\n                    }}\n                  />\n                  <span\n                    style={{ fontWeight: 700, color: '#0f172a' }}\n                  >\n                    Offer from {offer.lender?.name || 'Unknown'}\n                  </span>\n                </div>\n\n                <div\n                  style={{\n                    display: 'flex',\n                    gap: 12,\n                    alignItems: 'center',\n                    color: '#334155',\n                    fontSize: 14,\n                  }}\n                >\n                  <span>${Number(offer.amount || 0).toFixed(2)}</span>\n                  <span>{offer.interestRate}%</span>\n                  <span>{offer.duration} mo</span>\n                  <span\n                    style={{\n                      borderRadius: 999,\n                      padding: '2px 8px',\n                      fontSize: 12,\n                      fontWeight: 700,\n                      border: '1px solid',\n                      ...badgeStyle,\n                    }}\n                  >\n                    {statusLabel}\n                  </span>\n                  <span style={{ fontSize: 18, color: '#64748b' }}>\n                    {isOpen ? '▾' : '▸'}\n                  </span>\n                </div>\n              </button>\n\n              {/* Body */}\n              {isOpen && (\n                <div\n                  style={{\n                    padding: '12px 14px 14px',\n                    borderTop: '1px solid #e2e8f0',\n                  }}\n                >\n                  <p>\n                    <strong>Message:</strong> {offer.message || '—'}\n                  </p>\n\n                  {statusUpper === 'OPEN' && iAmBorrower && (\n                    <button\n                      onClick={() => handleAcceptOffer(offer)}\n                      style={{\n                        background: '#4f46e5',\n                        border: '1px solid #4f46e5',\n                        color: '#fff',\n                        fontWeight: 700,\n                        padding: '8px 12px',\n                        borderRadius: 10,\n                        cursor: 'pointer',\n                      }}\n                    >\n                      Accept Offer\n                    </button>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })\n      ) : (\n        <p>No offers yet.</p>\n      )}\n\n      {/* Borrower: link bank for receiving funds */}\n      {statusUpper === 'ACCEPTED' && iAmBorrower && !hasLoanBank && (\n        <div\n          style={{\n            marginTop: '2rem',\n            padding: '1rem',\n            border: '1px solid #e2e8f0',\n            borderRadius: 10,\n            background: '#f8fafc',\n          }}\n        >\n          <h3 style={{ marginTop: 0 }}>Before we disburse your loan…</h3>\n          <p style={{ color: '#334155' }}>\n            You must link a bank account in order to receive your loan funds.\n          </p>\n          <LinkLoanBankButton onLinked={() => setHasLoanBank(true)} />\n        </div>\n      )}\n\n      {/* Repayment section (borrower) */}\n      {statusUpper === 'FUNDED' && iAmBorrower && (\n        <div style={{ marginTop: '2rem' }}>\n          <h3>Repayments</h3>\n          <button onClick={() => setShowRepaymentForm(true)}>\n            Make a Payment\n          </button>\n          <button onClick={() => navigate(`/loan/${loan.id}/repayments`)}>\n            View Repayment Tracker\n          </button>\n          {showRepaymentForm && <RepaymentForm loanId={loan.id} />}\n        </div>\n      )}\n\n      <hr />\n\n      {/* Discussion thread */}\n      <div id=\"discussion-thread\" style={{ marginTop: '1.5rem' }}>\n        <h3>Public Discussion</h3>\n        {messages.length === 0 ? (\n          <p>No messages yet. Start the conversation!</p>\n        ) : (\n          messages.map((m) => (\n            <div\n              key={m.id}\n              style={{\n                borderTop: '1px solid #e5e7eb',\n                padding: '8px 0',\n              }}\n            >\n              <strong>{m.user?.name || 'User'}:</strong> {m.content}\n            </div>\n          ))\n        )}\n        <div style={{ display: 'flex', gap: 8, marginTop: 8 }}>\n          <textarea\n            placeholder=\"Write your message…\"\n            value={newMessage}\n            onChange={(e) => setNewMessage(e.target.value)}\n            style={{\n              flex: 1,\n              padding: 8,\n              border: '1px solid #e5e7eb',\n              borderRadius: 8,\n            }}\n          />\n          <button\n            onClick={handleSendMessage}\n            style={{\n              background: '#4f46e5',\n              border: '1px solid #4f46e5',\n              color: '#fff',\n              fontWeight: 700,\n              padding: '8px 12px',\n              borderRadius: 10,\n              cursor: 'pointer',\n              height: 40,\n              alignSelf: 'center',\n            }}\n          >\n            Send\n          </button>\n        </div>\n      </div>\n\n      {showContractModal && selectedOffer && (\n        <ContractModal\n          offer={selectedOffer}\n          borrower={loan.borrower}\n          onConfirm={async () => {\n            try {\n              const res = await fetch(\n                `/api/loans/offers/${selectedOffer.id}/accept`,\n                {\n                  method: 'POST',\n                  headers: {\n                    'Content-Type': 'application/json',\n                    Authorization: `Bearer ${token}`,\n                  },\n                }\n              );\n\n              if (!res.ok) {\n                const errorText = await res.text();\n                alert(`❌ ${errorText || 'Something went wrong'}`);\n                return;\n              }\n\n              await res.json();\n              alert('✅ Loan contract created and saved!');\n              setShowContractModal(false);\n              navigate('/dashboard');\n            } catch (err) {\n              console.error('❌ Error finalizing contract:', err);\n              alert('Network or server error occurred.');\n            }\n          }}\n          onCancel={() => setShowContractModal(false)}\n        />\n      )}\n\n      {/* Wallet modal for adding funds (lender) */}\n      {showWalletPanel && (\n        <div\n          style={{\n            position: 'fixed',\n            inset: 0,\n            background: 'rgba(15, 23, 42, 0.45)',\n            display: 'flex',\n            alignItems: 'center',\n            justifyContent: 'center',\n            zIndex: 40,\n          }}\n        >\n          <div\n            style={{\n              background: '#ffffff',\n              borderRadius: 12,\n              padding: 16,\n              minWidth: 320,\n              maxWidth: 420,\n              boxShadow:\n                '0 10px 15px -3px rgba(15, 23, 42, 0.2), 0 4px 6px -2px rgba(15, 23, 42, 0.1)',\n            }}\n          >\n            <WalletPanel\n              onClose={() => setShowWalletPanel(false)}\n              onBalanceUpdated={(cents) => {\n                setWalletAvailableCents(cents);\n                setShowWalletPanel(false);\n              }}\n            />\n          </div>\n        </div>\n      )}\n    </div>\n  );\n};\n\nexport default LoanDetails;\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}