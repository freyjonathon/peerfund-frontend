{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx\",\n  _s = $RefreshSig$();\n// src/features/money/MoneySummary.jsx\nimport React, { useEffect, useState, useCallback } from 'react';\nimport './MoneySummary.css';\nimport LoanThreadModal from '../loans/LoanThreadModal';\nimport OfferModal from '../../components/OfferModal';\nimport RepaymentButton from '../loans/RepaymentButton';\n\n/* ----------------------- helpers ----------------------- */\n\n// decode JWT for current user id\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction getCurrentUserId() {\n  const t = localStorage.getItem('token');\n  if (!t) return null;\n  try {\n    var _payload$userId;\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\n    return (_payload$userId = payload === null || payload === void 0 ? void 0 : payload.userId) !== null && _payload$userId !== void 0 ? _payload$userId : null;\n  } catch {\n    return null;\n  }\n}\nconst fmtMoney = n => typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\n\n// compact row layout\nconst ROW_GRID = {\n  display: 'grid',\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\n  alignItems: 'center',\n  gap: 10\n};\nasync function authFetch(url, options = {}) {\n  const token = localStorage.getItem('token');\n  const headers = {\n    ...(options.headers || {}),\n    ...(token ? {\n      Authorization: `Bearer ${token}`\n    } : {})\n  };\n  const res = await fetch(url, {\n    ...options,\n    headers,\n    credentials: 'include'\n  });\n  if (res.status === 401) {\n    try {\n      console.warn('401 on', url, await res.text());\n    } catch {}\n    window.location.assign('/login');\n    throw new Error('Unauthorized');\n  }\n  return res;\n}\nfunction isLoanPaidOff(loan) {\n  const s = (loan.status || '').toUpperCase();\n\n  // Explicit status flags\n  if (['PAID_OFF', 'COMPLETED', 'CLOSED'].includes(s)) return true;\n\n  // Remaining principal flags\n  if (typeof loan.remainingPrincipal === 'number' && loan.remainingPrincipal <= 0) {\n    return true;\n  }\n  if (typeof loan.remainingPrincipalCents === 'number' && loan.remainingPrincipalCents <= 0) {\n    return true;\n  }\n\n  // Frontend-only inference (no next due date + no installment amount)\n  const hasNextDue = !!loan.nextDueDate;\n  const installment = typeof loan.installmentAmount === 'number' ? loan.installmentAmount : null;\n  if (!hasNextDue && (installment === null || installment <= 0)) {\n    return true;\n  }\n  return false;\n}\nfunction sortLoansWithPaidOffLast(list) {\n  return [...list].sort((a, b) => {\n    const aDone = isLoanPaidOff(a);\n    const bDone = isLoanPaidOff(b);\n    if (aDone === bDone) return 0;\n    return aDone ? 1 : -1; // active first, paid-off last\n  });\n}\n\n/* ------------------------- Small inline modal ------------------------- */\n\nfunction LinkBankFirstModal({\n  open,\n  onClose\n}) {\n  if (!open) return null;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    role: \"dialog\",\n    \"aria-modal\": \"true\",\n    style: {\n      position: 'fixed',\n      inset: 0,\n      background: 'rgba(0,0,0,0.35)',\n      display: 'flex',\n      alignItems: 'center',\n      justifyContent: 'center',\n      padding: 16,\n      zIndex: 1000\n    },\n    onClick: onClose,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      onClick: e => e.stopPropagation(),\n      style: {\n        width: '100%',\n        maxWidth: 520,\n        background: '#fff',\n        border: '1px solid #e5e7eb',\n        borderRadius: 12,\n        boxShadow: '0 10px 30px rgba(0,0,0,0.12)',\n        padding: 20\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n        style: {\n          margin: 0\n        },\n        children: \"Add a bank to receive funds\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 124,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        style: {\n          color: '#334155',\n          marginTop: 8\n        },\n        children: \"Before you can accept an offer, please link a bank account for loan disbursement on the Payment Method page.\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          gap: 8,\n          justifyContent: 'flex-end',\n          marginTop: 14\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onClose,\n          children: \"Close\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 137,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm primary\",\n          onClick: () => {\n            window.location.assign('/payment-method');\n          },\n          children: \"Go to Payment Method\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 140,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 129,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 7\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 97,\n    columnNumber: 5\n  }, this);\n}\n\n/* ------------------------- Open request row ------------------------- */\n_c = LinkBankFirstModal;\nfunction OpenRequestRow({\n  req,\n  isExpanded,\n  onToggle,\n  actionLoading,\n  offersContent,\n  // React node for market/borrower offers list\n  onMakeOffer,\n  // fn for market/lender to open OfferModal\n  onAcceptDirect,\n  // fn for direct approve\n  onDeclineDirect // fn for direct decline\n}) {\n  var _req$status;\n  const isMarket = req.type === 'market';\n  const isBorrowing = req.role === 'Borrowing';\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-card\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card-row\",\n      style: ROW_GRID,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Counterparty\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 174,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: [req.counterpartyName || 'Unknown', /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              marginLeft: 8,\n              color: '#64748b',\n              fontWeight: 600\n            },\n            children: [\"\\u2022 \", req.role]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 177,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 175,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 173,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Amount\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: fmtMoney(req.amount)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 185,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 183,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          justifySelf: 'end'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"ms-badge ms-badge--warn\",\n          children: \"Open\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 189,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 188,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          justifySelf: 'end',\n          display: 'flex',\n          gap: 8\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onToggle,\n          title: \"View request\",\n          children: isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 193,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 192,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 172,\n      columnNumber: 7\n    }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-details\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Status:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 207,\n          columnNumber: 13\n        }, this), \" \", (_req$status = req.status) !== null && _req$status !== void 0 ? _req$status : 'OPEN']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 206,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Interest Rate:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 210,\n          columnNumber: 13\n        }, this), ' ', Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Duration:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 13\n        }, this), ' ', Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 11\n      }, this), req.purpose ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Reason:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 219,\n          columnNumber: 15\n        }, this), \" \", req.purpose]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 13\n      }, this) : null, isMarket && isBorrowing && offersContent, isMarket && !isBorrowing && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-8\",\n        style: {\n          display: 'flex',\n          justifyContent: 'flex-end'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm primary\",\n          onClick: onMakeOffer,\n          children: \"\\uD83D\\uDCB5 Make Offer\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 232,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 228,\n        columnNumber: 13\n      }, this), !isMarket && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-8\",\n        style: {\n          display: 'flex',\n          gap: 8,\n          justifyContent: 'flex-end'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm primary\",\n          onClick: onAcceptDirect,\n          disabled: !!actionLoading[req.id],\n          children: actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 248,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onDeclineDirect,\n          disabled: !!actionLoading[req.id],\n          children: actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 255,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 240,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 205,\n      columnNumber: 9\n    }, this)]\n  }, req.id, true, {\n    fileName: _jsxFileName,\n    lineNumber: 170,\n    columnNumber: 5\n  }, this);\n}\n\n/* -------------------------------- Parent -------------------------------- */\n_c2 = OpenRequestRow;\nexport default function MoneySummary() {\n  _s();\n  const [summary, setSummary] = useState({\n    loansGiven: [],\n    loansReceived: [],\n    myOpenRequests: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [expanded, setExpanded] = useState({});\n  const [openSec, setOpenSec] = useState({\n    open: true,\n    given: true,\n    received: true\n  });\n  const [actionLoading, setActionLoading] = useState({});\n  const [threadLoanId, setThreadLoanId] = useState(null);\n\n  // marketplace offers cache per loanId\n  const [offersByLoanId, setOffersByLoanId] = useState({});\n  const [offersLoading, setOffersLoading] = useState({});\n  const [offerWorking, setOfferWorking] = useState({});\n  const [offerModalLoanId, setOfferModalLoanId] = useState(null);\n\n  // cached: does borrower have a payment method for loan funding\n  const [hasLoanPM, setHasLoanPM] = useState(null); // null=unknown, true/false known\n  const [showLinkModal, setShowLinkModal] = useState(false);\n  const checkHasLoanPaymentMethod = useCallback(async () => {\n    if (hasLoanPM !== null) return hasLoanPM;\n    try {\n      const r = await authFetch('/api/stripe/has-loan-payment-method');\n      if (!r.ok) throw new Error('has-loan-payment-method failed');\n      const d = await r.json();\n      const val = !!(d !== null && d !== void 0 && d.hasLoanPaymentMethod);\n      setHasLoanPM(val);\n      return val;\n    } catch {\n      setHasLoanPM(false);\n      return false;\n    }\n  }, [hasLoanPM]);\n\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\n\n  const fetchMarketOpenRequests = useCallback(async () => {\n    const me = getCurrentUserId();\n    if (!me) return [];\n    const rows = [];\n\n    // (A) Requests where I am the LENDER (Iâ€™ve made an offer)\n    try {\n      const r = await authFetch('/api/loans/offers/mine');\n      if (r.ok) {\n        const data = await r.json();\n        const items = Array.isArray(data === null || data === void 0 ? void 0 : data.items) ? data.items : Array.isArray(data) ? data : [];\n        for (const it of items) {\n          var _it$myOffer$interestR, _it$myOffer, _it$borrower, _it$borrower2, _it$borrower3;\n          rows.push({\n            type: 'market',\n            id: it.id,\n            // loanRequest id\n            amount: Number(it.amount),\n            duration: Number(it.duration),\n            interestRate: Number((_it$myOffer$interestR = (_it$myOffer = it.myOffer) === null || _it$myOffer === void 0 ? void 0 : _it$myOffer.interestRate) !== null && _it$myOffer$interestR !== void 0 ? _it$myOffer$interestR : it.interestRate),\n            purpose: it.purpose || '',\n            createdAt: it.createdAt || null,\n            borrowerId: (_it$borrower = it.borrower) === null || _it$borrower === void 0 ? void 0 : _it$borrower.id,\n            borrowerName: ((_it$borrower2 = it.borrower) === null || _it$borrower2 === void 0 ? void 0 : _it$borrower2.name) || 'Borrower',\n            counterpartyName: ((_it$borrower3 = it.borrower) === null || _it$borrower3 === void 0 ? void 0 : _it$borrower3.name) || 'Borrower',\n            role: 'Lending',\n            status: it.status || 'OPEN',\n            myOffer: it.myOffer ? {\n              id: it.myOffer.id,\n              amount: Number(it.myOffer.amount),\n              duration: Number(it.myOffer.duration),\n              interestRate: Number(it.myOffer.interestRate),\n              createdAt: it.myOffer.createdAt\n            } : null\n          });\n        }\n      }\n    } catch {\n      /* ignore */\n    }\n\n    // (B) My OPEN requests that already have offers\n    let mineOpen = [];\n    try {\n      const rAll = await authFetch('/api/loans/open');\n      if (rAll.ok) {\n        const rawAll = await rAll.json();\n        const listAll = Array.isArray(rawAll) ? rawAll : (rawAll === null || rawAll === void 0 ? void 0 : rawAll.items) || [];\n        mineOpen = listAll.filter(x => {\n          var _x$borrower;\n          return (x.status || 'OPEN').toUpperCase() === 'OPEN' && String(x.borrowerId || (x === null || x === void 0 ? void 0 : (_x$borrower = x.borrower) === null || _x$borrower === void 0 ? void 0 : _x$borrower.id)) === String(me);\n        });\n      }\n    } catch {\n      /* ignore */\n    }\n    const keepNow = [];\n    const toProbe = [];\n    for (const req of mineOpen) {\n      var _req$_count;\n      const offersArr = Array.isArray(req.loanOffers) ? req.loanOffers : [];\n      const offerCount = typeof (req === null || req === void 0 ? void 0 : (_req$_count = req._count) === null || _req$_count === void 0 ? void 0 : _req$_count.loanOffers) === 'number' ? req._count.loanOffers : offersArr.length;\n      if (offerCount > 0) keepNow.push(req);else toProbe.push(req);\n    }\n    if (toProbe.length) {\n      const probed = await Promise.all(toProbe.map(async req => {\n        try {\n          const r = await authFetch(`/api/loans/${req.id}/offers`);\n          const arr = r.ok ? await r.json() : [];\n          if (Array.isArray(arr) && arr.length > 0) {\n            setOffersByLoanId(m => ({\n              ...m,\n              [req.id]: arr\n            }));\n            return req;\n          }\n        } catch {}\n        return null;\n      }));\n      keepNow.push(...probed.filter(Boolean));\n    }\n    for (const req of keepNow) {\n      var _req$borrower, _req$duration, _req$interestRate, _req$borrower2;\n      const borrowerId = req.borrowerId || (req === null || req === void 0 ? void 0 : (_req$borrower = req.borrower) === null || _req$borrower === void 0 ? void 0 : _req$borrower.id) || me;\n      rows.push({\n        type: 'market',\n        id: req.id,\n        amount: Number(req.amount),\n        duration: Number((_req$duration = req.duration) !== null && _req$duration !== void 0 ? _req$duration : req.months),\n        interestRate: Number((_req$interestRate = req.interestRate) !== null && _req$interestRate !== void 0 ? _req$interestRate : req.apr),\n        purpose: req.purpose || '',\n        createdAt: req.createdAt || null,\n        borrowerId,\n        borrowerName: (req === null || req === void 0 ? void 0 : (_req$borrower2 = req.borrower) === null || _req$borrower2 === void 0 ? void 0 : _req$borrower2.name) || 'You',\n        counterpartyName: 'â€” Borrowing',\n        role: 'Borrowing',\n        status: req.status || 'OPEN'\n      });\n    }\n    const seen = new Set();\n    return rows.filter(r => seen.has(r.id) ? false : (seen.add(r.id), true));\n  }, []);\n  const fetchDirectOpenRequests = useCallback(async () => {\n    const me = getCurrentUserId();\n    if (!me) return [];\n    try {\n      const r = await authFetch('/api/direct-requests/open/mine');\n      if (!r.ok) return [];\n      const rows = await r.json();\n      return (Array.isArray(rows) ? rows : []).map(d => {\n        var _d$borrower, _d$lender, _d$months, _d$apr, _d$borrower2, _d$lender2, _d$lender3, _d$borrower3;\n        const borrowerId = d.borrowerId || (d === null || d === void 0 ? void 0 : (_d$borrower = d.borrower) === null || _d$borrower === void 0 ? void 0 : _d$borrower.id);\n        const lenderId = d.lenderId || (d === null || d === void 0 ? void 0 : (_d$lender = d.lender) === null || _d$lender === void 0 ? void 0 : _d$lender.id);\n        const iAmBorrower = String(borrowerId) === String(me);\n        return {\n          type: 'direct',\n          id: d.id,\n          amount: Number(d.amount),\n          duration: Number((_d$months = d.months) !== null && _d$months !== void 0 ? _d$months : d.duration),\n          interestRate: Number((_d$apr = d.apr) !== null && _d$apr !== void 0 ? _d$apr : d.interestRate),\n          createdAt: d.createdAt || null,\n          borrowerId,\n          borrowerName: (d === null || d === void 0 ? void 0 : (_d$borrower2 = d.borrower) === null || _d$borrower2 === void 0 ? void 0 : _d$borrower2.name) || (iAmBorrower ? 'You' : ''),\n          lenderId,\n          lenderName: (d === null || d === void 0 ? void 0 : (_d$lender2 = d.lender) === null || _d$lender2 === void 0 ? void 0 : _d$lender2.name) || (!iAmBorrower ? 'You' : ''),\n          counterpartyName: iAmBorrower ? (d === null || d === void 0 ? void 0 : (_d$lender3 = d.lender) === null || _d$lender3 === void 0 ? void 0 : _d$lender3.name) || 'Lender' : (d === null || d === void 0 ? void 0 : (_d$borrower3 = d.borrower) === null || _d$borrower3 === void 0 ? void 0 : _d$borrower3.name) || 'Borrower',\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\n          status: d.status || 'PENDING'\n        };\n      });\n    } catch {\n      return [];\n    }\n  }, []);\n  const fetchSummary = useCallback(async () => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    setLoading(true);\n    try {\n      const res = await authFetch('/api/users/my-money-summary');\n      let loansGiven = [];\n      let loansReceived = [];\n      if (res.ok) {\n        const data = await res.json();\n        loansGiven = Array.isArray(data.loansGiven) ? data.loansGiven : Array.isArray(data.loansAsLender) ? data.loansAsLender : [];\n        loansReceived = Array.isArray(data.loansReceived) ? data.loansReceived : Array.isArray(data.loansAsBorrower) ? data.loansAsBorrower : [];\n      }\n      const [marketOpen, directOpen] = await Promise.all([fetchMarketOpenRequests(), fetchDirectOpenRequests()]);\n      setSummary({\n        loansGiven: sortLoansWithPaidOffLast(loansGiven),\n        loansReceived: sortLoansWithPaidOffLast(loansReceived),\n        myOpenRequests: [...marketOpen, ...directOpen]\n      });\n    } catch (err) {\n      console.error('Error fetching money summary:', err);\n      setSummary({\n        loansGiven: [],\n        loansReceived: [],\n        myOpenRequests: []\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [fetchMarketOpenRequests, fetchDirectOpenRequests]);\n  useEffect(() => {\n    fetchSummary();\n  }, [fetchSummary]);\n  const toggleDetails = async req => {\n    setExpanded(prev => {\n      const collapsed = Object.keys(prev).reduce((acc, k) => ({\n        ...acc,\n        [k]: false\n      }), {});\n      return {\n        ...collapsed,\n        [req.id]: !prev[req.id]\n      };\n    });\n    if (req.type === 'market' && req.role === 'Borrowing') {\n      if (!offersByLoanId[req.id] && !offersLoading[req.id]) {\n        await loadOffers(req.id);\n      }\n    }\n  };\n\n  /* -------------------- Offers (marketplace) -------------------- */\n\n  const loadOffers = async loanId => {\n    setOffersLoading(m => ({\n      ...m,\n      [loanId]: true\n    }));\n    try {\n      const r = await authFetch(`/api/loans/${loanId}/offers`);\n      const items = r.ok ? await r.json() : [];\n      setOffersByLoanId(m => ({\n        ...m,\n        [loanId]: Array.isArray(items) ? items : []\n      }));\n    } catch (e) {\n      console.error('loadOffers error', e);\n      setOffersByLoanId(m => ({\n        ...m,\n        [loanId]: []\n      }));\n    } finally {\n      setOffersLoading(m => ({\n        ...m,\n        [loanId]: false\n      }));\n    }\n  };\n  const acceptOffer = async offer => {\n    setOfferWorking(m => ({\n      ...m,\n      [offer.id]: true\n    }));\n    try {\n      var _data$loan;\n      // 1) Optional: ensure borrower has payout method on file\n      const ok = await checkHasLoanPaymentMethod();\n      if (!ok) {\n        setShowLinkModal(true);\n        setOfferWorking(m => ({\n          ...m,\n          [offer.id]: false\n        }));\n        return;\n      }\n\n      // 2) Accept the offer -> server creates the Loan (status: ACCEPTED)\n      const r = await authFetch(`/api/loans/offers/${offer.id}/accept`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      const data = r.ok ? await r.json() : null;\n      if (!r.ok || !(data !== null && data !== void 0 && (_data$loan = data.loan) !== null && _data$loan !== void 0 && _data$loan.id)) {\n        const t = !r.ok ? await r.text().catch(() => '') : '';\n        throw new Error(t || (data === null || data === void 0 ? void 0 : data.error) || 'Failed to accept offer');\n      }\n      console.log('âœ… Offer accepted response:', data);\n\n      // 3) Just refresh the summary; funding is done later by the lender\n      await fetchSummary();\n      alert('Loan accepted and contract saved. Waiting for lender to fund from their PeerFund wallet.');\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setOfferWorking(m => ({\n        ...m,\n        [offer.id]: false\n      }));\n    }\n  };\n\n  /* -------------------- Direct request actions -------------------- */\n\n  async function tryEndpoints(methods, url, body) {\n    const optionsBase = {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: body ? JSON.stringify(body) : undefined\n    };\n    let lastErr = null;\n    for (const method of methods) {\n      try {\n        const r = await authFetch(url, {\n          method,\n          ...optionsBase\n        });\n        if (r.ok) return r;\n        const txt = await r.text().catch(() => '');\n        lastErr = new Error(`${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`);\n      } catch (e) {\n        lastErr = e;\n      }\n    }\n    throw lastErr || new Error('All methods failed');\n  }\n  const acceptDirect = async req => {\n    setActionLoading(m => ({\n      ...m,\n      [req.id]: true\n    }));\n    try {\n      const urls = [`/api/direct-requests/${req.id}/approve`, `/api/direct-requests/${req.id}/accept`, `/api/direct-requests/${req.id}/respond?action=ACCEPT`];\n      let ok = false;\n      let last = null;\n      for (const u of urls) {\n        try {\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\n          ok = true;\n          break;\n        } catch (e) {\n          last = e;\n        }\n      }\n      if (!ok) throw last || new Error('Approve failed');\n      await fetchSummary();\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setActionLoading(m => ({\n        ...m,\n        [req.id]: false\n      }));\n    }\n  };\n  const declineDirect = async req => {\n    setActionLoading(m => ({\n      ...m,\n      [req.id]: true\n    }));\n    try {\n      const urls = [`/api/direct-requests/${req.id}/decline`, `/api/direct-requests/${req.id}/reject`, `/api/direct-requests/${req.id}/respond?action=DECLINE`];\n      let ok = false;\n      let last = null;\n      for (const u of urls) {\n        try {\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\n          ok = true;\n          break;\n        } catch (e) {\n          last = e;\n        }\n      }\n      if (!ok) throw last || new Error('Decline failed');\n      await fetchSummary();\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setActionLoading(m => ({\n        ...m,\n        [req.id]: false\n      }));\n    }\n  };\n\n  /* ------------------------------- Funding (lender-side) ------------------------------- */\n\n  const [funding, setFunding] = useState({}); // track loading per-loan\n\n  const handleFundLoan = async loanId => {\n    if (!loanId) return;\n    setFunding(m => ({\n      ...m,\n      [loanId]: true\n    }));\n    try {\n      const res = await authFetch(`/api/loans/${loanId}/fund`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      if (!res.ok) {\n        const txt = await res.text().catch(() => '');\n        console.error('Fund loan failed:', res.status, txt);\n        alert(`Funding failed (${res.status}).\\n${txt || 'Check backend logs for details.'}`);\n        return;\n      }\n      const data = await res.json().catch(() => ({}));\n      console.log('âœ… Loan funded response:', data);\n      alert('Loan successfully funded from your PeerFund wallet.');\n      // Refresh Money Summary + wallets/transactions in UI\n      await fetchSummary();\n    } catch (err) {\n      console.error('Fund loan error:', err);\n      alert(`Funding error:\\n${err.message || err}`);\n    } finally {\n      setFunding(m => ({\n        ...m,\n        [loanId]: false\n      }));\n    }\n  };\n\n  /* ------------------------------- Renderers ------------------------------- */\n\n  const renderOffersBlock = loanId => {\n    const loading = !!offersLoading[loanId];\n    const offers = offersByLoanId[loanId] || [];\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"mt-8\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          alignItems: 'center',\n          gap: 8,\n          marginBottom: 6\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Active Offers\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 720,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn xs\",\n          onClick: () => loadOffers(loanId),\n          disabled: loading,\n          title: \"Refresh offers\",\n          children: loading ? 'Refreshingâ€¦' : 'Refresh'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 721,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 712,\n        columnNumber: 9\n      }, this), loading ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"ms-muted\",\n        children: \"Loading offers\\u2026\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 731,\n        columnNumber: 11\n      }, this) : offers.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"ms-muted\",\n        children: \"No offers yet\\u2014be the first!\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 733,\n        columnNumber: 11\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gap: 8\n        },\n        children: offers.map(of => {\n          var _of$lender;\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              border: '1px solid #e2e8f0',\n              borderRadius: 10,\n              padding: '8px 10px',\n              display: 'grid',\n              gridTemplateColumns: 'minmax(160px,1fr) 120px 120px 120px auto',\n              gap: 8,\n              alignItems: 'center'\n            },\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                fontWeight: 600\n              },\n              children: (of === null || of === void 0 ? void 0 : (_of$lender = of.lender) === null || _of$lender === void 0 ? void 0 : _of$lender.name) || 'Lender'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 750,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: fmtMoney(Number(of.amount) || 0)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 753,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: Number.isFinite(of.duration) ? `${of.duration} mo` : 'â€”'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 754,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              children: Number.isFinite(of.interestRate) ? `${of.interestRate}%` : 'â€”'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 757,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                justifySelf: 'end',\n                display: 'flex',\n                gap: 6\n              },\n              children: /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"action-btn xs primary\",\n                onClick: () => acceptOffer(of),\n                disabled: !!offerWorking[of.id],\n                children: offerWorking[of.id] ? 'Workingâ€¦' : 'Accept'\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 769,\n                columnNumber: 19\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 762,\n              columnNumber: 17\n            }, this), of.message ? /*#__PURE__*/_jsxDEV(\"div\", {\n              style: {\n                gridColumn: '1 / -1',\n                color: '#334155',\n                fontSize: 13\n              },\n              children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n                children: \"Message:\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 785,\n                columnNumber: 21\n              }, this), \" \", of.message]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 778,\n              columnNumber: 19\n            }, this) : null]\n          }, of.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 737,\n            columnNumber: 15\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 735,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 711,\n      columnNumber: 7\n    }, this);\n  };\n  const renderLoanCard = (loan, isLender, idx) => {\n    const key = (loan === null || loan === void 0 ? void 0 : loan.id) || (loan === null || loan === void 0 ? void 0 : loan._id) || String(idx);\n    const loanId = loan.id || loan._id;\n    const isExpanded = !!expanded[key];\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\n    const rawStatus = (loan.status || '').toUpperCase();\n    const isPaidOff = isLoanPaidOff(loan);\n    const isBorrower = !isLender;\n    const badgeClass = isPaidOff ? 'ms-badge ms-badge--muted' : rawStatus === 'FUNDED' ? 'ms-badge ms-badge--ok' : 'ms-badge ms-badge--warn';\n    const cardClass = `ms-card${isPaidOff ? ' ms-card--paid-off' : ''}`;\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: cardClass,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-card-row\",\n        style: ROW_GRID,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: isLender ? 'Borrower' : 'Lender'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 819,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: otherParty || 'Unknown'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 820,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 818,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Amount\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 824,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fmtMoney(loan.amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 825,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 823,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Status\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 830,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: /*#__PURE__*/_jsxDEV(\"span\", {\n              className: badgeClass,\n              children: loan.status || 'â€”'\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 832,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 831,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 829,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            justifySelf: 'end',\n            display: 'flex',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setThreadLoanId(loanId),\n            className: \"action-btn sm\",\n            title: \"Open conversation\",\n            children: \"\\uD83D\\uDCAC Messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 837,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setExpanded(m => ({\n              ...m,\n              [key]: !isExpanded\n            })),\n            className: \"action-btn sm\",\n            title: \"View contract\",\n            children: isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 844,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 836,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 817,\n        columnNumber: 9\n      }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-details\",\n        children: [loan.status && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 858,\n            columnNumber: 17\n          }, this), \" \", loan.status]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 857,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Interest Rate:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 862,\n            columnNumber: 15\n          }, this), ' ', typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 861,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Duration:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 868,\n            columnNumber: 15\n          }, this), ' ', typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 867,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Next Due Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 874,\n            columnNumber: 15\n          }, this), ' ', loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 873,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Installment (this period):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 880,\n            columnNumber: 15\n          }, this), ' ', fmtMoney(loan.installmentAmount)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 879,\n          columnNumber: 13\n        }, this), isPaidOff && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6 ms-muted\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Repayment:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 887,\n            columnNumber: 17\n          }, this), \" Loan fully repaid. No further installments.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 886,\n          columnNumber: 15\n        }, this), isBorrower && !isPaidOff && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-8\",\n          children: /*#__PURE__*/_jsxDEV(RepaymentButton, {\n            loanId: loanId,\n            onPaid: fetchSummary\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 895,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 894,\n          columnNumber: 15\n        }, this), isLender && !isPaidOff && rawStatus === 'ACCEPTED' && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-8\",\n          style: {\n            display: 'flex',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"action-btn sm primary\",\n            onClick: () => handleFundLoan(loanId),\n            disabled: !!funding[loanId],\n            children: funding[loanId] ? 'Fundingâ€¦' : 'Fund from PeerFund wallet'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 902,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"ms-muted\",\n            style: {\n              alignSelf: 'center'\n            },\n            children: \"Requires enough wallet balance\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 909,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 901,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 855,\n        columnNumber: 11\n      }, this)]\n    }, key, true, {\n      fileName: _jsxFileName,\n      lineNumber: 816,\n      columnNumber: 7\n    }, this);\n  };\n\n  /* ------------------------------- Render ------------------------------- */\n\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"ms-loading ms-container\",\n    children: \"Loading money summary...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 924,\n    columnNumber: 7\n  }, this);\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"ms-heading\",\n      children: \"\\uD83D\\uDCB5 My Money Summary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 937,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          open: !s.open\n        })),\n        \"aria-expanded\": openSec.open,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"My Open Loan Requests\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 946,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.open ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 947,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 941,\n        columnNumber: 9\n      }, this), openSec.open && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: myOpen.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"You have no open requests.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 952,\n          columnNumber: 15\n        }, this) : myOpen.map(req => /*#__PURE__*/_jsxDEV(OpenRequestRow, {\n          req: req,\n          isExpanded: !!expanded[req.id],\n          onToggle: () => toggleDetails(req),\n          actionLoading: actionLoading\n          // MARKET + Borrowing: offers block (as a React node)\n          ,\n          offersContent: req.type === 'market' && req.role === 'Borrowing' ? renderOffersBlock(req.id) : undefined\n          // MARKET + Lending: open OfferModal\n          ,\n          onMakeOffer: req.type === 'market' && req.role === 'Lending' ? () => setOfferModalLoanId(req.id) : undefined\n          // DIRECT actions\n          ,\n          onAcceptDirect: req.type === 'direct' ? () => acceptDirect(req) : undefined,\n          onDeclineDirect: req.type === 'direct' ? () => declineDirect(req) : undefined\n        }, req.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 955,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 950,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 940,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          given: !s.given\n        })),\n        \"aria-expanded\": openSec.given,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Given (I'm the Lender)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 998,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.given ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 999,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 993,\n        columnNumber: 9\n      }, this), openSec.given && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: given.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans given yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1004,\n          columnNumber: 15\n        }, this) : given.map((loan, idx) => renderLoanCard(loan, true, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1002,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 992,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          received: !s.received\n        })),\n        \"aria-expanded\": openSec.received,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Received (I'm the Borrower)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1021,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.received ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1024,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 1014,\n        columnNumber: 9\n      }, this), openSec.received && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: received.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans received yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 1029,\n          columnNumber: 15\n        }, this) : received.map((loan, idx) => renderLoanCard(loan, false, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 1027,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 1013,\n      columnNumber: 7\n    }, this), threadLoanId && /*#__PURE__*/_jsxDEV(LoanThreadModal, {\n      loanId: threadLoanId,\n      onClose: () => setThreadLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1038,\n      columnNumber: 9\n    }, this), offerModalLoanId && /*#__PURE__*/_jsxDEV(OfferModal, {\n      loanId: offerModalLoanId,\n      onClose: () => setOfferModalLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1045,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(LinkBankFirstModal, {\n      open: showLinkModal,\n      onClose: () => setShowLinkModal(false)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 1051,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 936,\n    columnNumber: 5\n  }, this);\n}\n_s(MoneySummary, \"otji1KfQ33MN2d0a7oXFlnti0W0=\");\n_c3 = MoneySummary;\nvar _c, _c2, _c3;\n$RefreshReg$(_c, \"LinkBankFirstModal\");\n$RefreshReg$(_c2, \"OpenRequestRow\");\n$RefreshReg$(_c3, \"MoneySummary\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","LoanThreadModal","OfferModal","RepaymentButton","jsxDEV","_jsxDEV","getCurrentUserId","t","localStorage","getItem","_payload$userId","payload","JSON","parse","atob","split","userId","fmtMoney","n","Number","isNaN","toFixed","ROW_GRID","display","gridTemplateColumns","alignItems","gap","authFetch","url","options","token","headers","Authorization","res","fetch","credentials","status","console","warn","text","window","location","assign","Error","isLoanPaidOff","loan","s","toUpperCase","includes","remainingPrincipal","remainingPrincipalCents","hasNextDue","nextDueDate","installment","installmentAmount","sortLoansWithPaidOffLast","list","sort","a","b","aDone","bDone","LinkBankFirstModal","open","onClose","role","style","position","inset","background","justifyContent","padding","zIndex","onClick","children","e","stopPropagation","width","maxWidth","border","borderRadius","boxShadow","margin","fileName","_jsxFileName","lineNumber","columnNumber","color","marginTop","className","_c","OpenRequestRow","req","isExpanded","onToggle","actionLoading","offersContent","onMakeOffer","onAcceptDirect","onDeclineDirect","_req$status","isMarket","type","isBorrowing","counterpartyName","marginLeft","fontWeight","amount","justifySelf","title","isFinite","interestRate","duration","purpose","disabled","id","_c2","MoneySummary","_s","summary","setSummary","loansGiven","loansReceived","myOpenRequests","loading","setLoading","expanded","setExpanded","openSec","setOpenSec","given","received","setActionLoading","threadLoanId","setThreadLoanId","offersByLoanId","setOffersByLoanId","offersLoading","setOffersLoading","offerWorking","setOfferWorking","offerModalLoanId","setOfferModalLoanId","hasLoanPM","setHasLoanPM","showLinkModal","setShowLinkModal","checkHasLoanPaymentMethod","r","ok","d","json","val","hasLoanPaymentMethod","fetchMarketOpenRequests","me","rows","data","items","Array","isArray","it","_it$myOffer$interestR","_it$myOffer","_it$borrower","_it$borrower2","_it$borrower3","push","myOffer","createdAt","borrowerId","borrower","borrowerName","name","mineOpen","rAll","rawAll","listAll","filter","x","_x$borrower","String","keepNow","toProbe","_req$_count","offersArr","loanOffers","offerCount","_count","length","probed","Promise","all","map","arr","m","Boolean","_req$borrower","_req$duration","_req$interestRate","_req$borrower2","months","apr","seen","Set","has","add","fetchDirectOpenRequests","_d$borrower","_d$lender","_d$months","_d$apr","_d$borrower2","_d$lender2","_d$lender3","_d$borrower3","lenderId","lender","iAmBorrower","lenderName","fetchSummary","loansAsLender","loansAsBorrower","marketOpen","directOpen","err","error","toggleDetails","prev","collapsed","Object","keys","reduce","acc","k","loadOffers","loanId","acceptOffer","offer","_data$loan","method","catch","log","alert","message","tryEndpoints","methods","body","optionsBase","stringify","undefined","lastErr","txt","statusText","acceptDirect","urls","last","u","declineDirect","funding","setFunding","handleFundLoan","renderOffersBlock","offers","marginBottom","of","_of$lender","gridColumn","fontSize","renderLoanCard","isLender","idx","key","_id","otherParty","rawStatus","isPaidOff","isBorrower","badgeClass","cardClass","Date","toLocaleDateString","onPaid","alignSelf","myOpen","_c3","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx"],"sourcesContent":["// src/features/money/MoneySummary.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport './MoneySummary.css';\r\nimport LoanThreadModal from '../loans/LoanThreadModal';\r\nimport OfferModal from '../../components/OfferModal';\r\nimport RepaymentButton from '../loans/RepaymentButton';\r\n\r\n/* ----------------------- helpers ----------------------- */\r\n\r\n// decode JWT for current user id\r\nfunction getCurrentUserId() {\r\n  const t = localStorage.getItem('token');\r\n  if (!t) return null;\r\n  try {\r\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\r\n    return payload?.userId ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nconst fmtMoney = (n) =>\r\n  typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\r\n\r\n// compact row layout\r\nconst ROW_GRID = {\r\n  display: 'grid',\r\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\r\n  alignItems: 'center',\r\n  gap: 10,\r\n};\r\n\r\nasync function authFetch(url, options = {}) {\r\n  const token = localStorage.getItem('token');\r\n  const headers = {\r\n    ...(options.headers || {}),\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n  };\r\n  const res = await fetch(url, {\r\n    ...options,\r\n    headers,\r\n    credentials: 'include',\r\n  });\r\n  if (res.status === 401) {\r\n    try {\r\n      console.warn('401 on', url, await res.text());\r\n    } catch {}\r\n    window.location.assign('/login');\r\n    throw new Error('Unauthorized');\r\n  }\r\n  return res;\r\n}\r\n\r\nfunction isLoanPaidOff(loan) {\r\n  const s = (loan.status || '').toUpperCase();\r\n\r\n  // Explicit status flags\r\n  if (['PAID_OFF', 'COMPLETED', 'CLOSED'].includes(s)) return true;\r\n\r\n  // Remaining principal flags\r\n  if (typeof loan.remainingPrincipal === 'number' && loan.remainingPrincipal <= 0) {\r\n    return true;\r\n  }\r\n  if (\r\n    typeof loan.remainingPrincipalCents === 'number' &&\r\n    loan.remainingPrincipalCents <= 0\r\n  ) {\r\n    return true;\r\n  }\r\n\r\n  // Frontend-only inference (no next due date + no installment amount)\r\n  const hasNextDue = !!loan.nextDueDate;\r\n  const installment =\r\n    typeof loan.installmentAmount === 'number' ? loan.installmentAmount : null;\r\n\r\n  if (!hasNextDue && (installment === null || installment <= 0)) {\r\n    return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nfunction sortLoansWithPaidOffLast(list) {\r\n  return [...list].sort((a, b) => {\r\n    const aDone = isLoanPaidOff(a);\r\n    const bDone = isLoanPaidOff(b);\r\n    if (aDone === bDone) return 0;\r\n    return aDone ? 1 : -1; // active first, paid-off last\r\n  });\r\n}\r\n\r\n/* ------------------------- Small inline modal ------------------------- */\r\n\r\nfunction LinkBankFirstModal({ open, onClose }) {\r\n  if (!open) return null;\r\n  return (\r\n    <div\r\n      role=\"dialog\"\r\n      aria-modal=\"true\"\r\n      style={{\r\n        position: 'fixed',\r\n        inset: 0,\r\n        background: 'rgba(0,0,0,0.35)',\r\n        display: 'flex',\r\n        alignItems: 'center',\r\n        justifyContent: 'center',\r\n        padding: 16,\r\n        zIndex: 1000,\r\n      }}\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        onClick={(e) => e.stopPropagation()}\r\n        style={{\r\n          width: '100%',\r\n          maxWidth: 520,\r\n          background: '#fff',\r\n          border: '1px solid #e5e7eb',\r\n          borderRadius: 12,\r\n          boxShadow: '0 10px 30px rgba(0,0,0,0.12)',\r\n          padding: 20,\r\n        }}\r\n      >\r\n        <h3 style={{ margin: 0 }}>Add a bank to receive funds</h3>\r\n        <p style={{ color: '#334155', marginTop: 8 }}>\r\n          Before you can accept an offer, please link a bank account for loan\r\n          disbursement on the Payment Method page.\r\n        </p>\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            gap: 8,\r\n            justifyContent: 'flex-end',\r\n            marginTop: 14,\r\n          }}\r\n        >\r\n          <button className=\"action-btn sm\" onClick={onClose}>\r\n            Close\r\n          </button>\r\n          <button\r\n            className=\"action-btn sm primary\"\r\n            onClick={() => {\r\n              window.location.assign('/payment-method');\r\n            }}\r\n          >\r\n            Go to Payment Method\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ------------------------- Open request row ------------------------- */\r\n\r\nfunction OpenRequestRow({\r\n  req,\r\n  isExpanded,\r\n  onToggle,\r\n  actionLoading,\r\n  offersContent, // React node for market/borrower offers list\r\n  onMakeOffer, // fn for market/lender to open OfferModal\r\n  onAcceptDirect, // fn for direct approve\r\n  onDeclineDirect, // fn for direct decline\r\n}) {\r\n  const isMarket = req.type === 'market';\r\n  const isBorrowing = req.role === 'Borrowing';\r\n\r\n  return (\r\n    <div className=\"ms-card\" key={req.id}>\r\n      {/* ONE-LINE TOP ROW */}\r\n      <div className=\"ms-card-row\" style={ROW_GRID}>\r\n        <div>\r\n          <div className=\"ms-label\">Counterparty</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.counterpartyName || 'Unknown'}\r\n            <span style={{ marginLeft: 8, color: '#64748b', fontWeight: 600 }}>\r\n              â€¢ {req.role}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"ms-label\">Amount</div>\r\n          <div className=\"ms-value-strong\">{fmtMoney(req.amount)}</div>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end' }}>\r\n          <span className=\"ms-badge ms-badge--warn\">Open</span>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n          <button\r\n            className=\"action-btn sm\"\r\n            onClick={onToggle}\r\n            title=\"View request\"\r\n          >\r\n            {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* DETAILS */}\r\n      {isExpanded && (\r\n        <div className=\"ms-details\">\r\n          <p className=\"mt-6\">\r\n            <strong>Status:</strong> {req.status ?? 'OPEN'}\r\n          </p>\r\n          <p className=\"mt-6\">\r\n            <strong>Interest Rate:</strong>{' '}\r\n            {Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”'}\r\n          </p>\r\n          <p className=\"mt-6\">\r\n            <strong>Duration:</strong>{' '}\r\n            {Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”'}\r\n          </p>\r\n          {req.purpose ? (\r\n            <p className=\"mt-6\">\r\n              <strong>Reason:</strong> {req.purpose}\r\n            </p>\r\n          ) : null}\r\n\r\n          {/* MARKET: Borrowing => show the actual offers placed by lenders */}\r\n          {isMarket && isBorrowing && offersContent}\r\n\r\n          {/* MARKET: Lending => allow me to place an offer */}\r\n          {isMarket && !isBorrowing && (\r\n            <div\r\n              className=\"mt-8\"\r\n              style={{ display: 'flex', justifyContent: 'flex-end' }}\r\n            >\r\n              <button className=\"action-btn sm primary\" onClick={onMakeOffer}>\r\n                ðŸ’µ Make Offer\r\n              </button>\r\n            </div>\r\n          )}\r\n\r\n          {/* DIRECT requests => approve/decline */}\r\n          {!isMarket && (\r\n            <div\r\n              className=\"mt-8\"\r\n              style={{\r\n                display: 'flex',\r\n                gap: 8,\r\n                justifyContent: 'flex-end',\r\n              }}\r\n            >\r\n              <button\r\n                className=\"action-btn sm primary\"\r\n                onClick={onAcceptDirect}\r\n                disabled={!!actionLoading[req.id]}\r\n              >\r\n                {actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'}\r\n              </button>\r\n              <button\r\n                className=\"action-btn sm\"\r\n                onClick={onDeclineDirect}\r\n                disabled={!!actionLoading[req.id]}\r\n              >\r\n                {actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'}\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -------------------------------- Parent -------------------------------- */\r\n\r\nexport default function MoneySummary() {\r\n  const [summary, setSummary] = useState({\r\n    loansGiven: [],\r\n    loansReceived: [],\r\n    myOpenRequests: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [expanded, setExpanded] = useState({});\r\n  const [openSec, setOpenSec] = useState({\r\n    open: true,\r\n    given: true,\r\n    received: true,\r\n  });\r\n\r\n  const [actionLoading, setActionLoading] = useState({});\r\n  const [threadLoanId, setThreadLoanId] = useState(null);\r\n\r\n  // marketplace offers cache per loanId\r\n  const [offersByLoanId, setOffersByLoanId] = useState({});\r\n  const [offersLoading, setOffersLoading] = useState({});\r\n  const [offerWorking, setOfferWorking] = useState({});\r\n  const [offerModalLoanId, setOfferModalLoanId] = useState(null);\r\n\r\n  // cached: does borrower have a payment method for loan funding\r\n  const [hasLoanPM, setHasLoanPM] = useState(null); // null=unknown, true/false known\r\n  const [showLinkModal, setShowLinkModal] = useState(false);\r\n\r\n  const checkHasLoanPaymentMethod = useCallback(async () => {\r\n    if (hasLoanPM !== null) return hasLoanPM;\r\n    try {\r\n      const r = await authFetch('/api/stripe/has-loan-payment-method');\r\n      if (!r.ok) throw new Error('has-loan-payment-method failed');\r\n      const d = await r.json();\r\n      const val = !!d?.hasLoanPaymentMethod;\r\n      setHasLoanPM(val);\r\n      return val;\r\n    } catch {\r\n      setHasLoanPM(false);\r\n      return false;\r\n    }\r\n  }, [hasLoanPM]);\r\n\r\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\r\n\r\n  const fetchMarketOpenRequests = useCallback(async () => {\r\n    const me = getCurrentUserId();\r\n    if (!me) return [];\r\n\r\n    const rows = [];\r\n\r\n    // (A) Requests where I am the LENDER (Iâ€™ve made an offer)\r\n    try {\r\n      const r = await authFetch('/api/loans/offers/mine');\r\n      if (r.ok) {\r\n        const data = await r.json();\r\n        const items = Array.isArray(data?.items)\r\n          ? data.items\r\n          : Array.isArray(data)\r\n          ? data\r\n          : [];\r\n        for (const it of items) {\r\n          rows.push({\r\n            type: 'market',\r\n            id: it.id, // loanRequest id\r\n            amount: Number(it.amount),\r\n            duration: Number(it.duration),\r\n            interestRate: Number(it.myOffer?.interestRate ?? it.interestRate),\r\n            purpose: it.purpose || '',\r\n            createdAt: it.createdAt || null,\r\n            borrowerId: it.borrower?.id,\r\n            borrowerName: it.borrower?.name || 'Borrower',\r\n            counterpartyName: it.borrower?.name || 'Borrower',\r\n            role: 'Lending',\r\n            status: it.status || 'OPEN',\r\n            myOffer: it.myOffer\r\n              ? {\r\n                  id: it.myOffer.id,\r\n                  amount: Number(it.myOffer.amount),\r\n                  duration: Number(it.myOffer.duration),\r\n                  interestRate: Number(it.myOffer.interestRate),\r\n                  createdAt: it.myOffer.createdAt,\r\n                }\r\n              : null,\r\n          });\r\n        }\r\n      }\r\n    } catch {\r\n      /* ignore */\r\n    }\r\n\r\n    // (B) My OPEN requests that already have offers\r\n    let mineOpen = [];\r\n    try {\r\n      const rAll = await authFetch('/api/loans/open');\r\n      if (rAll.ok) {\r\n        const rawAll = await rAll.json();\r\n        const listAll = Array.isArray(rawAll) ? rawAll : rawAll?.items || [];\r\n        mineOpen = listAll.filter(\r\n          (x) =>\r\n            (x.status || 'OPEN').toUpperCase() === 'OPEN' &&\r\n            String(x.borrowerId || x?.borrower?.id) === String(me)\r\n        );\r\n      }\r\n    } catch {\r\n      /* ignore */\r\n    }\r\n\r\n    const keepNow = [];\r\n    const toProbe = [];\r\n    for (const req of mineOpen) {\r\n      const offersArr = Array.isArray(req.loanOffers) ? req.loanOffers : [];\r\n      const offerCount =\r\n        typeof req?._count?.loanOffers === 'number'\r\n          ? req._count.loanOffers\r\n          : offersArr.length;\r\n\r\n      if (offerCount > 0) keepNow.push(req);\r\n      else toProbe.push(req);\r\n    }\r\n\r\n    if (toProbe.length) {\r\n      const probed = await Promise.all(\r\n        toProbe.map(async (req) => {\r\n          try {\r\n            const r = await authFetch(`/api/loans/${req.id}/offers`);\r\n            const arr = r.ok ? await r.json() : [];\r\n            if (Array.isArray(arr) && arr.length > 0) {\r\n              setOffersByLoanId((m) => ({ ...m, [req.id]: arr }));\r\n              return req;\r\n            }\r\n          } catch {}\r\n          return null;\r\n        })\r\n      );\r\n      keepNow.push(...probed.filter(Boolean));\r\n    }\r\n\r\n    for (const req of keepNow) {\r\n      const borrowerId = req.borrowerId || req?.borrower?.id || me;\r\n      rows.push({\r\n        type: 'market',\r\n        id: req.id,\r\n        amount: Number(req.amount),\r\n        duration: Number(req.duration ?? req.months),\r\n        interestRate: Number(req.interestRate ?? req.apr),\r\n        purpose: req.purpose || '',\r\n        createdAt: req.createdAt || null,\r\n        borrowerId,\r\n        borrowerName: req?.borrower?.name || 'You',\r\n        counterpartyName: 'â€” Borrowing',\r\n        role: 'Borrowing',\r\n        status: req.status || 'OPEN',\r\n      });\r\n    }\r\n\r\n    const seen = new Set();\r\n    return rows.filter((r) => (seen.has(r.id) ? false : (seen.add(r.id), true)));\r\n  }, []);\r\n\r\n  const fetchDirectOpenRequests = useCallback(async () => {\r\n    const me = getCurrentUserId();\r\n    if (!me) return [];\r\n    try {\r\n      const r = await authFetch('/api/direct-requests/open/mine');\r\n      if (!r.ok) return [];\r\n      const rows = await r.json();\r\n      return (Array.isArray(rows) ? rows : []).map((d) => {\r\n        const borrowerId = d.borrowerId || d?.borrower?.id;\r\n        const lenderId = d.lenderId || d?.lender?.id;\r\n        const iAmBorrower = String(borrowerId) === String(me);\r\n        return {\r\n          type: 'direct',\r\n          id: d.id,\r\n          amount: Number(d.amount),\r\n          duration: Number(d.months ?? d.duration),\r\n          interestRate: Number(d.apr ?? d.interestRate),\r\n          createdAt: d.createdAt || null,\r\n          borrowerId,\r\n          borrowerName: d?.borrower?.name || (iAmBorrower ? 'You' : ''),\r\n          lenderId,\r\n          lenderName: d?.lender?.name || (!iAmBorrower ? 'You' : ''),\r\n          counterpartyName: iAmBorrower\r\n            ? d?.lender?.name || 'Lender'\r\n            : d?.borrower?.name || 'Borrower',\r\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\r\n          status: d.status || 'PENDING',\r\n        };\r\n      });\r\n    } catch {\r\n      return [];\r\n    }\r\n  }, []);\r\n\r\n  const fetchSummary = useCallback(\r\n    async () => {\r\n      const token = localStorage.getItem('token');\r\n      if (!token) return;\r\n      setLoading(true);\r\n      try {\r\n        const res = await authFetch('/api/users/my-money-summary');\r\n        let loansGiven = [];\r\n        let loansReceived = [];\r\n\r\n        if (res.ok) {\r\n          const data = await res.json();\r\n          loansGiven = Array.isArray(data.loansGiven)\r\n            ? data.loansGiven\r\n            : Array.isArray(data.loansAsLender)\r\n            ? data.loansAsLender\r\n            : [];\r\n          loansReceived = Array.isArray(data.loansReceived)\r\n            ? data.loansReceived\r\n            : Array.isArray(data.loansAsBorrower)\r\n            ? data.loansAsBorrower\r\n            : [];\r\n        }\r\n\r\n        const [marketOpen, directOpen] = await Promise.all([\r\n          fetchMarketOpenRequests(),\r\n          fetchDirectOpenRequests(),\r\n        ]);\r\n\r\n        setSummary({\r\n          loansGiven: sortLoansWithPaidOffLast(loansGiven),\r\n          loansReceived: sortLoansWithPaidOffLast(loansReceived),\r\n          myOpenRequests: [...marketOpen, ...directOpen],\r\n        });\r\n      } catch (err) {\r\n        console.error('Error fetching money summary:', err);\r\n        setSummary({ loansGiven: [], loansReceived: [], myOpenRequests: [] });\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    },\r\n    [fetchMarketOpenRequests, fetchDirectOpenRequests]\r\n  );\r\n\r\n  useEffect(() => {\r\n    fetchSummary();\r\n  }, [fetchSummary]);\r\n\r\n  const toggleDetails = async (req) => {\r\n    setExpanded((prev) => {\r\n      const collapsed = Object.keys(prev).reduce(\r\n        (acc, k) => ({ ...acc, [k]: false }),\r\n        {}\r\n      );\r\n      return { ...collapsed, [req.id]: !prev[req.id] };\r\n    });\r\n\r\n    if (req.type === 'market' && req.role === 'Borrowing') {\r\n      if (!offersByLoanId[req.id] && !offersLoading[req.id]) {\r\n        await loadOffers(req.id);\r\n      }\r\n    }\r\n  };\r\n\r\n  /* -------------------- Offers (marketplace) -------------------- */\r\n\r\n  const loadOffers = async (loanId) => {\r\n    setOffersLoading((m) => ({ ...m, [loanId]: true }));\r\n    try {\r\n      const r = await authFetch(`/api/loans/${loanId}/offers`);\r\n      const items = r.ok ? await r.json() : [];\r\n      setOffersByLoanId((m) => ({\r\n        ...m,\r\n        [loanId]: Array.isArray(items) ? items : [],\r\n      }));\r\n    } catch (e) {\r\n      console.error('loadOffers error', e);\r\n      setOffersByLoanId((m) => ({ ...m, [loanId]: [] }));\r\n    } finally {\r\n      setOffersLoading((m) => ({ ...m, [loanId]: false }));\r\n    }\r\n  };\r\n\r\n  const acceptOffer = async (offer) => {\r\n    setOfferWorking((m) => ({ ...m, [offer.id]: true }));\r\n\r\n    try {\r\n      // 1) Optional: ensure borrower has payout method on file\r\n      const ok = await checkHasLoanPaymentMethod();\r\n      if (!ok) {\r\n        setShowLinkModal(true);\r\n        setOfferWorking((m) => ({ ...m, [offer.id]: false }));\r\n        return;\r\n      }\r\n\r\n      // 2) Accept the offer -> server creates the Loan (status: ACCEPTED)\r\n      const r = await authFetch(`/api/loans/offers/${offer.id}/accept`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n\r\n      const data = r.ok ? await r.json() : null;\r\n\r\n      if (!r.ok || !data?.loan?.id) {\r\n        const t = !r.ok ? await r.text().catch(() => '') : '';\r\n        throw new Error(t || data?.error || 'Failed to accept offer');\r\n      }\r\n\r\n      console.log('âœ… Offer accepted response:', data);\r\n\r\n      // 3) Just refresh the summary; funding is done later by the lender\r\n      await fetchSummary();\r\n      alert('Loan accepted and contract saved. Waiting for lender to fund from their PeerFund wallet.');\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setOfferWorking((m) => ({ ...m, [offer.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* -------------------- Direct request actions -------------------- */\r\n\r\n  async function tryEndpoints(methods, url, body) {\r\n    const optionsBase = {\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    };\r\n    let lastErr = null;\r\n    for (const method of methods) {\r\n      try {\r\n        const r = await authFetch(url, { method, ...optionsBase });\r\n        if (r.ok) return r;\r\n        const txt = await r.text().catch(() => '');\r\n        lastErr = new Error(\r\n          `${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`\r\n        );\r\n      } catch (e) {\r\n        lastErr = e;\r\n      }\r\n    }\r\n    throw lastErr || new Error('All methods failed');\r\n  }\r\n\r\n  const acceptDirect = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      const urls = [\r\n        `/api/direct-requests/${req.id}/approve`,\r\n        `/api/direct-requests/${req.id}/accept`,\r\n        `/api/direct-requests/${req.id}/respond?action=ACCEPT`,\r\n      ];\r\n      let ok = false;\r\n      let last = null;\r\n      for (const u of urls) {\r\n        try {\r\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\r\n          ok = true;\r\n          break;\r\n        } catch (e) {\r\n          last = e;\r\n        }\r\n      }\r\n      if (!ok) throw last || new Error('Approve failed');\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  const declineDirect = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      const urls = [\r\n        `/api/direct-requests/${req.id}/decline`,\r\n        `/api/direct-requests/${req.id}/reject`,\r\n        `/api/direct-requests/${req.id}/respond?action=DECLINE`,\r\n      ];\r\n      let ok = false;\r\n      let last = null;\r\n      for (const u of urls) {\r\n        try {\r\n          await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\r\n          ok = true;\r\n          break;\r\n        } catch (e) {\r\n          last = e;\r\n        }\r\n      }\r\n      if (!ok) throw last || new Error('Decline failed');\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* ------------------------------- Funding (lender-side) ------------------------------- */\r\n\r\n  const [funding, setFunding] = useState({}); // track loading per-loan\r\n\r\n  const handleFundLoan = async (loanId) => {\r\n    if (!loanId) return;\r\n    setFunding((m) => ({ ...m, [loanId]: true }));\r\n    try {\r\n      const res = await authFetch(`/api/loans/${loanId}/fund`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n      });\r\n\r\n      if (!res.ok) {\r\n        const txt = await res.text().catch(() => '');\r\n        console.error('Fund loan failed:', res.status, txt);\r\n        alert(\r\n          `Funding failed (${res.status}).\\n${\r\n            txt || 'Check backend logs for details.'\r\n          }`\r\n        );\r\n        return;\r\n      }\r\n\r\n      const data = await res.json().catch(() => ({}));\r\n      console.log('âœ… Loan funded response:', data);\r\n      alert('Loan successfully funded from your PeerFund wallet.');\r\n      // Refresh Money Summary + wallets/transactions in UI\r\n      await fetchSummary();\r\n    } catch (err) {\r\n      console.error('Fund loan error:', err);\r\n      alert(`Funding error:\\n${err.message || err}`);\r\n    } finally {\r\n      setFunding((m) => ({ ...m, [loanId]: false }));\r\n    }\r\n  };\r\n\r\n  /* ------------------------------- Renderers ------------------------------- */\r\n\r\n  const renderOffersBlock = (loanId) => {\r\n    const loading = !!offersLoading[loanId];\r\n    const offers = offersByLoanId[loanId] || [];\r\n    return (\r\n      <div className=\"mt-8\">\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            alignItems: 'center',\r\n            gap: 8,\r\n            marginBottom: 6,\r\n          }}\r\n        >\r\n          <strong>Active Offers</strong>\r\n          <button\r\n            className=\"action-btn xs\"\r\n            onClick={() => loadOffers(loanId)}\r\n            disabled={loading}\r\n            title=\"Refresh offers\"\r\n          >\r\n            {loading ? 'Refreshingâ€¦' : 'Refresh'}\r\n          </button>\r\n        </div>\r\n        {loading ? (\r\n          <p className=\"ms-muted\">Loading offersâ€¦</p>\r\n        ) : offers.length === 0 ? (\r\n          <p className=\"ms-muted\">No offers yetâ€”be the first!</p>\r\n        ) : (\r\n          <div style={{ display: 'grid', gap: 8 }}>\r\n            {offers.map((of) => (\r\n              <div\r\n                key={of.id}\r\n                style={{\r\n                  border: '1px solid #e2e8f0',\r\n                  borderRadius: 10,\r\n                  padding: '8px 10px',\r\n                  display: 'grid',\r\n                  gridTemplateColumns:\r\n                    'minmax(160px,1fr) 120px 120px 120px auto',\r\n                  gap: 8,\r\n                  alignItems: 'center',\r\n                }}\r\n              >\r\n                <div style={{ fontWeight: 600 }}>\r\n                  {of?.lender?.name || 'Lender'}\r\n                </div>\r\n                <div>{fmtMoney(Number(of.amount) || 0)}</div>\r\n                <div>\r\n                  {Number.isFinite(of.duration) ? `${of.duration} mo` : 'â€”'}\r\n                </div>\r\n                <div>\r\n                  {Number.isFinite(of.interestRate)\r\n                    ? `${of.interestRate}%`\r\n                    : 'â€”'}\r\n                </div>\r\n                <div\r\n                  style={{\r\n                    justifySelf: 'end',\r\n                    display: 'flex',\r\n                    gap: 6,\r\n                  }}\r\n                >\r\n                  <button\r\n                    className=\"action-btn xs primary\"\r\n                    onClick={() => acceptOffer(of)}\r\n                    disabled={!!offerWorking[of.id]}\r\n                  >\r\n                    {offerWorking[of.id] ? 'Workingâ€¦' : 'Accept'}\r\n                  </button>\r\n                </div>\r\n                {of.message ? (\r\n                  <div\r\n                    style={{\r\n                      gridColumn: '1 / -1',\r\n                      color: '#334155',\r\n                      fontSize: 13,\r\n                    }}\r\n                  >\r\n                    <strong>Message:</strong> {of.message}\r\n                  </div>\r\n                ) : null}\r\n              </div>\r\n            ))}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  const renderLoanCard = (loan, isLender, idx) => {\r\n    const key = loan?.id || loan?._id || String(idx);\r\n    const loanId = loan.id || loan._id;\r\n    const isExpanded = !!expanded[key];\r\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\r\n\r\n    const rawStatus = (loan.status || '').toUpperCase();\r\n    const isPaidOff = isLoanPaidOff(loan);\r\n    const isBorrower = !isLender;\r\n\r\n    const badgeClass =\r\n      isPaidOff\r\n        ? 'ms-badge ms-badge--muted'\r\n        : rawStatus === 'FUNDED'\r\n        ? 'ms-badge ms-badge--ok'\r\n        : 'ms-badge ms-badge--warn';\r\n\r\n    const cardClass = `ms-card${isPaidOff ? ' ms-card--paid-off' : ''}`;\r\n\r\n    return (\r\n      <div className={cardClass} key={key}>\r\n        <div className=\"ms-card-row\" style={ROW_GRID}>\r\n          <div>\r\n            <div className=\"ms-label\">{isLender ? 'Borrower' : 'Lender'}</div>\r\n            <div className=\"ms-value-strong\">{otherParty || 'Unknown'}</div>\r\n          </div>\r\n\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(loan.amount)}</div>\r\n          </div>\r\n\r\n          {/* simple status in the header row */}\r\n          <div>\r\n            <div className=\"ms-label\">Status</div>\r\n            <div className=\"ms-value-strong\">\r\n              <span className={badgeClass}>{loan.status || 'â€”'}</span>\r\n            </div>\r\n          </div>\r\n\r\n          <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n            <button\r\n              onClick={() => setThreadLoanId(loanId)}\r\n              className=\"action-btn sm\"\r\n              title=\"Open conversation\"\r\n            >\r\n              ðŸ’¬ Messages\r\n            </button>\r\n            <button\r\n              onClick={() => setExpanded((m) => ({ ...m, [key]: !isExpanded }))}\r\n              className=\"action-btn sm\"\r\n              title=\"View contract\"\r\n            >\r\n              {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            {loan.status && (\r\n              <p className=\"mt-6\">\r\n                <strong>Status:</strong> {loan.status}\r\n              </p>\r\n            )}\r\n            <p className=\"mt-6\">\r\n              <strong>Interest Rate:</strong>{' '}\r\n              {typeof loan.interestRate === 'number'\r\n                ? `${loan.interestRate}%`\r\n                : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Duration:</strong>{' '}\r\n              {typeof loan.duration === 'number'\r\n                ? `${loan.duration} months`\r\n                : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Next Due Date:</strong>{' '}\r\n              {loan.nextDueDate\r\n                ? new Date(loan.nextDueDate).toLocaleDateString()\r\n                : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Installment (this period):</strong>{' '}\r\n              {fmtMoney(loan.installmentAmount)}\r\n            </p>\r\n\r\n            {/* Paid-off note */}\r\n            {isPaidOff && (\r\n              <p className=\"mt-6 ms-muted\">\r\n                <strong>Repayment:</strong> Loan fully repaid. No further\r\n                installments.\r\n              </p>\r\n            )}\r\n\r\n            {/* Borrower view: pay next installment */}\r\n            {isBorrower && !isPaidOff && (\r\n              <div className=\"mt-8\">\r\n                <RepaymentButton loanId={loanId} onPaid={fetchSummary} />\r\n              </div>\r\n            )}\r\n\r\n            {/* Lender view: fund ACCEPTED loans from wallet */}\r\n            {isLender && !isPaidOff && rawStatus === 'ACCEPTED' && (\r\n              <div className=\"mt-8\" style={{ display: 'flex', gap: 8 }}>\r\n                <button\r\n                  className=\"action-btn sm primary\"\r\n                  onClick={() => handleFundLoan(loanId)}\r\n                  disabled={!!funding[loanId]}\r\n                >\r\n                  {funding[loanId] ? 'Fundingâ€¦' : 'Fund from PeerFund wallet'}\r\n                </button>\r\n                <span className=\"ms-muted\" style={{ alignSelf: 'center' }}>\r\n                  Requires enough wallet balance\r\n                </span>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /* ------------------------------- Render ------------------------------- */\r\n\r\n  if (loading)\r\n    return (\r\n      <p className=\"ms-loading ms-container\">Loading money summary...</p>\r\n    );\r\n\r\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\r\n  const received = Array.isArray(summary.loansReceived)\r\n    ? summary.loansReceived\r\n    : [];\r\n  const myOpen = Array.isArray(summary.myOpenRequests)\r\n    ? summary.myOpenRequests\r\n    : [];\r\n\r\n  return (\r\n    <div className=\"ms-container\">\r\n      <h2 className=\"ms-heading\">ðŸ’µ My Money Summary</h2>\r\n\r\n      {/* Section: Open Requests */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, open: !s.open }))}\r\n          aria-expanded={openSec.open}\r\n        >\r\n          <div className=\"ms-subheading\">My Open Loan Requests</div>\r\n          <div className=\"ms-caret\">{openSec.open ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.open && (\r\n          <div className=\"ms-section-body\">\r\n            {myOpen.length === 0 ? (\r\n              <p className=\"ms-empty\">You have no open requests.</p>\r\n            ) : (\r\n              myOpen.map((req) => (\r\n                <OpenRequestRow\r\n                  key={req.id}\r\n                  req={req}\r\n                  isExpanded={!!expanded[req.id]}\r\n                  onToggle={() => toggleDetails(req)}\r\n                  actionLoading={actionLoading}\r\n                  // MARKET + Borrowing: offers block (as a React node)\r\n                  offersContent={\r\n                    req.type === 'market' && req.role === 'Borrowing'\r\n                      ? renderOffersBlock(req.id)\r\n                      : undefined\r\n                  }\r\n                  // MARKET + Lending: open OfferModal\r\n                  onMakeOffer={\r\n                    req.type === 'market' && req.role === 'Lending'\r\n                      ? () => setOfferModalLoanId(req.id)\r\n                      : undefined\r\n                  }\r\n                  // DIRECT actions\r\n                  onAcceptDirect={\r\n                    req.type === 'direct'\r\n                      ? () => acceptDirect(req)\r\n                      : undefined\r\n                  }\r\n                  onDeclineDirect={\r\n                    req.type === 'direct'\r\n                      ? () => declineDirect(req)\r\n                      : undefined\r\n                  }\r\n                />\r\n              ))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Given */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, given: !s.given }))}\r\n          aria-expanded={openSec.given}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Given (I'm the Lender)</div>\r\n          <div className=\"ms-caret\">{openSec.given ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.given && (\r\n          <div className=\"ms-section-body\">\r\n            {given.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans given yet.</p>\r\n            ) : (\r\n              given.map((loan, idx) => renderLoanCard(loan, true, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Received */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() =>\r\n            setOpenSec((s) => ({ ...s, received: !s.received }))\r\n          }\r\n          aria-expanded={openSec.received}\r\n        >\r\n          <div className=\"ms-subheading\">\r\n            Loans Received (I'm the Borrower)\r\n          </div>\r\n          <div className=\"ms-caret\">{openSec.received ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.received && (\r\n          <div className=\"ms-section-body\">\r\n            {received.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans received yet.</p>\r\n            ) : (\r\n              received.map((loan, idx) => renderLoanCard(loan, false, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {threadLoanId && (\r\n        <LoanThreadModal\r\n          loanId={threadLoanId}\r\n          onClose={() => setThreadLoanId(null)}\r\n        />\r\n      )}\r\n\r\n      {offerModalLoanId && (\r\n        <OfferModal\r\n          loanId={offerModalLoanId}\r\n          onClose={() => setOfferModalLoanId(null)}\r\n        />\r\n      )}\r\n\r\n      <LinkBankFirstModal\r\n        open={showLinkModal}\r\n        onClose={() => setShowLinkModal(false)}\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}