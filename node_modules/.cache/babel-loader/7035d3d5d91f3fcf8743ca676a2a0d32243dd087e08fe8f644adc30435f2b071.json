{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx\",\n  _s = $RefreshSig$();\n// src/features/money/MoneySummary.jsx\nimport React, { useEffect, useState, useCallback } from 'react';\nimport './MoneySummary.css';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LoanThreadModal from '../loans/LoanThreadModal';\n\n/* ----------------------- helpers ----------------------- */\n\n// decode JWT for current user id\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction getCurrentUserId() {\n  const t = localStorage.getItem('token');\n  if (!t) return null;\n  try {\n    var _payload$userId;\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\n    return (_payload$userId = payload === null || payload === void 0 ? void 0 : payload.userId) !== null && _payload$userId !== void 0 ? _payload$userId : null;\n  } catch {\n    return null;\n  }\n}\nconst fmtMoney = n => typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\n\n// One-line row layout used across all sections (compact)\nconst ROW_GRID = {\n  display: 'grid',\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\n  alignItems: 'center',\n  gap: 10\n};\n\n/* token + cookies */\nasync function authFetch(url, options = {}) {\n  const token = localStorage.getItem('token');\n  const headers = {\n    ...(options.headers || {}),\n    ...(token ? {\n      Authorization: `Bearer ${token}`\n    } : {})\n  };\n  const res = await fetch(url, {\n    ...options,\n    headers,\n    credentials: 'include'\n  });\n  if (res.status === 401) {\n    try {\n      console.warn('401 on', url, await res.text());\n    } catch {}\n    window.location.assign('/login');\n    throw new Error('Unauthorized');\n  }\n  return res;\n}\n\n/* ------------------ compact row (no negotiate) ------------------ */\n\nfunction OpenRequestRow({\n  req,\n  isExpanded,\n  onToggle,\n  actionLoading,\n  onAccept,\n  onDecline\n}) {\n  var _req$status;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-card\",\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card-row\",\n      style: ROW_GRID,\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Counterparty\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 67,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: [req.counterpartyName || 'Unknown', /*#__PURE__*/_jsxDEV(\"span\", {\n            style: {\n              marginLeft: 8,\n              color: '#64748b',\n              fontWeight: 600\n            },\n            children: [\"\\u2022 \", req.role]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 70,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 68,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 66,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Amount\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 77,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: fmtMoney(req.amount)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 76,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-label\",\n          children: \"Created\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 82,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-value-strong\",\n          children: req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 83,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 81,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          justifySelf: 'end'\n        },\n        children: /*#__PURE__*/_jsxDEV(\"span\", {\n          className: \"ms-badge ms-badge--warn\",\n          children: \"Open\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 89,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 88,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          justifySelf: 'end',\n          display: 'flex',\n          gap: 8\n        },\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onToggle,\n          title: \"View request\",\n          children: \"\\uD83D\\uDCC4 View\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 93,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 92,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 65,\n      columnNumber: 7\n    }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-details\",\n      children: [/*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Your role:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 102,\n          columnNumber: 31\n        }, this), \" \", req.role]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 102,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Status:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 103,\n          columnNumber: 31\n        }, this), \" \", (_req$status = req.status) !== null && _req$status !== void 0 ? _req$status : 'OPEN']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 103,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Interest Rate:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 104,\n          columnNumber: 31\n        }, this), \" \", Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 104,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Duration:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 105,\n          columnNumber: 31\n        }, this), \" \", Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”']\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 105,\n        columnNumber: 11\n      }, this), req.purpose ? /*#__PURE__*/_jsxDEV(\"p\", {\n        className: \"mt-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n          children: \"Reason:\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 107,\n          columnNumber: 33\n        }, this), \" \", req.purpose]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 107,\n        columnNumber: 13\n      }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"mt-8\",\n        style: {\n          display: 'flex',\n          gap: 8,\n          justifyContent: 'flex-end'\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm primary\",\n          onClick: onAccept,\n          disabled: !!actionLoading[req.id],\n          children: actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn sm\",\n          onClick: onDecline,\n          disabled: !!actionLoading[req.id],\n          children: actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 110,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }, this)]\n  }, req.id, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 5\n  }, this);\n}\n\n/* -------------------------------- Parent -------------------------------- */\n_c = OpenRequestRow;\nconst MoneySummary = () => {\n  _s();\n  const [summary, setSummary] = useState({\n    loansGiven: [],\n    loansReceived: [],\n    myOpenRequests: []\n  });\n  const [loading, setLoading] = useState(true);\n  const [expanded, setExpanded] = useState({});\n  const [openSec, setOpenSec] = useState({\n    open: true,\n    given: true,\n    received: true\n  });\n  const [payLoading, setPayLoading] = useState({});\n  const [actionLoading, setActionLoading] = useState({});\n  const [profileUserId, setProfileUserId] = useState(null);\n  const [threadLoanId, setThreadLoanId] = useState(null);\n\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\n\n  // MARKET requests that involve me (as borrower) â€” and we still show them for reference.\n  // For lenders, \"Accept\" sends a quick offer; there is no global \"decline\".\n  const fetchMarketOpenRequests = async () => {\n    const me = getCurrentUserId();\n    if (!me) return [];\n    try {\n      // your route actually lives under /api/loans/open\n      const r = await authFetch('/api/loans/open');\n      if (!r.ok) return [];\n      const listRaw = await r.json();\n      const list = Array.isArray(listRaw) ? listRaw : (listRaw === null || listRaw === void 0 ? void 0 : listRaw.items) || [];\n\n      // Keep only requests that either I created (Borrowing) OR Iâ€™ve already interacted with (if you add that later)\n      return list.filter(req => !!(req !== null && req !== void 0 && req.borrowerId)) // sanity\n      .map(req => {\n        var _req$borrower, _req$duration, _req$interestRate, _req$borrower2, _req$lender, _req$borrower3;\n        const borrowerId = req.borrowerId || (req === null || req === void 0 ? void 0 : (_req$borrower = req.borrower) === null || _req$borrower === void 0 ? void 0 : _req$borrower.id);\n        const iAmBorrower = String(borrowerId) === String(me);\n        return {\n          type: 'market',\n          id: req.id,\n          amount: Number(req.amount),\n          duration: Number((_req$duration = req.duration) !== null && _req$duration !== void 0 ? _req$duration : req.months),\n          interestRate: Number((_req$interestRate = req.interestRate) !== null && _req$interestRate !== void 0 ? _req$interestRate : req.apr),\n          purpose: req.purpose || '',\n          createdAt: req.createdAt || null,\n          borrowerId,\n          borrowerName: (req === null || req === void 0 ? void 0 : (_req$borrower2 = req.borrower) === null || _req$borrower2 === void 0 ? void 0 : _req$borrower2.name) || (iAmBorrower ? 'You' : 'Borrower'),\n          lenderName: (req === null || req === void 0 ? void 0 : (_req$lender = req.lender) === null || _req$lender === void 0 ? void 0 : _req$lender.name) || '',\n          counterpartyName: iAmBorrower ? 'â€”' : (req === null || req === void 0 ? void 0 : (_req$borrower3 = req.borrower) === null || _req$borrower3 === void 0 ? void 0 : _req$borrower3.name) || 'Borrower',\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\n          status: req.status || 'OPEN'\n        };\n      })\n      // If you want to show only requests involving me: keep iAmBorrower;\n      // if you also want to show all open requests I *could* lend to, remove the filter below.\n      .filter(it => it.role === 'Borrowing'); // show only mine in \"My Open Loan Requests\"\n    } catch {\n      return [];\n    }\n  };\n\n  // DIRECT (involves me as borrower or lender)\n  const fetchDirectOpenRequests = async () => {\n    const me = getCurrentUserId();\n    if (!me) return [];\n    try {\n      const r = await authFetch('/api/direct-requests/open/mine'); // your consolidated view\n      if (!r.ok) return [];\n      const rows = await r.json();\n      return (Array.isArray(rows) ? rows : []).map(d => {\n        var _d$borrower, _d$lender, _d$months, _d$apr, _d$borrower2, _d$lender2, _d$lender3, _d$borrower3;\n        const borrowerId = d.borrowerId || (d === null || d === void 0 ? void 0 : (_d$borrower = d.borrower) === null || _d$borrower === void 0 ? void 0 : _d$borrower.id);\n        const lenderId = d.lenderId || (d === null || d === void 0 ? void 0 : (_d$lender = d.lender) === null || _d$lender === void 0 ? void 0 : _d$lender.id);\n        const iAmBorrower = String(borrowerId) === String(me);\n        return {\n          type: 'direct',\n          id: d.id,\n          amount: Number(d.amount),\n          duration: Number((_d$months = d.months) !== null && _d$months !== void 0 ? _d$months : d.duration),\n          interestRate: Number((_d$apr = d.apr) !== null && _d$apr !== void 0 ? _d$apr : d.interestRate),\n          createdAt: d.createdAt || null,\n          borrowerId,\n          borrowerName: (d === null || d === void 0 ? void 0 : (_d$borrower2 = d.borrower) === null || _d$borrower2 === void 0 ? void 0 : _d$borrower2.name) || (iAmBorrower ? 'You' : ''),\n          lenderId,\n          lenderName: (d === null || d === void 0 ? void 0 : (_d$lender2 = d.lender) === null || _d$lender2 === void 0 ? void 0 : _d$lender2.name) || (!iAmBorrower ? 'You' : ''),\n          counterpartyName: iAmBorrower ? (d === null || d === void 0 ? void 0 : (_d$lender3 = d.lender) === null || _d$lender3 === void 0 ? void 0 : _d$lender3.name) || 'Lender' : (d === null || d === void 0 ? void 0 : (_d$borrower3 = d.borrower) === null || _d$borrower3 === void 0 ? void 0 : _d$borrower3.name) || 'Borrower',\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\n          status: d.status || 'PENDING'\n        };\n      });\n    } catch {\n      return [];\n    }\n  };\n  const fetchSummary = useCallback(async () => {\n    const token = localStorage.getItem('token');\n    if (!token) return;\n    setLoading(true);\n    try {\n      // my funded/active loans\n      const res = await authFetch('/api/users/my-money-summary');\n      let loansGiven = [];\n      let loansReceived = [];\n      if (res.ok) {\n        const data = await res.json();\n        loansGiven = Array.isArray(data.loansGiven) ? data.loansGiven : Array.isArray(data.loansAsLender) ? data.loansAsLender : [];\n        loansReceived = Array.isArray(data.loansReceived) ? data.loansReceived : Array.isArray(data.loansAsBorrower) ? data.loansAsBorrower : [];\n      }\n      const [marketOpen, directOpen] = await Promise.all([fetchMarketOpenRequests(), fetchDirectOpenRequests()]);\n\n      // Combine: borrower-side market requests + all direct requests involving me\n      const myOpenRequests = [...marketOpen, ...directOpen];\n      setSummary({\n        loansGiven,\n        loansReceived,\n        myOpenRequests\n      });\n    } catch (err) {\n      console.error('Error fetching money summary:', err);\n      setSummary({\n        loansGiven: [],\n        loansReceived: [],\n        myOpenRequests: []\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, []);\n  useEffect(() => {\n    fetchSummary();\n  }, [fetchSummary]);\n  const loanKey = (loan, idx) => (loan === null || loan === void 0 ? void 0 : loan.id) || (loan === null || loan === void 0 ? void 0 : loan._id) || String(idx);\n  const toggleDetails = id => {\n    setExpanded(prev => ({\n      ...Object.keys(prev).reduce((acc, k) => ({\n        ...acc,\n        [k]: false\n      }), {}),\n      [id]: !prev[id]\n    }));\n  };\n\n  /* -------------------- Accept / Decline actions -------------------- */\n\n  async function tryEndpoints(methods, url, body) {\n    const optionsBase = {\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: body ? JSON.stringify(body) : undefined\n    };\n    let lastErr = null;\n    for (const method of methods) {\n      try {\n        const r = await authFetch(url, {\n          method,\n          ...optionsBase\n        });\n        if (r.ok) return r;\n        const txt = await r.text().catch(() => '');\n        lastErr = new Error(`${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`);\n      } catch (e) {\n        lastErr = e;\n      }\n    }\n    throw lastErr || new Error('All methods failed');\n  }\n\n  // Market: Accept == send a quick offer with the requestâ€™s own terms\n  const sendQuickOffer = async req => {\n    const res = await authFetch(`/api/loans/${req.id}/offers`, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify({\n        interestRate: req.interestRate,\n        // server ignores amount/duration & uses canonical\n        message: ''\n      })\n    });\n    if (!res.ok) {\n      const t = await res.text().catch(() => '');\n      throw new Error(t || 'Failed to submit offer');\n    }\n  };\n  const acceptRequest = async req => {\n    setActionLoading(m => ({\n      ...m,\n      [req.id]: true\n    }));\n    try {\n      if (req.type === 'market') {\n        await sendQuickOffer(req);\n        alert('Offer sent to borrower!');\n      } else {\n        // direct request -> approve\n        const urls = [`/api/direct-requests/${req.id}/approve`, `/api/direct-requests/${req.id}/accept`, `/api/direct-requests/${req.id}/respond?action=ACCEPT`];\n        let ok = false;\n        let last = null;\n        for (const u of urls) {\n          try {\n            await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\n            ok = true;\n            break;\n          } catch (e) {\n            last = e;\n          }\n        }\n        if (!ok) throw last || new Error('Approve failed');\n      }\n      await fetchSummary();\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setActionLoading(m => ({\n        ...m,\n        [req.id]: false\n      }));\n    }\n  };\n  const declineRequest = async req => {\n    setActionLoading(m => ({\n      ...m,\n      [req.id]: true\n    }));\n    try {\n      if (req.type === 'market') {\n        // no global decline; just hide locally\n        setSummary(s => ({\n          ...s,\n          myOpenRequests: s.myOpenRequests.filter(r => r.id !== req.id)\n        }));\n        return;\n      } else {\n        const urls = [`/api/direct-requests/${req.id}/decline`, `/api/direct-requests/${req.id}/reject`, `/api/direct-requests/${req.id}/respond?action=DECLINE`];\n        let ok = false;\n        let last = null;\n        for (const u of urls) {\n          try {\n            await tryEndpoints(['POST', 'PUT', 'PATCH'], u);\n            ok = true;\n            break;\n          } catch (e) {\n            last = e;\n          }\n        }\n        if (!ok) throw last || new Error('Decline failed');\n      }\n      await fetchSummary();\n    } catch (e) {\n      console.error(e);\n      alert(`Action failed:\\n${e.message || e}`);\n    } finally {\n      setActionLoading(m => ({\n        ...m,\n        [req.id]: false\n      }));\n    }\n  };\n\n  /* ------------------------------- Loan cards (unchanged) ------------------------------- */\n\n  const renderLoanCard = (loan, isLender, idx) => {\n    const key = loanKey(loan, idx);\n    const isExpanded = !!expanded[key];\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\n    const canPay = !isLender && typeof loan.installmentAmount === 'number' && loan.installmentAmount > 0 && !!loan.nextDueDate;\n    const badgeClass = (loan.status || '').toUpperCase() === 'FUNDED' ? 'ms-badge ms-badge--ok' : 'ms-badge ms-badge--warn';\n    const fundedDate = loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-card-row\",\n        style: ROW_GRID,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: isLender ? 'Borrower' : 'Lender'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 408,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: otherParty || 'Unknown'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 409,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 407,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Amount\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 412,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fmtMoney(loan.amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 413,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 411,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Funded Date\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 416,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fundedDate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 417,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 415,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            justifySelf: 'end'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: badgeClass,\n            children: loan.status || 'â€”'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 420,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 419,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            justifySelf: 'end',\n            display: 'flex',\n            gap: 8\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setThreadLoanId(loan.id || loan._id),\n            className: \"action-btn sm\",\n            title: \"Open conversation\",\n            children: \"\\uD83D\\uDCAC Messages\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: () => setExpanded(m => ({\n              ...m,\n              [key]: !isExpanded\n            })),\n            className: \"action-btn sm\",\n            title: \"View contract\",\n            children: isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 430,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 422,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 406,\n        columnNumber: 9\n      }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-details\",\n        children: [loan.status && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 443,\n            columnNumber: 35\n          }, this), \" \", loan.status]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Interest Rate:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 445,\n            columnNumber: 33\n          }, this), \" \", typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 445,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Duration:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 446,\n            columnNumber: 33\n          }, this), \" \", typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Next Due Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 447,\n            columnNumber: 33\n          }, this), \" \", loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 447,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Installment (this period):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 448,\n            columnNumber: 33\n          }, this), \" \", fmtMoney(loan.installmentAmount)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 448,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 441,\n        columnNumber: 11\n      }, this)]\n    }, key, true, {\n      fileName: _jsxFileName,\n      lineNumber: 405,\n      columnNumber: 7\n    }, this);\n  };\n\n  /* ------------------------------- Render ------------------------------- */\n\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"ms-loading ms-container\",\n    children: \"Loading money summary...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 457,\n    columnNumber: 23\n  }, this);\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"ms-heading\",\n      children: \"\\uD83D\\uDCB5 My Money Summary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 465,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          open: !s.open\n        })),\n        \"aria-expanded\": openSec.open,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"My Open Loan Requests\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 474,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.open ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 475,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 469,\n        columnNumber: 9\n      }, this), openSec.open && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: myOpen.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"You have no open requests.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 480,\n          columnNumber: 15\n        }, this) : myOpen.map(req => /*#__PURE__*/_jsxDEV(OpenRequestRow, {\n          req: req,\n          isExpanded: !!expanded[req.id],\n          onToggle: () => toggleDetails(req.id),\n          actionLoading: actionLoading,\n          onAccept: () => acceptRequest(req),\n          onDecline: () => declineRequest(req)\n        }, req.id, false, {\n          fileName: _jsxFileName,\n          lineNumber: 483,\n          columnNumber: 17\n        }, this))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 478,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 468,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          given: !s.given\n        })),\n        \"aria-expanded\": openSec.given,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Given (I'm the Lender)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 505,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.given ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 506,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 500,\n        columnNumber: 9\n      }, this), openSec.given && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: given.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans given yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 511,\n          columnNumber: 15\n        }, this) : given.map((loan, idx) => renderLoanCard(loan, true, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 509,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 499,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          received: !s.received\n        })),\n        \"aria-expanded\": openSec.received,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Received (I'm the Borrower)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 526,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.received ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 527,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 521,\n        columnNumber: 9\n      }, this), openSec.received && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: received.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans received yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 532,\n          columnNumber: 15\n        }, this) : received.map((loan, idx) => renderLoanCard(loan, false, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 530,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 520,\n      columnNumber: 7\n    }, this), profileUserId && /*#__PURE__*/_jsxDEV(UserProfileModal, {\n      userId: profileUserId,\n      onClose: () => setProfileUserId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 541,\n      columnNumber: 9\n    }, this), threadLoanId && /*#__PURE__*/_jsxDEV(LoanThreadModal, {\n      loanId: threadLoanId,\n      onClose: () => setThreadLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 544,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 464,\n    columnNumber: 5\n  }, this);\n};\n_s(MoneySummary, \"FUNx3gRlSivYcy3OJtluZvZKQog=\");\n_c2 = MoneySummary;\nexport default MoneySummary;\nvar _c, _c2;\n$RefreshReg$(_c, \"OpenRequestRow\");\n$RefreshReg$(_c2, \"MoneySummary\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","UserProfileModal","LoanThreadModal","jsxDEV","_jsxDEV","getCurrentUserId","t","localStorage","getItem","_payload$userId","payload","JSON","parse","atob","split","userId","fmtMoney","n","Number","isNaN","toFixed","ROW_GRID","display","gridTemplateColumns","alignItems","gap","authFetch","url","options","token","headers","Authorization","res","fetch","credentials","status","console","warn","text","window","location","assign","Error","OpenRequestRow","req","isExpanded","onToggle","actionLoading","onAccept","onDecline","_req$status","className","children","style","fileName","_jsxFileName","lineNumber","columnNumber","counterpartyName","marginLeft","color","fontWeight","role","amount","createdAt","Date","toLocaleDateString","justifySelf","onClick","title","isFinite","interestRate","duration","purpose","justifyContent","disabled","id","_c","MoneySummary","_s","summary","setSummary","loansGiven","loansReceived","myOpenRequests","loading","setLoading","expanded","setExpanded","openSec","setOpenSec","open","given","received","payLoading","setPayLoading","setActionLoading","profileUserId","setProfileUserId","threadLoanId","setThreadLoanId","fetchMarketOpenRequests","me","r","ok","listRaw","json","list","Array","isArray","items","filter","borrowerId","map","_req$borrower","_req$duration","_req$interestRate","_req$borrower2","_req$lender","_req$borrower3","borrower","iAmBorrower","String","type","months","apr","borrowerName","name","lenderName","lender","it","fetchDirectOpenRequests","rows","d","_d$borrower","_d$lender","_d$months","_d$apr","_d$borrower2","_d$lender2","_d$lender3","_d$borrower3","lenderId","fetchSummary","data","loansAsLender","loansAsBorrower","marketOpen","directOpen","Promise","all","err","error","loanKey","loan","idx","_id","toggleDetails","prev","Object","keys","reduce","acc","k","tryEndpoints","methods","body","optionsBase","stringify","undefined","lastErr","method","txt","catch","statusText","e","sendQuickOffer","message","acceptRequest","m","alert","urls","last","u","declineRequest","s","renderLoanCard","isLender","key","otherParty","canPay","installmentAmount","nextDueDate","badgeClass","toUpperCase","fundedDate","myOpen","length","onClose","loanId","_c2","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx"],"sourcesContent":["// src/features/money/MoneySummary.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport './MoneySummary.css';\r\nimport UserProfileModal from '../../components/UserProfileModal';\r\nimport LoanThreadModal from '../loans/LoanThreadModal';\r\n\r\n/* ----------------------- helpers ----------------------- */\r\n\r\n// decode JWT for current user id\r\nfunction getCurrentUserId() {\r\n  const t = localStorage.getItem('token');\r\n  if (!t) return null;\r\n  try {\r\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\r\n    return payload?.userId ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nconst fmtMoney = (n) =>\r\n  typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\r\n\r\n// One-line row layout used across all sections (compact)\r\nconst ROW_GRID = {\r\n  display: 'grid',\r\n  gridTemplateColumns: 'minmax(140px,1fr) 120px 140px auto auto',\r\n  alignItems: 'center',\r\n  gap: 10,\r\n};\r\n\r\n/* token + cookies */\r\nasync function authFetch(url, options = {}) {\r\n  const token = localStorage.getItem('token');\r\n  const headers = {\r\n    ...(options.headers || {}),\r\n    ...(token ? { Authorization: `Bearer ${token}` } : {}),\r\n  };\r\n  const res = await fetch(url, {\r\n    ...options,\r\n    headers,\r\n    credentials: 'include',\r\n  });\r\n  if (res.status === 401) {\r\n    try { console.warn('401 on', url, await res.text()); } catch {}\r\n    window.location.assign('/login');\r\n    throw new Error('Unauthorized');\r\n  }\r\n  return res;\r\n}\r\n\r\n/* ------------------ compact row (no negotiate) ------------------ */\r\n\r\nfunction OpenRequestRow({\r\n  req,\r\n  isExpanded,\r\n  onToggle,\r\n  actionLoading,\r\n  onAccept,\r\n  onDecline,\r\n}) {\r\n  return (\r\n    <div className=\"ms-card\" key={req.id}>\r\n      {/* ONE-LINE TOP ROW */}\r\n      <div className=\"ms-card-row\" style={ROW_GRID}>\r\n        <div>\r\n          <div className=\"ms-label\">Counterparty</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.counterpartyName || 'Unknown'}\r\n            <span style={{ marginLeft: 8, color: '#64748b', fontWeight: 600 }}>\r\n              â€¢ {req.role}\r\n            </span>\r\n          </div>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"ms-label\">Amount</div>\r\n          <div className=\"ms-value-strong\">{fmtMoney(req.amount)}</div>\r\n        </div>\r\n\r\n        <div>\r\n          <div className=\"ms-label\">Created</div>\r\n          <div className=\"ms-value-strong\">\r\n            {req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'}\r\n          </div>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end' }}>\r\n          <span className=\"ms-badge ms-badge--warn\">Open</span>\r\n        </div>\r\n\r\n        <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n          <button className=\"action-btn sm\" onClick={onToggle} title=\"View request\">\r\n            ðŸ“„ View\r\n          </button>\r\n        </div>\r\n      </div>\r\n\r\n      {/* DETAILS (read-only) + actions */}\r\n      {isExpanded && (\r\n        <div className=\"ms-details\">\r\n          <p className=\"mt-6\"><strong>Your role:</strong> {req.role}</p>\r\n          <p className=\"mt-6\"><strong>Status:</strong> {req.status ?? 'OPEN'}</p>\r\n          <p className=\"mt-6\"><strong>Interest Rate:</strong> {Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”'}</p>\r\n          <p className=\"mt-6\"><strong>Duration:</strong> {Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”'}</p>\r\n          {req.purpose ? (\r\n            <p className=\"mt-6\"><strong>Reason:</strong> {req.purpose}</p>\r\n          ) : null}\r\n\r\n          <div className=\"mt-8\" style={{ display: 'flex', gap: 8, justifyContent: 'flex-end' }}>\r\n            <button\r\n              className=\"action-btn sm primary\"\r\n              onClick={onAccept}\r\n              disabled={!!actionLoading[req.id]}\r\n            >\r\n              {actionLoading[req.id] ? 'Workingâ€¦' : 'Accept'}\r\n            </button>\r\n            <button\r\n              className=\"action-btn sm\"\r\n              onClick={onDecline}\r\n              disabled={!!actionLoading[req.id]}\r\n            >\r\n              {actionLoading[req.id] ? 'Workingâ€¦' : 'Decline'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* -------------------------------- Parent -------------------------------- */\r\n\r\nconst MoneySummary = () => {\r\n  const [summary, setSummary] = useState({\r\n    loansGiven: [],\r\n    loansReceived: [],\r\n    myOpenRequests: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  const [expanded, setExpanded] = useState({});\r\n  const [openSec, setOpenSec] = useState({ open: true, given: true, received: true });\r\n\r\n  const [payLoading, setPayLoading] = useState({});\r\n  const [actionLoading, setActionLoading] = useState({});\r\n  const [profileUserId, setProfileUserId] = useState(null);\r\n  const [threadLoanId, setThreadLoanId] = useState(null);\r\n\r\n  /* ------------------ Fetch helpers (market + direct) ------------------ */\r\n\r\n  // MARKET requests that involve me (as borrower) â€” and we still show them for reference.\r\n  // For lenders, \"Accept\" sends a quick offer; there is no global \"decline\".\r\n  const fetchMarketOpenRequests = async () => {\r\n    const me = getCurrentUserId();\r\n    if (!me) return [];\r\n\r\n    try {\r\n      // your route actually lives under /api/loans/open\r\n      const r = await authFetch('/api/loans/open');\r\n      if (!r.ok) return [];\r\n      const listRaw = await r.json();\r\n      const list = Array.isArray(listRaw) ? listRaw : listRaw?.items || [];\r\n\r\n      // Keep only requests that either I created (Borrowing) OR Iâ€™ve already interacted with (if you add that later)\r\n      return list\r\n        .filter((req) => !!req?.borrowerId) // sanity\r\n        .map((req) => {\r\n          const borrowerId = req.borrowerId || req?.borrower?.id;\r\n          const iAmBorrower = String(borrowerId) === String(me);\r\n\r\n          return {\r\n            type: 'market',\r\n            id: req.id,\r\n            amount: Number(req.amount),\r\n            duration: Number(req.duration ?? req.months),\r\n            interestRate: Number(req.interestRate ?? req.apr),\r\n            purpose: req.purpose || '',\r\n            createdAt: req.createdAt || null,\r\n            borrowerId,\r\n            borrowerName: req?.borrower?.name || (iAmBorrower ? 'You' : 'Borrower'),\r\n            lenderName: req?.lender?.name || '',\r\n            counterpartyName: iAmBorrower ? 'â€”' : (req?.borrower?.name || 'Borrower'),\r\n            role: iAmBorrower ? 'Borrowing' : 'Lending',\r\n            status: req.status || 'OPEN',\r\n          };\r\n        })\r\n        // If you want to show only requests involving me: keep iAmBorrower;\r\n        // if you also want to show all open requests I *could* lend to, remove the filter below.\r\n        .filter((it) => it.role === 'Borrowing'); // show only mine in \"My Open Loan Requests\"\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  // DIRECT (involves me as borrower or lender)\r\n  const fetchDirectOpenRequests = async () => {\r\n    const me = getCurrentUserId();\r\n    if (!me) return [];\r\n\r\n    try {\r\n      const r = await authFetch('/api/direct-requests/open/mine'); // your consolidated view\r\n      if (!r.ok) return [];\r\n      const rows = await r.json();\r\n\r\n      return (Array.isArray(rows) ? rows : []).map((d) => {\r\n        const borrowerId = d.borrowerId || d?.borrower?.id;\r\n        const lenderId = d.lenderId || d?.lender?.id;\r\n        const iAmBorrower = String(borrowerId) === String(me);\r\n\r\n        return {\r\n          type: 'direct',\r\n          id: d.id,\r\n          amount: Number(d.amount),\r\n          duration: Number(d.months ?? d.duration),\r\n          interestRate: Number(d.apr ?? d.interestRate),\r\n          createdAt: d.createdAt || null,\r\n          borrowerId,\r\n          borrowerName: d?.borrower?.name || (iAmBorrower ? 'You' : ''),\r\n          lenderId,\r\n          lenderName: d?.lender?.name || (!iAmBorrower ? 'You' : ''),\r\n          counterpartyName: iAmBorrower\r\n            ? d?.lender?.name || 'Lender'\r\n            : d?.borrower?.name || 'Borrower',\r\n          role: iAmBorrower ? 'Borrowing' : 'Lending',\r\n          status: d.status || 'PENDING',\r\n        };\r\n      });\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const fetchSummary = useCallback(async () => {\r\n    const token = localStorage.getItem('token');\r\n    if (!token) return;\r\n    setLoading(true);\r\n    try {\r\n      // my funded/active loans\r\n      const res = await authFetch('/api/users/my-money-summary');\r\n      let loansGiven = [];\r\n      let loansReceived = [];\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        loansGiven = Array.isArray(data.loansGiven)\r\n          ? data.loansGiven\r\n          : Array.isArray(data.loansAsLender)\r\n          ? data.loansAsLender\r\n          : [];\r\n        loansReceived = Array.isArray(data.loansReceived)\r\n          ? data.loansReceived\r\n          : Array.isArray(data.loansAsBorrower)\r\n          ? data.loansAsBorrower\r\n          : [];\r\n      }\r\n\r\n      const [marketOpen, directOpen] = await Promise.all([\r\n        fetchMarketOpenRequests(),\r\n        fetchDirectOpenRequests(),\r\n      ]);\r\n\r\n      // Combine: borrower-side market requests + all direct requests involving me\r\n      const myOpenRequests = [...marketOpen, ...directOpen];\r\n\r\n      setSummary({ loansGiven, loansReceived, myOpenRequests });\r\n    } catch (err) {\r\n      console.error('Error fetching money summary:', err);\r\n      setSummary({ loansGiven: [], loansReceived: [], myOpenRequests: [] });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, []);\r\n\r\n  useEffect(() => { fetchSummary(); }, [fetchSummary]);\r\n\r\n  const loanKey = (loan, idx) => loan?.id || loan?._id || String(idx);\r\n\r\n  const toggleDetails = (id) => {\r\n    setExpanded((prev) => ({\r\n      ...(Object.keys(prev).reduce((acc, k) => ({ ...acc, [k]: false }), {})),\r\n      [id]: !prev[id],\r\n    }));\r\n  };\r\n\r\n  /* -------------------- Accept / Decline actions -------------------- */\r\n\r\n  async function tryEndpoints(methods, url, body) {\r\n    const optionsBase = {\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: body ? JSON.stringify(body) : undefined,\r\n    };\r\n    let lastErr = null;\r\n    for (const method of methods) {\r\n      try {\r\n        const r = await authFetch(url, { method, ...optionsBase });\r\n        if (r.ok) return r;\r\n        const txt = await r.text().catch(() => '');\r\n        lastErr = new Error(`${r.status} ${r.statusText}${txt ? ` â€¢ ${txt}` : ''}`);\r\n      } catch (e) {\r\n        lastErr = e;\r\n      }\r\n    }\r\n    throw lastErr || new Error('All methods failed');\r\n  }\r\n\r\n  // Market: Accept == send a quick offer with the requestâ€™s own terms\r\n  const sendQuickOffer = async (req) => {\r\n    const res = await authFetch(`/api/loans/${req.id}/offers`, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json' },\r\n      body: JSON.stringify({\r\n        interestRate: req.interestRate, // server ignores amount/duration & uses canonical\r\n        message: '',\r\n      }),\r\n    });\r\n    if (!res.ok) {\r\n      const t = await res.text().catch(() => '');\r\n      throw new Error(t || 'Failed to submit offer');\r\n    }\r\n  };\r\n\r\n  const acceptRequest = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      if (req.type === 'market') {\r\n        await sendQuickOffer(req);\r\n        alert('Offer sent to borrower!');\r\n      } else {\r\n        // direct request -> approve\r\n        const urls = [\r\n          `/api/direct-requests/${req.id}/approve`,\r\n          `/api/direct-requests/${req.id}/accept`,\r\n          `/api/direct-requests/${req.id}/respond?action=ACCEPT`,\r\n        ];\r\n        let ok = false; let last = null;\r\n        for (const u of urls) {\r\n          try { await tryEndpoints(['POST','PUT','PATCH'], u); ok = true; break; }\r\n          catch (e) { last = e; }\r\n        }\r\n        if (!ok) throw last || new Error('Approve failed');\r\n      }\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  const declineRequest = async (req) => {\r\n    setActionLoading((m) => ({ ...m, [req.id]: true }));\r\n    try {\r\n      if (req.type === 'market') {\r\n        // no global decline; just hide locally\r\n        setSummary((s) => ({\r\n          ...s,\r\n          myOpenRequests: s.myOpenRequests.filter((r) => r.id !== req.id),\r\n        }));\r\n        return;\r\n      } else {\r\n        const urls = [\r\n          `/api/direct-requests/${req.id}/decline`,\r\n          `/api/direct-requests/${req.id}/reject`,\r\n          `/api/direct-requests/${req.id}/respond?action=DECLINE`,\r\n        ];\r\n        let ok = false; let last = null;\r\n        for (const u of urls) {\r\n          try { await tryEndpoints(['POST','PUT','PATCH'], u); ok = true; break; }\r\n          catch (e) { last = e; }\r\n        }\r\n        if (!ok) throw last || new Error('Decline failed');\r\n      }\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      console.error(e);\r\n      alert(`Action failed:\\n${e.message || e}`);\r\n    } finally {\r\n      setActionLoading((m) => ({ ...m, [req.id]: false }));\r\n    }\r\n  };\r\n\r\n  /* ------------------------------- Loan cards (unchanged) ------------------------------- */\r\n\r\n  const renderLoanCard = (loan, isLender, idx) => {\r\n    const key = loanKey(loan, idx);\r\n    const isExpanded = !!expanded[key];\r\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\r\n\r\n    const canPay =\r\n      !isLender &&\r\n      typeof loan.installmentAmount === 'number' &&\r\n      loan.installmentAmount > 0 &&\r\n      !!loan.nextDueDate;\r\n\r\n    const badgeClass =\r\n      (loan.status || '').toUpperCase() === 'FUNDED'\r\n        ? 'ms-badge ms-badge--ok'\r\n        : 'ms-badge ms-badge--warn';\r\n\r\n    const fundedDate =\r\n      loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\r\n\r\n    return (\r\n      <div className=\"ms-card\" key={key}>\r\n        <div className=\"ms-card-row\" style={ROW_GRID}>\r\n          <div>\r\n            <div className=\"ms-label\">{isLender ? 'Borrower' : 'Lender'}</div>\r\n            <div className=\"ms-value-strong\">{otherParty || 'Unknown'}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(loan.amount)}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Funded Date</div>\r\n            <div className=\"ms-value-strong\">{fundedDate}</div>\r\n          </div>\r\n          <div style={{ justifySelf: 'end' }}>\r\n            <span className={badgeClass}>{loan.status || 'â€”'}</span>\r\n          </div>\r\n          <div style={{ justifySelf: 'end', display: 'flex', gap: 8 }}>\r\n            <button\r\n              onClick={() => setThreadLoanId(loan.id || loan._id)}\r\n              className=\"action-btn sm\"\r\n              title=\"Open conversation\"\r\n            >\r\n              ðŸ’¬ Messages\r\n            </button>\r\n            <button\r\n              onClick={() => setExpanded((m) => ({ ...m, [key]: !isExpanded }))}\r\n              className=\"action-btn sm\"\r\n              title=\"View contract\"\r\n            >\r\n              {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n            </button>\r\n          </div>\r\n        </div>\r\n\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            {loan.status && (\r\n              <p className=\"mt-6\"><strong>Status:</strong> {loan.status}</p>\r\n            )}\r\n            <p className=\"mt-6\"><strong>Interest Rate:</strong> {typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”'}</p>\r\n            <p className=\"mt-6\"><strong>Duration:</strong> {typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”'}</p>\r\n            <p className=\"mt-6\"><strong>Next Due Date:</strong> {loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”'}</p>\r\n            <p className=\"mt-6\"><strong>Installment (this period):</strong> {fmtMoney(loan.installmentAmount)}</p>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  /* ------------------------------- Render ------------------------------- */\r\n\r\n  if (loading) return <p className=\"ms-loading ms-container\">Loading money summary...</p>;\r\n\r\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\r\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\r\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\r\n\r\n  return (\r\n    <div className=\"ms-container\">\r\n      <h2 className=\"ms-heading\">ðŸ’µ My Money Summary</h2>\r\n\r\n      {/* Section: Open Requests */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, open: !s.open }))}\r\n          aria-expanded={openSec.open}\r\n        >\r\n          <div className=\"ms-subheading\">My Open Loan Requests</div>\r\n          <div className=\"ms-caret\">{openSec.open ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.open && (\r\n          <div className=\"ms-section-body\">\r\n            {myOpen.length === 0 ? (\r\n              <p className=\"ms-empty\">You have no open requests.</p>\r\n            ) : (\r\n              myOpen.map((req) => (\r\n                <OpenRequestRow\r\n                  key={req.id}\r\n                  req={req}\r\n                  isExpanded={!!expanded[req.id]}\r\n                  onToggle={() => toggleDetails(req.id)}\r\n                  actionLoading={actionLoading}\r\n                  onAccept={() => acceptRequest(req)}\r\n                  onDecline={() => declineRequest(req)}\r\n                />\r\n              ))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Given */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, given: !s.given }))}\r\n          aria-expanded={openSec.given}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Given (I'm the Lender)</div>\r\n          <div className=\"ms-caret\">{openSec.given ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.given && (\r\n          <div className=\"ms-section-body\">\r\n            {given.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans given yet.</p>\r\n            ) : (\r\n              given.map((loan, idx) => renderLoanCard(loan, true, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Received */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, received: !s.received }))}\r\n          aria-expanded={openSec.received}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Received (I'm the Borrower)</div>\r\n          <div className=\"ms-caret\">{openSec.received ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.received && (\r\n          <div className=\"ms-section-body\">\r\n            {received.length === 0 ? (\r\n              <p className=\"ms-empty\">No loans received yet.</p>\r\n            ) : (\r\n              received.map((loan, idx) => renderLoanCard(loan, false, idx))\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {profileUserId && (\r\n        <UserProfileModal userId={profileUserId} onClose={() => setProfileUserId(null)} />\r\n      )}\r\n      {threadLoanId && (\r\n        <LoanThreadModal loanId={threadLoanId} onClose={() => setThreadLoanId(null)} />\r\n      )}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MoneySummary;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}