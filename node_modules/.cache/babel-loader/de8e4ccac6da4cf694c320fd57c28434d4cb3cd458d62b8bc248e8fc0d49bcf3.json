{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/LinkLoanBankButton.jsx\",\n  _s = $RefreshSig$();\n// src/features/loans/LinkLoanBankButton.jsx\nimport React, { useState } from 'react';\nimport { useStripe } from '@stripe/react-stripe-js';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function LinkLoanBankButton({\n  onLinked\n}) {\n  _s();\n  const stripe = useStripe();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n  const linkBankForLoan = async () => {\n    try {\n      var _confirmed$setupInten;\n      setLoading(true);\n      setError('');\n\n      // Step 0️⃣: Ensure Stripe Customer exists (borrower identity)\n      await fetch('/api/stripe/ensure-customer', {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n\n      // Step 1️⃣: Create SetupIntent specifically for loan ACH funding\n      const res = await fetch('/api/stripe/create-bank-setup-intent', {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        }\n      });\n      const data = await res.json();\n      if (!data.client_secret) throw new Error('Missing client secret from SetupIntent');\n\n      // Step 2️⃣: Collect bank account using Financial Connections\n      const result = await stripe.collectBankAccountForSetup({\n        clientSecret: data.client_secret,\n        params: {\n          payment_method_type: 'us_bank_account'\n        }\n      });\n      if (result.error) throw result.error;\n\n      // Step 3️⃣: Confirm and attach to customer\n      const confirmed = await stripe.confirmBankAccountSetup(data.client_secret);\n      if (confirmed.error) throw confirmed.error;\n      const paymentMethodId = confirmed === null || confirmed === void 0 ? void 0 : (_confirmed$setupInten = confirmed.setupIntent) === null || _confirmed$setupInten === void 0 ? void 0 : _confirmed$setupInten.payment_method;\n      if (!paymentMethodId) throw new Error('No paymentMethod returned from Stripe');\n\n      // Step 4️⃣: Tell backend to save PM AS LOAN FUNDING PM (isForLoans=true)\n      const saveRes = await fetch('/api/stripe/save-loan-payment-method', {\n        method: 'POST',\n        credentials: 'include',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          paymentMethodId\n        })\n      });\n      const saveJson = await saveRes.json();\n      if (!saveJson.success) throw new Error(saveJson.error || 'Failed to save loan PM');\n      if (onLinked) onLinked(paymentMethodId);\n      alert('✅ Bank linked for loan funding successfully!');\n    } catch (err) {\n      console.error('Loan bank linking error:', err);\n      setError(err.message || 'Failed to link bank for loan funding');\n    } finally {\n      setLoading(false);\n    }\n  };\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: 10\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"button\", {\n      onClick: linkBankForLoan,\n      disabled: loading || !stripe,\n      style: {\n        background: '#4f46e5',\n        color: 'white',\n        padding: '8px 12px',\n        borderRadius: 6,\n        cursor: loading ? 'not-allowed' : 'pointer'\n      },\n      children: loading ? 'Linking…' : 'Link Bank for Loan Funding'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 69,\n      columnNumber: 7\n    }, this), error && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        color: 'red',\n        marginTop: 8\n      },\n      children: error\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 68,\n    columnNumber: 5\n  }, this);\n}\n_s(LinkLoanBankButton, \"0AaghWOhI+HmE3XWhHHlsbj70i0=\", false, function () {\n  return [useStripe];\n});\n_c = LinkLoanBankButton;\nvar _c;\n$RefreshReg$(_c, \"LinkLoanBankButton\");","map":{"version":3,"names":["React","useState","useStripe","jsxDEV","_jsxDEV","LinkLoanBankButton","onLinked","_s","stripe","loading","setLoading","error","setError","linkBankForLoan","_confirmed$setupInten","fetch","method","credentials","headers","res","data","json","client_secret","Error","result","collectBankAccountForSetup","clientSecret","params","payment_method_type","confirmed","confirmBankAccountSetup","paymentMethodId","setupIntent","payment_method","saveRes","body","JSON","stringify","saveJson","success","alert","err","console","message","style","marginTop","children","onClick","disabled","background","color","padding","borderRadius","cursor","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/loans/LinkLoanBankButton.jsx"],"sourcesContent":["// src/features/loans/LinkLoanBankButton.jsx\nimport React, { useState } from 'react';\nimport { useStripe } from '@stripe/react-stripe-js';\n\nexport default function LinkLoanBankButton({ onLinked }) {\n  const stripe = useStripe();\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState('');\n\n  const linkBankForLoan = async () => {\n    try {\n      setLoading(true);\n      setError('');\n\n      // Step 0️⃣: Ensure Stripe Customer exists (borrower identity)\n      await fetch('/api/stripe/ensure-customer', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n      });\n\n      // Step 1️⃣: Create SetupIntent specifically for loan ACH funding\n      const res = await fetch('/api/stripe/create-bank-setup-intent', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n      });\n      const data = await res.json();\n      if (!data.client_secret) throw new Error('Missing client secret from SetupIntent');\n\n      // Step 2️⃣: Collect bank account using Financial Connections\n      const result = await stripe.collectBankAccountForSetup({\n        clientSecret: data.client_secret,\n        params: { payment_method_type: 'us_bank_account' },\n      });\n\n      if (result.error) throw result.error;\n\n      // Step 3️⃣: Confirm and attach to customer\n      const confirmed = await stripe.confirmBankAccountSetup(data.client_secret);\n      if (confirmed.error) throw confirmed.error;\n\n      const paymentMethodId = confirmed?.setupIntent?.payment_method;\n      if (!paymentMethodId) throw new Error('No paymentMethod returned from Stripe');\n\n      // Step 4️⃣: Tell backend to save PM AS LOAN FUNDING PM (isForLoans=true)\n      const saveRes = await fetch('/api/stripe/save-loan-payment-method', {\n        method: 'POST',\n        credentials: 'include',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ paymentMethodId }),\n      });\n\n      const saveJson = await saveRes.json();\n      if (!saveJson.success) throw new Error(saveJson.error || 'Failed to save loan PM');\n\n      if (onLinked) onLinked(paymentMethodId);\n      alert('✅ Bank linked for loan funding successfully!');\n    } catch (err) {\n      console.error('Loan bank linking error:', err);\n      setError(err.message || 'Failed to link bank for loan funding');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <div style={{ marginTop: 10 }}>\n      <button\n        onClick={linkBankForLoan}\n        disabled={loading || !stripe}\n        style={{\n          background: '#4f46e5',\n          color: 'white',\n          padding: '8px 12px',\n          borderRadius: 6,\n          cursor: loading ? 'not-allowed' : 'pointer'\n        }}\n      >\n        {loading ? 'Linking…' : 'Link Bank for Loan Funding'}\n      </button>\n      {error && (\n        <div style={{ color: 'red', marginTop: 8 }}>\n          {error}\n        </div>\n      )}\n    </div>\n  );\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}