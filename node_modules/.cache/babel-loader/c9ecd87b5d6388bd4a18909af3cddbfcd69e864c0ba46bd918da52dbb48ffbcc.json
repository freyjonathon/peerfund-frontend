{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/PaymentMethod.jsx\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// src/features/wallet/PaymentMethod.jsx\nimport { useEffect, useMemo, useRef, useState } from 'react';\nimport PropTypes from 'prop-types';\nimport { loadStripe } from '@stripe/stripe-js';\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\n\n/* ---------------- Stripe publishable key ---------------- */\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\n\n/* ---------------- Auth header helpers ---------------- */\nfunction getToken() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, '');\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\n  return t || null;\n}\nfunction authHeaders() {\n  const t = getToken();\n  return t ? {\n    Authorization: `Bearer ${t}`\n  } : {};\n}\n\n/* ---------------- Stripe init (cached) ---------------- */\nlet cachedStripePromise;\nfunction getStripePromise() {\n  if (!pk) return null;\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\n  return cachedStripePromise;\n}\n\n/* ================================================================== */\n/*                     One-card Bank Setup / Management                */\n/* ================================================================== */\n\nexport default function PaymentMethodPage() {\n  _s();\n  const [clientSecret, setClientSecret] = useState(null);\n\n  // current primary method (default or first)\n  const [currentPM, setCurrentPM] = useState(null);\n\n  // UI state\n  const [linking, setLinking] = useState(false);\n  const [errorMsg, setErrorMsg] = useState('');\n  const [loading, setLoading] = useState(true);\n\n  // Prefilled identity for first-time link\n  const [fullName, setFullName] = useState('');\n  const [email, setEmail] = useState('');\n  const stripePromise = useMemo(getStripePromise, [pk]);\n  useEffect(() => {\n    const ac = new AbortController();\n    (async () => {\n      try {\n        // Prefill name/email\n        try {\n          const r = await fetch('/api/users/profile', {\n            headers: {\n              ...authHeaders()\n            },\n            signal: ac.signal\n          });\n          if (r.ok) {\n            const u = await r.json();\n            if (u !== null && u !== void 0 && u.name) setFullName(u.name);\n            if (u !== null && u !== void 0 && u.email) setEmail(u.email);\n          }\n        } catch {\n          /* noop */\n        }\n        await refreshPrimary(ac.signal);\n      } finally {\n        setLoading(false);\n      }\n    })();\n    return () => ac.abort();\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, []);\n  async function refreshPrimary(signal) {\n    try {\n      const r = await fetch('/api/payment-method/mine', {\n        headers: {\n          ...authHeaders()\n        },\n        signal\n      });\n      if (!r.ok) {\n        setCurrentPM(null);\n        return;\n      }\n      const d = await r.json();\n      const list = Array.isArray(d === null || d === void 0 ? void 0 : d.items) ? d.items : [];\n      const primary = list.find(x => x.isDefault) || list[0] || null;\n      setCurrentPM(primary);\n    } catch {\n      setCurrentPM(null);\n    }\n  }\n  async function startBankLink() {\n    setLinking(true);\n    setErrorMsg('');\n    try {\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeaders()\n        }\n      });\n      if (r.status === 401) {\n        setErrorMsg('Your session expired. Please log in again, then return here.');\n        return;\n      }\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\n      const {\n        client_secret\n      } = await r.json();\n      if (!client_secret) throw new Error('No client_secret returned from server.');\n      setClientSecret(client_secret);\n    } catch (e) {\n      setErrorMsg(e.message || 'Could not start bank link.');\n    } finally {\n      setLinking(false);\n    }\n  }\n  const hasPM = !!currentPM;\n  const stripeReady = !!pk && !!stripePromise;\n  const disabledBtn = linking || !stripeReady || !hasPM && !fullName;\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      maxWidth: 720,\n      margin: '0 auto',\n      padding: 16\n    },\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      style: {\n        marginTop: 0\n      },\n      children: \"Payment Method\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this), !pk && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fef2f2',\n        border: '1px solid #fecaca',\n        color: '#7f1d1d',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: [\"Missing Stripe publishable key. Add\", ' ', /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \"REACT_APP_STRIPE_PUBLISHABLE_KEY\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 11\n      }, this), \" to your \", /*#__PURE__*/_jsxDEV(\"code\", {\n        children: \".env\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 143,\n        columnNumber: 65\n      }, this), \".\"]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 132,\n      columnNumber: 9\n    }, this), errorMsg && /*#__PURE__*/_jsxDEV(\"div\", {\n      style: {\n        background: '#fff7ed',\n        border: '1px solid #fed7aa',\n        color: '#7c2d12',\n        padding: '10px 12px',\n        borderRadius: 8,\n        marginBottom: 12\n      },\n      children: errorMsg\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 148,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"section\", {\n      style: {\n        border: '1px solid #e2e8f0',\n        borderRadius: 12,\n        background: '#fff',\n        padding: 14,\n        opacity: loading ? 0.7 : 1\n      },\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n          gap: 12\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontWeight: 800,\n              fontSize: 16,\n              marginBottom: 4\n            },\n            children: hasPM ? (currentPM === null || currentPM === void 0 ? void 0 : currentPM.brand) || 'Bank account' : 'No bank account on file'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 180,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            style: {\n              fontSize: 13,\n              color: '#475569',\n              marginBottom: 6\n            },\n            children: hasPM ? currentPM !== null && currentPM !== void 0 && currentPM.last4 ? `•••• ${currentPM.last4}` : '—' : 'Link your bank to send and receive money on PeerFund.'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 183,\n            columnNumber: 13\n          }, this), hasPM && /*#__PURE__*/_jsxDEV(\"small\", {\n            style: {\n              color: '#64748b'\n            },\n            children: [\"Used for \", /*#__PURE__*/_jsxDEV(\"strong\", {\n              children: \"both\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 192,\n              columnNumber: 26\n            }, this), \" funding and payouts. Updating replaces your current bank.\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 191,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 179,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: startBankLink,\n          disabled: disabledBtn,\n          style: {\n            background: '#4f46e5',\n            color: '#fff',\n            border: '1px solid #4f46e5',\n            padding: '10px 14px',\n            borderRadius: 10,\n            fontWeight: 800,\n            cursor: disabledBtn ? 'not-allowed' : 'pointer',\n            whiteSpace: 'nowrap'\n          },\n          children: hasPM ? linking ? 'Starting…' : 'Update bank account' : linking ? 'Starting…' : 'Link bank account'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 198,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 171,\n        columnNumber: 9\n      }, this), !hasPM && /*#__PURE__*/_jsxDEV(\"div\", {\n        style: {\n          display: 'grid',\n          gap: 8,\n          marginTop: 12,\n          background: '#fafafa',\n          border: '1px solid #e5e7eb',\n          borderRadius: 8,\n          padding: 10\n        },\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            fontSize: 14,\n            color: '#6b7280'\n          },\n          children: \"Account holder\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          value: fullName,\n          onChange: e => setFullName(e.target.value),\n          placeholder: \"Account holder full name\",\n          style: {\n            padding: '8px 10px',\n            border: '1px solid #e2e8f0',\n            borderRadius: 8\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 230,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"small\", {\n          style: {\n            color: '#6b7280'\n          },\n          children: \"We pass this to Stripe only to label your bank method.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 218,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 162,\n      columnNumber: 7\n    }, this), clientSecret && stripePromise && /*#__PURE__*/_jsxDEV(Elements, {\n      stripe: stripePromise,\n      children: /*#__PURE__*/_jsxDEV(BankLinkFlow, {\n        clientSecret: clientSecret,\n        fullName: fullName,\n        email: email,\n        onSaved: async () => {\n          setClientSecret(null);\n          await refreshPrimary();\n        },\n        onError: msg => {\n          setClientSecret(null); // hide the flow if user cancels/errors\n          setErrorMsg(msg);\n        }\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 248,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 128,\n    columnNumber: 5\n  }, this);\n}\n\n/* ---------------- Flow: collect + confirm + SAVE (auto-run) ---------------- */\n_s(PaymentMethodPage, \"wwQ6xH4kjrz7TkJcANY4ZnWfUSg=\");\n_c = PaymentMethodPage;\nfunction BankLinkFlow({\n  clientSecret,\n  fullName,\n  email,\n  onSaved,\n  onError\n}) {\n  _s2();\n  const stripe = useStripe();\n  const [working, setWorking] = useState(true);\n  const startedRef = useRef(false);\n  async function saveToBackend(paymentMethodId) {\n    const r = await fetch('/api/payment-method/save', {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...authHeaders()\n      },\n      body: JSON.stringify({\n        paymentMethodId,\n        makeDefault: true,\n        useForLoans: true\n      })\n    });\n    if (!r.ok) {\n      const t = await r.text().catch(() => '');\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\n    }\n  }\n  useEffect(() => {\n    if (!stripe || !clientSecret || startedRef.current) return;\n    if (!fullName) {\n      onError === null || onError === void 0 ? void 0 : onError('Please enter the account holder’s full name.');\n      return;\n    }\n    startedRef.current = true;\n    (async () => {\n      try {\n        // 1) Open Financial Connections immediately\n        const {\n          error: collectError\n        } = await stripe.collectBankAccountForSetup({\n          clientSecret,\n          params: {\n            payment_method_type: 'us_bank_account',\n            payment_method_data: {\n              billing_details: {\n                name: fullName,\n                ...(email ? {\n                  email\n                } : {})\n              }\n            }\n          }\n        });\n        if (collectError) throw collectError;\n\n        // 2) Confirm the SetupIntent\n        const {\n          setupIntent,\n          error: confirmError\n        } = await stripe.confirmUsBankAccountSetup(clientSecret);\n        if (confirmError) throw confirmError;\n        const pmId = setupIntent === null || setupIntent === void 0 ? void 0 : setupIntent.payment_method;\n        if (!pmId) throw new Error('Missing payment method id from Stripe.');\n\n        // 3) Persist as default + payout\n        await saveToBackend(pmId);\n\n        // 4) Finish quietly; parent will refresh and show last4\n        onSaved === null || onSaved === void 0 ? void 0 : onSaved();\n      } catch (e) {\n        onError === null || onError === void 0 ? void 0 : onError((e === null || e === void 0 ? void 0 : e.message) || 'Failed to link bank account.');\n      } finally {\n        setWorking(false);\n      }\n    })();\n  }, [stripe, clientSecret, fullName, email, onSaved, onError]);\n\n  // Minimal inline “working” hint while the Stripe modal opens/finishes.\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      marginTop: 12,\n      background: '#f8fafc',\n      border: '1px solid #e2e8f0',\n      borderRadius: 8,\n      padding: '10px 12px',\n      fontSize: 14,\n      color: '#334155'\n    },\n    children: working ? 'Opening secure bank link…' : 'Done.'\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 335,\n    columnNumber: 5\n  }, this);\n}\n_s2(BankLinkFlow, \"tZ3Ll7qnc9kvFmxnNvnenfVp1QY=\", false, function () {\n  return [useStripe];\n});\n_c2 = BankLinkFlow;\nBankLinkFlow.propTypes = {\n  clientSecret: PropTypes.string.isRequired,\n  fullName: PropTypes.string.isRequired,\n  email: PropTypes.string,\n  onSaved: PropTypes.func,\n  onError: PropTypes.func\n};\nvar _c, _c2;\n$RefreshReg$(_c, \"PaymentMethodPage\");\n$RefreshReg$(_c2, \"BankLinkFlow\");","map":{"version":3,"names":["useEffect","useMemo","useRef","useState","PropTypes","loadStripe","Elements","useStripe","jsxDEV","_jsxDEV","rawPk","process","env","REACT_APP_STRIPE_PUBLISHABLE_KEY","trim","pk","test","getToken","t","localStorage","getItem","replace","toLowerCase","startsWith","slice","authHeaders","Authorization","cachedStripePromise","getStripePromise","PaymentMethodPage","_s","clientSecret","setClientSecret","currentPM","setCurrentPM","linking","setLinking","errorMsg","setErrorMsg","loading","setLoading","fullName","setFullName","email","setEmail","stripePromise","ac","AbortController","r","fetch","headers","signal","ok","u","json","name","refreshPrimary","abort","d","list","Array","isArray","items","primary","find","x","isDefault","startBankLink","method","status","Error","text","client_secret","e","message","hasPM","stripeReady","disabledBtn","style","maxWidth","margin","padding","children","marginTop","fileName","_jsxFileName","lineNumber","columnNumber","background","border","color","borderRadius","marginBottom","opacity","display","justifyContent","alignItems","gap","fontWeight","fontSize","brand","last4","onClick","disabled","cursor","whiteSpace","type","value","onChange","target","placeholder","stripe","BankLinkFlow","onSaved","onError","msg","_c","_s2","working","setWorking","startedRef","saveToBackend","paymentMethodId","body","JSON","stringify","makeDefault","useForLoans","catch","current","error","collectError","collectBankAccountForSetup","params","payment_method_type","payment_method_data","billing_details","setupIntent","confirmError","confirmUsBankAccountSetup","pmId","payment_method","_c2","propTypes","string","isRequired","func","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/PaymentMethod.jsx"],"sourcesContent":["// src/features/wallet/PaymentMethod.jsx\r\nimport { useEffect, useMemo, useRef, useState } from 'react';\r\nimport PropTypes from 'prop-types';\r\nimport { loadStripe } from '@stripe/stripe-js';\r\nimport { Elements, useStripe } from '@stripe/react-stripe-js';\r\n\r\n/* ---------------- Stripe publishable key ---------------- */\r\nconst rawPk = (process.env.REACT_APP_STRIPE_PUBLISHABLE_KEY || '').trim();\r\nconst pk = /^pk_(test|live)_[A-Za-z0-9_]+$/.test(rawPk) ? rawPk : '';\r\n\r\n/* ---------------- Auth header helpers ---------------- */\r\nfunction getToken() {\r\n  let t = localStorage.getItem('token') || '';\r\n  t = t.replace(/^\"|\"$/g, '');\r\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\r\n  return t || null;\r\n}\r\nfunction authHeaders() {\r\n  const t = getToken();\r\n  return t ? { Authorization: `Bearer ${t}` } : {};\r\n}\r\n\r\n/* ---------------- Stripe init (cached) ---------------- */\r\nlet cachedStripePromise;\r\nfunction getStripePromise() {\r\n  if (!pk) return null;\r\n  if (!cachedStripePromise) cachedStripePromise = loadStripe(pk);\r\n  return cachedStripePromise;\r\n}\r\n\r\n/* ================================================================== */\r\n/*                     One-card Bank Setup / Management                */\r\n/* ================================================================== */\r\n\r\nexport default function PaymentMethodPage() {\r\n  const [clientSecret, setClientSecret] = useState(null);\r\n\r\n  // current primary method (default or first)\r\n  const [currentPM, setCurrentPM] = useState(null);\r\n\r\n  // UI state\r\n  const [linking, setLinking] = useState(false);\r\n  const [errorMsg, setErrorMsg] = useState('');\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Prefilled identity for first-time link\r\n  const [fullName, setFullName] = useState('');\r\n  const [email, setEmail] = useState('');\r\n\r\n  const stripePromise = useMemo(getStripePromise, [pk]);\r\n\r\n  useEffect(() => {\r\n    const ac = new AbortController();\r\n    (async () => {\r\n      try {\r\n        // Prefill name/email\r\n        try {\r\n          const r = await fetch('/api/users/profile', {\r\n            headers: { ...authHeaders() },\r\n            signal: ac.signal,\r\n          });\r\n          if (r.ok) {\r\n            const u = await r.json();\r\n            if (u?.name) setFullName(u.name);\r\n            if (u?.email) setEmail(u.email);\r\n          }\r\n        } catch {\r\n          /* noop */\r\n        }\r\n\r\n        await refreshPrimary(ac.signal);\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    })();\r\n\r\n    return () => ac.abort();\r\n    // eslint-disable-next-line react-hooks/exhaustive-deps\r\n  }, []);\r\n\r\n  async function refreshPrimary(signal) {\r\n    try {\r\n      const r = await fetch('/api/payment-method/mine', {\r\n        headers: { ...authHeaders() },\r\n        signal,\r\n      });\r\n      if (!r.ok) {\r\n        setCurrentPM(null);\r\n        return;\r\n      }\r\n      const d = await r.json();\r\n      const list = Array.isArray(d?.items) ? d.items : [];\r\n      const primary = list.find((x) => x.isDefault) || list[0] || null;\r\n      setCurrentPM(primary);\r\n    } catch {\r\n      setCurrentPM(null);\r\n    }\r\n  }\r\n\r\n  async function startBankLink() {\r\n    setLinking(true);\r\n    setErrorMsg('');\r\n    try {\r\n      const r = await fetch('/api/stripe/create-bank-setup-intent', {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      });\r\n      if (r.status === 401) {\r\n        setErrorMsg('Your session expired. Please log in again, then return here.');\r\n        return;\r\n      }\r\n      if (!r.ok) throw new Error((await r.text()) || 'Failed to create SetupIntent.');\r\n      const { client_secret } = await r.json();\r\n      if (!client_secret) throw new Error('No client_secret returned from server.');\r\n      setClientSecret(client_secret);\r\n    } catch (e) {\r\n      setErrorMsg(e.message || 'Could not start bank link.');\r\n    } finally {\r\n      setLinking(false);\r\n    }\r\n  }\r\n\r\n  const hasPM = !!currentPM;\r\n  const stripeReady = !!pk && !!stripePromise;\r\n  const disabledBtn = linking || !stripeReady || (!hasPM && !fullName);\r\n\r\n  return (\r\n    <div style={{ maxWidth: 720, margin: '0 auto', padding: 16 }}>\r\n      <h2 style={{ marginTop: 0 }}>Payment Method</h2>\r\n\r\n      {!pk && (\r\n        <div\r\n          style={{\r\n            background: '#fef2f2',\r\n            border: '1px solid #fecaca',\r\n            color: '#7f1d1d',\r\n            padding: '10px 12px',\r\n            borderRadius: 8,\r\n            marginBottom: 12,\r\n          }}\r\n        >\r\n          Missing Stripe publishable key. Add{' '}\r\n          <code>REACT_APP_STRIPE_PUBLISHABLE_KEY</code> to your <code>.env</code>.\r\n        </div>\r\n      )}\r\n\r\n      {errorMsg && (\r\n        <div\r\n          style={{\r\n            background: '#fff7ed',\r\n            border: '1px solid #fed7aa',\r\n            color: '#7c2d12',\r\n            padding: '10px 12px',\r\n            borderRadius: 8,\r\n            marginBottom: 12,\r\n          }}\r\n        >\r\n          {errorMsg}\r\n        </div>\r\n      )}\r\n\r\n      <section\r\n        style={{\r\n          border: '1px solid #e2e8f0',\r\n          borderRadius: 12,\r\n          background: '#fff',\r\n          padding: 14,\r\n          opacity: loading ? 0.7 : 1,\r\n        }}\r\n      >\r\n        <div\r\n          style={{\r\n            display: 'flex',\r\n            justifyContent: 'space-between',\r\n            alignItems: 'center',\r\n            gap: 12,\r\n          }}\r\n        >\r\n          <div>\r\n            <div style={{ fontWeight: 800, fontSize: 16, marginBottom: 4 }}>\r\n              {hasPM ? currentPM?.brand || 'Bank account' : 'No bank account on file'}\r\n            </div>\r\n            <div style={{ fontSize: 13, color: '#475569', marginBottom: 6 }}>\r\n              {hasPM\r\n                ? currentPM?.last4\r\n                  ? `•••• ${currentPM.last4}`\r\n                  : '—'\r\n                : 'Link your bank to send and receive money on PeerFund.'}\r\n            </div>\r\n            {hasPM && (\r\n              <small style={{ color: '#64748b' }}>\r\n                Used for <strong>both</strong> funding and payouts. Updating replaces your current\r\n                bank.\r\n              </small>\r\n            )}\r\n          </div>\r\n\r\n          <button\r\n            onClick={startBankLink}\r\n            disabled={disabledBtn}\r\n            style={{\r\n              background: '#4f46e5',\r\n              color: '#fff',\r\n              border: '1px solid #4f46e5',\r\n              padding: '10px 14px',\r\n              borderRadius: 10,\r\n              fontWeight: 800,\r\n              cursor: disabledBtn ? 'not-allowed' : 'pointer',\r\n              whiteSpace: 'nowrap',\r\n            }}\r\n          >\r\n            {hasPM ? (linking ? 'Starting…' : 'Update bank account') : linking ? 'Starting…' : 'Link bank account'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* First-time: show identity fields below the button */}\r\n        {!hasPM && (\r\n          <div\r\n            style={{\r\n              display: 'grid',\r\n              gap: 8,\r\n              marginTop: 12,\r\n              background: '#fafafa',\r\n              border: '1px solid #e5e7eb',\r\n              borderRadius: 8,\r\n              padding: 10,\r\n            }}\r\n          >\r\n            <div style={{ fontSize: 14, color: '#6b7280' }}>Account holder</div>\r\n            <input\r\n              type=\"text\"\r\n              value={fullName}\r\n              onChange={(e) => setFullName(e.target.value)}\r\n              placeholder=\"Account holder full name\"\r\n              style={{ padding: '8px 10px', border: '1px solid #e2e8f0', borderRadius: 8 }}\r\n            />\r\n          \r\n            <small style={{ color: '#6b7280' }}>\r\n              We pass this to Stripe only to label your bank method.\r\n            </small>\r\n          </div>\r\n        )}\r\n      </section>\r\n\r\n      {/* Stripe bank link + SAVE to backend (makes it Default + Payout) */}\r\n      {clientSecret && stripePromise && (\r\n        <Elements stripe={stripePromise}>\r\n          <BankLinkFlow\r\n            clientSecret={clientSecret}\r\n            fullName={fullName}\r\n            email={email}\r\n            onSaved={async () => {\r\n              setClientSecret(null);\r\n              await refreshPrimary();\r\n            }}\r\n            onError={(msg) => {\r\n              setClientSecret(null); // hide the flow if user cancels/errors\r\n              setErrorMsg(msg);\r\n            }}\r\n          />\r\n        </Elements>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n\r\n/* ---------------- Flow: collect + confirm + SAVE (auto-run) ---------------- */\r\nfunction BankLinkFlow({ clientSecret, fullName, email, onSaved, onError }) {\r\n  const stripe = useStripe();\r\n  const [working, setWorking] = useState(true);\r\n  const startedRef = useRef(false);\r\n\r\n  async function saveToBackend(paymentMethodId) {\r\n    const r = await fetch('/api/payment-method/save', {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...authHeaders() },\r\n      body: JSON.stringify({\r\n        paymentMethodId,\r\n        makeDefault: true,\r\n        useForLoans: true,\r\n      }),\r\n    });\r\n    if (!r.ok) {\r\n      const t = await r.text().catch(() => '');\r\n      throw new Error(t || 'Failed to save payment method to your PeerFund account.');\r\n    }\r\n  }\r\n\r\n  useEffect(() => {\r\n    if (!stripe || !clientSecret || startedRef.current) return;\r\n    if (!fullName) {\r\n      onError?.('Please enter the account holder’s full name.');\r\n      return;\r\n    }\r\n\r\n    startedRef.current = true;\r\n\r\n    (async () => {\r\n      try {\r\n        // 1) Open Financial Connections immediately\r\n        const { error: collectError } = await stripe.collectBankAccountForSetup({\r\n          clientSecret,\r\n          params: {\r\n            payment_method_type: 'us_bank_account',\r\n            payment_method_data: {\r\n              billing_details: { name: fullName, ...(email ? { email } : {}) },\r\n            },\r\n          },\r\n        });\r\n        if (collectError) throw collectError;\r\n\r\n        // 2) Confirm the SetupIntent\r\n        const { setupIntent, error: confirmError } =\r\n          await stripe.confirmUsBankAccountSetup(clientSecret);\r\n        if (confirmError) throw confirmError;\r\n\r\n        const pmId = setupIntent?.payment_method;\r\n        if (!pmId) throw new Error('Missing payment method id from Stripe.');\r\n\r\n        // 3) Persist as default + payout\r\n        await saveToBackend(pmId);\r\n\r\n        // 4) Finish quietly; parent will refresh and show last4\r\n        onSaved?.();\r\n      } catch (e) {\r\n        onError?.(e?.message || 'Failed to link bank account.');\r\n      } finally {\r\n        setWorking(false);\r\n      }\r\n    })();\r\n  }, [stripe, clientSecret, fullName, email, onSaved, onError]);\r\n\r\n  // Minimal inline “working” hint while the Stripe modal opens/finishes.\r\n  return (\r\n    <div\r\n      style={{\r\n        marginTop: 12,\r\n        background: '#f8fafc',\r\n        border: '1px solid #e2e8f0',\r\n        borderRadius: 8,\r\n        padding: '10px 12px',\r\n        fontSize: 14,\r\n        color: '#334155',\r\n      }}\r\n    >\r\n      {working ? 'Opening secure bank link…' : 'Done.'}\r\n    </div>\r\n  );\r\n}\r\n\r\nBankLinkFlow.propTypes = {\r\n  clientSecret: PropTypes.string.isRequired,\r\n  fullName: PropTypes.string.isRequired,\r\n  email: PropTypes.string,\r\n  onSaved: PropTypes.func,\r\n  onError: PropTypes.func,\r\n};\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}