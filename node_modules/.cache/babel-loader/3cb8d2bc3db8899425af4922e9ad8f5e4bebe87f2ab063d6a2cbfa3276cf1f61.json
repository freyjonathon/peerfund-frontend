{"ast":null,"code":"var _jsxFileName = \"/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx\",\n  _s = $RefreshSig$();\n// src/features/money/MoneySummary.jsx\nimport React, { useEffect, useState, useCallback } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport './MoneySummary.css';\nimport UserProfileModal from '../../components/UserProfileModal';\nimport LoanThreadModal from '../loans/LoanThreadModal';\n\n// helper: decode JWT for current user id\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nfunction getCurrentUserId() {\n  const t = localStorage.getItem('token');\n  if (!t) return null;\n  try {\n    var _payload$userId;\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\n    return (_payload$userId = payload === null || payload === void 0 ? void 0 : payload.userId) !== null && _payload$userId !== void 0 ? _payload$userId : null;\n  } catch {\n    return null;\n  }\n}\nconst fmtMoney = n => typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\nconst MoneySummary = () => {\n  _s();\n  const [summary, setSummary] = useState({\n    loansGiven: [],\n    loansReceived: [],\n    myOpenRequests: []\n  });\n  const [loading, setLoading] = useState(true);\n\n  // expanded panels (loans + requests share the same map)\n  const [expandedLoans, setExpandedLoans] = useState({});\n  // small counter-offer form state for each request id\n  const [counterForm, setCounterForm] = useState({}); // { [reqId]: { amount, interestRate, duration } }\n\n  // accordions\n  const [openSec, setOpenSec] = useState({\n    open: true,\n    given: true,\n    received: true\n  });\n  const [payLoading, setPayLoading] = useState({});\n  const [profileUserId, setProfileUserId] = useState(null);\n\n  // discussion modal\n  const [threadLoanId, setThreadLoanId] = useState(null);\n  const token = localStorage.getItem('token');\n  const navigate = useNavigate();\n  const me = getCurrentUserId();\n  const authHeader = token ? {\n    Authorization: `Bearer ${token}`\n  } : {};\n\n  /** ----------------- ACTION HELPERS (Negotiation) ----------------- */\n\n  const postOffer = async req => {\n    const {\n      amount,\n      interestRate,\n      duration\n    } = counterForm[req.id] || {};\n    if (!Number.isFinite(Number(amount)) || !Number.isFinite(Number(interestRate)) || !Number.isFinite(Number(duration))) {\n      alert('Please enter valid numbers for amount, interest and months.');\n      return false;\n    }\n    const path = req.type === 'direct' ? `/api/direct-requests/${req.id}/offer` : `/api/loan-requests/${req.id}/offer`;\n    const res = await fetch(path, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n        ...authHeader\n      },\n      body: JSON.stringify({\n        amount: Number(amount),\n        apr: Number(interestRate),\n        months: Number(duration)\n      })\n    });\n    const data = await res.json().catch(() => ({}));\n    if (!res.ok) {\n      alert((data === null || data === void 0 ? void 0 : data.error) || 'Failed to send offer');\n      return false;\n    }\n    alert('Offer sent!');\n    return true;\n  };\n  const acceptRequest = async req => {\n    const path = req.type === 'direct' ? `/api/direct-requests/${req.id}/accept` : `/api/loan-requests/${req.id}/accept`;\n    const res = await fetch(path, {\n      method: 'POST',\n      headers: authHeader\n    });\n    const data = await res.json().catch(() => ({}));\n    if (!res.ok) {\n      alert((data === null || data === void 0 ? void 0 : data.error) || 'Failed to accept');\n      return false;\n    }\n    alert('Accepted!');\n    return true;\n  };\n  const cancelRequest = async req => {\n    const path = req.type === 'direct' ? `/api/direct-requests/${req.id}/cancel` : `/api/loan-requests/${req.id}/cancel`;\n    const res = await fetch(path, {\n      method: 'POST',\n      headers: authHeader\n    });\n    const data = await res.json().catch(() => ({}));\n    if (!res.ok) {\n      alert((data === null || data === void 0 ? void 0 : data.error) || 'Failed to cancel');\n      return false;\n    }\n    alert('Cancelled.');\n    return true;\n  };\n\n  /** ---- helpers to fetch open requests (market + direct) ---- */\n\n  // Try a couple of marketplace endpoints, normalize result\n  const fetchMarketOpenRequests = async () => {\n    const meId = me;\n    if (!meId) return [];\n\n    // Preferred: /api/loan-requests/mine?status=OPEN\n    try {\n      const r = await fetch('/api/loan-requests/mine?status=OPEN', {\n        headers: authHeader\n      });\n      if (r.ok) {\n        const list = await r.json();\n        const items = Array.isArray(list) ? list : Array.isArray(list === null || list === void 0 ? void 0 : list.items) ? list.items : [];\n        return items.filter(it => {\n          var _it$borrower;\n          return ((it === null || it === void 0 ? void 0 : it.borrowerId) || (it === null || it === void 0 ? void 0 : (_it$borrower = it.borrower) === null || _it$borrower === void 0 ? void 0 : _it$borrower.id)) === meId;\n        }).map(r => {\n          var _r$duration, _r$interestRate, _r$borrower, _r$borrower2;\n          return {\n            type: 'market',\n            id: r.id,\n            amount: Number(r.amount),\n            duration: Number((_r$duration = r.duration) !== null && _r$duration !== void 0 ? _r$duration : r.months),\n            interestRate: Number((_r$interestRate = r.interestRate) !== null && _r$interestRate !== void 0 ? _r$interestRate : r.apr),\n            purpose: r.purpose || '',\n            createdAt: r.createdAt || null,\n            borrowerName: (r === null || r === void 0 ? void 0 : (_r$borrower = r.borrower) === null || _r$borrower === void 0 ? void 0 : _r$borrower.name) || 'You',\n            borrowerId: (r === null || r === void 0 ? void 0 : (_r$borrower2 = r.borrower) === null || _r$borrower2 === void 0 ? void 0 : _r$borrower2.id) || r.borrowerId || meId,\n            status: r.status || 'OPEN'\n          };\n        });\n      }\n    } catch {}\n\n    // Fallback: /api/loans/open\n    try {\n      const resOpen = await fetch('/api/loans/open', {\n        headers: authHeader\n      });\n      if (resOpen.ok) {\n        const openListRaw = await resOpen.json();\n        const openList = Array.isArray(openListRaw) ? openListRaw : Array.isArray(openListRaw === null || openListRaw === void 0 ? void 0 : openListRaw.items) ? openListRaw.items : [];\n        const mine = openList.filter(r => {\n          var _r$borrower3;\n          return ((r === null || r === void 0 ? void 0 : (_r$borrower3 = r.borrower) === null || _r$borrower3 === void 0 ? void 0 : _r$borrower3.id) || (r === null || r === void 0 ? void 0 : r.borrowerId)) === meId;\n        });\n        return mine.map(r => {\n          var _r$duration2, _r$interestRate2, _r$borrower4, _r$borrower5;\n          return {\n            type: 'market',\n            id: r.id,\n            amount: Number(r.amount),\n            duration: Number((_r$duration2 = r.duration) !== null && _r$duration2 !== void 0 ? _r$duration2 : r.months),\n            interestRate: Number((_r$interestRate2 = r.interestRate) !== null && _r$interestRate2 !== void 0 ? _r$interestRate2 : r.apr),\n            purpose: r.purpose || '',\n            createdAt: r.createdAt || null,\n            borrowerName: (r === null || r === void 0 ? void 0 : (_r$borrower4 = r.borrower) === null || _r$borrower4 === void 0 ? void 0 : _r$borrower4.name) || 'You',\n            borrowerId: (r === null || r === void 0 ? void 0 : (_r$borrower5 = r.borrower) === null || _r$borrower5 === void 0 ? void 0 : _r$borrower5.id) || (r === null || r === void 0 ? void 0 : r.borrowerId) || meId,\n            status: r.status || 'OPEN'\n          };\n        });\n      }\n    } catch {}\n    return [];\n  };\n\n  // Direct requests endpoint, normalize pending ones (both roles)\n  const fetchDirectOpenRequests = async () => {\n    const meId = me;\n    if (!meId) return [];\n    try {\n      const r = await fetch('/api/direct-requests/mine', {\n        headers: authHeader\n      });\n      if (!r.ok) return [];\n      const data = await r.json();\n\n      // Accept either a flat array or {asBorrower, asLender}\n      const combined = Array.isArray(data) ? data : [...(Array.isArray(data === null || data === void 0 ? void 0 : data.asBorrower) ? data.asBorrower : []), ...(Array.isArray(data === null || data === void 0 ? void 0 : data.asLender) ? data.asLender : [])];\n      const FINAL = new Set(['DECLINED', 'CANCELLED', 'DISBURSED', 'APPROVED', 'REJECTED']);\n      return combined.filter(d => !FINAL.has(((d === null || d === void 0 ? void 0 : d.status) || '').toUpperCase())).map(d => {\n        var _d$borrower, _d$lender, _d$months, _d$apr, _d$borrower2, _d$lender2;\n        const borrowerId = d.borrowerId || (d === null || d === void 0 ? void 0 : (_d$borrower = d.borrower) === null || _d$borrower === void 0 ? void 0 : _d$borrower.id);\n        const lenderId = d.lenderId || (d === null || d === void 0 ? void 0 : (_d$lender = d.lender) === null || _d$lender === void 0 ? void 0 : _d$lender.id);\n        const iAmBorrower = borrowerId === meId;\n        return {\n          type: 'direct',\n          id: d.id,\n          amount: Number(d.amount),\n          duration: Number((_d$months = d.months) !== null && _d$months !== void 0 ? _d$months : d.duration),\n          interestRate: Number((_d$apr = d.apr) !== null && _d$apr !== void 0 ? _d$apr : d.interestRate),\n          createdAt: d.createdAt || null,\n          borrowerId,\n          borrowerName: (d === null || d === void 0 ? void 0 : (_d$borrower2 = d.borrower) === null || _d$borrower2 === void 0 ? void 0 : _d$borrower2.name) || (iAmBorrower ? 'You' : ''),\n          lenderId,\n          lenderName: (d === null || d === void 0 ? void 0 : (_d$lender2 = d.lender) === null || _d$lender2 === void 0 ? void 0 : _d$lender2.name) || (!iAmBorrower ? 'Counterparty' : ''),\n          status: d.status || 'PENDING'\n        };\n      });\n    } catch {\n      return [];\n    }\n  };\n  const fetchSummary = useCallback(async () => {\n    if (!token) return;\n    setLoading(true);\n    try {\n      // loans summary\n      const res = await fetch('/api/users/my-money-summary', {\n        headers: authHeader\n      });\n      let loansGiven = [];\n      let loansReceived = [];\n      if (res.ok) {\n        const data = await res.json();\n        loansGiven = Array.isArray(data.loansGiven) ? data.loansGiven : Array.isArray(data.loansAsLender) ? data.loansAsLender : [];\n        loansReceived = Array.isArray(data.loansReceived) ? data.loansReceived : Array.isArray(data.loansAsBorrower) ? data.loansAsBorrower : [];\n      }\n\n      // open requests: market + direct\n      const [marketOpen, directOpen] = await Promise.all([fetchMarketOpenRequests(), fetchDirectOpenRequests()]);\n      const myOpenRequests = [...marketOpen, ...directOpen];\n\n      // prime counterForm defaults\n      const cf = {};\n      myOpenRequests.forEach(r => {\n        var _r$amount, _r$interestRate3, _r$duration3;\n        cf[r.id] = {\n          amount: (_r$amount = r.amount) !== null && _r$amount !== void 0 ? _r$amount : 0,\n          interestRate: (_r$interestRate3 = r.interestRate) !== null && _r$interestRate3 !== void 0 ? _r$interestRate3 : 0,\n          duration: (_r$duration3 = r.duration) !== null && _r$duration3 !== void 0 ? _r$duration3 : 1\n        };\n      });\n      setCounterForm(cf);\n      setSummary({\n        loansGiven,\n        loansReceived,\n        myOpenRequests\n      });\n    } catch (err) {\n      console.error('Error fetching money summary:', err);\n      setSummary({\n        loansGiven: [],\n        loansReceived: [],\n        myOpenRequests: []\n      });\n    } finally {\n      setLoading(false);\n    }\n  }, [token]); // eslint-disable-line react-hooks/exhaustive-deps\n\n  useEffect(() => {\n    fetchSummary();\n  }, [fetchSummary]);\n  const loanKey = (loan, idx) => (loan === null || loan === void 0 ? void 0 : loan.id) || (loan === null || loan === void 0 ? void 0 : loan._id) || String(idx);\n  const toggleLoanDetails = id => {\n    setExpandedLoans(prev => ({\n      ...Object.keys(prev).reduce((acc, k) => ({\n        ...acc,\n        [k]: false\n      }), {}),\n      [id]: !prev[id]\n    }));\n  };\n  const payNext = async loan => {\n    var _loan$installmentAmou;\n    const key = loanKey(loan);\n    const amount = (_loan$installmentAmou = loan === null || loan === void 0 ? void 0 : loan.installmentAmount) !== null && _loan$installmentAmou !== void 0 ? _loan$installmentAmou : 0;\n    if (!window.confirm(`Pay the next installment (${fmtMoney(amount)})?`)) return;\n    try {\n      setPayLoading(m => ({\n        ...m,\n        [key]: true\n      }));\n      const res = await fetch(`/api/loans/${loan.id || loan._id}/pay-next`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n          ...authHeader\n        },\n        credentials: 'include'\n      });\n      const data = await res.json();\n      if (!res.ok) throw new Error((data === null || data === void 0 ? void 0 : data.error) || 'Payment failed');\n      const paid = typeof data.amount === 'number' ? data.amount : amount;\n      alert(`Payment successful! Amount: ${fmtMoney(paid)}`);\n      await fetchSummary();\n    } catch (e) {\n      alert(e.message);\n    } finally {\n      setPayLoading(m => ({\n        ...m,\n        [key]: false\n      }));\n    }\n  };\n\n  /** -------------------------- RENDERERS --------------------------- */\n\n  const renderLoanCard = (loan, isLender, idx) => {\n    const key = loanKey(loan, idx);\n    const isExpanded = !!expandedLoans[key];\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\n    const canPay = !isLender && typeof loan.installmentAmount === 'number' && loan.installmentAmount > 0 && !!loan.nextDueDate;\n    const badgeClass = (loan.status || '').toUpperCase() === 'FUNDED' ? 'ms-badge ms-badge--ok' : 'ms-badge ms-badge--warn';\n    const fundedDate = loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-card-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: isLender ? 'Borrower' : 'Lender'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 326,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: otherParty || 'Unknown'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 327,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 325,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Amount\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 330,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fmtMoney(loan.amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 331,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 329,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Funded Date\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 334,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fundedDate\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 335,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 333,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'right'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: badgeClass,\n            children: loan.status || 'â€”'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 338,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 337,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 324,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-actions\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => setThreadLoanId(loan.id || loan._id),\n          className: \"action-btn\",\n          title: \"Open conversation\",\n          children: \"\\uD83D\\uDCAC Messages\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 343,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          onClick: () => toggleLoanDetails(key),\n          className: \"action-btn\",\n          children: isExpanded ? 'ðŸ”½ Hide Contract' : 'ðŸ“„ View Contract'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 347,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 342,\n        columnNumber: 9\n      }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-details\",\n        children: [loan.status && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 356,\n            columnNumber: 17\n          }, this), \" \", loan.status]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 355,\n          columnNumber: 15\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Interest Rate:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 360,\n            columnNumber: 15\n          }, this), \" \", typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 359,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Duration:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 363,\n            columnNumber: 15\n          }, this), \" \", typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 362,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Next Due Date:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 366,\n            columnNumber: 15\n          }, this), \" \", loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 365,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Installment (this period):\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 369,\n            columnNumber: 15\n          }, this), \" \", fmtMoney(loan.installmentAmount)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 368,\n          columnNumber: 13\n        }, this), isLender && typeof loan.amountCollected === 'number' && /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Amount collected on loan:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 374,\n            columnNumber: 17\n          }, this), \" \", fmtMoney(loan.amountCollected)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 373,\n          columnNumber: 15\n        }, this), !isLender && canPay && /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"mt-6\",\n          children: /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"action-btn primary\",\n            onClick: () => payNext(loan),\n            disabled: !!payLoading[key],\n            title: \"Pay next installment\",\n            children: payLoading[key] ? 'Processingâ€¦' : 'ðŸ’³ Make Payment'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 380,\n            columnNumber: 17\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 379,\n          columnNumber: 15\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 353,\n        columnNumber: 11\n      }, this)]\n    }, key, true, {\n      fileName: _jsxFileName,\n      lineNumber: 323,\n      columnNumber: 7\n    }, this);\n  };\n\n  // Negotiable open requests (market + direct)\n  const renderOpenRequestCard = req => {\n    var _req$status;\n    const isExpanded = !!expandedLoans[req.id];\n    const iAmBorrower = req.borrowerId === me;\n    const cf = counterForm[req.id] || {\n      amount: req.amount || 0,\n      interestRate: req.interestRate || 0,\n      duration: req.duration || 1\n    };\n    const updateCF = patch => setCounterForm(m => ({\n      ...m,\n      [req.id]: {\n        ...(m[req.id] || {}),\n        ...patch\n      }\n    }));\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-card\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-card-row\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Borrower\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 414,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: req.borrowerName || 'You'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 415,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 413,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Amount\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 418,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: fmtMoney(req.amount)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 419,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 417,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-label\",\n            children: \"Created\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 422,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"ms-value-strong\",\n            children: req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 423,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 421,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            textAlign: 'right'\n          },\n          children: /*#__PURE__*/_jsxDEV(\"span\", {\n            className: \"ms-badge ms-badge--warn\",\n            children: \"Open\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 412,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-actions\",\n        children: /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"action-btn\",\n          onClick: () => toggleLoanDetails(req.id),\n          title: \"View request details\",\n          children: isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 432,\n          columnNumber: 11\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 431,\n        columnNumber: 9\n      }, this), isExpanded && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-details\",\n        children: [/*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Status:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 441,\n            columnNumber: 15\n          }, this), \" \", (_req$status = req.status) !== null && _req$status !== void 0 ? _req$status : 'OPEN']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 440,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Interest Rate:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 444,\n            columnNumber: 15\n          }, this), \" \", Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 443,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Duration:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 447,\n            columnNumber: 15\n          }, this), \" \", Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”']\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 446,\n          columnNumber: 13\n        }, this), req.purpose ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Reason:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 451,\n            columnNumber: 17\n          }, this), \" \", req.purpose]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 450,\n          columnNumber: 15\n        }, this) : null, req.lenderName ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"strong\", {\n            children: \"Requested Lender:\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 456,\n            columnNumber: 17\n          }, this), \" \", req.lenderName]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 455,\n          columnNumber: 15\n        }, this) : null, /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-offer-grid mt-8\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"ms-label\",\n              children: \"Offer Amount\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 463,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: \"1\",\n              className: \"ms-input\",\n              value: cf.amount,\n              onChange: e => updateCF({\n                amount: Number(e.target.value)\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 464,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 462,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"ms-label\",\n              children: \"APR (%)\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 473,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: \"0\",\n              step: \"0.1\",\n              className: \"ms-input\",\n              value: cf.interestRate,\n              onChange: e => updateCF({\n                interestRate: Number(e.target.value)\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 474,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 472,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            children: [/*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"ms-label\",\n              children: \"Months\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 484,\n              columnNumber: 17\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              min: \"1\",\n              max: \"36\",\n              className: \"ms-input\",\n              value: cf.duration,\n              onChange: e => updateCF({\n                duration: Number(e.target.value)\n              })\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 485,\n              columnNumber: 17\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 483,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 461,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-actions mt-6\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"action-btn\",\n            onClick: async () => {\n              if (await postOffer(req)) fetchSummary();\n            },\n            title: \"Send counter-offer\",\n            children: \"\\uD83E\\uDD1D Send Counter-Offer\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 497,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"action-btn primary\",\n            onClick: async () => {\n              if (await acceptRequest(req)) fetchSummary();\n            },\n            title: \"Accept terms\",\n            children: \"\\u2705 Accept\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 508,\n            columnNumber: 15\n          }, this), iAmBorrower && /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"action-btn\",\n            onClick: async () => {\n              if (!window.confirm('Cancel this request?')) return;\n              if (await cancelRequest(req)) fetchSummary();\n            },\n            title: \"Cancel request\",\n            children: \"\\uD83D\\uDDD1 Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 520,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 496,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 439,\n        columnNumber: 11\n      }, this)]\n    }, req.id, true, {\n      fileName: _jsxFileName,\n      lineNumber: 410,\n      columnNumber: 7\n    }, this);\n  };\n  if (loading) return /*#__PURE__*/_jsxDEV(\"p\", {\n    className: \"ms-loading ms-container\",\n    children: \"Loading money summary...\"\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 538,\n    columnNumber: 23\n  }, this);\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"ms-container\",\n    children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n      className: \"ms-heading\",\n      children: \"\\uD83D\\uDCB5 My Money Summary\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 546,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          open: !s.open\n        })),\n        \"aria-expanded\": openSec.open,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"My Open Loan Requests\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 555,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.open ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 556,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 550,\n        columnNumber: 9\n      }, this), openSec.open && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: myOpen.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"You have no open requests.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 560,\n          columnNumber: 36\n        }, this) : myOpen.map(renderOpenRequestCard)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 559,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 549,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          given: !s.given\n        })),\n        \"aria-expanded\": openSec.given,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Given (I'm the Lender)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 568,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.given ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 569,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 567,\n        columnNumber: 9\n      }, this), openSec.given && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: given.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans given yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 573,\n          columnNumber: 35\n        }, this) : given.map((loan, idx) => renderLoanCard(loan, true, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 572,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 566,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"ms-section\",\n      children: [/*#__PURE__*/_jsxDEV(\"button\", {\n        className: \"ms-section-head\",\n        onClick: () => setOpenSec(s => ({\n          ...s,\n          received: !s.received\n        })),\n        \"aria-expanded\": openSec.received,\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-subheading\",\n          children: \"Loans Received (I'm the Borrower)\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 585,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"ms-caret\",\n          children: openSec.received ? 'â–¾' : 'â–¸'\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 586,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 580,\n        columnNumber: 9\n      }, this), openSec.received && /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"ms-section-body\",\n        children: received.length === 0 ? /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"ms-empty\",\n          children: \"No loans received yet.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 590,\n          columnNumber: 38\n        }, this) : received.map((loan, idx) => renderLoanCard(loan, false, idx))\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 589,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 579,\n      columnNumber: 7\n    }, this), profileUserId && /*#__PURE__*/_jsxDEV(UserProfileModal, {\n      userId: profileUserId,\n      onClose: () => setProfileUserId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 595,\n      columnNumber: 25\n    }, this), threadLoanId && /*#__PURE__*/_jsxDEV(LoanThreadModal, {\n      loanId: threadLoanId,\n      onClose: () => setThreadLoanId(null)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 597,\n      columnNumber: 24\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 545,\n    columnNumber: 5\n  }, this);\n};\n_s(MoneySummary, \"kU3WgXkFr11Zz9lpHHmAuUIZ0KQ=\", false, function () {\n  return [useNavigate];\n});\n_c = MoneySummary;\nexport default MoneySummary;\nvar _c;\n$RefreshReg$(_c, \"MoneySummary\");","map":{"version":3,"names":["React","useEffect","useState","useCallback","useNavigate","UserProfileModal","LoanThreadModal","jsxDEV","_jsxDEV","getCurrentUserId","t","localStorage","getItem","_payload$userId","payload","JSON","parse","atob","split","userId","fmtMoney","n","Number","isNaN","toFixed","MoneySummary","_s","summary","setSummary","loansGiven","loansReceived","myOpenRequests","loading","setLoading","expandedLoans","setExpandedLoans","counterForm","setCounterForm","openSec","setOpenSec","open","given","received","payLoading","setPayLoading","profileUserId","setProfileUserId","threadLoanId","setThreadLoanId","token","navigate","me","authHeader","Authorization","postOffer","req","amount","interestRate","duration","id","isFinite","alert","path","type","res","fetch","method","headers","body","stringify","apr","months","data","json","catch","ok","error","acceptRequest","cancelRequest","fetchMarketOpenRequests","meId","r","list","items","Array","isArray","filter","it","_it$borrower","borrowerId","borrower","map","_r$duration","_r$interestRate","_r$borrower","_r$borrower2","purpose","createdAt","borrowerName","name","status","resOpen","openListRaw","openList","mine","_r$borrower3","_r$duration2","_r$interestRate2","_r$borrower4","_r$borrower5","fetchDirectOpenRequests","combined","asBorrower","asLender","FINAL","Set","d","has","toUpperCase","_d$borrower","_d$lender","_d$months","_d$apr","_d$borrower2","_d$lender2","lenderId","lender","iAmBorrower","lenderName","fetchSummary","loansAsLender","loansAsBorrower","marketOpen","directOpen","Promise","all","cf","forEach","_r$amount","_r$interestRate3","_r$duration3","err","console","loanKey","loan","idx","_id","String","toggleLoanDetails","prev","Object","keys","reduce","acc","k","payNext","_loan$installmentAmou","key","installmentAmount","window","confirm","m","credentials","Error","paid","e","message","renderLoanCard","isLender","isExpanded","otherParty","canPay","nextDueDate","badgeClass","fundedDate","Date","toLocaleDateString","className","children","fileName","_jsxFileName","lineNumber","columnNumber","style","textAlign","onClick","title","amountCollected","disabled","renderOpenRequestCard","_req$status","updateCF","patch","min","value","onChange","target","step","max","myOpen","s","length","onClose","loanId","_c","$RefreshReg$"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/dashboard/MoneySummary.jsx"],"sourcesContent":["// src/features/money/MoneySummary.jsx\r\nimport React, { useEffect, useState, useCallback } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport './MoneySummary.css';\r\nimport UserProfileModal from '../../components/UserProfileModal';\r\nimport LoanThreadModal from '../loans/LoanThreadModal';\r\n\r\n// helper: decode JWT for current user id\r\nfunction getCurrentUserId() {\r\n  const t = localStorage.getItem('token');\r\n  if (!t) return null;\r\n  try {\r\n    const payload = JSON.parse(atob(t.split('.')[1] || ''));\r\n    return payload?.userId ?? null;\r\n  } catch {\r\n    return null;\r\n  }\r\n}\r\n\r\nconst fmtMoney = (n) =>\r\n  typeof n === 'number' && !Number.isNaN(n) ? `$${n.toFixed(2)}` : 'â€”';\r\n\r\nconst MoneySummary = () => {\r\n  const [summary, setSummary] = useState({\r\n    loansGiven: [],\r\n    loansReceived: [],\r\n    myOpenRequests: [],\r\n  });\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // expanded panels (loans + requests share the same map)\r\n  const [expandedLoans, setExpandedLoans] = useState({});\r\n  // small counter-offer form state for each request id\r\n  const [counterForm, setCounterForm] = useState({}); // { [reqId]: { amount, interestRate, duration } }\r\n\r\n  // accordions\r\n  const [openSec, setOpenSec] = useState({ open: true, given: true, received: true });\r\n\r\n  const [payLoading, setPayLoading] = useState({});\r\n  const [profileUserId, setProfileUserId] = useState(null);\r\n\r\n  // discussion modal\r\n  const [threadLoanId, setThreadLoanId] = useState(null);\r\n\r\n  const token = localStorage.getItem('token');\r\n  const navigate = useNavigate();\r\n\r\n  const me = getCurrentUserId();\r\n  const authHeader = token ? { Authorization: `Bearer ${token}` } : {};\r\n\r\n  /** ----------------- ACTION HELPERS (Negotiation) ----------------- */\r\n\r\n  const postOffer = async (req) => {\r\n    const { amount, interestRate, duration } = counterForm[req.id] || {};\r\n    if (!Number.isFinite(Number(amount)) || !Number.isFinite(Number(interestRate)) || !Number.isFinite(Number(duration))) {\r\n      alert('Please enter valid numbers for amount, interest and months.');\r\n      return false;\r\n    }\r\n\r\n    const path =\r\n      req.type === 'direct'\r\n        ? `/api/direct-requests/${req.id}/offer`\r\n        : `/api/loan-requests/${req.id}/offer`;\r\n\r\n    const res = await fetch(path, {\r\n      method: 'POST',\r\n      headers: { 'Content-Type': 'application/json', ...authHeader },\r\n      body: JSON.stringify({\r\n        amount: Number(amount),\r\n        apr: Number(interestRate),\r\n        months: Number(duration),\r\n      }),\r\n    });\r\n\r\n    const data = await res.json().catch(() => ({}));\r\n    if (!res.ok) {\r\n      alert(data?.error || 'Failed to send offer');\r\n      return false;\r\n    }\r\n    alert('Offer sent!');\r\n    return true;\r\n  };\r\n\r\n  const acceptRequest = async (req) => {\r\n    const path =\r\n      req.type === 'direct'\r\n        ? `/api/direct-requests/${req.id}/accept`\r\n        : `/api/loan-requests/${req.id}/accept`;\r\n\r\n    const res = await fetch(path, { method: 'POST', headers: authHeader });\r\n    const data = await res.json().catch(() => ({}));\r\n    if (!res.ok) {\r\n      alert(data?.error || 'Failed to accept');\r\n      return false;\r\n    }\r\n    alert('Accepted!');\r\n    return true;\r\n  };\r\n\r\n  const cancelRequest = async (req) => {\r\n    const path =\r\n      req.type === 'direct'\r\n        ? `/api/direct-requests/${req.id}/cancel`\r\n        : `/api/loan-requests/${req.id}/cancel`;\r\n\r\n    const res = await fetch(path, { method: 'POST', headers: authHeader });\r\n    const data = await res.json().catch(() => ({}));\r\n    if (!res.ok) {\r\n      alert(data?.error || 'Failed to cancel');\r\n      return false;\r\n    }\r\n    alert('Cancelled.');\r\n    return true;\r\n  };\r\n\r\n  /** ---- helpers to fetch open requests (market + direct) ---- */\r\n\r\n  // Try a couple of marketplace endpoints, normalize result\r\n  const fetchMarketOpenRequests = async () => {\r\n    const meId = me;\r\n    if (!meId) return [];\r\n\r\n    // Preferred: /api/loan-requests/mine?status=OPEN\r\n    try {\r\n      const r = await fetch('/api/loan-requests/mine?status=OPEN', { headers: authHeader });\r\n      if (r.ok) {\r\n        const list = await r.json();\r\n        const items = Array.isArray(list) ? list : Array.isArray(list?.items) ? list.items : [];\r\n        return items\r\n          .filter((it) => (it?.borrowerId || it?.borrower?.id) === meId)\r\n          .map((r) => ({\r\n            type: 'market',\r\n            id: r.id,\r\n            amount: Number(r.amount),\r\n            duration: Number(r.duration ?? r.months),\r\n            interestRate: Number(r.interestRate ?? r.apr),\r\n            purpose: r.purpose || '',\r\n            createdAt: r.createdAt || null,\r\n            borrowerName: r?.borrower?.name || 'You',\r\n            borrowerId: r?.borrower?.id || r.borrowerId || meId,\r\n            status: r.status || 'OPEN',\r\n          }));\r\n      }\r\n    } catch {}\r\n\r\n    // Fallback: /api/loans/open\r\n    try {\r\n      const resOpen = await fetch('/api/loans/open', { headers: authHeader });\r\n      if (resOpen.ok) {\r\n        const openListRaw = await resOpen.json();\r\n        const openList = Array.isArray(openListRaw)\r\n          ? openListRaw\r\n          : Array.isArray(openListRaw?.items)\r\n          ? openListRaw.items\r\n          : [];\r\n        const mine = openList.filter((r) => (r?.borrower?.id || r?.borrowerId) === meId);\r\n        return mine.map((r) => ({\r\n          type: 'market',\r\n          id: r.id,\r\n          amount: Number(r.amount),\r\n          duration: Number(r.duration ?? r.months),\r\n          interestRate: Number(r.interestRate ?? r.apr),\r\n          purpose: r.purpose || '',\r\n          createdAt: r.createdAt || null,\r\n          borrowerName: r?.borrower?.name || 'You',\r\n          borrowerId: r?.borrower?.id || r?.borrowerId || meId,\r\n          status: r.status || 'OPEN',\r\n        }));\r\n      }\r\n    } catch {}\r\n\r\n    return [];\r\n  };\r\n\r\n  // Direct requests endpoint, normalize pending ones (both roles)\r\n  const fetchDirectOpenRequests = async () => {\r\n    const meId = me;\r\n    if (!meId) return [];\r\n\r\n    try {\r\n      const r = await fetch('/api/direct-requests/mine', { headers: authHeader });\r\n      if (!r.ok) return [];\r\n      const data = await r.json();\r\n\r\n      // Accept either a flat array or {asBorrower, asLender}\r\n      const combined = Array.isArray(data)\r\n        ? data\r\n        : [\r\n            ...(Array.isArray(data?.asBorrower) ? data.asBorrower : []),\r\n            ...(Array.isArray(data?.asLender) ? data.asLender : []),\r\n          ];\r\n\r\n      const FINAL = new Set(['DECLINED', 'CANCELLED', 'DISBURSED', 'APPROVED', 'REJECTED']);\r\n      return combined\r\n        .filter((d) => !FINAL.has((d?.status || '').toUpperCase()))\r\n        .map((d) => {\r\n          const borrowerId = d.borrowerId || d?.borrower?.id;\r\n          const lenderId = d.lenderId || d?.lender?.id;\r\n          const iAmBorrower = borrowerId === meId;\r\n\r\n          return {\r\n            type: 'direct',\r\n            id: d.id,\r\n            amount: Number(d.amount),\r\n            duration: Number(d.months ?? d.duration),\r\n            interestRate: Number(d.apr ?? d.interestRate),\r\n            createdAt: d.createdAt || null,\r\n            borrowerId,\r\n            borrowerName: d?.borrower?.name || (iAmBorrower ? 'You' : ''),\r\n            lenderId,\r\n            lenderName: d?.lender?.name || (!iAmBorrower ? 'Counterparty' : ''),\r\n            status: d.status || 'PENDING',\r\n          };\r\n        });\r\n    } catch {\r\n      return [];\r\n    }\r\n  };\r\n\r\n  const fetchSummary = useCallback(async () => {\r\n    if (!token) return;\r\n    setLoading(true);\r\n    try {\r\n      // loans summary\r\n      const res = await fetch('/api/users/my-money-summary', { headers: authHeader });\r\n      let loansGiven = [];\r\n      let loansReceived = [];\r\n      if (res.ok) {\r\n        const data = await res.json();\r\n        loansGiven = Array.isArray(data.loansGiven)\r\n          ? data.loansGiven\r\n          : Array.isArray(data.loansAsLender)\r\n          ? data.loansAsLender\r\n          : [];\r\n        loansReceived = Array.isArray(data.loansReceived)\r\n          ? data.loansReceived\r\n          : Array.isArray(data.loansAsBorrower)\r\n          ? data.loansAsBorrower\r\n          : [];\r\n      }\r\n\r\n      // open requests: market + direct\r\n      const [marketOpen, directOpen] = await Promise.all([fetchMarketOpenRequests(), fetchDirectOpenRequests()]);\r\n      const myOpenRequests = [...marketOpen, ...directOpen];\r\n\r\n      // prime counterForm defaults\r\n      const cf = {};\r\n      myOpenRequests.forEach((r) => {\r\n        cf[r.id] = {\r\n          amount: r.amount ?? 0,\r\n          interestRate: r.interestRate ?? 0,\r\n          duration: r.duration ?? 1,\r\n        };\r\n      });\r\n\r\n      setCounterForm(cf);\r\n      setSummary({ loansGiven, loansReceived, myOpenRequests });\r\n    } catch (err) {\r\n      console.error('Error fetching money summary:', err);\r\n      setSummary({ loansGiven: [], loansReceived: [], myOpenRequests: [] });\r\n    } finally {\r\n      setLoading(false);\r\n    }\r\n  }, [token]); // eslint-disable-line react-hooks/exhaustive-deps\r\n\r\n  useEffect(() => {\r\n    fetchSummary();\r\n  }, [fetchSummary]);\r\n\r\n  const loanKey = (loan, idx) => loan?.id || loan?._id || String(idx);\r\n\r\n  const toggleLoanDetails = (id) => {\r\n    setExpandedLoans((prev) => ({\r\n      ...(Object.keys(prev).reduce((acc, k) => ({ ...acc, [k]: false }), {})),\r\n      [id]: !prev[id],\r\n    }));\r\n  };\r\n\r\n  const payNext = async (loan) => {\r\n    const key = loanKey(loan);\r\n    const amount = loan?.installmentAmount ?? 0;\r\n    if (!window.confirm(`Pay the next installment (${fmtMoney(amount)})?`)) return;\r\n    try {\r\n      setPayLoading((m) => ({ ...m, [key]: true }));\r\n      const res = await fetch(`/api/loans/${loan.id || loan._id}/pay-next`, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json', ...authHeader },\r\n        credentials: 'include',\r\n      });\r\n      const data = await res.json();\r\n      if (!res.ok) throw new Error(data?.error || 'Payment failed');\r\n      const paid = typeof data.amount === 'number' ? data.amount : amount;\r\n      alert(`Payment successful! Amount: ${fmtMoney(paid)}`);\r\n      await fetchSummary();\r\n    } catch (e) {\r\n      alert(e.message);\r\n    } finally {\r\n      setPayLoading((m) => ({ ...m, [key]: false }));\r\n    }\r\n  };\r\n\r\n  /** -------------------------- RENDERERS --------------------------- */\r\n\r\n  const renderLoanCard = (loan, isLender, idx) => {\r\n    const key = loanKey(loan, idx);\r\n    const isExpanded = !!expandedLoans[key];\r\n    const otherParty = isLender ? loan.borrowerName : loan.lenderName;\r\n\r\n    const canPay =\r\n      !isLender &&\r\n      typeof loan.installmentAmount === 'number' &&\r\n      loan.installmentAmount > 0 &&\r\n      !!loan.nextDueDate;\r\n\r\n    const badgeClass =\r\n      (loan.status || '').toUpperCase() === 'FUNDED'\r\n        ? 'ms-badge ms-badge--ok'\r\n        : 'ms-badge ms-badge--warn';\r\n\r\n    const fundedDate = loan.fundedDate ? new Date(loan.fundedDate).toLocaleDateString() : 'â€”';\r\n\r\n    return (\r\n      <div className=\"ms-card\" key={key}>\r\n        <div className=\"ms-card-row\">\r\n          <div>\r\n            <div className=\"ms-label\">{isLender ? 'Borrower' : 'Lender'}</div>\r\n            <div className=\"ms-value-strong\">{otherParty || 'Unknown'}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(loan.amount)}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Funded Date</div>\r\n            <div className=\"ms-value-strong\">{fundedDate}</div>\r\n          </div>\r\n          <div style={{ textAlign: 'right' }}>\r\n            <span className={badgeClass}>{loan.status || 'â€”'}</span>\r\n          </div>\r\n        </div>\r\n\r\n        <div className=\"ms-actions\">\r\n          <button onClick={() => setThreadLoanId(loan.id || loan._id)} className=\"action-btn\" title=\"Open conversation\">\r\n            ðŸ’¬ Messages\r\n          </button>\r\n\r\n          <button onClick={() => toggleLoanDetails(key)} className=\"action-btn\">\r\n            {isExpanded ? 'ðŸ”½ Hide Contract' : 'ðŸ“„ View Contract'}\r\n          </button>\r\n        </div>\r\n\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            {loan.status && (\r\n              <p className=\"mt-6\">\r\n                <strong>Status:</strong> {loan.status}\r\n              </p>\r\n            )}\r\n            <p className=\"mt-6\">\r\n              <strong>Interest Rate:</strong> {typeof loan.interestRate === 'number' ? `${loan.interestRate}%` : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Duration:</strong> {typeof loan.duration === 'number' ? `${loan.duration} months` : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Next Due Date:</strong> {loan.nextDueDate ? new Date(loan.nextDueDate).toLocaleDateString() : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Installment (this period):</strong> {fmtMoney(loan.installmentAmount)}\r\n            </p>\r\n\r\n            {isLender && typeof loan.amountCollected === 'number' && (\r\n              <p className=\"mt-6\">\r\n                <strong>Amount collected on loan:</strong> {fmtMoney(loan.amountCollected)}\r\n              </p>\r\n            )}\r\n\r\n            {!isLender && canPay && (\r\n              <div className=\"mt-6\">\r\n                <button\r\n                  className=\"action-btn primary\"\r\n                  onClick={() => payNext(loan)}\r\n                  disabled={!!payLoading[key]}\r\n                  title=\"Pay next installment\"\r\n                >\r\n                  {payLoading[key] ? 'Processingâ€¦' : 'ðŸ’³ Make Payment'}\r\n                </button>\r\n              </div>\r\n            )}\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  // Negotiable open requests (market + direct)\r\n  const renderOpenRequestCard = (req) => {\r\n    const isExpanded = !!expandedLoans[req.id];\r\n    const iAmBorrower = req.borrowerId === me;\r\n\r\n    const cf = counterForm[req.id] || { amount: req.amount || 0, interestRate: req.interestRate || 0, duration: req.duration || 1 };\r\n\r\n    const updateCF = (patch) =>\r\n      setCounterForm((m) => ({\r\n        ...m,\r\n        [req.id]: { ...(m[req.id] || {}), ...patch },\r\n      }));\r\n\r\n    return (\r\n      <div className=\"ms-card\" key={req.id}>\r\n        {/* Collapsed row */}\r\n        <div className=\"ms-card-row\">\r\n          <div>\r\n            <div className=\"ms-label\">Borrower</div>\r\n            <div className=\"ms-value-strong\">{req.borrowerName || 'You'}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Amount</div>\r\n            <div className=\"ms-value-strong\">{fmtMoney(req.amount)}</div>\r\n          </div>\r\n          <div>\r\n            <div className=\"ms-label\">Created</div>\r\n            <div className=\"ms-value-strong\">{req.createdAt ? new Date(req.createdAt).toLocaleDateString() : 'â€”'}</div>\r\n          </div>\r\n          <div style={{ textAlign: 'right' }}>\r\n            <span className=\"ms-badge ms-badge--warn\">Open</span>\r\n          </div>\r\n        </div>\r\n\r\n        {/* Action row */}\r\n        <div className=\"ms-actions\">\r\n          <button className=\"action-btn\" onClick={() => toggleLoanDetails(req.id)} title=\"View request details\">\r\n            {isExpanded ? 'ðŸ”½ Hide' : 'ðŸ“„ View'}\r\n          </button>\r\n        </div>\r\n\r\n        {/* Details + negotiation */}\r\n        {isExpanded && (\r\n          <div className=\"ms-details\">\r\n            <p className=\"mt-6\">\r\n              <strong>Status:</strong> {req.status ?? 'OPEN'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Interest Rate:</strong> {Number.isFinite(req.interestRate) ? `${req.interestRate}%` : 'â€”'}\r\n            </p>\r\n            <p className=\"mt-6\">\r\n              <strong>Duration:</strong> {Number.isFinite(req.duration) ? `${req.duration} months` : 'â€”'}\r\n            </p>\r\n            {req.purpose ? (\r\n              <p className=\"mt-6\">\r\n                <strong>Reason:</strong> {req.purpose}\r\n              </p>\r\n            ) : null}\r\n            {req.lenderName ? (\r\n              <p className=\"mt-6\">\r\n                <strong>Requested Lender:</strong> {req.lenderName}\r\n              </p>\r\n            ) : null}\r\n\r\n            {/* Negotiation row */}\r\n            <div className=\"ms-offer-grid mt-8\">\r\n              <div>\r\n                <label className=\"ms-label\">Offer Amount</label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"1\"\r\n                  className=\"ms-input\"\r\n                  value={cf.amount}\r\n                  onChange={(e) => updateCF({ amount: Number(e.target.value) })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"ms-label\">APR (%)</label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"0\"\r\n                  step=\"0.1\"\r\n                  className=\"ms-input\"\r\n                  value={cf.interestRate}\r\n                  onChange={(e) => updateCF({ interestRate: Number(e.target.value) })}\r\n                />\r\n              </div>\r\n              <div>\r\n                <label className=\"ms-label\">Months</label>\r\n                <input\r\n                  type=\"number\"\r\n                  min=\"1\"\r\n                  max=\"36\"\r\n                  className=\"ms-input\"\r\n                  value={cf.duration}\r\n                  onChange={(e) => updateCF({ duration: Number(e.target.value) })}\r\n                />\r\n              </div>\r\n            </div>\r\n\r\n            <div className=\"ms-actions mt-6\">\r\n              <button\r\n                className=\"action-btn\"\r\n                onClick={async () => {\r\n                  if (await postOffer(req)) fetchSummary();\r\n                }}\r\n                title=\"Send counter-offer\"\r\n              >\r\n                ðŸ¤ Send Counter-Offer\r\n              </button>\r\n\r\n              {/* Accept: both sides may need to accept depending on your backend; keep it available */}\r\n              <button\r\n                className=\"action-btn primary\"\r\n                onClick={async () => {\r\n                  if (await acceptRequest(req)) fetchSummary();\r\n                }}\r\n                title=\"Accept terms\"\r\n              >\r\n                âœ… Accept\r\n              </button>\r\n\r\n              {/* Cancel: borrower usually can cancel their own request */}\r\n              {iAmBorrower && (\r\n                <button\r\n                  className=\"action-btn\"\r\n                  onClick={async () => {\r\n                    if (!window.confirm('Cancel this request?')) return;\r\n                    if (await cancelRequest(req)) fetchSummary();\r\n                  }}\r\n                  title=\"Cancel request\"\r\n                >\r\n                  ðŸ—‘ Cancel\r\n                </button>\r\n              )}\r\n            </div>\r\n          </div>\r\n        )}\r\n      </div>\r\n    );\r\n  };\r\n\r\n  if (loading) return <p className=\"ms-loading ms-container\">Loading money summary...</p>;\r\n\r\n  const given = Array.isArray(summary.loansGiven) ? summary.loansGiven : [];\r\n  const received = Array.isArray(summary.loansReceived) ? summary.loansReceived : [];\r\n  const myOpen = Array.isArray(summary.myOpenRequests) ? summary.myOpenRequests : [];\r\n\r\n  return (\r\n    <div className=\"ms-container\">\r\n      <h2 className=\"ms-heading\">ðŸ’µ My Money Summary</h2>\r\n\r\n      {/* Section: Open Requests */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, open: !s.open }))}\r\n          aria-expanded={openSec.open}\r\n        >\r\n          <div className=\"ms-subheading\">My Open Loan Requests</div>\r\n          <div className=\"ms-caret\">{openSec.open ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.open && (\r\n          <div className=\"ms-section-body\">\r\n            {myOpen.length === 0 ? <p className=\"ms-empty\">You have no open requests.</p> : myOpen.map(renderOpenRequestCard)}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Given */}\r\n      <div className=\"ms-section\">\r\n        <button className=\"ms-section-head\" onClick={() => setOpenSec((s) => ({ ...s, given: !s.given }))} aria-expanded={openSec.given}>\r\n          <div className=\"ms-subheading\">Loans Given (I'm the Lender)</div>\r\n          <div className=\"ms-caret\">{openSec.given ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.given && (\r\n          <div className=\"ms-section-body\">\r\n            {given.length === 0 ? <p className=\"ms-empty\">No loans given yet.</p> : given.map((loan, idx) => renderLoanCard(loan, true, idx))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {/* Section: Loans Received */}\r\n      <div className=\"ms-section\">\r\n        <button\r\n          className=\"ms-section-head\"\r\n          onClick={() => setOpenSec((s) => ({ ...s, received: !s.received }))}\r\n          aria-expanded={openSec.received}\r\n        >\r\n          <div className=\"ms-subheading\">Loans Received (I'm the Borrower)</div>\r\n          <div className=\"ms-caret\">{openSec.received ? 'â–¾' : 'â–¸'}</div>\r\n        </button>\r\n        {openSec.received && (\r\n          <div className=\"ms-section-body\">\r\n            {received.length === 0 ? <p className=\"ms-empty\">No loans received yet.</p> : received.map((loan, idx) => renderLoanCard(loan, false, idx))}\r\n          </div>\r\n        )}\r\n      </div>\r\n\r\n      {profileUserId && <UserProfileModal userId={profileUserId} onClose={() => setProfileUserId(null)} />}\r\n\r\n      {threadLoanId && <LoanThreadModal loanId={threadLoanId} onClose={() => setThreadLoanId(null)} />}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MoneySummary;\r\n"],"mappings":";;AAAA;AACA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,EAAEC,WAAW,QAAQ,OAAO;AAC/D,SAASC,WAAW,QAAQ,kBAAkB;AAC9C,OAAO,oBAAoB;AAC3B,OAAOC,gBAAgB,MAAM,mCAAmC;AAChE,OAAOC,eAAe,MAAM,0BAA0B;;AAEtD;AAAA,SAAAC,MAAA,IAAAC,OAAA;AACA,SAASC,gBAAgBA,CAAA,EAAG;EAC1B,MAAMC,CAAC,GAAGC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EACvC,IAAI,CAACF,CAAC,EAAE,OAAO,IAAI;EACnB,IAAI;IAAA,IAAAG,eAAA;IACF,MAAMC,OAAO,GAAGC,IAAI,CAACC,KAAK,CAACC,IAAI,CAACP,CAAC,CAACQ,KAAK,CAAC,GAAG,CAAC,CAAC,CAAC,CAAC,IAAI,EAAE,CAAC,CAAC;IACvD,QAAAL,eAAA,GAAOC,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEK,MAAM,cAAAN,eAAA,cAAAA,eAAA,GAAI,IAAI;EAChC,CAAC,CAAC,MAAM;IACN,OAAO,IAAI;EACb;AACF;AAEA,MAAMO,QAAQ,GAAIC,CAAC,IACjB,OAAOA,CAAC,KAAK,QAAQ,IAAI,CAACC,MAAM,CAACC,KAAK,CAACF,CAAC,CAAC,GAAG,IAAIA,CAAC,CAACG,OAAO,CAAC,CAAC,CAAC,EAAE,GAAG,GAAG;AAEtE,MAAMC,YAAY,GAAGA,CAAA,KAAM;EAAAC,EAAA;EACzB,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAG1B,QAAQ,CAAC;IACrC2B,UAAU,EAAE,EAAE;IACdC,aAAa,EAAE,EAAE;IACjBC,cAAc,EAAE;EAClB,CAAC,CAAC;EACF,MAAM,CAACC,OAAO,EAAEC,UAAU,CAAC,GAAG/B,QAAQ,CAAC,IAAI,CAAC;;EAE5C;EACA,MAAM,CAACgC,aAAa,EAAEC,gBAAgB,CAAC,GAAGjC,QAAQ,CAAC,CAAC,CAAC,CAAC;EACtD;EACA,MAAM,CAACkC,WAAW,EAAEC,cAAc,CAAC,GAAGnC,QAAQ,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;;EAEpD;EACA,MAAM,CAACoC,OAAO,EAAEC,UAAU,CAAC,GAAGrC,QAAQ,CAAC;IAAEsC,IAAI,EAAE,IAAI;IAAEC,KAAK,EAAE,IAAI;IAAEC,QAAQ,EAAE;EAAK,CAAC,CAAC;EAEnF,MAAM,CAACC,UAAU,EAAEC,aAAa,CAAC,GAAG1C,QAAQ,CAAC,CAAC,CAAC,CAAC;EAChD,MAAM,CAAC2C,aAAa,EAAEC,gBAAgB,CAAC,GAAG5C,QAAQ,CAAC,IAAI,CAAC;;EAExD;EACA,MAAM,CAAC6C,YAAY,EAAEC,eAAe,CAAC,GAAG9C,QAAQ,CAAC,IAAI,CAAC;EAEtD,MAAM+C,KAAK,GAAGtC,YAAY,CAACC,OAAO,CAAC,OAAO,CAAC;EAC3C,MAAMsC,QAAQ,GAAG9C,WAAW,CAAC,CAAC;EAE9B,MAAM+C,EAAE,GAAG1C,gBAAgB,CAAC,CAAC;EAC7B,MAAM2C,UAAU,GAAGH,KAAK,GAAG;IAAEI,aAAa,EAAE,UAAUJ,KAAK;EAAG,CAAC,GAAG,CAAC,CAAC;;EAEpE;;EAEA,MAAMK,SAAS,GAAG,MAAOC,GAAG,IAAK;IAC/B,MAAM;MAAEC,MAAM;MAAEC,YAAY;MAAEC;IAAS,CAAC,GAAGtB,WAAW,CAACmB,GAAG,CAACI,EAAE,CAAC,IAAI,CAAC,CAAC;IACpE,IAAI,CAACrC,MAAM,CAACsC,QAAQ,CAACtC,MAAM,CAACkC,MAAM,CAAC,CAAC,IAAI,CAAClC,MAAM,CAACsC,QAAQ,CAACtC,MAAM,CAACmC,YAAY,CAAC,CAAC,IAAI,CAACnC,MAAM,CAACsC,QAAQ,CAACtC,MAAM,CAACoC,QAAQ,CAAC,CAAC,EAAE;MACpHG,KAAK,CAAC,6DAA6D,CAAC;MACpE,OAAO,KAAK;IACd;IAEA,MAAMC,IAAI,GACRP,GAAG,CAACQ,IAAI,KAAK,QAAQ,GACjB,wBAAwBR,GAAG,CAACI,EAAE,QAAQ,GACtC,sBAAsBJ,GAAG,CAACI,EAAE,QAAQ;IAE1C,MAAMK,GAAG,GAAG,MAAMC,KAAK,CAACH,IAAI,EAAE;MAC5BI,MAAM,EAAE,MAAM;MACdC,OAAO,EAAE;QAAE,cAAc,EAAE,kBAAkB;QAAE,GAAGf;MAAW,CAAC;MAC9DgB,IAAI,EAAErD,IAAI,CAACsD,SAAS,CAAC;QACnBb,MAAM,EAAElC,MAAM,CAACkC,MAAM,CAAC;QACtBc,GAAG,EAAEhD,MAAM,CAACmC,YAAY,CAAC;QACzBc,MAAM,EAAEjD,MAAM,CAACoC,QAAQ;MACzB,CAAC;IACH,CAAC,CAAC;IAEF,MAAMc,IAAI,GAAG,MAAMR,GAAG,CAACS,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IAC/C,IAAI,CAACV,GAAG,CAACW,EAAE,EAAE;MACXd,KAAK,CAAC,CAAAW,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,KAAK,KAAI,sBAAsB,CAAC;MAC5C,OAAO,KAAK;IACd;IACAf,KAAK,CAAC,aAAa,CAAC;IACpB,OAAO,IAAI;EACb,CAAC;EAED,MAAMgB,aAAa,GAAG,MAAOtB,GAAG,IAAK;IACnC,MAAMO,IAAI,GACRP,GAAG,CAACQ,IAAI,KAAK,QAAQ,GACjB,wBAAwBR,GAAG,CAACI,EAAE,SAAS,GACvC,sBAAsBJ,GAAG,CAACI,EAAE,SAAS;IAE3C,MAAMK,GAAG,GAAG,MAAMC,KAAK,CAACH,IAAI,EAAE;MAAEI,MAAM,EAAE,MAAM;MAAEC,OAAO,EAAEf;IAAW,CAAC,CAAC;IACtE,MAAMoB,IAAI,GAAG,MAAMR,GAAG,CAACS,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IAC/C,IAAI,CAACV,GAAG,CAACW,EAAE,EAAE;MACXd,KAAK,CAAC,CAAAW,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,KAAK,KAAI,kBAAkB,CAAC;MACxC,OAAO,KAAK;IACd;IACAf,KAAK,CAAC,WAAW,CAAC;IAClB,OAAO,IAAI;EACb,CAAC;EAED,MAAMiB,aAAa,GAAG,MAAOvB,GAAG,IAAK;IACnC,MAAMO,IAAI,GACRP,GAAG,CAACQ,IAAI,KAAK,QAAQ,GACjB,wBAAwBR,GAAG,CAACI,EAAE,SAAS,GACvC,sBAAsBJ,GAAG,CAACI,EAAE,SAAS;IAE3C,MAAMK,GAAG,GAAG,MAAMC,KAAK,CAACH,IAAI,EAAE;MAAEI,MAAM,EAAE,MAAM;MAAEC,OAAO,EAAEf;IAAW,CAAC,CAAC;IACtE,MAAMoB,IAAI,GAAG,MAAMR,GAAG,CAACS,IAAI,CAAC,CAAC,CAACC,KAAK,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;IAC/C,IAAI,CAACV,GAAG,CAACW,EAAE,EAAE;MACXd,KAAK,CAAC,CAAAW,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,KAAK,KAAI,kBAAkB,CAAC;MACxC,OAAO,KAAK;IACd;IACAf,KAAK,CAAC,YAAY,CAAC;IACnB,OAAO,IAAI;EACb,CAAC;;EAED;;EAEA;EACA,MAAMkB,uBAAuB,GAAG,MAAAA,CAAA,KAAY;IAC1C,MAAMC,IAAI,GAAG7B,EAAE;IACf,IAAI,CAAC6B,IAAI,EAAE,OAAO,EAAE;;IAEpB;IACA,IAAI;MACF,MAAMC,CAAC,GAAG,MAAMhB,KAAK,CAAC,qCAAqC,EAAE;QAAEE,OAAO,EAAEf;MAAW,CAAC,CAAC;MACrF,IAAI6B,CAAC,CAACN,EAAE,EAAE;QACR,MAAMO,IAAI,GAAG,MAAMD,CAAC,CAACR,IAAI,CAAC,CAAC;QAC3B,MAAMU,KAAK,GAAGC,KAAK,CAACC,OAAO,CAACH,IAAI,CAAC,GAAGA,IAAI,GAAGE,KAAK,CAACC,OAAO,CAACH,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEC,KAAK,CAAC,GAAGD,IAAI,CAACC,KAAK,GAAG,EAAE;QACvF,OAAOA,KAAK,CACTG,MAAM,CAAEC,EAAE;UAAA,IAAAC,YAAA;UAAA,OAAK,CAAC,CAAAD,EAAE,aAAFA,EAAE,uBAAFA,EAAE,CAAEE,UAAU,MAAIF,EAAE,aAAFA,EAAE,wBAAAC,YAAA,GAAFD,EAAE,CAAEG,QAAQ,cAAAF,YAAA,uBAAZA,YAAA,CAAc7B,EAAE,OAAMqB,IAAI;QAAA,EAAC,CAC7DW,GAAG,CAAEV,CAAC;UAAA,IAAAW,WAAA,EAAAC,eAAA,EAAAC,WAAA,EAAAC,YAAA;UAAA,OAAM;YACXhC,IAAI,EAAE,QAAQ;YACdJ,EAAE,EAAEsB,CAAC,CAACtB,EAAE;YACRH,MAAM,EAAElC,MAAM,CAAC2D,CAAC,CAACzB,MAAM,CAAC;YACxBE,QAAQ,EAAEpC,MAAM,EAAAsE,WAAA,GAACX,CAAC,CAACvB,QAAQ,cAAAkC,WAAA,cAAAA,WAAA,GAAIX,CAAC,CAACV,MAAM,CAAC;YACxCd,YAAY,EAAEnC,MAAM,EAAAuE,eAAA,GAACZ,CAAC,CAACxB,YAAY,cAAAoC,eAAA,cAAAA,eAAA,GAAIZ,CAAC,CAACX,GAAG,CAAC;YAC7C0B,OAAO,EAAEf,CAAC,CAACe,OAAO,IAAI,EAAE;YACxBC,SAAS,EAAEhB,CAAC,CAACgB,SAAS,IAAI,IAAI;YAC9BC,YAAY,EAAE,CAAAjB,CAAC,aAADA,CAAC,wBAAAa,WAAA,GAADb,CAAC,CAAES,QAAQ,cAAAI,WAAA,uBAAXA,WAAA,CAAaK,IAAI,KAAI,KAAK;YACxCV,UAAU,EAAE,CAAAR,CAAC,aAADA,CAAC,wBAAAc,YAAA,GAADd,CAAC,CAAES,QAAQ,cAAAK,YAAA,uBAAXA,YAAA,CAAapC,EAAE,KAAIsB,CAAC,CAACQ,UAAU,IAAIT,IAAI;YACnDoB,MAAM,EAAEnB,CAAC,CAACmB,MAAM,IAAI;UACtB,CAAC;QAAA,CAAC,CAAC;MACP;IACF,CAAC,CAAC,MAAM,CAAC;;IAET;IACA,IAAI;MACF,MAAMC,OAAO,GAAG,MAAMpC,KAAK,CAAC,iBAAiB,EAAE;QAAEE,OAAO,EAAEf;MAAW,CAAC,CAAC;MACvE,IAAIiD,OAAO,CAAC1B,EAAE,EAAE;QACd,MAAM2B,WAAW,GAAG,MAAMD,OAAO,CAAC5B,IAAI,CAAC,CAAC;QACxC,MAAM8B,QAAQ,GAAGnB,KAAK,CAACC,OAAO,CAACiB,WAAW,CAAC,GACvCA,WAAW,GACXlB,KAAK,CAACC,OAAO,CAACiB,WAAW,aAAXA,WAAW,uBAAXA,WAAW,CAAEnB,KAAK,CAAC,GACjCmB,WAAW,CAACnB,KAAK,GACjB,EAAE;QACN,MAAMqB,IAAI,GAAGD,QAAQ,CAACjB,MAAM,CAAEL,CAAC;UAAA,IAAAwB,YAAA;UAAA,OAAK,CAAC,CAAAxB,CAAC,aAADA,CAAC,wBAAAwB,YAAA,GAADxB,CAAC,CAAES,QAAQ,cAAAe,YAAA,uBAAXA,YAAA,CAAa9C,EAAE,MAAIsB,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEQ,UAAU,OAAMT,IAAI;QAAA,EAAC;QAChF,OAAOwB,IAAI,CAACb,GAAG,CAAEV,CAAC;UAAA,IAAAyB,YAAA,EAAAC,gBAAA,EAAAC,YAAA,EAAAC,YAAA;UAAA,OAAM;YACtB9C,IAAI,EAAE,QAAQ;YACdJ,EAAE,EAAEsB,CAAC,CAACtB,EAAE;YACRH,MAAM,EAAElC,MAAM,CAAC2D,CAAC,CAACzB,MAAM,CAAC;YACxBE,QAAQ,EAAEpC,MAAM,EAAAoF,YAAA,GAACzB,CAAC,CAACvB,QAAQ,cAAAgD,YAAA,cAAAA,YAAA,GAAIzB,CAAC,CAACV,MAAM,CAAC;YACxCd,YAAY,EAAEnC,MAAM,EAAAqF,gBAAA,GAAC1B,CAAC,CAACxB,YAAY,cAAAkD,gBAAA,cAAAA,gBAAA,GAAI1B,CAAC,CAACX,GAAG,CAAC;YAC7C0B,OAAO,EAAEf,CAAC,CAACe,OAAO,IAAI,EAAE;YACxBC,SAAS,EAAEhB,CAAC,CAACgB,SAAS,IAAI,IAAI;YAC9BC,YAAY,EAAE,CAAAjB,CAAC,aAADA,CAAC,wBAAA2B,YAAA,GAAD3B,CAAC,CAAES,QAAQ,cAAAkB,YAAA,uBAAXA,YAAA,CAAaT,IAAI,KAAI,KAAK;YACxCV,UAAU,EAAE,CAAAR,CAAC,aAADA,CAAC,wBAAA4B,YAAA,GAAD5B,CAAC,CAAES,QAAQ,cAAAmB,YAAA,uBAAXA,YAAA,CAAalD,EAAE,MAAIsB,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEQ,UAAU,KAAIT,IAAI;YACpDoB,MAAM,EAAEnB,CAAC,CAACmB,MAAM,IAAI;UACtB,CAAC;QAAA,CAAC,CAAC;MACL;IACF,CAAC,CAAC,MAAM,CAAC;IAET,OAAO,EAAE;EACX,CAAC;;EAED;EACA,MAAMU,uBAAuB,GAAG,MAAAA,CAAA,KAAY;IAC1C,MAAM9B,IAAI,GAAG7B,EAAE;IACf,IAAI,CAAC6B,IAAI,EAAE,OAAO,EAAE;IAEpB,IAAI;MACF,MAAMC,CAAC,GAAG,MAAMhB,KAAK,CAAC,2BAA2B,EAAE;QAAEE,OAAO,EAAEf;MAAW,CAAC,CAAC;MAC3E,IAAI,CAAC6B,CAAC,CAACN,EAAE,EAAE,OAAO,EAAE;MACpB,MAAMH,IAAI,GAAG,MAAMS,CAAC,CAACR,IAAI,CAAC,CAAC;;MAE3B;MACA,MAAMsC,QAAQ,GAAG3B,KAAK,CAACC,OAAO,CAACb,IAAI,CAAC,GAChCA,IAAI,GACJ,CACE,IAAIY,KAAK,CAACC,OAAO,CAACb,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEwC,UAAU,CAAC,GAAGxC,IAAI,CAACwC,UAAU,GAAG,EAAE,CAAC,EAC3D,IAAI5B,KAAK,CAACC,OAAO,CAACb,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEyC,QAAQ,CAAC,GAAGzC,IAAI,CAACyC,QAAQ,GAAG,EAAE,CAAC,CACxD;MAEL,MAAMC,KAAK,GAAG,IAAIC,GAAG,CAAC,CAAC,UAAU,EAAE,WAAW,EAAE,WAAW,EAAE,UAAU,EAAE,UAAU,CAAC,CAAC;MACrF,OAAOJ,QAAQ,CACZzB,MAAM,CAAE8B,CAAC,IAAK,CAACF,KAAK,CAACG,GAAG,CAAC,CAAC,CAAAD,CAAC,aAADA,CAAC,uBAADA,CAAC,CAAEhB,MAAM,KAAI,EAAE,EAAEkB,WAAW,CAAC,CAAC,CAAC,CAAC,CAC1D3B,GAAG,CAAEyB,CAAC,IAAK;QAAA,IAAAG,WAAA,EAAAC,SAAA,EAAAC,SAAA,EAAAC,MAAA,EAAAC,YAAA,EAAAC,UAAA;QACV,MAAMnC,UAAU,GAAG2B,CAAC,CAAC3B,UAAU,KAAI2B,CAAC,aAADA,CAAC,wBAAAG,WAAA,GAADH,CAAC,CAAE1B,QAAQ,cAAA6B,WAAA,uBAAXA,WAAA,CAAa5D,EAAE;QAClD,MAAMkE,QAAQ,GAAGT,CAAC,CAACS,QAAQ,KAAIT,CAAC,aAADA,CAAC,wBAAAI,SAAA,GAADJ,CAAC,CAAEU,MAAM,cAAAN,SAAA,uBAATA,SAAA,CAAW7D,EAAE;QAC5C,MAAMoE,WAAW,GAAGtC,UAAU,KAAKT,IAAI;QAEvC,OAAO;UACLjB,IAAI,EAAE,QAAQ;UACdJ,EAAE,EAAEyD,CAAC,CAACzD,EAAE;UACRH,MAAM,EAAElC,MAAM,CAAC8F,CAAC,CAAC5D,MAAM,CAAC;UACxBE,QAAQ,EAAEpC,MAAM,EAAAmG,SAAA,GAACL,CAAC,CAAC7C,MAAM,cAAAkD,SAAA,cAAAA,SAAA,GAAIL,CAAC,CAAC1D,QAAQ,CAAC;UACxCD,YAAY,EAAEnC,MAAM,EAAAoG,MAAA,GAACN,CAAC,CAAC9C,GAAG,cAAAoD,MAAA,cAAAA,MAAA,GAAIN,CAAC,CAAC3D,YAAY,CAAC;UAC7CwC,SAAS,EAAEmB,CAAC,CAACnB,SAAS,IAAI,IAAI;UAC9BR,UAAU;UACVS,YAAY,EAAE,CAAAkB,CAAC,aAADA,CAAC,wBAAAO,YAAA,GAADP,CAAC,CAAE1B,QAAQ,cAAAiC,YAAA,uBAAXA,YAAA,CAAaxB,IAAI,MAAK4B,WAAW,GAAG,KAAK,GAAG,EAAE,CAAC;UAC7DF,QAAQ;UACRG,UAAU,EAAE,CAAAZ,CAAC,aAADA,CAAC,wBAAAQ,UAAA,GAADR,CAAC,CAAEU,MAAM,cAAAF,UAAA,uBAATA,UAAA,CAAWzB,IAAI,MAAK,CAAC4B,WAAW,GAAG,cAAc,GAAG,EAAE,CAAC;UACnE3B,MAAM,EAAEgB,CAAC,CAAChB,MAAM,IAAI;QACtB,CAAC;MACH,CAAC,CAAC;IACN,CAAC,CAAC,MAAM;MACN,OAAO,EAAE;IACX;EACF,CAAC;EAED,MAAM6B,YAAY,GAAG9H,WAAW,CAAC,YAAY;IAC3C,IAAI,CAAC8C,KAAK,EAAE;IACZhB,UAAU,CAAC,IAAI,CAAC;IAChB,IAAI;MACF;MACA,MAAM+B,GAAG,GAAG,MAAMC,KAAK,CAAC,6BAA6B,EAAE;QAAEE,OAAO,EAAEf;MAAW,CAAC,CAAC;MAC/E,IAAIvB,UAAU,GAAG,EAAE;MACnB,IAAIC,aAAa,GAAG,EAAE;MACtB,IAAIkC,GAAG,CAACW,EAAE,EAAE;QACV,MAAMH,IAAI,GAAG,MAAMR,GAAG,CAACS,IAAI,CAAC,CAAC;QAC7B5C,UAAU,GAAGuD,KAAK,CAACC,OAAO,CAACb,IAAI,CAAC3C,UAAU,CAAC,GACvC2C,IAAI,CAAC3C,UAAU,GACfuD,KAAK,CAACC,OAAO,CAACb,IAAI,CAAC0D,aAAa,CAAC,GACjC1D,IAAI,CAAC0D,aAAa,GAClB,EAAE;QACNpG,aAAa,GAAGsD,KAAK,CAACC,OAAO,CAACb,IAAI,CAAC1C,aAAa,CAAC,GAC7C0C,IAAI,CAAC1C,aAAa,GAClBsD,KAAK,CAACC,OAAO,CAACb,IAAI,CAAC2D,eAAe,CAAC,GACnC3D,IAAI,CAAC2D,eAAe,GACpB,EAAE;MACR;;MAEA;MACA,MAAM,CAACC,UAAU,EAAEC,UAAU,CAAC,GAAG,MAAMC,OAAO,CAACC,GAAG,CAAC,CAACxD,uBAAuB,CAAC,CAAC,EAAE+B,uBAAuB,CAAC,CAAC,CAAC,CAAC;MAC1G,MAAM/E,cAAc,GAAG,CAAC,GAAGqG,UAAU,EAAE,GAAGC,UAAU,CAAC;;MAErD;MACA,MAAMG,EAAE,GAAG,CAAC,CAAC;MACbzG,cAAc,CAAC0G,OAAO,CAAExD,CAAC,IAAK;QAAA,IAAAyD,SAAA,EAAAC,gBAAA,EAAAC,YAAA;QAC5BJ,EAAE,CAACvD,CAAC,CAACtB,EAAE,CAAC,GAAG;UACTH,MAAM,GAAAkF,SAAA,GAAEzD,CAAC,CAACzB,MAAM,cAAAkF,SAAA,cAAAA,SAAA,GAAI,CAAC;UACrBjF,YAAY,GAAAkF,gBAAA,GAAE1D,CAAC,CAACxB,YAAY,cAAAkF,gBAAA,cAAAA,gBAAA,GAAI,CAAC;UACjCjF,QAAQ,GAAAkF,YAAA,GAAE3D,CAAC,CAACvB,QAAQ,cAAAkF,YAAA,cAAAA,YAAA,GAAI;QAC1B,CAAC;MACH,CAAC,CAAC;MAEFvG,cAAc,CAACmG,EAAE,CAAC;MAClB5G,UAAU,CAAC;QAAEC,UAAU;QAAEC,aAAa;QAAEC;MAAe,CAAC,CAAC;IAC3D,CAAC,CAAC,OAAO8G,GAAG,EAAE;MACZC,OAAO,CAAClE,KAAK,CAAC,+BAA+B,EAAEiE,GAAG,CAAC;MACnDjH,UAAU,CAAC;QAAEC,UAAU,EAAE,EAAE;QAAEC,aAAa,EAAE,EAAE;QAAEC,cAAc,EAAE;MAAG,CAAC,CAAC;IACvE,CAAC,SAAS;MACRE,UAAU,CAAC,KAAK,CAAC;IACnB;EACF,CAAC,EAAE,CAACgB,KAAK,CAAC,CAAC,CAAC,CAAC;;EAEbhD,SAAS,CAAC,MAAM;IACdgI,YAAY,CAAC,CAAC;EAChB,CAAC,EAAE,CAACA,YAAY,CAAC,CAAC;EAElB,MAAMc,OAAO,GAAGA,CAACC,IAAI,EAAEC,GAAG,KAAK,CAAAD,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAErF,EAAE,MAAIqF,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEE,GAAG,KAAIC,MAAM,CAACF,GAAG,CAAC;EAEnE,MAAMG,iBAAiB,GAAIzF,EAAE,IAAK;IAChCxB,gBAAgB,CAAEkH,IAAI,KAAM;MAC1B,GAAIC,MAAM,CAACC,IAAI,CAACF,IAAI,CAAC,CAACG,MAAM,CAAC,CAACC,GAAG,EAAEC,CAAC,MAAM;QAAE,GAAGD,GAAG;QAAE,CAACC,CAAC,GAAG;MAAM,CAAC,CAAC,EAAE,CAAC,CAAC,CAAE;MACvE,CAAC/F,EAAE,GAAG,CAAC0F,IAAI,CAAC1F,EAAE;IAChB,CAAC,CAAC,CAAC;EACL,CAAC;EAED,MAAMgG,OAAO,GAAG,MAAOX,IAAI,IAAK;IAAA,IAAAY,qBAAA;IAC9B,MAAMC,GAAG,GAAGd,OAAO,CAACC,IAAI,CAAC;IACzB,MAAMxF,MAAM,IAAAoG,qBAAA,GAAGZ,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEc,iBAAiB,cAAAF,qBAAA,cAAAA,qBAAA,GAAI,CAAC;IAC3C,IAAI,CAACG,MAAM,CAACC,OAAO,CAAC,6BAA6B5I,QAAQ,CAACoC,MAAM,CAAC,IAAI,CAAC,EAAE;IACxE,IAAI;MACFZ,aAAa,CAAEqH,CAAC,KAAM;QAAE,GAAGA,CAAC;QAAE,CAACJ,GAAG,GAAG;MAAK,CAAC,CAAC,CAAC;MAC7C,MAAM7F,GAAG,GAAG,MAAMC,KAAK,CAAC,cAAc+E,IAAI,CAACrF,EAAE,IAAIqF,IAAI,CAACE,GAAG,WAAW,EAAE;QACpEhF,MAAM,EAAE,MAAM;QACdC,OAAO,EAAE;UAAE,cAAc,EAAE,kBAAkB;UAAE,GAAGf;QAAW,CAAC;QAC9D8G,WAAW,EAAE;MACf,CAAC,CAAC;MACF,MAAM1F,IAAI,GAAG,MAAMR,GAAG,CAACS,IAAI,CAAC,CAAC;MAC7B,IAAI,CAACT,GAAG,CAACW,EAAE,EAAE,MAAM,IAAIwF,KAAK,CAAC,CAAA3F,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAEI,KAAK,KAAI,gBAAgB,CAAC;MAC7D,MAAMwF,IAAI,GAAG,OAAO5F,IAAI,CAAChB,MAAM,KAAK,QAAQ,GAAGgB,IAAI,CAAChB,MAAM,GAAGA,MAAM;MACnEK,KAAK,CAAC,+BAA+BzC,QAAQ,CAACgJ,IAAI,CAAC,EAAE,CAAC;MACtD,MAAMnC,YAAY,CAAC,CAAC;IACtB,CAAC,CAAC,OAAOoC,CAAC,EAAE;MACVxG,KAAK,CAACwG,CAAC,CAACC,OAAO,CAAC;IAClB,CAAC,SAAS;MACR1H,aAAa,CAAEqH,CAAC,KAAM;QAAE,GAAGA,CAAC;QAAE,CAACJ,GAAG,GAAG;MAAM,CAAC,CAAC,CAAC;IAChD;EACF,CAAC;;EAED;;EAEA,MAAMU,cAAc,GAAGA,CAACvB,IAAI,EAAEwB,QAAQ,EAAEvB,GAAG,KAAK;IAC9C,MAAMY,GAAG,GAAGd,OAAO,CAACC,IAAI,EAAEC,GAAG,CAAC;IAC9B,MAAMwB,UAAU,GAAG,CAAC,CAACvI,aAAa,CAAC2H,GAAG,CAAC;IACvC,MAAMa,UAAU,GAAGF,QAAQ,GAAGxB,IAAI,CAAC9C,YAAY,GAAG8C,IAAI,CAAChB,UAAU;IAEjE,MAAM2C,MAAM,GACV,CAACH,QAAQ,IACT,OAAOxB,IAAI,CAACc,iBAAiB,KAAK,QAAQ,IAC1Cd,IAAI,CAACc,iBAAiB,GAAG,CAAC,IAC1B,CAAC,CAACd,IAAI,CAAC4B,WAAW;IAEpB,MAAMC,UAAU,GACd,CAAC7B,IAAI,CAAC5C,MAAM,IAAI,EAAE,EAAEkB,WAAW,CAAC,CAAC,KAAK,QAAQ,GAC1C,uBAAuB,GACvB,yBAAyB;IAE/B,MAAMwD,UAAU,GAAG9B,IAAI,CAAC8B,UAAU,GAAG,IAAIC,IAAI,CAAC/B,IAAI,CAAC8B,UAAU,CAAC,CAACE,kBAAkB,CAAC,CAAC,GAAG,GAAG;IAEzF,oBACExK,OAAA;MAAKyK,SAAS,EAAC,SAAS;MAAAC,QAAA,gBACtB1K,OAAA;QAAKyK,SAAS,EAAC,aAAa;QAAAC,QAAA,gBAC1B1K,OAAA;UAAA0K,QAAA,gBACE1K,OAAA;YAAKyK,SAAS,EAAC,UAAU;YAAAC,QAAA,EAAEV,QAAQ,GAAG,UAAU,GAAG;UAAQ;YAAAW,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC,eAClE9K,OAAA;YAAKyK,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAER,UAAU,IAAI;UAAS;YAAAS,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7D,CAAC,eACN9K,OAAA;UAAA0K,QAAA,gBACE1K,OAAA;YAAKyK,SAAS,EAAC,UAAU;YAAAC,QAAA,EAAC;UAAM;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACtC9K,OAAA;YAAKyK,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAE9J,QAAQ,CAAC4H,IAAI,CAACxF,MAAM;UAAC;YAAA2H,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC3D,CAAC,eACN9K,OAAA;UAAA0K,QAAA,gBACE1K,OAAA;YAAKyK,SAAS,EAAC,UAAU;YAAAC,QAAA,EAAC;UAAW;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eAC3C9K,OAAA;YAAKyK,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAEJ;UAAU;YAAAK,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAChD,CAAC,eACN9K,OAAA;UAAK+K,KAAK,EAAE;YAAEC,SAAS,EAAE;UAAQ,CAAE;UAAAN,QAAA,eACjC1K,OAAA;YAAMyK,SAAS,EAAEJ,UAAW;YAAAK,QAAA,EAAElC,IAAI,CAAC5C,MAAM,IAAI;UAAG;YAAA+E,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAO;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACrD,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAEN9K,OAAA;QAAKyK,SAAS,EAAC,YAAY;QAAAC,QAAA,gBACzB1K,OAAA;UAAQiL,OAAO,EAAEA,CAAA,KAAMzI,eAAe,CAACgG,IAAI,CAACrF,EAAE,IAAIqF,IAAI,CAACE,GAAG,CAAE;UAAC+B,SAAS,EAAC,YAAY;UAACS,KAAK,EAAC,mBAAmB;UAAAR,QAAA,EAAC;QAE9G;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAQ,CAAC,eAET9K,OAAA;UAAQiL,OAAO,EAAEA,CAAA,KAAMrC,iBAAiB,CAACS,GAAG,CAAE;UAACoB,SAAS,EAAC,YAAY;UAAAC,QAAA,EAClET,UAAU,GAAG,kBAAkB,GAAG;QAAkB;UAAAU,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC/C,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,EAELb,UAAU,iBACTjK,OAAA;QAAKyK,SAAS,EAAC,YAAY;QAAAC,QAAA,GACxBlC,IAAI,CAAC5C,MAAM,iBACV5F,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAO;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAACtC,IAAI,CAAC5C,MAAM;QAAA;UAAA+E,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpC,CACJ,eACD9K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAc;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAC,OAAOtC,IAAI,CAACvF,YAAY,KAAK,QAAQ,GAAG,GAAGuF,IAAI,CAACvF,YAAY,GAAG,GAAG,GAAG;QAAA;UAAA0H,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACrG,CAAC,eACJ9K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAS;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAC,OAAOtC,IAAI,CAACtF,QAAQ,KAAK,QAAQ,GAAG,GAAGsF,IAAI,CAACtF,QAAQ,SAAS,GAAG,GAAG;QAAA;UAAAyH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC9F,CAAC,eACJ9K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAc;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAACtC,IAAI,CAAC4B,WAAW,GAAG,IAAIG,IAAI,CAAC/B,IAAI,CAAC4B,WAAW,CAAC,CAACI,kBAAkB,CAAC,CAAC,GAAG,GAAG;QAAA;UAAAG,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxG,CAAC,eACJ9K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAA0B;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAClK,QAAQ,CAAC4H,IAAI,CAACc,iBAAiB,CAAC;QAAA;UAAAqB,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC5E,CAAC,EAEHd,QAAQ,IAAI,OAAOxB,IAAI,CAAC2C,eAAe,KAAK,QAAQ,iBACnDnL,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAyB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAClK,QAAQ,CAAC4H,IAAI,CAAC2C,eAAe,CAAC;QAAA;UAAAR,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzE,CACJ,EAEA,CAACd,QAAQ,IAAIG,MAAM,iBAClBnK,OAAA;UAAKyK,SAAS,EAAC,MAAM;UAAAC,QAAA,eACnB1K,OAAA;YACEyK,SAAS,EAAC,oBAAoB;YAC9BQ,OAAO,EAAEA,CAAA,KAAM9B,OAAO,CAACX,IAAI,CAAE;YAC7B4C,QAAQ,EAAE,CAAC,CAACjJ,UAAU,CAACkH,GAAG,CAAE;YAC5B6B,KAAK,EAAC,sBAAsB;YAAAR,QAAA,EAE3BvI,UAAU,CAACkH,GAAG,CAAC,GAAG,aAAa,GAAG;UAAiB;YAAAsB,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAC9C;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACN,CACN;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACE,CACN;IAAA,GApE2BzB,GAAG;MAAAsB,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAqE5B,CAAC;EAEV,CAAC;;EAED;EACA,MAAMO,qBAAqB,GAAItI,GAAG,IAAK;IAAA,IAAAuI,WAAA;IACrC,MAAMrB,UAAU,GAAG,CAAC,CAACvI,aAAa,CAACqB,GAAG,CAACI,EAAE,CAAC;IAC1C,MAAMoE,WAAW,GAAGxE,GAAG,CAACkC,UAAU,KAAKtC,EAAE;IAEzC,MAAMqF,EAAE,GAAGpG,WAAW,CAACmB,GAAG,CAACI,EAAE,CAAC,IAAI;MAAEH,MAAM,EAAED,GAAG,CAACC,MAAM,IAAI,CAAC;MAAEC,YAAY,EAAEF,GAAG,CAACE,YAAY,IAAI,CAAC;MAAEC,QAAQ,EAAEH,GAAG,CAACG,QAAQ,IAAI;IAAE,CAAC;IAE/H,MAAMqI,QAAQ,GAAIC,KAAK,IACrB3J,cAAc,CAAE4H,CAAC,KAAM;MACrB,GAAGA,CAAC;MACJ,CAAC1G,GAAG,CAACI,EAAE,GAAG;QAAE,IAAIsG,CAAC,CAAC1G,GAAG,CAACI,EAAE,CAAC,IAAI,CAAC,CAAC,CAAC;QAAE,GAAGqI;MAAM;IAC7C,CAAC,CAAC,CAAC;IAEL,oBACExL,OAAA;MAAKyK,SAAS,EAAC,SAAS;MAAAC,QAAA,gBAEtB1K,OAAA;QAAKyK,SAAS,EAAC,aAAa;QAAAC,QAAA,gBAC1B1K,OAAA;UAAA0K,QAAA,gBACE1K,OAAA;YAAKyK,SAAS,EAAC,UAAU;YAAAC,QAAA,EAAC;UAAQ;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACxC9K,OAAA;YAAKyK,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAE3H,GAAG,CAAC2C,YAAY,IAAI;UAAK;YAAAiF,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC/D,CAAC,eACN9K,OAAA;UAAA0K,QAAA,gBACE1K,OAAA;YAAKyK,SAAS,EAAC,UAAU;YAAAC,QAAA,EAAC;UAAM;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACtC9K,OAAA;YAAKyK,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAE9J,QAAQ,CAACmC,GAAG,CAACC,MAAM;UAAC;YAAA2H,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC1D,CAAC,eACN9K,OAAA;UAAA0K,QAAA,gBACE1K,OAAA;YAAKyK,SAAS,EAAC,UAAU;YAAAC,QAAA,EAAC;UAAO;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAK,CAAC,eACvC9K,OAAA;YAAKyK,SAAS,EAAC,iBAAiB;YAAAC,QAAA,EAAE3H,GAAG,CAAC0C,SAAS,GAAG,IAAI8E,IAAI,CAACxH,GAAG,CAAC0C,SAAS,CAAC,CAAC+E,kBAAkB,CAAC,CAAC,GAAG;UAAG;YAAAG,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACxG,CAAC,eACN9K,OAAA;UAAK+K,KAAK,EAAE;YAAEC,SAAS,EAAE;UAAQ,CAAE;UAAAN,QAAA,eACjC1K,OAAA;YAAMyK,SAAS,EAAC,yBAAyB;YAAAC,QAAA,EAAC;UAAI;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAM;QAAC;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAClD,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CAAC,eAGN9K,OAAA;QAAKyK,SAAS,EAAC,YAAY;QAAAC,QAAA,eACzB1K,OAAA;UAAQyK,SAAS,EAAC,YAAY;UAACQ,OAAO,EAAEA,CAAA,KAAMrC,iBAAiB,CAAC7F,GAAG,CAACI,EAAE,CAAE;UAAC+H,KAAK,EAAC,sBAAsB;UAAAR,QAAA,EAClGT,UAAU,GAAG,SAAS,GAAG;QAAS;UAAAU,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7B;MAAC;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACN,CAAC,EAGLb,UAAU,iBACTjK,OAAA;QAAKyK,SAAS,EAAC,YAAY;QAAAC,QAAA,gBACzB1K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAO;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,GAAAQ,WAAA,GAACvI,GAAG,CAAC6C,MAAM,cAAA0F,WAAA,cAAAA,WAAA,GAAI,MAAM;QAAA;UAAAX,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC7C,CAAC,eACJ9K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAc;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAChK,MAAM,CAACsC,QAAQ,CAACL,GAAG,CAACE,YAAY,CAAC,GAAG,GAAGF,GAAG,CAACE,YAAY,GAAG,GAAG,GAAG;QAAA;UAAA0H,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAChG,CAAC,eACJ9K,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAS;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAChK,MAAM,CAACsC,QAAQ,CAACL,GAAG,CAACG,QAAQ,CAAC,GAAG,GAAGH,GAAG,CAACG,QAAQ,SAAS,GAAG,GAAG;QAAA;UAAAyH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACzF,CAAC,EACH/H,GAAG,CAACyC,OAAO,gBACVxF,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAO;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAC/H,GAAG,CAACyC,OAAO;QAAA;UAAAmF,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACpC,CAAC,GACF,IAAI,EACP/H,GAAG,CAACyE,UAAU,gBACbxH,OAAA;UAAGyK,SAAS,EAAC,MAAM;UAAAC,QAAA,gBACjB1K,OAAA;YAAA0K,QAAA,EAAQ;UAAiB;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,KAAC,EAAC/H,GAAG,CAACyE,UAAU;QAAA;UAAAmD,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACjD,CAAC,GACF,IAAI,eAGR9K,OAAA;UAAKyK,SAAS,EAAC,oBAAoB;UAAAC,QAAA,gBACjC1K,OAAA;YAAA0K,QAAA,gBACE1K,OAAA;cAAOyK,SAAS,EAAC,UAAU;cAAAC,QAAA,EAAC;YAAY;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAChD9K,OAAA;cACEuD,IAAI,EAAC,QAAQ;cACbkI,GAAG,EAAC,GAAG;cACPhB,SAAS,EAAC,UAAU;cACpBiB,KAAK,EAAE1D,EAAE,CAAChF,MAAO;cACjB2I,QAAQ,EAAG9B,CAAC,IAAK0B,QAAQ,CAAC;gBAAEvI,MAAM,EAAElC,MAAM,CAAC+I,CAAC,CAAC+B,MAAM,CAACF,KAAK;cAAE,CAAC;YAAE;cAAAf,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAC/D,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC,eACN9K,OAAA;YAAA0K,QAAA,gBACE1K,OAAA;cAAOyK,SAAS,EAAC,UAAU;cAAAC,QAAA,EAAC;YAAO;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC3C9K,OAAA;cACEuD,IAAI,EAAC,QAAQ;cACbkI,GAAG,EAAC,GAAG;cACPI,IAAI,EAAC,KAAK;cACVpB,SAAS,EAAC,UAAU;cACpBiB,KAAK,EAAE1D,EAAE,CAAC/E,YAAa;cACvB0I,QAAQ,EAAG9B,CAAC,IAAK0B,QAAQ,CAAC;gBAAEtI,YAAY,EAAEnC,MAAM,CAAC+I,CAAC,CAAC+B,MAAM,CAACF,KAAK;cAAE,CAAC;YAAE;cAAAf,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACrE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC,eACN9K,OAAA;YAAA0K,QAAA,gBACE1K,OAAA;cAAOyK,SAAS,EAAC,UAAU;cAAAC,QAAA,EAAC;YAAM;cAAAC,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OAAO,CAAC,eAC1C9K,OAAA;cACEuD,IAAI,EAAC,QAAQ;cACbkI,GAAG,EAAC,GAAG;cACPK,GAAG,EAAC,IAAI;cACRrB,SAAS,EAAC,UAAU;cACpBiB,KAAK,EAAE1D,EAAE,CAAC9E,QAAS;cACnByI,QAAQ,EAAG9B,CAAC,IAAK0B,QAAQ,CAAC;gBAAErI,QAAQ,EAAEpC,MAAM,CAAC+I,CAAC,CAAC+B,MAAM,CAACF,KAAK;cAAE,CAAC;YAAE;cAAAf,QAAA,EAAAC,YAAA;cAAAC,UAAA;cAAAC,YAAA;YAAA,OACjE,CAAC;UAAA;YAAAH,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OACC,CAAC;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACH,CAAC,eAEN9K,OAAA;UAAKyK,SAAS,EAAC,iBAAiB;UAAAC,QAAA,gBAC9B1K,OAAA;YACEyK,SAAS,EAAC,YAAY;YACtBQ,OAAO,EAAE,MAAAA,CAAA,KAAY;cACnB,IAAI,MAAMnI,SAAS,CAACC,GAAG,CAAC,EAAE0E,YAAY,CAAC,CAAC;YAC1C,CAAE;YACFyD,KAAK,EAAC,oBAAoB;YAAAR,QAAA,EAC3B;UAED;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,eAGT9K,OAAA;YACEyK,SAAS,EAAC,oBAAoB;YAC9BQ,OAAO,EAAE,MAAAA,CAAA,KAAY;cACnB,IAAI,MAAM5G,aAAa,CAACtB,GAAG,CAAC,EAAE0E,YAAY,CAAC,CAAC;YAC9C,CAAE;YACFyD,KAAK,EAAC,cAAc;YAAAR,QAAA,EACrB;UAED;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CAAC,EAGRvD,WAAW,iBACVvH,OAAA;YACEyK,SAAS,EAAC,YAAY;YACtBQ,OAAO,EAAE,MAAAA,CAAA,KAAY;cACnB,IAAI,CAAC1B,MAAM,CAACC,OAAO,CAAC,sBAAsB,CAAC,EAAE;cAC7C,IAAI,MAAMlF,aAAa,CAACvB,GAAG,CAAC,EAAE0E,YAAY,CAAC,CAAC;YAC9C,CAAE;YACFyD,KAAK,EAAC,gBAAgB;YAAAR,QAAA,EACvB;UAED;YAAAC,QAAA,EAAAC,YAAA;YAAAC,UAAA;YAAAC,YAAA;UAAA,OAAQ,CACT;QAAA;UAAAH,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACE,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACH,CACN;IAAA,GA3H2B/H,GAAG,CAACI,EAAE;MAAAwH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OA4H/B,CAAC;EAEV,CAAC;EAED,IAAItJ,OAAO,EAAE,oBAAOxB,OAAA;IAAGyK,SAAS,EAAC,yBAAyB;IAAAC,QAAA,EAAC;EAAwB;IAAAC,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAAG,CAAC;EAEvF,MAAM7I,KAAK,GAAG2C,KAAK,CAACC,OAAO,CAAC1D,OAAO,CAACE,UAAU,CAAC,GAAGF,OAAO,CAACE,UAAU,GAAG,EAAE;EACzE,MAAMa,QAAQ,GAAG0C,KAAK,CAACC,OAAO,CAAC1D,OAAO,CAACG,aAAa,CAAC,GAAGH,OAAO,CAACG,aAAa,GAAG,EAAE;EAClF,MAAMyK,MAAM,GAAGnH,KAAK,CAACC,OAAO,CAAC1D,OAAO,CAACI,cAAc,CAAC,GAAGJ,OAAO,CAACI,cAAc,GAAG,EAAE;EAElF,oBACEvB,OAAA;IAAKyK,SAAS,EAAC,cAAc;IAAAC,QAAA,gBAC3B1K,OAAA;MAAIyK,SAAS,EAAC,YAAY;MAAAC,QAAA,EAAC;IAAmB;MAAAC,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAI,CAAC,eAGnD9K,OAAA;MAAKyK,SAAS,EAAC,YAAY;MAAAC,QAAA,gBACzB1K,OAAA;QACEyK,SAAS,EAAC,iBAAiB;QAC3BQ,OAAO,EAAEA,CAAA,KAAMlJ,UAAU,CAAEiK,CAAC,KAAM;UAAE,GAAGA,CAAC;UAAEhK,IAAI,EAAE,CAACgK,CAAC,CAAChK;QAAK,CAAC,CAAC,CAAE;QAC5D,iBAAeF,OAAO,CAACE,IAAK;QAAA0I,QAAA,gBAE5B1K,OAAA;UAAKyK,SAAS,EAAC,eAAe;UAAAC,QAAA,EAAC;QAAqB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,eAC1D9K,OAAA;UAAKyK,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAE5I,OAAO,CAACE,IAAI,GAAG,GAAG,GAAG;QAAG;UAAA2I,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACpD,CAAC,EACRhJ,OAAO,CAACE,IAAI,iBACXhC,OAAA;QAAKyK,SAAS,EAAC,iBAAiB;QAAAC,QAAA,EAC7BqB,MAAM,CAACE,MAAM,KAAK,CAAC,gBAAGjM,OAAA;UAAGyK,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAC;QAA0B;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,GAAGiB,MAAM,CAAC5G,GAAG,CAACkG,qBAAqB;MAAC;QAAAV,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9G,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,eAGN9K,OAAA;MAAKyK,SAAS,EAAC,YAAY;MAAAC,QAAA,gBACzB1K,OAAA;QAAQyK,SAAS,EAAC,iBAAiB;QAACQ,OAAO,EAAEA,CAAA,KAAMlJ,UAAU,CAAEiK,CAAC,KAAM;UAAE,GAAGA,CAAC;UAAE/J,KAAK,EAAE,CAAC+J,CAAC,CAAC/J;QAAM,CAAC,CAAC,CAAE;QAAC,iBAAeH,OAAO,CAACG,KAAM;QAAAyI,QAAA,gBAC9H1K,OAAA;UAAKyK,SAAS,EAAC,eAAe;UAAAC,QAAA,EAAC;QAA4B;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,eACjE9K,OAAA;UAAKyK,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAE5I,OAAO,CAACG,KAAK,GAAG,GAAG,GAAG;QAAG;UAAA0I,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACrD,CAAC,EACRhJ,OAAO,CAACG,KAAK,iBACZjC,OAAA;QAAKyK,SAAS,EAAC,iBAAiB;QAAAC,QAAA,EAC7BzI,KAAK,CAACgK,MAAM,KAAK,CAAC,gBAAGjM,OAAA;UAAGyK,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAC;QAAmB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,GAAG7I,KAAK,CAACkD,GAAG,CAAC,CAACqD,IAAI,EAAEC,GAAG,KAAKsB,cAAc,CAACvB,IAAI,EAAE,IAAI,EAAEC,GAAG,CAAC;MAAC;QAAAkC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAC9H,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,eAGN9K,OAAA;MAAKyK,SAAS,EAAC,YAAY;MAAAC,QAAA,gBACzB1K,OAAA;QACEyK,SAAS,EAAC,iBAAiB;QAC3BQ,OAAO,EAAEA,CAAA,KAAMlJ,UAAU,CAAEiK,CAAC,KAAM;UAAE,GAAGA,CAAC;UAAE9J,QAAQ,EAAE,CAAC8J,CAAC,CAAC9J;QAAS,CAAC,CAAC,CAAE;QACpE,iBAAeJ,OAAO,CAACI,QAAS;QAAAwI,QAAA,gBAEhC1K,OAAA;UAAKyK,SAAS,EAAC,eAAe;UAAAC,QAAA,EAAC;QAAiC;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAK,CAAC,eACtE9K,OAAA;UAAKyK,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAE5I,OAAO,CAACI,QAAQ,GAAG,GAAG,GAAG;QAAG;UAAAyI,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAM,CAAC;MAAA;QAAAH,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxD,CAAC,EACRhJ,OAAO,CAACI,QAAQ,iBACflC,OAAA;QAAKyK,SAAS,EAAC,iBAAiB;QAAAC,QAAA,EAC7BxI,QAAQ,CAAC+J,MAAM,KAAK,CAAC,gBAAGjM,OAAA;UAAGyK,SAAS,EAAC,UAAU;UAAAC,QAAA,EAAC;QAAsB;UAAAC,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAAG,CAAC,GAAG5I,QAAQ,CAACiD,GAAG,CAAC,CAACqD,IAAI,EAAEC,GAAG,KAAKsB,cAAc,CAACvB,IAAI,EAAE,KAAK,EAAEC,GAAG,CAAC;MAAC;QAAAkC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OACxI,CACN;IAAA;MAAAH,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OACE,CAAC,EAELzI,aAAa,iBAAIrC,OAAA,CAACH,gBAAgB;MAACc,MAAM,EAAE0B,aAAc;MAAC6J,OAAO,EAAEA,CAAA,KAAM5J,gBAAgB,CAAC,IAAI;IAAE;MAAAqI,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC,EAEnGvI,YAAY,iBAAIvC,OAAA,CAACF,eAAe;MAACqM,MAAM,EAAE5J,YAAa;MAAC2J,OAAO,EAAEA,CAAA,KAAM1J,eAAe,CAAC,IAAI;IAAE;MAAAmI,QAAA,EAAAC,YAAA;MAAAC,UAAA;MAAAC,YAAA;IAAA,OAAE,CAAC;EAAA;IAAAH,QAAA,EAAAC,YAAA;IAAAC,UAAA;IAAAC,YAAA;EAAA,OAC7F,CAAC;AAEV,CAAC;AAAC5J,EAAA,CAjkBID,YAAY;EAAA,QAuBCrB,WAAW;AAAA;AAAAwM,EAAA,GAvBxBnL,YAAY;AAmkBlB,eAAeA,YAAY;AAAC,IAAAmL,EAAA;AAAAC,YAAA,CAAAD,EAAA","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}