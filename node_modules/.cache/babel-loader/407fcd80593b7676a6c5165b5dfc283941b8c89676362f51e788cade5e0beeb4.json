{"ast":null,"code":"var _import$meta$env;\n// src/features/wallet/walletApi.js\n\n// Optional: point to another origin (e.g., when the API runs on :5050)\nconst API_BASE = typeof import.meta !== 'undefined' && ((_import$meta$env = import.meta.env) === null || _import$meta$env === void 0 ? void 0 : _import$meta$env.VITE_API_URL) || process.env.REACT_APP_API_URL || ''; // '' means same origin (proxy or dev server)\n\nfunction cleanToken() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, ''); // remove accidental JSON quotes\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\n  return t || null;\n}\nasync function http(path, opts = {}) {\n  const token = cleanToken();\n  const res = await fetch(`${API_BASE}${path}`, {\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token ? {\n        Authorization: `Bearer ${token}`\n      } : {}),\n      ...(opts.headers || {})\n    },\n    ...opts\n  });\n  let data = null;\n  try {\n    data = await res.json();\n  } catch {/* non-JSON */}\n  if (!res.ok) {\n    var _data, _data2;\n    const msg = ((_data = data) === null || _data === void 0 ? void 0 : _data.error) || ((_data2 = data) === null || _data2 === void 0 ? void 0 : _data2.message) || `${res.status} ${res.statusText}`;\n    throw new Error(msg);\n  }\n  return data;\n}\n\n/* ---------------- Public API ---------------- */\n\n// GET /api/wallet/me  -> { availableCents, pendingCents }\nexport function fetchWallet() {\n  return http('/api/wallet/me');\n}\n\n/**\n * POST /api/wallet/deposit-intent\n *\n * Preferred: pass cents: createDepositIntent({ amountCents: 2500 })\n * Backcompat: pass dollars: createDepositIntent({ amountDollars: 25 })\n *\n * Returns: { clientSecret, ledgerId }  (or { simulated: true, ledgerId } in dev)\n */\nexport function createDepositIntent({\n  amountCents,\n  amountDollars\n} = {}) {\n  // normalize to what your backend expects right now\n  // If your backend expects \"amount\" in dollars, keep sending dollars.\n  // If you switch backend to cents, change payload below accordingly.\n  let payload;\n  if (Number.isFinite(amountCents)) {\n    // sending cents — safer for money\n    // --- If your backend expects dollars today, convert here:\n    const dollars = Math.round(amountCents) / 100;\n    payload = {\n      amount: dollars\n    }; // <-- backend currently expects \"amount\" in dollars\n  } else if (Number.isFinite(amountDollars)) {\n    payload = {\n      amount: amountDollars\n    };\n  } else {\n    throw new Error('Provide amountCents or amountDollars');\n  }\n  return http('/api/wallet/deposit-intent', {\n    method: 'POST',\n    body: JSON.stringify(payload)\n  });\n}\n\n/**\n * POST /api/wallet/deposit/confirm\n * Dev helper to force-confirm a simulated deposit.\n * Body: { ledgerId }\n * Returns: { ok: true, available }\n */\nexport function devConfirmDeposit(ledgerId) {\n  return http('/api/wallet/deposit/confirm', {\n    method: 'POST',\n    body: JSON.stringify({\n      ledgerId\n    })\n  });\n}","map":{"version":3,"names":["API_BASE","import","meta","_import$meta$env","env","VITE_API_URL","process","REACT_APP_API_URL","cleanToken","t","localStorage","getItem","replace","toLowerCase","startsWith","slice","http","path","opts","token","res","fetch","credentials","headers","Authorization","data","json","ok","_data","_data2","msg","error","message","status","statusText","Error","fetchWallet","createDepositIntent","amountCents","amountDollars","payload","Number","isFinite","dollars","Math","round","amount","method","body","JSON","stringify","devConfirmDeposit","ledgerId"],"sources":["/Users/alabamalewis/Desktop/PeerFund/p2p_contract_frontend/src/features/wallet/walletApi.js"],"sourcesContent":["// src/features/wallet/walletApi.js\n\n// Optional: point to another origin (e.g., when the API runs on :5050)\nconst API_BASE =\n  (typeof import.meta !== 'undefined' && import.meta.env?.VITE_API_URL) ||\n  process.env.REACT_APP_API_URL ||\n  ''; // '' means same origin (proxy or dev server)\n\nfunction cleanToken() {\n  let t = localStorage.getItem('token') || '';\n  t = t.replace(/^\"|\"$/g, ''); // remove accidental JSON quotes\n  if (t.toLowerCase().startsWith('bearer ')) t = t.slice(7);\n  return t || null;\n}\n\nasync function http(path, opts = {}) {\n  const token = cleanToken();\n  const res = await fetch(`${API_BASE}${path}`, {\n    credentials: 'include',\n    headers: {\n      'Content-Type': 'application/json',\n      ...(token ? { Authorization: `Bearer ${token}` } : {}),\n      ...(opts.headers || {}),\n    },\n    ...opts,\n  });\n\n  let data = null;\n  try { data = await res.json(); } catch { /* non-JSON */ }\n\n  if (!res.ok) {\n    const msg = data?.error || data?.message || `${res.status} ${res.statusText}`;\n    throw new Error(msg);\n  }\n  return data;\n}\n\n/* ---------------- Public API ---------------- */\n\n// GET /api/wallet/me  -> { availableCents, pendingCents }\nexport function fetchWallet() {\n  return http('/api/wallet/me');\n}\n\n/**\n * POST /api/wallet/deposit-intent\n *\n * Preferred: pass cents: createDepositIntent({ amountCents: 2500 })\n * Backcompat: pass dollars: createDepositIntent({ amountDollars: 25 })\n *\n * Returns: { clientSecret, ledgerId }  (or { simulated: true, ledgerId } in dev)\n */\nexport function createDepositIntent({ amountCents, amountDollars } = {}) {\n  // normalize to what your backend expects right now\n  // If your backend expects \"amount\" in dollars, keep sending dollars.\n  // If you switch backend to cents, change payload below accordingly.\n  let payload;\n  if (Number.isFinite(amountCents)) {\n    // sending cents — safer for money\n    // --- If your backend expects dollars today, convert here:\n    const dollars = Math.round(amountCents) / 100;\n    payload = { amount: dollars }; // <-- backend currently expects \"amount\" in dollars\n  } else if (Number.isFinite(amountDollars)) {\n    payload = { amount: amountDollars };\n  } else {\n    throw new Error('Provide amountCents or amountDollars');\n  }\n\n  return http('/api/wallet/deposit-intent', {\n    method: 'POST',\n    body: JSON.stringify(payload),\n  });\n}\n\n/**\n * POST /api/wallet/deposit/confirm\n * Dev helper to force-confirm a simulated deposit.\n * Body: { ledgerId }\n * Returns: { ok: true, available }\n */\nexport function devConfirmDeposit(ledgerId) {\n  return http('/api/wallet/deposit/confirm', {\n    method: 'POST',\n    body: JSON.stringify({ ledgerId }),\n  });\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}